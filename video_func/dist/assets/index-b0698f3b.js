(function(){const s=document.createElement("link").relList;if(s&&s.supports&&s.supports("modulepreload"))return;for(const p of document.querySelectorAll('link[rel="modulepreload"]'))l(p);new MutationObserver(p=>{for(const _ of p)if(_.type==="childList")for(const y of _.addedNodes)y.tagName==="LINK"&&y.rel==="modulepreload"&&l(y)}).observe(document,{childList:!0,subtree:!0});function c(p){const _={};return p.integrity&&(_.integrity=p.integrity),p.referrerPolicy&&(_.referrerPolicy=p.referrerPolicy),p.crossOrigin==="use-credentials"?_.credentials="include":p.crossOrigin==="anonymous"?_.credentials="omit":_.credentials="same-origin",_}function l(p){if(p.ep)return;p.ep=!0;const _=c(p);fetch(p.href,_)}})();var Jn=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof global<"u"?global:typeof self<"u"?self:{};function ZN(i){return i&&i.__esModule&&Object.prototype.hasOwnProperty.call(i,"default")?i.default:i}var eb={exports:{}},op={},tb={exports:{}},lt={};/**
 * @license React
 * react.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var dl=Symbol.for("react.element"),a3=Symbol.for("react.portal"),c3=Symbol.for("react.fragment"),d3=Symbol.for("react.strict_mode"),l3=Symbol.for("react.profiler"),u3=Symbol.for("react.provider"),h3=Symbol.for("react.context"),p3=Symbol.for("react.forward_ref"),f3=Symbol.for("react.suspense"),m3=Symbol.for("react.memo"),E3=Symbol.for("react.lazy"),O0=Symbol.iterator;function _3(i){return i===null||typeof i!="object"?null:(i=O0&&i[O0]||i["@@iterator"],typeof i=="function"?i:null)}var nb={isMounted:function(){return!1},enqueueForceUpdate:function(){},enqueueReplaceState:function(){},enqueueSetState:function(){}},rb=Object.assign,ib={};function Dc(i,s,c){this.props=i,this.context=s,this.refs=ib,this.updater=c||nb}Dc.prototype.isReactComponent={};Dc.prototype.setState=function(i,s){if(typeof i!="object"&&typeof i!="function"&&i!=null)throw Error("setState(...): takes an object of state variables to update or a function which returns an object of state variables.");this.updater.enqueueSetState(this,i,s,"setState")};Dc.prototype.forceUpdate=function(i){this.updater.enqueueForceUpdate(this,i,"forceUpdate")};function ob(){}ob.prototype=Dc.prototype;function Ng(i,s,c){this.props=i,this.context=s,this.refs=ib,this.updater=c||nb}var bg=Ng.prototype=new ob;bg.constructor=Ng;rb(bg,Dc.prototype);bg.isPureReactComponent=!0;var w0=Array.isArray,sb=Object.prototype.hasOwnProperty,Dg={current:null},ab={key:!0,ref:!0,__self:!0,__source:!0};function cb(i,s,c){var l,p={},_=null,y=null;if(s!=null)for(l in s.ref!==void 0&&(y=s.ref),s.key!==void 0&&(_=""+s.key),s)sb.call(s,l)&&!ab.hasOwnProperty(l)&&(p[l]=s[l]);var C=arguments.length-2;if(C===1)p.children=c;else if(1<C){for(var L=Array(C),U=0;U<C;U++)L[U]=arguments[U+2];p.children=L}if(i&&i.defaultProps)for(l in C=i.defaultProps,C)p[l]===void 0&&(p[l]=C[l]);return{$$typeof:dl,type:i,key:_,ref:y,props:p,_owner:Dg.current}}function g3(i,s){return{$$typeof:dl,type:i.type,key:s,ref:i.ref,props:i.props,_owner:i._owner}}function Pg(i){return typeof i=="object"&&i!==null&&i.$$typeof===dl}function S3(i){var s={"=":"=0",":":"=2"};return"$"+i.replace(/[=:]/g,function(c){return s[c]})}var N0=/\/+/g;function t_(i,s){return typeof i=="object"&&i!==null&&i.key!=null?S3(""+i.key):s.toString(36)}function mh(i,s,c,l,p){var _=typeof i;(_==="undefined"||_==="boolean")&&(i=null);var y=!1;if(i===null)y=!0;else switch(_){case"string":case"number":y=!0;break;case"object":switch(i.$$typeof){case dl:case a3:y=!0}}if(y)return y=i,p=p(y),i=l===""?"."+t_(y,0):l,w0(p)?(c="",i!=null&&(c=i.replace(N0,"$&/")+"/"),mh(p,s,c,"",function(U){return U})):p!=null&&(Pg(p)&&(p=g3(p,c+(!p.key||y&&y.key===p.key?"":(""+p.key).replace(N0,"$&/")+"/")+i)),s.push(p)),1;if(y=0,l=l===""?".":l+":",w0(i))for(var C=0;C<i.length;C++){_=i[C];var L=l+t_(_,C);y+=mh(_,s,c,L,p)}else if(L=_3(i),typeof L=="function")for(i=L.call(i),C=0;!(_=i.next()).done;)_=_.value,L=l+t_(_,C++),y+=mh(_,s,c,L,p);else if(_==="object")throw s=String(i),Error("Objects are not valid as a React child (found: "+(s==="[object Object]"?"object with keys {"+Object.keys(i).join(", ")+"}":s)+"). If you meant to render a collection of children, use an array instead.");return y}function Qu(i,s,c){if(i==null)return i;var l=[],p=0;return mh(i,l,"","",function(_){return s.call(c,_,p++)}),l}function T3(i){if(i._status===-1){var s=i._result;s=s(),s.then(function(c){(i._status===0||i._status===-1)&&(i._status=1,i._result=c)},function(c){(i._status===0||i._status===-1)&&(i._status=2,i._result=c)}),i._status===-1&&(i._status=0,i._result=s)}if(i._status===1)return i._result.default;throw i._result}var Sr={current:null},Eh={transition:null},v3={ReactCurrentDispatcher:Sr,ReactCurrentBatchConfig:Eh,ReactCurrentOwner:Dg};lt.Children={map:Qu,forEach:function(i,s,c){Qu(i,function(){s.apply(this,arguments)},c)},count:function(i){var s=0;return Qu(i,function(){s++}),s},toArray:function(i){return Qu(i,function(s){return s})||[]},only:function(i){if(!Pg(i))throw Error("React.Children.only expected to receive a single React element child.");return i}};lt.Component=Dc;lt.Fragment=c3;lt.Profiler=l3;lt.PureComponent=Ng;lt.StrictMode=d3;lt.Suspense=f3;lt.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=v3;lt.cloneElement=function(i,s,c){if(i==null)throw Error("React.cloneElement(...): The argument must be a React element, but you passed "+i+".");var l=rb({},i.props),p=i.key,_=i.ref,y=i._owner;if(s!=null){if(s.ref!==void 0&&(_=s.ref,y=Dg.current),s.key!==void 0&&(p=""+s.key),i.type&&i.type.defaultProps)var C=i.type.defaultProps;for(L in s)sb.call(s,L)&&!ab.hasOwnProperty(L)&&(l[L]=s[L]===void 0&&C!==void 0?C[L]:s[L])}var L=arguments.length-2;if(L===1)l.children=c;else if(1<L){C=Array(L);for(var U=0;U<L;U++)C[U]=arguments[U+2];l.children=C}return{$$typeof:dl,type:i.type,key:p,ref:_,props:l,_owner:y}};lt.createContext=function(i){return i={$$typeof:h3,_currentValue:i,_currentValue2:i,_threadCount:0,Provider:null,Consumer:null,_defaultValue:null,_globalName:null},i.Provider={$$typeof:u3,_context:i},i.Consumer=i};lt.createElement=cb;lt.createFactory=function(i){var s=cb.bind(null,i);return s.type=i,s};lt.createRef=function(){return{current:null}};lt.forwardRef=function(i){return{$$typeof:p3,render:i}};lt.isValidElement=Pg;lt.lazy=function(i){return{$$typeof:E3,_payload:{_status:-1,_result:i},_init:T3}};lt.memo=function(i,s){return{$$typeof:m3,type:i,compare:s===void 0?null:s}};lt.startTransition=function(i){var s=Eh.transition;Eh.transition={};try{i()}finally{Eh.transition=s}};lt.unstable_act=function(){throw Error("act(...) is not supported in production builds of React.")};lt.useCallback=function(i,s){return Sr.current.useCallback(i,s)};lt.useContext=function(i){return Sr.current.useContext(i)};lt.useDebugValue=function(){};lt.useDeferredValue=function(i){return Sr.current.useDeferredValue(i)};lt.useEffect=function(i,s){return Sr.current.useEffect(i,s)};lt.useId=function(){return Sr.current.useId()};lt.useImperativeHandle=function(i,s,c){return Sr.current.useImperativeHandle(i,s,c)};lt.useInsertionEffect=function(i,s){return Sr.current.useInsertionEffect(i,s)};lt.useLayoutEffect=function(i,s){return Sr.current.useLayoutEffect(i,s)};lt.useMemo=function(i,s){return Sr.current.useMemo(i,s)};lt.useReducer=function(i,s,c){return Sr.current.useReducer(i,s,c)};lt.useRef=function(i){return Sr.current.useRef(i)};lt.useState=function(i){return Sr.current.useState(i)};lt.useSyncExternalStore=function(i,s,c){return Sr.current.useSyncExternalStore(i,s,c)};lt.useTransition=function(){return Sr.current.useTransition()};lt.version="18.2.0";tb.exports=lt;var dr=tb.exports;const y3=ZN(dr);/**
 * @license React
 * react-jsx-runtime.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var R3=dr,C3=Symbol.for("react.element"),I3=Symbol.for("react.fragment"),A3=Object.prototype.hasOwnProperty,O3=R3.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED.ReactCurrentOwner,w3={key:!0,ref:!0,__self:!0,__source:!0};function db(i,s,c){var l,p={},_=null,y=null;c!==void 0&&(_=""+c),s.key!==void 0&&(_=""+s.key),s.ref!==void 0&&(y=s.ref);for(l in s)A3.call(s,l)&&!w3.hasOwnProperty(l)&&(p[l]=s[l]);if(i&&i.defaultProps)for(l in s=i.defaultProps,s)p[l]===void 0&&(p[l]=s[l]);return{$$typeof:C3,type:i,key:_,ref:y,props:p,_owner:O3.current}}op.Fragment=I3;op.jsx=db;op.jsxs=db;eb.exports=op;var Lt=eb.exports,P_={},lb={exports:{}},ii={},ub={exports:{}},hb={};/**
 * @license React
 * scheduler.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */(function(i){function s(ge,Le){var Ve=ge.length;ge.push(Le);e:for(;0<Ve;){var Nt=Ve-1>>>1,mt=ge[Nt];if(0<p(mt,Le))ge[Nt]=Le,ge[Ve]=mt,Ve=Nt;else break e}}function c(ge){return ge.length===0?null:ge[0]}function l(ge){if(ge.length===0)return null;var Le=ge[0],Ve=ge.pop();if(Ve!==Le){ge[0]=Ve;e:for(var Nt=0,mt=ge.length,Lo=mt>>>1;Nt<Lo;){var fn=2*(Nt+1)-1,Ci=ge[fn],$n=fn+1,Ii=ge[$n];if(0>p(Ci,Ve))$n<mt&&0>p(Ii,Ci)?(ge[Nt]=Ii,ge[$n]=Ve,Nt=$n):(ge[Nt]=Ci,ge[fn]=Ve,Nt=fn);else if($n<mt&&0>p(Ii,Ve))ge[Nt]=Ii,ge[$n]=Ve,Nt=$n;else break e}}return Le}function p(ge,Le){var Ve=ge.sortIndex-Le.sortIndex;return Ve!==0?Ve:ge.id-Le.id}if(typeof performance=="object"&&typeof performance.now=="function"){var _=performance;i.unstable_now=function(){return _.now()}}else{var y=Date,C=y.now();i.unstable_now=function(){return y.now()-C}}var L=[],U=[],G=1,F=null,H=3,ne=!1,W=!1,ie=!1,Ie=typeof setTimeout=="function"?setTimeout:null,B=typeof clearTimeout=="function"?clearTimeout:null,P=typeof setImmediate<"u"?setImmediate:null;typeof navigator<"u"&&navigator.scheduling!==void 0&&navigator.scheduling.isInputPending!==void 0&&navigator.scheduling.isInputPending.bind(navigator.scheduling);function M(ge){for(var Le=c(U);Le!==null;){if(Le.callback===null)l(U);else if(Le.startTime<=ge)l(U),Le.sortIndex=Le.expirationTime,s(L,Le);else break;Le=c(U)}}function j(ge){if(ie=!1,M(ge),!W)if(c(L)!==null)W=!0,Fr(J);else{var Le=c(U);Le!==null&&ao(j,Le.startTime-ge)}}function J(ge,Le){W=!1,ie&&(ie=!1,B(me),me=-1),ne=!0;var Ve=H;try{for(M(Le),F=c(L);F!==null&&(!(F.expirationTime>Le)||ge&&!Ye());){var Nt=F.callback;if(typeof Nt=="function"){F.callback=null,H=F.priorityLevel;var mt=Nt(F.expirationTime<=Le);Le=i.unstable_now(),typeof mt=="function"?F.callback=mt:F===c(L)&&l(L),M(Le)}else l(L);F=c(L)}if(F!==null)var Lo=!0;else{var fn=c(U);fn!==null&&ao(j,fn.startTime-Le),Lo=!1}return Lo}finally{F=null,H=Ve,ne=!1}}var Z=!1,ce=null,me=-1,_e=5,Ne=-1;function Ye(){return!(i.unstable_now()-Ne<_e)}function en(){if(ce!==null){var ge=i.unstable_now();Ne=ge;var Le=!0;try{Le=ce(!0,ge)}finally{Le?Vr():(Z=!1,ce=null)}}else Z=!1}var Vr;if(typeof P=="function")Vr=function(){P(en)};else if(typeof MessageChannel<"u"){var Gn=new MessageChannel,Ri=Gn.port2;Gn.port1.onmessage=en,Vr=function(){Ri.postMessage(null)}}else Vr=function(){Ie(en,0)};function Fr(ge){ce=ge,Z||(Z=!0,Vr())}function ao(ge,Le){me=Ie(function(){ge(i.unstable_now())},Le)}i.unstable_IdlePriority=5,i.unstable_ImmediatePriority=1,i.unstable_LowPriority=4,i.unstable_NormalPriority=3,i.unstable_Profiling=null,i.unstable_UserBlockingPriority=2,i.unstable_cancelCallback=function(ge){ge.callback=null},i.unstable_continueExecution=function(){W||ne||(W=!0,Fr(J))},i.unstable_forceFrameRate=function(ge){0>ge||125<ge?console.error("forceFrameRate takes a positive int between 0 and 125, forcing frame rates higher than 125 fps is not supported"):_e=0<ge?Math.floor(1e3/ge):5},i.unstable_getCurrentPriorityLevel=function(){return H},i.unstable_getFirstCallbackNode=function(){return c(L)},i.unstable_next=function(ge){switch(H){case 1:case 2:case 3:var Le=3;break;default:Le=H}var Ve=H;H=Le;try{return ge()}finally{H=Ve}},i.unstable_pauseExecution=function(){},i.unstable_requestPaint=function(){},i.unstable_runWithPriority=function(ge,Le){switch(ge){case 1:case 2:case 3:case 4:case 5:break;default:ge=3}var Ve=H;H=ge;try{return Le()}finally{H=Ve}},i.unstable_scheduleCallback=function(ge,Le,Ve){var Nt=i.unstable_now();switch(typeof Ve=="object"&&Ve!==null?(Ve=Ve.delay,Ve=typeof Ve=="number"&&0<Ve?Nt+Ve:Nt):Ve=Nt,ge){case 1:var mt=-1;break;case 2:mt=250;break;case 5:mt=1073741823;break;case 4:mt=1e4;break;default:mt=5e3}return mt=Ve+mt,ge={id:G++,callback:Le,priorityLevel:ge,startTime:Ve,expirationTime:mt,sortIndex:-1},Ve>Nt?(ge.sortIndex=Ve,s(U,ge),c(L)===null&&ge===c(U)&&(ie?(B(me),me=-1):ie=!0,ao(j,Ve-Nt))):(ge.sortIndex=mt,s(L,ge),W||ne||(W=!0,Fr(J))),ge},i.unstable_shouldYield=Ye,i.unstable_wrapCallback=function(ge){var Le=H;return function(){var Ve=H;H=Le;try{return ge.apply(this,arguments)}finally{H=Ve}}}})(hb);ub.exports=hb;var N3=ub.exports;/**
 * @license React
 * react-dom.production.min.js
 *
 * Copyright (c) Facebook, Inc. and its affiliates.
 *
 * This source code is licensed under the MIT license found in the
 * LICENSE file in the root directory of this source tree.
 */var pb=dr,ri=N3;function fe(i){for(var s="https://reactjs.org/docs/error-decoder.html?invariant="+i,c=1;c<arguments.length;c++)s+="&args[]="+encodeURIComponent(arguments[c]);return"Minified React error #"+i+"; visit "+s+" for the full message or use the non-minified dev environment for full errors and additional helpful warnings."}var fb=new Set,Kd={};function ha(i,s){Rc(i,s),Rc(i+"Capture",s)}function Rc(i,s){for(Kd[i]=s,i=0;i<s.length;i++)fb.add(s[i])}var wo=!(typeof window>"u"||typeof window.document>"u"||typeof window.document.createElement>"u"),L_=Object.prototype.hasOwnProperty,b3=/^[:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD][:A-Z_a-z\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u02FF\u0370-\u037D\u037F-\u1FFF\u200C-\u200D\u2070-\u218F\u2C00-\u2FEF\u3001-\uD7FF\uF900-\uFDCF\uFDF0-\uFFFD\-.0-9\u00B7\u0300-\u036F\u203F-\u2040]*$/,b0={},D0={};function D3(i){return L_.call(D0,i)?!0:L_.call(b0,i)?!1:b3.test(i)?D0[i]=!0:(b0[i]=!0,!1)}function P3(i,s,c,l){if(c!==null&&c.type===0)return!1;switch(typeof s){case"function":case"symbol":return!0;case"boolean":return l?!1:c!==null?!c.acceptsBooleans:(i=i.toLowerCase().slice(0,5),i!=="data-"&&i!=="aria-");default:return!1}}function L3(i,s,c,l){if(s===null||typeof s>"u"||P3(i,s,c,l))return!0;if(l)return!1;if(c!==null)switch(c.type){case 3:return!s;case 4:return s===!1;case 5:return isNaN(s);case 6:return isNaN(s)||1>s}return!1}function Tr(i,s,c,l,p,_,y){this.acceptsBooleans=s===2||s===3||s===4,this.attributeName=l,this.attributeNamespace=p,this.mustUseProperty=c,this.propertyName=i,this.type=s,this.sanitizeURL=_,this.removeEmptyString=y}var Qn={};"children dangerouslySetInnerHTML defaultValue defaultChecked innerHTML suppressContentEditableWarning suppressHydrationWarning style".split(" ").forEach(function(i){Qn[i]=new Tr(i,0,!1,i,null,!1,!1)});[["acceptCharset","accept-charset"],["className","class"],["htmlFor","for"],["httpEquiv","http-equiv"]].forEach(function(i){var s=i[0];Qn[s]=new Tr(s,1,!1,i[1],null,!1,!1)});["contentEditable","draggable","spellCheck","value"].forEach(function(i){Qn[i]=new Tr(i,2,!1,i.toLowerCase(),null,!1,!1)});["autoReverse","externalResourcesRequired","focusable","preserveAlpha"].forEach(function(i){Qn[i]=new Tr(i,2,!1,i,null,!1,!1)});"allowFullScreen async autoFocus autoPlay controls default defer disabled disablePictureInPicture disableRemotePlayback formNoValidate hidden loop noModule noValidate open playsInline readOnly required reversed scoped seamless itemScope".split(" ").forEach(function(i){Qn[i]=new Tr(i,3,!1,i.toLowerCase(),null,!1,!1)});["checked","multiple","muted","selected"].forEach(function(i){Qn[i]=new Tr(i,3,!0,i,null,!1,!1)});["capture","download"].forEach(function(i){Qn[i]=new Tr(i,4,!1,i,null,!1,!1)});["cols","rows","size","span"].forEach(function(i){Qn[i]=new Tr(i,6,!1,i,null,!1,!1)});["rowSpan","start"].forEach(function(i){Qn[i]=new Tr(i,5,!1,i.toLowerCase(),null,!1,!1)});var Lg=/[\-:]([a-z])/g;function kg(i){return i[1].toUpperCase()}"accent-height alignment-baseline arabic-form baseline-shift cap-height clip-path clip-rule color-interpolation color-interpolation-filters color-profile color-rendering dominant-baseline enable-background fill-opacity fill-rule flood-color flood-opacity font-family font-size font-size-adjust font-stretch font-style font-variant font-weight glyph-name glyph-orientation-horizontal glyph-orientation-vertical horiz-adv-x horiz-origin-x image-rendering letter-spacing lighting-color marker-end marker-mid marker-start overline-position overline-thickness paint-order panose-1 pointer-events rendering-intent shape-rendering stop-color stop-opacity strikethrough-position strikethrough-thickness stroke-dasharray stroke-dashoffset stroke-linecap stroke-linejoin stroke-miterlimit stroke-opacity stroke-width text-anchor text-decoration text-rendering underline-position underline-thickness unicode-bidi unicode-range units-per-em v-alphabetic v-hanging v-ideographic v-mathematical vector-effect vert-adv-y vert-origin-x vert-origin-y word-spacing writing-mode xmlns:xlink x-height".split(" ").forEach(function(i){var s=i.replace(Lg,kg);Qn[s]=new Tr(s,1,!1,i,null,!1,!1)});"xlink:actuate xlink:arcrole xlink:role xlink:show xlink:title xlink:type".split(" ").forEach(function(i){var s=i.replace(Lg,kg);Qn[s]=new Tr(s,1,!1,i,"http://www.w3.org/1999/xlink",!1,!1)});["xml:base","xml:lang","xml:space"].forEach(function(i){var s=i.replace(Lg,kg);Qn[s]=new Tr(s,1,!1,i,"http://www.w3.org/XML/1998/namespace",!1,!1)});["tabIndex","crossOrigin"].forEach(function(i){Qn[i]=new Tr(i,1,!1,i.toLowerCase(),null,!1,!1)});Qn.xlinkHref=new Tr("xlinkHref",1,!1,"xlink:href","http://www.w3.org/1999/xlink",!0,!1);["src","href","action","formAction"].forEach(function(i){Qn[i]=new Tr(i,1,!1,i.toLowerCase(),null,!0,!0)});function Mg(i,s,c,l){var p=Qn.hasOwnProperty(s)?Qn[s]:null;(p!==null?p.type!==0:l||!(2<s.length)||s[0]!=="o"&&s[0]!=="O"||s[1]!=="n"&&s[1]!=="N")&&(L3(s,c,p,l)&&(c=null),l||p===null?D3(s)&&(c===null?i.removeAttribute(s):i.setAttribute(s,""+c)):p.mustUseProperty?i[p.propertyName]=c===null?p.type===3?!1:"":c:(s=p.attributeName,l=p.attributeNamespace,c===null?i.removeAttribute(s):(p=p.type,c=p===3||p===4&&c===!0?"":""+c,l?i.setAttributeNS(l,s,c):i.setAttribute(s,c))))}var Po=pb.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED,$u=Symbol.for("react.element"),oc=Symbol.for("react.portal"),sc=Symbol.for("react.fragment"),Ug=Symbol.for("react.strict_mode"),k_=Symbol.for("react.profiler"),mb=Symbol.for("react.provider"),Eb=Symbol.for("react.context"),xg=Symbol.for("react.forward_ref"),M_=Symbol.for("react.suspense"),U_=Symbol.for("react.suspense_list"),Vg=Symbol.for("react.memo"),ls=Symbol.for("react.lazy"),_b=Symbol.for("react.offscreen"),P0=Symbol.iterator;function Sd(i){return i===null||typeof i!="object"?null:(i=P0&&i[P0]||i["@@iterator"],typeof i=="function"?i:null)}var sn=Object.assign,n_;function bd(i){if(n_===void 0)try{throw Error()}catch(c){var s=c.stack.trim().match(/\n( *(at )?)/);n_=s&&s[1]||""}return`
`+n_+i}var r_=!1;function i_(i,s){if(!i||r_)return"";r_=!0;var c=Error.prepareStackTrace;Error.prepareStackTrace=void 0;try{if(s)if(s=function(){throw Error()},Object.defineProperty(s.prototype,"props",{set:function(){throw Error()}}),typeof Reflect=="object"&&Reflect.construct){try{Reflect.construct(s,[])}catch(U){var l=U}Reflect.construct(i,[],s)}else{try{s.call()}catch(U){l=U}i.call(s.prototype)}else{try{throw Error()}catch(U){l=U}i()}}catch(U){if(U&&l&&typeof U.stack=="string"){for(var p=U.stack.split(`
`),_=l.stack.split(`
`),y=p.length-1,C=_.length-1;1<=y&&0<=C&&p[y]!==_[C];)C--;for(;1<=y&&0<=C;y--,C--)if(p[y]!==_[C]){if(y!==1||C!==1)do if(y--,C--,0>C||p[y]!==_[C]){var L=`
`+p[y].replace(" at new "," at ");return i.displayName&&L.includes("<anonymous>")&&(L=L.replace("<anonymous>",i.displayName)),L}while(1<=y&&0<=C);break}}}finally{r_=!1,Error.prepareStackTrace=c}return(i=i?i.displayName||i.name:"")?bd(i):""}function k3(i){switch(i.tag){case 5:return bd(i.type);case 16:return bd("Lazy");case 13:return bd("Suspense");case 19:return bd("SuspenseList");case 0:case 2:case 15:return i=i_(i.type,!1),i;case 11:return i=i_(i.type.render,!1),i;case 1:return i=i_(i.type,!0),i;default:return""}}function x_(i){if(i==null)return null;if(typeof i=="function")return i.displayName||i.name||null;if(typeof i=="string")return i;switch(i){case sc:return"Fragment";case oc:return"Portal";case k_:return"Profiler";case Ug:return"StrictMode";case M_:return"Suspense";case U_:return"SuspenseList"}if(typeof i=="object")switch(i.$$typeof){case Eb:return(i.displayName||"Context")+".Consumer";case mb:return(i._context.displayName||"Context")+".Provider";case xg:var s=i.render;return i=i.displayName,i||(i=s.displayName||s.name||"",i=i!==""?"ForwardRef("+i+")":"ForwardRef"),i;case Vg:return s=i.displayName||null,s!==null?s:x_(i.type)||"Memo";case ls:s=i._payload,i=i._init;try{return x_(i(s))}catch{}}return null}function M3(i){var s=i.type;switch(i.tag){case 24:return"Cache";case 9:return(s.displayName||"Context")+".Consumer";case 10:return(s._context.displayName||"Context")+".Provider";case 18:return"DehydratedFragment";case 11:return i=s.render,i=i.displayName||i.name||"",s.displayName||(i!==""?"ForwardRef("+i+")":"ForwardRef");case 7:return"Fragment";case 5:return s;case 4:return"Portal";case 3:return"Root";case 6:return"Text";case 16:return x_(s);case 8:return s===Ug?"StrictMode":"Mode";case 22:return"Offscreen";case 12:return"Profiler";case 21:return"Scope";case 13:return"Suspense";case 19:return"SuspenseList";case 25:return"TracingMarker";case 1:case 0:case 17:case 2:case 14:case 15:if(typeof s=="function")return s.displayName||s.name||null;if(typeof s=="string")return s}return null}function Cs(i){switch(typeof i){case"boolean":case"number":case"string":case"undefined":return i;case"object":return i;default:return""}}function gb(i){var s=i.type;return(i=i.nodeName)&&i.toLowerCase()==="input"&&(s==="checkbox"||s==="radio")}function U3(i){var s=gb(i)?"checked":"value",c=Object.getOwnPropertyDescriptor(i.constructor.prototype,s),l=""+i[s];if(!i.hasOwnProperty(s)&&typeof c<"u"&&typeof c.get=="function"&&typeof c.set=="function"){var p=c.get,_=c.set;return Object.defineProperty(i,s,{configurable:!0,get:function(){return p.call(this)},set:function(y){l=""+y,_.call(this,y)}}),Object.defineProperty(i,s,{enumerable:c.enumerable}),{getValue:function(){return l},setValue:function(y){l=""+y},stopTracking:function(){i._valueTracker=null,delete i[s]}}}}function Zu(i){i._valueTracker||(i._valueTracker=U3(i))}function Sb(i){if(!i)return!1;var s=i._valueTracker;if(!s)return!0;var c=s.getValue(),l="";return i&&(l=gb(i)?i.checked?"true":"false":i.value),i=l,i!==c?(s.setValue(i),!0):!1}function kh(i){if(i=i||(typeof document<"u"?document:void 0),typeof i>"u")return null;try{return i.activeElement||i.body}catch{return i.body}}function V_(i,s){var c=s.checked;return sn({},s,{defaultChecked:void 0,defaultValue:void 0,value:void 0,checked:c??i._wrapperState.initialChecked})}function L0(i,s){var c=s.defaultValue==null?"":s.defaultValue,l=s.checked!=null?s.checked:s.defaultChecked;c=Cs(s.value!=null?s.value:c),i._wrapperState={initialChecked:l,initialValue:c,controlled:s.type==="checkbox"||s.type==="radio"?s.checked!=null:s.value!=null}}function Tb(i,s){s=s.checked,s!=null&&Mg(i,"checked",s,!1)}function F_(i,s){Tb(i,s);var c=Cs(s.value),l=s.type;if(c!=null)l==="number"?(c===0&&i.value===""||i.value!=c)&&(i.value=""+c):i.value!==""+c&&(i.value=""+c);else if(l==="submit"||l==="reset"){i.removeAttribute("value");return}s.hasOwnProperty("value")?j_(i,s.type,c):s.hasOwnProperty("defaultValue")&&j_(i,s.type,Cs(s.defaultValue)),s.checked==null&&s.defaultChecked!=null&&(i.defaultChecked=!!s.defaultChecked)}function k0(i,s,c){if(s.hasOwnProperty("value")||s.hasOwnProperty("defaultValue")){var l=s.type;if(!(l!=="submit"&&l!=="reset"||s.value!==void 0&&s.value!==null))return;s=""+i._wrapperState.initialValue,c||s===i.value||(i.value=s),i.defaultValue=s}c=i.name,c!==""&&(i.name=""),i.defaultChecked=!!i._wrapperState.initialChecked,c!==""&&(i.name=c)}function j_(i,s,c){(s!=="number"||kh(i.ownerDocument)!==i)&&(c==null?i.defaultValue=""+i._wrapperState.initialValue:i.defaultValue!==""+c&&(i.defaultValue=""+c))}var Dd=Array.isArray;function _c(i,s,c,l){if(i=i.options,s){s={};for(var p=0;p<c.length;p++)s["$"+c[p]]=!0;for(c=0;c<i.length;c++)p=s.hasOwnProperty("$"+i[c].value),i[c].selected!==p&&(i[c].selected=p),p&&l&&(i[c].defaultSelected=!0)}else{for(c=""+Cs(c),s=null,p=0;p<i.length;p++){if(i[p].value===c){i[p].selected=!0,l&&(i[p].defaultSelected=!0);return}s!==null||i[p].disabled||(s=i[p])}s!==null&&(s.selected=!0)}}function B_(i,s){if(s.dangerouslySetInnerHTML!=null)throw Error(fe(91));return sn({},s,{value:void 0,defaultValue:void 0,children:""+i._wrapperState.initialValue})}function M0(i,s){var c=s.value;if(c==null){if(c=s.children,s=s.defaultValue,c!=null){if(s!=null)throw Error(fe(92));if(Dd(c)){if(1<c.length)throw Error(fe(93));c=c[0]}s=c}s==null&&(s=""),c=s}i._wrapperState={initialValue:Cs(c)}}function vb(i,s){var c=Cs(s.value),l=Cs(s.defaultValue);c!=null&&(c=""+c,c!==i.value&&(i.value=c),s.defaultValue==null&&i.defaultValue!==c&&(i.defaultValue=c)),l!=null&&(i.defaultValue=""+l)}function U0(i){var s=i.textContent;s===i._wrapperState.initialValue&&s!==""&&s!==null&&(i.value=s)}function yb(i){switch(i){case"svg":return"http://www.w3.org/2000/svg";case"math":return"http://www.w3.org/1998/Math/MathML";default:return"http://www.w3.org/1999/xhtml"}}function G_(i,s){return i==null||i==="http://www.w3.org/1999/xhtml"?yb(s):i==="http://www.w3.org/2000/svg"&&s==="foreignObject"?"http://www.w3.org/1999/xhtml":i}var eh,Rb=function(i){return typeof MSApp<"u"&&MSApp.execUnsafeLocalFunction?function(s,c,l,p){MSApp.execUnsafeLocalFunction(function(){return i(s,c,l,p)})}:i}(function(i,s){if(i.namespaceURI!=="http://www.w3.org/2000/svg"||"innerHTML"in i)i.innerHTML=s;else{for(eh=eh||document.createElement("div"),eh.innerHTML="<svg>"+s.valueOf().toString()+"</svg>",s=eh.firstChild;i.firstChild;)i.removeChild(i.firstChild);for(;s.firstChild;)i.appendChild(s.firstChild)}});function zd(i,s){if(s){var c=i.firstChild;if(c&&c===i.lastChild&&c.nodeType===3){c.nodeValue=s;return}}i.textContent=s}var Ud={animationIterationCount:!0,aspectRatio:!0,borderImageOutset:!0,borderImageSlice:!0,borderImageWidth:!0,boxFlex:!0,boxFlexGroup:!0,boxOrdinalGroup:!0,columnCount:!0,columns:!0,flex:!0,flexGrow:!0,flexPositive:!0,flexShrink:!0,flexNegative:!0,flexOrder:!0,gridArea:!0,gridRow:!0,gridRowEnd:!0,gridRowSpan:!0,gridRowStart:!0,gridColumn:!0,gridColumnEnd:!0,gridColumnSpan:!0,gridColumnStart:!0,fontWeight:!0,lineClamp:!0,lineHeight:!0,opacity:!0,order:!0,orphans:!0,tabSize:!0,widows:!0,zIndex:!0,zoom:!0,fillOpacity:!0,floodOpacity:!0,stopOpacity:!0,strokeDasharray:!0,strokeDashoffset:!0,strokeMiterlimit:!0,strokeOpacity:!0,strokeWidth:!0},x3=["Webkit","ms","Moz","O"];Object.keys(Ud).forEach(function(i){x3.forEach(function(s){s=s+i.charAt(0).toUpperCase()+i.substring(1),Ud[s]=Ud[i]})});function Cb(i,s,c){return s==null||typeof s=="boolean"||s===""?"":c||typeof s!="number"||s===0||Ud.hasOwnProperty(i)&&Ud[i]?(""+s).trim():s+"px"}function Ib(i,s){i=i.style;for(var c in s)if(s.hasOwnProperty(c)){var l=c.indexOf("--")===0,p=Cb(c,s[c],l);c==="float"&&(c="cssFloat"),l?i.setProperty(c,p):i[c]=p}}var V3=sn({menuitem:!0},{area:!0,base:!0,br:!0,col:!0,embed:!0,hr:!0,img:!0,input:!0,keygen:!0,link:!0,meta:!0,param:!0,source:!0,track:!0,wbr:!0});function W_(i,s){if(s){if(V3[i]&&(s.children!=null||s.dangerouslySetInnerHTML!=null))throw Error(fe(137,i));if(s.dangerouslySetInnerHTML!=null){if(s.children!=null)throw Error(fe(60));if(typeof s.dangerouslySetInnerHTML!="object"||!("__html"in s.dangerouslySetInnerHTML))throw Error(fe(61))}if(s.style!=null&&typeof s.style!="object")throw Error(fe(62))}}function H_(i,s){if(i.indexOf("-")===-1)return typeof s.is=="string";switch(i){case"annotation-xml":case"color-profile":case"font-face":case"font-face-src":case"font-face-uri":case"font-face-format":case"font-face-name":case"missing-glyph":return!1;default:return!0}}var K_=null;function Fg(i){return i=i.target||i.srcElement||window,i.correspondingUseElement&&(i=i.correspondingUseElement),i.nodeType===3?i.parentNode:i}var z_=null,gc=null,Sc=null;function x0(i){if(i=hl(i)){if(typeof z_!="function")throw Error(fe(280));var s=i.stateNode;s&&(s=lp(s),z_(i.stateNode,i.type,s))}}function Ab(i){gc?Sc?Sc.push(i):Sc=[i]:gc=i}function Ob(){if(gc){var i=gc,s=Sc;if(Sc=gc=null,x0(i),s)for(i=0;i<s.length;i++)x0(s[i])}}function wb(i,s){return i(s)}function Nb(){}var o_=!1;function bb(i,s,c){if(o_)return i(s,c);o_=!0;try{return wb(i,s,c)}finally{o_=!1,(gc!==null||Sc!==null)&&(Nb(),Ob())}}function Yd(i,s){var c=i.stateNode;if(c===null)return null;var l=lp(c);if(l===null)return null;c=l[s];e:switch(s){case"onClick":case"onClickCapture":case"onDoubleClick":case"onDoubleClickCapture":case"onMouseDown":case"onMouseDownCapture":case"onMouseMove":case"onMouseMoveCapture":case"onMouseUp":case"onMouseUpCapture":case"onMouseEnter":(l=!l.disabled)||(i=i.type,l=!(i==="button"||i==="input"||i==="select"||i==="textarea")),i=!l;break e;default:i=!1}if(i)return null;if(c&&typeof c!="function")throw Error(fe(231,s,typeof c));return c}var Y_=!1;if(wo)try{var Td={};Object.defineProperty(Td,"passive",{get:function(){Y_=!0}}),window.addEventListener("test",Td,Td),window.removeEventListener("test",Td,Td)}catch{Y_=!1}function F3(i,s,c,l,p,_,y,C,L){var U=Array.prototype.slice.call(arguments,3);try{s.apply(c,U)}catch(G){this.onError(G)}}var xd=!1,Mh=null,Uh=!1,q_=null,j3={onError:function(i){xd=!0,Mh=i}};function B3(i,s,c,l,p,_,y,C,L){xd=!1,Mh=null,F3.apply(j3,arguments)}function G3(i,s,c,l,p,_,y,C,L){if(B3.apply(this,arguments),xd){if(xd){var U=Mh;xd=!1,Mh=null}else throw Error(fe(198));Uh||(Uh=!0,q_=U)}}function pa(i){var s=i,c=i;if(i.alternate)for(;s.return;)s=s.return;else{i=s;do s=i,s.flags&4098&&(c=s.return),i=s.return;while(i)}return s.tag===3?c:null}function Db(i){if(i.tag===13){var s=i.memoizedState;if(s===null&&(i=i.alternate,i!==null&&(s=i.memoizedState)),s!==null)return s.dehydrated}return null}function V0(i){if(pa(i)!==i)throw Error(fe(188))}function W3(i){var s=i.alternate;if(!s){if(s=pa(i),s===null)throw Error(fe(188));return s!==i?null:i}for(var c=i,l=s;;){var p=c.return;if(p===null)break;var _=p.alternate;if(_===null){if(l=p.return,l!==null){c=l;continue}break}if(p.child===_.child){for(_=p.child;_;){if(_===c)return V0(p),i;if(_===l)return V0(p),s;_=_.sibling}throw Error(fe(188))}if(c.return!==l.return)c=p,l=_;else{for(var y=!1,C=p.child;C;){if(C===c){y=!0,c=p,l=_;break}if(C===l){y=!0,l=p,c=_;break}C=C.sibling}if(!y){for(C=_.child;C;){if(C===c){y=!0,c=_,l=p;break}if(C===l){y=!0,l=_,c=p;break}C=C.sibling}if(!y)throw Error(fe(189))}}if(c.alternate!==l)throw Error(fe(190))}if(c.tag!==3)throw Error(fe(188));return c.stateNode.current===c?i:s}function Pb(i){return i=W3(i),i!==null?Lb(i):null}function Lb(i){if(i.tag===5||i.tag===6)return i;for(i=i.child;i!==null;){var s=Lb(i);if(s!==null)return s;i=i.sibling}return null}var kb=ri.unstable_scheduleCallback,F0=ri.unstable_cancelCallback,H3=ri.unstable_shouldYield,K3=ri.unstable_requestPaint,pn=ri.unstable_now,z3=ri.unstable_getCurrentPriorityLevel,jg=ri.unstable_ImmediatePriority,Mb=ri.unstable_UserBlockingPriority,xh=ri.unstable_NormalPriority,Y3=ri.unstable_LowPriority,Ub=ri.unstable_IdlePriority,sp=null,io=null;function q3(i){if(io&&typeof io.onCommitFiberRoot=="function")try{io.onCommitFiberRoot(sp,i,void 0,(i.current.flags&128)===128)}catch{}}var ji=Math.clz32?Math.clz32:Q3,J3=Math.log,X3=Math.LN2;function Q3(i){return i>>>=0,i===0?32:31-(J3(i)/X3|0)|0}var th=64,nh=4194304;function Pd(i){switch(i&-i){case 1:return 1;case 2:return 2;case 4:return 4;case 8:return 8;case 16:return 16;case 32:return 32;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return i&4194240;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return i&130023424;case 134217728:return 134217728;case 268435456:return 268435456;case 536870912:return 536870912;case 1073741824:return 1073741824;default:return i}}function Vh(i,s){var c=i.pendingLanes;if(c===0)return 0;var l=0,p=i.suspendedLanes,_=i.pingedLanes,y=c&268435455;if(y!==0){var C=y&~p;C!==0?l=Pd(C):(_&=y,_!==0&&(l=Pd(_)))}else y=c&~p,y!==0?l=Pd(y):_!==0&&(l=Pd(_));if(l===0)return 0;if(s!==0&&s!==l&&!(s&p)&&(p=l&-l,_=s&-s,p>=_||p===16&&(_&4194240)!==0))return s;if(l&4&&(l|=c&16),s=i.entangledLanes,s!==0)for(i=i.entanglements,s&=l;0<s;)c=31-ji(s),p=1<<c,l|=i[c],s&=~p;return l}function $3(i,s){switch(i){case 1:case 2:case 4:return s+250;case 8:case 16:case 32:case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:return s+5e3;case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:return-1;case 134217728:case 268435456:case 536870912:case 1073741824:return-1;default:return-1}}function Z3(i,s){for(var c=i.suspendedLanes,l=i.pingedLanes,p=i.expirationTimes,_=i.pendingLanes;0<_;){var y=31-ji(_),C=1<<y,L=p[y];L===-1?(!(C&c)||C&l)&&(p[y]=$3(C,s)):L<=s&&(i.expiredLanes|=C),_&=~C}}function J_(i){return i=i.pendingLanes&-1073741825,i!==0?i:i&1073741824?1073741824:0}function xb(){var i=th;return th<<=1,!(th&4194240)&&(th=64),i}function s_(i){for(var s=[],c=0;31>c;c++)s.push(i);return s}function ll(i,s,c){i.pendingLanes|=s,s!==536870912&&(i.suspendedLanes=0,i.pingedLanes=0),i=i.eventTimes,s=31-ji(s),i[s]=c}function eG(i,s){var c=i.pendingLanes&~s;i.pendingLanes=s,i.suspendedLanes=0,i.pingedLanes=0,i.expiredLanes&=s,i.mutableReadLanes&=s,i.entangledLanes&=s,s=i.entanglements;var l=i.eventTimes;for(i=i.expirationTimes;0<c;){var p=31-ji(c),_=1<<p;s[p]=0,l[p]=-1,i[p]=-1,c&=~_}}function Bg(i,s){var c=i.entangledLanes|=s;for(i=i.entanglements;c;){var l=31-ji(c),p=1<<l;p&s|i[l]&s&&(i[l]|=s),c&=~p}}var wt=0;function Vb(i){return i&=-i,1<i?4<i?i&268435455?16:536870912:4:1}var Fb,Gg,jb,Bb,Gb,X_=!1,rh=[],Es=null,_s=null,gs=null,qd=new Map,Jd=new Map,hs=[],tG="mousedown mouseup touchcancel touchend touchstart auxclick dblclick pointercancel pointerdown pointerup dragend dragstart drop compositionend compositionstart keydown keypress keyup input textInput copy cut paste click change contextmenu reset submit".split(" ");function j0(i,s){switch(i){case"focusin":case"focusout":Es=null;break;case"dragenter":case"dragleave":_s=null;break;case"mouseover":case"mouseout":gs=null;break;case"pointerover":case"pointerout":qd.delete(s.pointerId);break;case"gotpointercapture":case"lostpointercapture":Jd.delete(s.pointerId)}}function vd(i,s,c,l,p,_){return i===null||i.nativeEvent!==_?(i={blockedOn:s,domEventName:c,eventSystemFlags:l,nativeEvent:_,targetContainers:[p]},s!==null&&(s=hl(s),s!==null&&Gg(s)),i):(i.eventSystemFlags|=l,s=i.targetContainers,p!==null&&s.indexOf(p)===-1&&s.push(p),i)}function nG(i,s,c,l,p){switch(s){case"focusin":return Es=vd(Es,i,s,c,l,p),!0;case"dragenter":return _s=vd(_s,i,s,c,l,p),!0;case"mouseover":return gs=vd(gs,i,s,c,l,p),!0;case"pointerover":var _=p.pointerId;return qd.set(_,vd(qd.get(_)||null,i,s,c,l,p)),!0;case"gotpointercapture":return _=p.pointerId,Jd.set(_,vd(Jd.get(_)||null,i,s,c,l,p)),!0}return!1}function Wb(i){var s=na(i.target);if(s!==null){var c=pa(s);if(c!==null){if(s=c.tag,s===13){if(s=Db(c),s!==null){i.blockedOn=s,Gb(i.priority,function(){jb(c)});return}}else if(s===3&&c.stateNode.current.memoizedState.isDehydrated){i.blockedOn=c.tag===3?c.stateNode.containerInfo:null;return}}}i.blockedOn=null}function _h(i){if(i.blockedOn!==null)return!1;for(var s=i.targetContainers;0<s.length;){var c=Q_(i.domEventName,i.eventSystemFlags,s[0],i.nativeEvent);if(c===null){c=i.nativeEvent;var l=new c.constructor(c.type,c);K_=l,c.target.dispatchEvent(l),K_=null}else return s=hl(c),s!==null&&Gg(s),i.blockedOn=c,!1;s.shift()}return!0}function B0(i,s,c){_h(i)&&c.delete(s)}function rG(){X_=!1,Es!==null&&_h(Es)&&(Es=null),_s!==null&&_h(_s)&&(_s=null),gs!==null&&_h(gs)&&(gs=null),qd.forEach(B0),Jd.forEach(B0)}function yd(i,s){i.blockedOn===s&&(i.blockedOn=null,X_||(X_=!0,ri.unstable_scheduleCallback(ri.unstable_NormalPriority,rG)))}function Xd(i){function s(p){return yd(p,i)}if(0<rh.length){yd(rh[0],i);for(var c=1;c<rh.length;c++){var l=rh[c];l.blockedOn===i&&(l.blockedOn=null)}}for(Es!==null&&yd(Es,i),_s!==null&&yd(_s,i),gs!==null&&yd(gs,i),qd.forEach(s),Jd.forEach(s),c=0;c<hs.length;c++)l=hs[c],l.blockedOn===i&&(l.blockedOn=null);for(;0<hs.length&&(c=hs[0],c.blockedOn===null);)Wb(c),c.blockedOn===null&&hs.shift()}var Tc=Po.ReactCurrentBatchConfig,Fh=!0;function iG(i,s,c,l){var p=wt,_=Tc.transition;Tc.transition=null;try{wt=1,Wg(i,s,c,l)}finally{wt=p,Tc.transition=_}}function oG(i,s,c,l){var p=wt,_=Tc.transition;Tc.transition=null;try{wt=4,Wg(i,s,c,l)}finally{wt=p,Tc.transition=_}}function Wg(i,s,c,l){if(Fh){var p=Q_(i,s,c,l);if(p===null)E_(i,s,l,jh,c),j0(i,l);else if(nG(p,i,s,c,l))l.stopPropagation();else if(j0(i,l),s&4&&-1<tG.indexOf(i)){for(;p!==null;){var _=hl(p);if(_!==null&&Fb(_),_=Q_(i,s,c,l),_===null&&E_(i,s,l,jh,c),_===p)break;p=_}p!==null&&l.stopPropagation()}else E_(i,s,l,null,c)}}var jh=null;function Q_(i,s,c,l){if(jh=null,i=Fg(l),i=na(i),i!==null)if(s=pa(i),s===null)i=null;else if(c=s.tag,c===13){if(i=Db(s),i!==null)return i;i=null}else if(c===3){if(s.stateNode.current.memoizedState.isDehydrated)return s.tag===3?s.stateNode.containerInfo:null;i=null}else s!==i&&(i=null);return jh=i,null}function Hb(i){switch(i){case"cancel":case"click":case"close":case"contextmenu":case"copy":case"cut":case"auxclick":case"dblclick":case"dragend":case"dragstart":case"drop":case"focusin":case"focusout":case"input":case"invalid":case"keydown":case"keypress":case"keyup":case"mousedown":case"mouseup":case"paste":case"pause":case"play":case"pointercancel":case"pointerdown":case"pointerup":case"ratechange":case"reset":case"resize":case"seeked":case"submit":case"touchcancel":case"touchend":case"touchstart":case"volumechange":case"change":case"selectionchange":case"textInput":case"compositionstart":case"compositionend":case"compositionupdate":case"beforeblur":case"afterblur":case"beforeinput":case"blur":case"fullscreenchange":case"focus":case"hashchange":case"popstate":case"select":case"selectstart":return 1;case"drag":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"mousemove":case"mouseout":case"mouseover":case"pointermove":case"pointerout":case"pointerover":case"scroll":case"toggle":case"touchmove":case"wheel":case"mouseenter":case"mouseleave":case"pointerenter":case"pointerleave":return 4;case"message":switch(z3()){case jg:return 1;case Mb:return 4;case xh:case Y3:return 16;case Ub:return 536870912;default:return 16}default:return 16}}var fs=null,Hg=null,gh=null;function Kb(){if(gh)return gh;var i,s=Hg,c=s.length,l,p="value"in fs?fs.value:fs.textContent,_=p.length;for(i=0;i<c&&s[i]===p[i];i++);var y=c-i;for(l=1;l<=y&&s[c-l]===p[_-l];l++);return gh=p.slice(i,1<l?1-l:void 0)}function Sh(i){var s=i.keyCode;return"charCode"in i?(i=i.charCode,i===0&&s===13&&(i=13)):i=s,i===10&&(i=13),32<=i||i===13?i:0}function ih(){return!0}function G0(){return!1}function oi(i){function s(c,l,p,_,y){this._reactName=c,this._targetInst=p,this.type=l,this.nativeEvent=_,this.target=y,this.currentTarget=null;for(var C in i)i.hasOwnProperty(C)&&(c=i[C],this[C]=c?c(_):_[C]);return this.isDefaultPrevented=(_.defaultPrevented!=null?_.defaultPrevented:_.returnValue===!1)?ih:G0,this.isPropagationStopped=G0,this}return sn(s.prototype,{preventDefault:function(){this.defaultPrevented=!0;var c=this.nativeEvent;c&&(c.preventDefault?c.preventDefault():typeof c.returnValue!="unknown"&&(c.returnValue=!1),this.isDefaultPrevented=ih)},stopPropagation:function(){var c=this.nativeEvent;c&&(c.stopPropagation?c.stopPropagation():typeof c.cancelBubble!="unknown"&&(c.cancelBubble=!0),this.isPropagationStopped=ih)},persist:function(){},isPersistent:ih}),s}var Pc={eventPhase:0,bubbles:0,cancelable:0,timeStamp:function(i){return i.timeStamp||Date.now()},defaultPrevented:0,isTrusted:0},Kg=oi(Pc),ul=sn({},Pc,{view:0,detail:0}),sG=oi(ul),a_,c_,Rd,ap=sn({},ul,{screenX:0,screenY:0,clientX:0,clientY:0,pageX:0,pageY:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,getModifierState:zg,button:0,buttons:0,relatedTarget:function(i){return i.relatedTarget===void 0?i.fromElement===i.srcElement?i.toElement:i.fromElement:i.relatedTarget},movementX:function(i){return"movementX"in i?i.movementX:(i!==Rd&&(Rd&&i.type==="mousemove"?(a_=i.screenX-Rd.screenX,c_=i.screenY-Rd.screenY):c_=a_=0,Rd=i),a_)},movementY:function(i){return"movementY"in i?i.movementY:c_}}),W0=oi(ap),aG=sn({},ap,{dataTransfer:0}),cG=oi(aG),dG=sn({},ul,{relatedTarget:0}),d_=oi(dG),lG=sn({},Pc,{animationName:0,elapsedTime:0,pseudoElement:0}),uG=oi(lG),hG=sn({},Pc,{clipboardData:function(i){return"clipboardData"in i?i.clipboardData:window.clipboardData}}),pG=oi(hG),fG=sn({},Pc,{data:0}),H0=oi(fG),mG={Esc:"Escape",Spacebar:" ",Left:"ArrowLeft",Up:"ArrowUp",Right:"ArrowRight",Down:"ArrowDown",Del:"Delete",Win:"OS",Menu:"ContextMenu",Apps:"ContextMenu",Scroll:"ScrollLock",MozPrintableKey:"Unidentified"},EG={8:"Backspace",9:"Tab",12:"Clear",13:"Enter",16:"Shift",17:"Control",18:"Alt",19:"Pause",20:"CapsLock",27:"Escape",32:" ",33:"PageUp",34:"PageDown",35:"End",36:"Home",37:"ArrowLeft",38:"ArrowUp",39:"ArrowRight",40:"ArrowDown",45:"Insert",46:"Delete",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",117:"F6",118:"F7",119:"F8",120:"F9",121:"F10",122:"F11",123:"F12",144:"NumLock",145:"ScrollLock",224:"Meta"},_G={Alt:"altKey",Control:"ctrlKey",Meta:"metaKey",Shift:"shiftKey"};function gG(i){var s=this.nativeEvent;return s.getModifierState?s.getModifierState(i):(i=_G[i])?!!s[i]:!1}function zg(){return gG}var SG=sn({},ul,{key:function(i){if(i.key){var s=mG[i.key]||i.key;if(s!=="Unidentified")return s}return i.type==="keypress"?(i=Sh(i),i===13?"Enter":String.fromCharCode(i)):i.type==="keydown"||i.type==="keyup"?EG[i.keyCode]||"Unidentified":""},code:0,location:0,ctrlKey:0,shiftKey:0,altKey:0,metaKey:0,repeat:0,locale:0,getModifierState:zg,charCode:function(i){return i.type==="keypress"?Sh(i):0},keyCode:function(i){return i.type==="keydown"||i.type==="keyup"?i.keyCode:0},which:function(i){return i.type==="keypress"?Sh(i):i.type==="keydown"||i.type==="keyup"?i.keyCode:0}}),TG=oi(SG),vG=sn({},ap,{pointerId:0,width:0,height:0,pressure:0,tangentialPressure:0,tiltX:0,tiltY:0,twist:0,pointerType:0,isPrimary:0}),K0=oi(vG),yG=sn({},ul,{touches:0,targetTouches:0,changedTouches:0,altKey:0,metaKey:0,ctrlKey:0,shiftKey:0,getModifierState:zg}),RG=oi(yG),CG=sn({},Pc,{propertyName:0,elapsedTime:0,pseudoElement:0}),IG=oi(CG),AG=sn({},ap,{deltaX:function(i){return"deltaX"in i?i.deltaX:"wheelDeltaX"in i?-i.wheelDeltaX:0},deltaY:function(i){return"deltaY"in i?i.deltaY:"wheelDeltaY"in i?-i.wheelDeltaY:"wheelDelta"in i?-i.wheelDelta:0},deltaZ:0,deltaMode:0}),OG=oi(AG),wG=[9,13,27,32],Yg=wo&&"CompositionEvent"in window,Vd=null;wo&&"documentMode"in document&&(Vd=document.documentMode);var NG=wo&&"TextEvent"in window&&!Vd,zb=wo&&(!Yg||Vd&&8<Vd&&11>=Vd),z0=String.fromCharCode(32),Y0=!1;function Yb(i,s){switch(i){case"keyup":return wG.indexOf(s.keyCode)!==-1;case"keydown":return s.keyCode!==229;case"keypress":case"mousedown":case"focusout":return!0;default:return!1}}function qb(i){return i=i.detail,typeof i=="object"&&"data"in i?i.data:null}var ac=!1;function bG(i,s){switch(i){case"compositionend":return qb(s);case"keypress":return s.which!==32?null:(Y0=!0,z0);case"textInput":return i=s.data,i===z0&&Y0?null:i;default:return null}}function DG(i,s){if(ac)return i==="compositionend"||!Yg&&Yb(i,s)?(i=Kb(),gh=Hg=fs=null,ac=!1,i):null;switch(i){case"paste":return null;case"keypress":if(!(s.ctrlKey||s.altKey||s.metaKey)||s.ctrlKey&&s.altKey){if(s.char&&1<s.char.length)return s.char;if(s.which)return String.fromCharCode(s.which)}return null;case"compositionend":return zb&&s.locale!=="ko"?null:s.data;default:return null}}var PG={color:!0,date:!0,datetime:!0,"datetime-local":!0,email:!0,month:!0,number:!0,password:!0,range:!0,search:!0,tel:!0,text:!0,time:!0,url:!0,week:!0};function q0(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s==="input"?!!PG[i.type]:s==="textarea"}function Jb(i,s,c,l){Ab(l),s=Bh(s,"onChange"),0<s.length&&(c=new Kg("onChange","change",null,c,l),i.push({event:c,listeners:s}))}var Fd=null,Qd=null;function LG(i){sD(i,0)}function cp(i){var s=lc(i);if(Sb(s))return i}function kG(i,s){if(i==="change")return s}var Xb=!1;if(wo){var l_;if(wo){var u_="oninput"in document;if(!u_){var J0=document.createElement("div");J0.setAttribute("oninput","return;"),u_=typeof J0.oninput=="function"}l_=u_}else l_=!1;Xb=l_&&(!document.documentMode||9<document.documentMode)}function X0(){Fd&&(Fd.detachEvent("onpropertychange",Qb),Qd=Fd=null)}function Qb(i){if(i.propertyName==="value"&&cp(Qd)){var s=[];Jb(s,Qd,i,Fg(i)),bb(LG,s)}}function MG(i,s,c){i==="focusin"?(X0(),Fd=s,Qd=c,Fd.attachEvent("onpropertychange",Qb)):i==="focusout"&&X0()}function UG(i){if(i==="selectionchange"||i==="keyup"||i==="keydown")return cp(Qd)}function xG(i,s){if(i==="click")return cp(s)}function VG(i,s){if(i==="input"||i==="change")return cp(s)}function FG(i,s){return i===s&&(i!==0||1/i===1/s)||i!==i&&s!==s}var Gi=typeof Object.is=="function"?Object.is:FG;function $d(i,s){if(Gi(i,s))return!0;if(typeof i!="object"||i===null||typeof s!="object"||s===null)return!1;var c=Object.keys(i),l=Object.keys(s);if(c.length!==l.length)return!1;for(l=0;l<c.length;l++){var p=c[l];if(!L_.call(s,p)||!Gi(i[p],s[p]))return!1}return!0}function Q0(i){for(;i&&i.firstChild;)i=i.firstChild;return i}function $0(i,s){var c=Q0(i);i=0;for(var l;c;){if(c.nodeType===3){if(l=i+c.textContent.length,i<=s&&l>=s)return{node:c,offset:s-i};i=l}e:{for(;c;){if(c.nextSibling){c=c.nextSibling;break e}c=c.parentNode}c=void 0}c=Q0(c)}}function $b(i,s){return i&&s?i===s?!0:i&&i.nodeType===3?!1:s&&s.nodeType===3?$b(i,s.parentNode):"contains"in i?i.contains(s):i.compareDocumentPosition?!!(i.compareDocumentPosition(s)&16):!1:!1}function Zb(){for(var i=window,s=kh();s instanceof i.HTMLIFrameElement;){try{var c=typeof s.contentWindow.location.href=="string"}catch{c=!1}if(c)i=s.contentWindow;else break;s=kh(i.document)}return s}function qg(i){var s=i&&i.nodeName&&i.nodeName.toLowerCase();return s&&(s==="input"&&(i.type==="text"||i.type==="search"||i.type==="tel"||i.type==="url"||i.type==="password")||s==="textarea"||i.contentEditable==="true")}function jG(i){var s=Zb(),c=i.focusedElem,l=i.selectionRange;if(s!==c&&c&&c.ownerDocument&&$b(c.ownerDocument.documentElement,c)){if(l!==null&&qg(c)){if(s=l.start,i=l.end,i===void 0&&(i=s),"selectionStart"in c)c.selectionStart=s,c.selectionEnd=Math.min(i,c.value.length);else if(i=(s=c.ownerDocument||document)&&s.defaultView||window,i.getSelection){i=i.getSelection();var p=c.textContent.length,_=Math.min(l.start,p);l=l.end===void 0?_:Math.min(l.end,p),!i.extend&&_>l&&(p=l,l=_,_=p),p=$0(c,_);var y=$0(c,l);p&&y&&(i.rangeCount!==1||i.anchorNode!==p.node||i.anchorOffset!==p.offset||i.focusNode!==y.node||i.focusOffset!==y.offset)&&(s=s.createRange(),s.setStart(p.node,p.offset),i.removeAllRanges(),_>l?(i.addRange(s),i.extend(y.node,y.offset)):(s.setEnd(y.node,y.offset),i.addRange(s)))}}for(s=[],i=c;i=i.parentNode;)i.nodeType===1&&s.push({element:i,left:i.scrollLeft,top:i.scrollTop});for(typeof c.focus=="function"&&c.focus(),c=0;c<s.length;c++)i=s[c],i.element.scrollLeft=i.left,i.element.scrollTop=i.top}}var BG=wo&&"documentMode"in document&&11>=document.documentMode,cc=null,$_=null,jd=null,Z_=!1;function Z0(i,s,c){var l=c.window===c?c.document:c.nodeType===9?c:c.ownerDocument;Z_||cc==null||cc!==kh(l)||(l=cc,"selectionStart"in l&&qg(l)?l={start:l.selectionStart,end:l.selectionEnd}:(l=(l.ownerDocument&&l.ownerDocument.defaultView||window).getSelection(),l={anchorNode:l.anchorNode,anchorOffset:l.anchorOffset,focusNode:l.focusNode,focusOffset:l.focusOffset}),jd&&$d(jd,l)||(jd=l,l=Bh($_,"onSelect"),0<l.length&&(s=new Kg("onSelect","select",null,s,c),i.push({event:s,listeners:l}),s.target=cc)))}function oh(i,s){var c={};return c[i.toLowerCase()]=s.toLowerCase(),c["Webkit"+i]="webkit"+s,c["Moz"+i]="moz"+s,c}var dc={animationend:oh("Animation","AnimationEnd"),animationiteration:oh("Animation","AnimationIteration"),animationstart:oh("Animation","AnimationStart"),transitionend:oh("Transition","TransitionEnd")},h_={},eD={};wo&&(eD=document.createElement("div").style,"AnimationEvent"in window||(delete dc.animationend.animation,delete dc.animationiteration.animation,delete dc.animationstart.animation),"TransitionEvent"in window||delete dc.transitionend.transition);function dp(i){if(h_[i])return h_[i];if(!dc[i])return i;var s=dc[i],c;for(c in s)if(s.hasOwnProperty(c)&&c in eD)return h_[i]=s[c];return i}var tD=dp("animationend"),nD=dp("animationiteration"),rD=dp("animationstart"),iD=dp("transitionend"),oD=new Map,eN="abort auxClick cancel canPlay canPlayThrough click close contextMenu copy cut drag dragEnd dragEnter dragExit dragLeave dragOver dragStart drop durationChange emptied encrypted ended error gotPointerCapture input invalid keyDown keyPress keyUp load loadedData loadedMetadata loadStart lostPointerCapture mouseDown mouseMove mouseOut mouseOver mouseUp paste pause play playing pointerCancel pointerDown pointerMove pointerOut pointerOver pointerUp progress rateChange reset resize seeked seeking stalled submit suspend timeUpdate touchCancel touchEnd touchStart volumeChange scroll toggle touchMove waiting wheel".split(" ");function As(i,s){oD.set(i,s),ha(s,[i])}for(var p_=0;p_<eN.length;p_++){var f_=eN[p_],GG=f_.toLowerCase(),WG=f_[0].toUpperCase()+f_.slice(1);As(GG,"on"+WG)}As(tD,"onAnimationEnd");As(nD,"onAnimationIteration");As(rD,"onAnimationStart");As("dblclick","onDoubleClick");As("focusin","onFocus");As("focusout","onBlur");As(iD,"onTransitionEnd");Rc("onMouseEnter",["mouseout","mouseover"]);Rc("onMouseLeave",["mouseout","mouseover"]);Rc("onPointerEnter",["pointerout","pointerover"]);Rc("onPointerLeave",["pointerout","pointerover"]);ha("onChange","change click focusin focusout input keydown keyup selectionchange".split(" "));ha("onSelect","focusout contextmenu dragend focusin keydown keyup mousedown mouseup selectionchange".split(" "));ha("onBeforeInput",["compositionend","keypress","textInput","paste"]);ha("onCompositionEnd","compositionend focusout keydown keypress keyup mousedown".split(" "));ha("onCompositionStart","compositionstart focusout keydown keypress keyup mousedown".split(" "));ha("onCompositionUpdate","compositionupdate focusout keydown keypress keyup mousedown".split(" "));var Ld="abort canplay canplaythrough durationchange emptied encrypted ended error loadeddata loadedmetadata loadstart pause play playing progress ratechange resize seeked seeking stalled suspend timeupdate volumechange waiting".split(" "),HG=new Set("cancel close invalid load scroll toggle".split(" ").concat(Ld));function tN(i,s,c){var l=i.type||"unknown-event";i.currentTarget=c,G3(l,s,void 0,i),i.currentTarget=null}function sD(i,s){s=(s&4)!==0;for(var c=0;c<i.length;c++){var l=i[c],p=l.event;l=l.listeners;e:{var _=void 0;if(s)for(var y=l.length-1;0<=y;y--){var C=l[y],L=C.instance,U=C.currentTarget;if(C=C.listener,L!==_&&p.isPropagationStopped())break e;tN(p,C,U),_=L}else for(y=0;y<l.length;y++){if(C=l[y],L=C.instance,U=C.currentTarget,C=C.listener,L!==_&&p.isPropagationStopped())break e;tN(p,C,U),_=L}}}if(Uh)throw i=q_,Uh=!1,q_=null,i}function Jt(i,s){var c=s[ig];c===void 0&&(c=s[ig]=new Set);var l=i+"__bubble";c.has(l)||(aD(s,i,2,!1),c.add(l))}function m_(i,s,c){var l=0;s&&(l|=4),aD(c,i,l,s)}var sh="_reactListening"+Math.random().toString(36).slice(2);function Zd(i){if(!i[sh]){i[sh]=!0,fb.forEach(function(c){c!=="selectionchange"&&(HG.has(c)||m_(c,!1,i),m_(c,!0,i))});var s=i.nodeType===9?i:i.ownerDocument;s===null||s[sh]||(s[sh]=!0,m_("selectionchange",!1,s))}}function aD(i,s,c,l){switch(Hb(s)){case 1:var p=iG;break;case 4:p=oG;break;default:p=Wg}c=p.bind(null,s,c,i),p=void 0,!Y_||s!=="touchstart"&&s!=="touchmove"&&s!=="wheel"||(p=!0),l?p!==void 0?i.addEventListener(s,c,{capture:!0,passive:p}):i.addEventListener(s,c,!0):p!==void 0?i.addEventListener(s,c,{passive:p}):i.addEventListener(s,c,!1)}function E_(i,s,c,l,p){var _=l;if(!(s&1)&&!(s&2)&&l!==null)e:for(;;){if(l===null)return;var y=l.tag;if(y===3||y===4){var C=l.stateNode.containerInfo;if(C===p||C.nodeType===8&&C.parentNode===p)break;if(y===4)for(y=l.return;y!==null;){var L=y.tag;if((L===3||L===4)&&(L=y.stateNode.containerInfo,L===p||L.nodeType===8&&L.parentNode===p))return;y=y.return}for(;C!==null;){if(y=na(C),y===null)return;if(L=y.tag,L===5||L===6){l=_=y;continue e}C=C.parentNode}}l=l.return}bb(function(){var U=_,G=Fg(c),F=[];e:{var H=oD.get(i);if(H!==void 0){var ne=Kg,W=i;switch(i){case"keypress":if(Sh(c)===0)break e;case"keydown":case"keyup":ne=TG;break;case"focusin":W="focus",ne=d_;break;case"focusout":W="blur",ne=d_;break;case"beforeblur":case"afterblur":ne=d_;break;case"click":if(c.button===2)break e;case"auxclick":case"dblclick":case"mousedown":case"mousemove":case"mouseup":case"mouseout":case"mouseover":case"contextmenu":ne=W0;break;case"drag":case"dragend":case"dragenter":case"dragexit":case"dragleave":case"dragover":case"dragstart":case"drop":ne=cG;break;case"touchcancel":case"touchend":case"touchmove":case"touchstart":ne=RG;break;case tD:case nD:case rD:ne=uG;break;case iD:ne=IG;break;case"scroll":ne=sG;break;case"wheel":ne=OG;break;case"copy":case"cut":case"paste":ne=pG;break;case"gotpointercapture":case"lostpointercapture":case"pointercancel":case"pointerdown":case"pointermove":case"pointerout":case"pointerover":case"pointerup":ne=K0}var ie=(s&4)!==0,Ie=!ie&&i==="scroll",B=ie?H!==null?H+"Capture":null:H;ie=[];for(var P=U,M;P!==null;){M=P;var j=M.stateNode;if(M.tag===5&&j!==null&&(M=j,B!==null&&(j=Yd(P,B),j!=null&&ie.push(el(P,j,M)))),Ie)break;P=P.return}0<ie.length&&(H=new ne(H,W,null,c,G),F.push({event:H,listeners:ie}))}}if(!(s&7)){e:{if(H=i==="mouseover"||i==="pointerover",ne=i==="mouseout"||i==="pointerout",H&&c!==K_&&(W=c.relatedTarget||c.fromElement)&&(na(W)||W[No]))break e;if((ne||H)&&(H=G.window===G?G:(H=G.ownerDocument)?H.defaultView||H.parentWindow:window,ne?(W=c.relatedTarget||c.toElement,ne=U,W=W?na(W):null,W!==null&&(Ie=pa(W),W!==Ie||W.tag!==5&&W.tag!==6)&&(W=null)):(ne=null,W=U),ne!==W)){if(ie=W0,j="onMouseLeave",B="onMouseEnter",P="mouse",(i==="pointerout"||i==="pointerover")&&(ie=K0,j="onPointerLeave",B="onPointerEnter",P="pointer"),Ie=ne==null?H:lc(ne),M=W==null?H:lc(W),H=new ie(j,P+"leave",ne,c,G),H.target=Ie,H.relatedTarget=M,j=null,na(G)===U&&(ie=new ie(B,P+"enter",W,c,G),ie.target=M,ie.relatedTarget=Ie,j=ie),Ie=j,ne&&W)t:{for(ie=ne,B=W,P=0,M=ie;M;M=ic(M))P++;for(M=0,j=B;j;j=ic(j))M++;for(;0<P-M;)ie=ic(ie),P--;for(;0<M-P;)B=ic(B),M--;for(;P--;){if(ie===B||B!==null&&ie===B.alternate)break t;ie=ic(ie),B=ic(B)}ie=null}else ie=null;ne!==null&&nN(F,H,ne,ie,!1),W!==null&&Ie!==null&&nN(F,Ie,W,ie,!0)}}e:{if(H=U?lc(U):window,ne=H.nodeName&&H.nodeName.toLowerCase(),ne==="select"||ne==="input"&&H.type==="file")var J=kG;else if(q0(H))if(Xb)J=VG;else{J=UG;var Z=MG}else(ne=H.nodeName)&&ne.toLowerCase()==="input"&&(H.type==="checkbox"||H.type==="radio")&&(J=xG);if(J&&(J=J(i,U))){Jb(F,J,c,G);break e}Z&&Z(i,H,U),i==="focusout"&&(Z=H._wrapperState)&&Z.controlled&&H.type==="number"&&j_(H,"number",H.value)}switch(Z=U?lc(U):window,i){case"focusin":(q0(Z)||Z.contentEditable==="true")&&(cc=Z,$_=U,jd=null);break;case"focusout":jd=$_=cc=null;break;case"mousedown":Z_=!0;break;case"contextmenu":case"mouseup":case"dragend":Z_=!1,Z0(F,c,G);break;case"selectionchange":if(BG)break;case"keydown":case"keyup":Z0(F,c,G)}var ce;if(Yg)e:{switch(i){case"compositionstart":var me="onCompositionStart";break e;case"compositionend":me="onCompositionEnd";break e;case"compositionupdate":me="onCompositionUpdate";break e}me=void 0}else ac?Yb(i,c)&&(me="onCompositionEnd"):i==="keydown"&&c.keyCode===229&&(me="onCompositionStart");me&&(zb&&c.locale!=="ko"&&(ac||me!=="onCompositionStart"?me==="onCompositionEnd"&&ac&&(ce=Kb()):(fs=G,Hg="value"in fs?fs.value:fs.textContent,ac=!0)),Z=Bh(U,me),0<Z.length&&(me=new H0(me,i,null,c,G),F.push({event:me,listeners:Z}),ce?me.data=ce:(ce=qb(c),ce!==null&&(me.data=ce)))),(ce=NG?bG(i,c):DG(i,c))&&(U=Bh(U,"onBeforeInput"),0<U.length&&(G=new H0("onBeforeInput","beforeinput",null,c,G),F.push({event:G,listeners:U}),G.data=ce))}sD(F,s)})}function el(i,s,c){return{instance:i,listener:s,currentTarget:c}}function Bh(i,s){for(var c=s+"Capture",l=[];i!==null;){var p=i,_=p.stateNode;p.tag===5&&_!==null&&(p=_,_=Yd(i,c),_!=null&&l.unshift(el(i,_,p)),_=Yd(i,s),_!=null&&l.push(el(i,_,p))),i=i.return}return l}function ic(i){if(i===null)return null;do i=i.return;while(i&&i.tag!==5);return i||null}function nN(i,s,c,l,p){for(var _=s._reactName,y=[];c!==null&&c!==l;){var C=c,L=C.alternate,U=C.stateNode;if(L!==null&&L===l)break;C.tag===5&&U!==null&&(C=U,p?(L=Yd(c,_),L!=null&&y.unshift(el(c,L,C))):p||(L=Yd(c,_),L!=null&&y.push(el(c,L,C)))),c=c.return}y.length!==0&&i.push({event:s,listeners:y})}var KG=/\r\n?/g,zG=/\u0000|\uFFFD/g;function rN(i){return(typeof i=="string"?i:""+i).replace(KG,`
`).replace(zG,"")}function ah(i,s,c){if(s=rN(s),rN(i)!==s&&c)throw Error(fe(425))}function Gh(){}var eg=null,tg=null;function ng(i,s){return i==="textarea"||i==="noscript"||typeof s.children=="string"||typeof s.children=="number"||typeof s.dangerouslySetInnerHTML=="object"&&s.dangerouslySetInnerHTML!==null&&s.dangerouslySetInnerHTML.__html!=null}var rg=typeof setTimeout=="function"?setTimeout:void 0,YG=typeof clearTimeout=="function"?clearTimeout:void 0,iN=typeof Promise=="function"?Promise:void 0,qG=typeof queueMicrotask=="function"?queueMicrotask:typeof iN<"u"?function(i){return iN.resolve(null).then(i).catch(JG)}:rg;function JG(i){setTimeout(function(){throw i})}function __(i,s){var c=s,l=0;do{var p=c.nextSibling;if(i.removeChild(c),p&&p.nodeType===8)if(c=p.data,c==="/$"){if(l===0){i.removeChild(p),Xd(s);return}l--}else c!=="$"&&c!=="$?"&&c!=="$!"||l++;c=p}while(c);Xd(s)}function Ss(i){for(;i!=null;i=i.nextSibling){var s=i.nodeType;if(s===1||s===3)break;if(s===8){if(s=i.data,s==="$"||s==="$!"||s==="$?")break;if(s==="/$")return null}}return i}function oN(i){i=i.previousSibling;for(var s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="$"||c==="$!"||c==="$?"){if(s===0)return i;s--}else c==="/$"&&s++}i=i.previousSibling}return null}var Lc=Math.random().toString(36).slice(2),no="__reactFiber$"+Lc,tl="__reactProps$"+Lc,No="__reactContainer$"+Lc,ig="__reactEvents$"+Lc,XG="__reactListeners$"+Lc,QG="__reactHandles$"+Lc;function na(i){var s=i[no];if(s)return s;for(var c=i.parentNode;c;){if(s=c[No]||c[no]){if(c=s.alternate,s.child!==null||c!==null&&c.child!==null)for(i=oN(i);i!==null;){if(c=i[no])return c;i=oN(i)}return s}i=c,c=i.parentNode}return null}function hl(i){return i=i[no]||i[No],!i||i.tag!==5&&i.tag!==6&&i.tag!==13&&i.tag!==3?null:i}function lc(i){if(i.tag===5||i.tag===6)return i.stateNode;throw Error(fe(33))}function lp(i){return i[tl]||null}var og=[],uc=-1;function Os(i){return{current:i}}function Xt(i){0>uc||(i.current=og[uc],og[uc]=null,uc--)}function Kt(i,s){uc++,og[uc]=i.current,i.current=s}var Is={},ur=Os(Is),Mr=Os(!1),aa=Is;function Cc(i,s){var c=i.type.contextTypes;if(!c)return Is;var l=i.stateNode;if(l&&l.__reactInternalMemoizedUnmaskedChildContext===s)return l.__reactInternalMemoizedMaskedChildContext;var p={},_;for(_ in c)p[_]=s[_];return l&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=s,i.__reactInternalMemoizedMaskedChildContext=p),p}function Ur(i){return i=i.childContextTypes,i!=null}function Wh(){Xt(Mr),Xt(ur)}function sN(i,s,c){if(ur.current!==Is)throw Error(fe(168));Kt(ur,s),Kt(Mr,c)}function cD(i,s,c){var l=i.stateNode;if(s=s.childContextTypes,typeof l.getChildContext!="function")return c;l=l.getChildContext();for(var p in l)if(!(p in s))throw Error(fe(108,M3(i)||"Unknown",p));return sn({},c,l)}function Hh(i){return i=(i=i.stateNode)&&i.__reactInternalMemoizedMergedChildContext||Is,aa=ur.current,Kt(ur,i),Kt(Mr,Mr.current),!0}function aN(i,s,c){var l=i.stateNode;if(!l)throw Error(fe(169));c?(i=cD(i,s,aa),l.__reactInternalMemoizedMergedChildContext=i,Xt(Mr),Xt(ur),Kt(ur,i)):Xt(Mr),Kt(Mr,c)}var Ro=null,up=!1,g_=!1;function dD(i){Ro===null?Ro=[i]:Ro.push(i)}function $G(i){up=!0,dD(i)}function ws(){if(!g_&&Ro!==null){g_=!0;var i=0,s=wt;try{var c=Ro;for(wt=1;i<c.length;i++){var l=c[i];do l=l(!0);while(l!==null)}Ro=null,up=!1}catch(p){throw Ro!==null&&(Ro=Ro.slice(i+1)),kb(jg,ws),p}finally{wt=s,g_=!1}}return null}var hc=[],pc=0,Kh=null,zh=0,Ei=[],_i=0,ca=null,Co=1,Io="";function ea(i,s){hc[pc++]=zh,hc[pc++]=Kh,Kh=i,zh=s}function lD(i,s,c){Ei[_i++]=Co,Ei[_i++]=Io,Ei[_i++]=ca,ca=i;var l=Co;i=Io;var p=32-ji(l)-1;l&=~(1<<p),c+=1;var _=32-ji(s)+p;if(30<_){var y=p-p%5;_=(l&(1<<y)-1).toString(32),l>>=y,p-=y,Co=1<<32-ji(s)+p|c<<p|l,Io=_+i}else Co=1<<_|c<<p|l,Io=i}function Jg(i){i.return!==null&&(ea(i,1),lD(i,1,0))}function Xg(i){for(;i===Kh;)Kh=hc[--pc],hc[pc]=null,zh=hc[--pc],hc[pc]=null;for(;i===ca;)ca=Ei[--_i],Ei[_i]=null,Io=Ei[--_i],Ei[_i]=null,Co=Ei[--_i],Ei[_i]=null}var ni=null,ti=null,Zt=!1,Fi=null;function uD(i,s){var c=gi(5,null,null,0);c.elementType="DELETED",c.stateNode=s,c.return=i,s=i.deletions,s===null?(i.deletions=[c],i.flags|=16):s.push(c)}function cN(i,s){switch(i.tag){case 5:var c=i.type;return s=s.nodeType!==1||c.toLowerCase()!==s.nodeName.toLowerCase()?null:s,s!==null?(i.stateNode=s,ni=i,ti=Ss(s.firstChild),!0):!1;case 6:return s=i.pendingProps===""||s.nodeType!==3?null:s,s!==null?(i.stateNode=s,ni=i,ti=null,!0):!1;case 13:return s=s.nodeType!==8?null:s,s!==null?(c=ca!==null?{id:Co,overflow:Io}:null,i.memoizedState={dehydrated:s,treeContext:c,retryLane:1073741824},c=gi(18,null,null,0),c.stateNode=s,c.return=i,i.child=c,ni=i,ti=null,!0):!1;default:return!1}}function sg(i){return(i.mode&1)!==0&&(i.flags&128)===0}function ag(i){if(Zt){var s=ti;if(s){var c=s;if(!cN(i,s)){if(sg(i))throw Error(fe(418));s=Ss(c.nextSibling);var l=ni;s&&cN(i,s)?uD(l,c):(i.flags=i.flags&-4097|2,Zt=!1,ni=i)}}else{if(sg(i))throw Error(fe(418));i.flags=i.flags&-4097|2,Zt=!1,ni=i}}}function dN(i){for(i=i.return;i!==null&&i.tag!==5&&i.tag!==3&&i.tag!==13;)i=i.return;ni=i}function ch(i){if(i!==ni)return!1;if(!Zt)return dN(i),Zt=!0,!1;var s;if((s=i.tag!==3)&&!(s=i.tag!==5)&&(s=i.type,s=s!=="head"&&s!=="body"&&!ng(i.type,i.memoizedProps)),s&&(s=ti)){if(sg(i))throw hD(),Error(fe(418));for(;s;)uD(i,s),s=Ss(s.nextSibling)}if(dN(i),i.tag===13){if(i=i.memoizedState,i=i!==null?i.dehydrated:null,!i)throw Error(fe(317));e:{for(i=i.nextSibling,s=0;i;){if(i.nodeType===8){var c=i.data;if(c==="/$"){if(s===0){ti=Ss(i.nextSibling);break e}s--}else c!=="$"&&c!=="$!"&&c!=="$?"||s++}i=i.nextSibling}ti=null}}else ti=ni?Ss(i.stateNode.nextSibling):null;return!0}function hD(){for(var i=ti;i;)i=Ss(i.nextSibling)}function Ic(){ti=ni=null,Zt=!1}function Qg(i){Fi===null?Fi=[i]:Fi.push(i)}var ZG=Po.ReactCurrentBatchConfig;function xi(i,s){if(i&&i.defaultProps){s=sn({},s),i=i.defaultProps;for(var c in i)s[c]===void 0&&(s[c]=i[c]);return s}return s}var Yh=Os(null),qh=null,fc=null,$g=null;function Zg(){$g=fc=qh=null}function eS(i){var s=Yh.current;Xt(Yh),i._currentValue=s}function cg(i,s,c){for(;i!==null;){var l=i.alternate;if((i.childLanes&s)!==s?(i.childLanes|=s,l!==null&&(l.childLanes|=s)):l!==null&&(l.childLanes&s)!==s&&(l.childLanes|=s),i===c)break;i=i.return}}function vc(i,s){qh=i,$g=fc=null,i=i.dependencies,i!==null&&i.firstContext!==null&&(i.lanes&s&&(kr=!0),i.firstContext=null)}function vi(i){var s=i._currentValue;if($g!==i)if(i={context:i,memoizedValue:s,next:null},fc===null){if(qh===null)throw Error(fe(308));fc=i,qh.dependencies={lanes:0,firstContext:i}}else fc=fc.next=i;return s}var ra=null;function tS(i){ra===null?ra=[i]:ra.push(i)}function pD(i,s,c,l){var p=s.interleaved;return p===null?(c.next=c,tS(s)):(c.next=p.next,p.next=c),s.interleaved=c,bo(i,l)}function bo(i,s){i.lanes|=s;var c=i.alternate;for(c!==null&&(c.lanes|=s),c=i,i=i.return;i!==null;)i.childLanes|=s,c=i.alternate,c!==null&&(c.childLanes|=s),c=i,i=i.return;return c.tag===3?c.stateNode:null}var us=!1;function nS(i){i.updateQueue={baseState:i.memoizedState,firstBaseUpdate:null,lastBaseUpdate:null,shared:{pending:null,interleaved:null,lanes:0},effects:null}}function fD(i,s){i=i.updateQueue,s.updateQueue===i&&(s.updateQueue={baseState:i.baseState,firstBaseUpdate:i.firstBaseUpdate,lastBaseUpdate:i.lastBaseUpdate,shared:i.shared,effects:i.effects})}function Ao(i,s){return{eventTime:i,lane:s,tag:0,payload:null,callback:null,next:null}}function Ts(i,s,c){var l=i.updateQueue;if(l===null)return null;if(l=l.shared,ft&2){var p=l.pending;return p===null?s.next=s:(s.next=p.next,p.next=s),l.pending=s,bo(i,c)}return p=l.interleaved,p===null?(s.next=s,tS(l)):(s.next=p.next,p.next=s),l.interleaved=s,bo(i,c)}function Th(i,s,c){if(s=s.updateQueue,s!==null&&(s=s.shared,(c&4194240)!==0)){var l=s.lanes;l&=i.pendingLanes,c|=l,s.lanes=c,Bg(i,c)}}function lN(i,s){var c=i.updateQueue,l=i.alternate;if(l!==null&&(l=l.updateQueue,c===l)){var p=null,_=null;if(c=c.firstBaseUpdate,c!==null){do{var y={eventTime:c.eventTime,lane:c.lane,tag:c.tag,payload:c.payload,callback:c.callback,next:null};_===null?p=_=y:_=_.next=y,c=c.next}while(c!==null);_===null?p=_=s:_=_.next=s}else p=_=s;c={baseState:l.baseState,firstBaseUpdate:p,lastBaseUpdate:_,shared:l.shared,effects:l.effects},i.updateQueue=c;return}i=c.lastBaseUpdate,i===null?c.firstBaseUpdate=s:i.next=s,c.lastBaseUpdate=s}function Jh(i,s,c,l){var p=i.updateQueue;us=!1;var _=p.firstBaseUpdate,y=p.lastBaseUpdate,C=p.shared.pending;if(C!==null){p.shared.pending=null;var L=C,U=L.next;L.next=null,y===null?_=U:y.next=U,y=L;var G=i.alternate;G!==null&&(G=G.updateQueue,C=G.lastBaseUpdate,C!==y&&(C===null?G.firstBaseUpdate=U:C.next=U,G.lastBaseUpdate=L))}if(_!==null){var F=p.baseState;y=0,G=U=L=null,C=_;do{var H=C.lane,ne=C.eventTime;if((l&H)===H){G!==null&&(G=G.next={eventTime:ne,lane:0,tag:C.tag,payload:C.payload,callback:C.callback,next:null});e:{var W=i,ie=C;switch(H=s,ne=c,ie.tag){case 1:if(W=ie.payload,typeof W=="function"){F=W.call(ne,F,H);break e}F=W;break e;case 3:W.flags=W.flags&-65537|128;case 0:if(W=ie.payload,H=typeof W=="function"?W.call(ne,F,H):W,H==null)break e;F=sn({},F,H);break e;case 2:us=!0}}C.callback!==null&&C.lane!==0&&(i.flags|=64,H=p.effects,H===null?p.effects=[C]:H.push(C))}else ne={eventTime:ne,lane:H,tag:C.tag,payload:C.payload,callback:C.callback,next:null},G===null?(U=G=ne,L=F):G=G.next=ne,y|=H;if(C=C.next,C===null){if(C=p.shared.pending,C===null)break;H=C,C=H.next,H.next=null,p.lastBaseUpdate=H,p.shared.pending=null}}while(1);if(G===null&&(L=F),p.baseState=L,p.firstBaseUpdate=U,p.lastBaseUpdate=G,s=p.shared.interleaved,s!==null){p=s;do y|=p.lane,p=p.next;while(p!==s)}else _===null&&(p.shared.lanes=0);la|=y,i.lanes=y,i.memoizedState=F}}function uN(i,s,c){if(i=s.effects,s.effects=null,i!==null)for(s=0;s<i.length;s++){var l=i[s],p=l.callback;if(p!==null){if(l.callback=null,l=c,typeof p!="function")throw Error(fe(191,p));p.call(l)}}}var mD=new pb.Component().refs;function dg(i,s,c,l){s=i.memoizedState,c=c(l,s),c=c==null?s:sn({},s,c),i.memoizedState=c,i.lanes===0&&(i.updateQueue.baseState=c)}var hp={isMounted:function(i){return(i=i._reactInternals)?pa(i)===i:!1},enqueueSetState:function(i,s,c){i=i._reactInternals;var l=gr(),p=ys(i),_=Ao(l,p);_.payload=s,c!=null&&(_.callback=c),s=Ts(i,_,p),s!==null&&(Bi(s,i,p,l),Th(s,i,p))},enqueueReplaceState:function(i,s,c){i=i._reactInternals;var l=gr(),p=ys(i),_=Ao(l,p);_.tag=1,_.payload=s,c!=null&&(_.callback=c),s=Ts(i,_,p),s!==null&&(Bi(s,i,p,l),Th(s,i,p))},enqueueForceUpdate:function(i,s){i=i._reactInternals;var c=gr(),l=ys(i),p=Ao(c,l);p.tag=2,s!=null&&(p.callback=s),s=Ts(i,p,l),s!==null&&(Bi(s,i,l,c),Th(s,i,l))}};function hN(i,s,c,l,p,_,y){return i=i.stateNode,typeof i.shouldComponentUpdate=="function"?i.shouldComponentUpdate(l,_,y):s.prototype&&s.prototype.isPureReactComponent?!$d(c,l)||!$d(p,_):!0}function ED(i,s,c){var l=!1,p=Is,_=s.contextType;return typeof _=="object"&&_!==null?_=vi(_):(p=Ur(s)?aa:ur.current,l=s.contextTypes,_=(l=l!=null)?Cc(i,p):Is),s=new s(c,_),i.memoizedState=s.state!==null&&s.state!==void 0?s.state:null,s.updater=hp,i.stateNode=s,s._reactInternals=i,l&&(i=i.stateNode,i.__reactInternalMemoizedUnmaskedChildContext=p,i.__reactInternalMemoizedMaskedChildContext=_),s}function pN(i,s,c,l){i=s.state,typeof s.componentWillReceiveProps=="function"&&s.componentWillReceiveProps(c,l),typeof s.UNSAFE_componentWillReceiveProps=="function"&&s.UNSAFE_componentWillReceiveProps(c,l),s.state!==i&&hp.enqueueReplaceState(s,s.state,null)}function lg(i,s,c,l){var p=i.stateNode;p.props=c,p.state=i.memoizedState,p.refs=mD,nS(i);var _=s.contextType;typeof _=="object"&&_!==null?p.context=vi(_):(_=Ur(s)?aa:ur.current,p.context=Cc(i,_)),p.state=i.memoizedState,_=s.getDerivedStateFromProps,typeof _=="function"&&(dg(i,s,_,c),p.state=i.memoizedState),typeof s.getDerivedStateFromProps=="function"||typeof p.getSnapshotBeforeUpdate=="function"||typeof p.UNSAFE_componentWillMount!="function"&&typeof p.componentWillMount!="function"||(s=p.state,typeof p.componentWillMount=="function"&&p.componentWillMount(),typeof p.UNSAFE_componentWillMount=="function"&&p.UNSAFE_componentWillMount(),s!==p.state&&hp.enqueueReplaceState(p,p.state,null),Jh(i,c,p,l),p.state=i.memoizedState),typeof p.componentDidMount=="function"&&(i.flags|=4194308)}function Cd(i,s,c){if(i=c.ref,i!==null&&typeof i!="function"&&typeof i!="object"){if(c._owner){if(c=c._owner,c){if(c.tag!==1)throw Error(fe(309));var l=c.stateNode}if(!l)throw Error(fe(147,i));var p=l,_=""+i;return s!==null&&s.ref!==null&&typeof s.ref=="function"&&s.ref._stringRef===_?s.ref:(s=function(y){var C=p.refs;C===mD&&(C=p.refs={}),y===null?delete C[_]:C[_]=y},s._stringRef=_,s)}if(typeof i!="string")throw Error(fe(284));if(!c._owner)throw Error(fe(290,i))}return i}function dh(i,s){throw i=Object.prototype.toString.call(s),Error(fe(31,i==="[object Object]"?"object with keys {"+Object.keys(s).join(", ")+"}":i))}function fN(i){var s=i._init;return s(i._payload)}function _D(i){function s(B,P){if(i){var M=B.deletions;M===null?(B.deletions=[P],B.flags|=16):M.push(P)}}function c(B,P){if(!i)return null;for(;P!==null;)s(B,P),P=P.sibling;return null}function l(B,P){for(B=new Map;P!==null;)P.key!==null?B.set(P.key,P):B.set(P.index,P),P=P.sibling;return B}function p(B,P){return B=Rs(B,P),B.index=0,B.sibling=null,B}function _(B,P,M){return B.index=M,i?(M=B.alternate,M!==null?(M=M.index,M<P?(B.flags|=2,P):M):(B.flags|=2,P)):(B.flags|=1048576,P)}function y(B){return i&&B.alternate===null&&(B.flags|=2),B}function C(B,P,M,j){return P===null||P.tag!==6?(P=I_(M,B.mode,j),P.return=B,P):(P=p(P,M),P.return=B,P)}function L(B,P,M,j){var J=M.type;return J===sc?G(B,P,M.props.children,j,M.key):P!==null&&(P.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===ls&&fN(J)===P.type)?(j=p(P,M.props),j.ref=Cd(B,P,M),j.return=B,j):(j=Ah(M.type,M.key,M.props,null,B.mode,j),j.ref=Cd(B,P,M),j.return=B,j)}function U(B,P,M,j){return P===null||P.tag!==4||P.stateNode.containerInfo!==M.containerInfo||P.stateNode.implementation!==M.implementation?(P=A_(M,B.mode,j),P.return=B,P):(P=p(P,M.children||[]),P.return=B,P)}function G(B,P,M,j,J){return P===null||P.tag!==7?(P=sa(M,B.mode,j,J),P.return=B,P):(P=p(P,M),P.return=B,P)}function F(B,P,M){if(typeof P=="string"&&P!==""||typeof P=="number")return P=I_(""+P,B.mode,M),P.return=B,P;if(typeof P=="object"&&P!==null){switch(P.$$typeof){case $u:return M=Ah(P.type,P.key,P.props,null,B.mode,M),M.ref=Cd(B,null,P),M.return=B,M;case oc:return P=A_(P,B.mode,M),P.return=B,P;case ls:var j=P._init;return F(B,j(P._payload),M)}if(Dd(P)||Sd(P))return P=sa(P,B.mode,M,null),P.return=B,P;dh(B,P)}return null}function H(B,P,M,j){var J=P!==null?P.key:null;if(typeof M=="string"&&M!==""||typeof M=="number")return J!==null?null:C(B,P,""+M,j);if(typeof M=="object"&&M!==null){switch(M.$$typeof){case $u:return M.key===J?L(B,P,M,j):null;case oc:return M.key===J?U(B,P,M,j):null;case ls:return J=M._init,H(B,P,J(M._payload),j)}if(Dd(M)||Sd(M))return J!==null?null:G(B,P,M,j,null);dh(B,M)}return null}function ne(B,P,M,j,J){if(typeof j=="string"&&j!==""||typeof j=="number")return B=B.get(M)||null,C(P,B,""+j,J);if(typeof j=="object"&&j!==null){switch(j.$$typeof){case $u:return B=B.get(j.key===null?M:j.key)||null,L(P,B,j,J);case oc:return B=B.get(j.key===null?M:j.key)||null,U(P,B,j,J);case ls:var Z=j._init;return ne(B,P,M,Z(j._payload),J)}if(Dd(j)||Sd(j))return B=B.get(M)||null,G(P,B,j,J,null);dh(P,j)}return null}function W(B,P,M,j){for(var J=null,Z=null,ce=P,me=P=0,_e=null;ce!==null&&me<M.length;me++){ce.index>me?(_e=ce,ce=null):_e=ce.sibling;var Ne=H(B,ce,M[me],j);if(Ne===null){ce===null&&(ce=_e);break}i&&ce&&Ne.alternate===null&&s(B,ce),P=_(Ne,P,me),Z===null?J=Ne:Z.sibling=Ne,Z=Ne,ce=_e}if(me===M.length)return c(B,ce),Zt&&ea(B,me),J;if(ce===null){for(;me<M.length;me++)ce=F(B,M[me],j),ce!==null&&(P=_(ce,P,me),Z===null?J=ce:Z.sibling=ce,Z=ce);return Zt&&ea(B,me),J}for(ce=l(B,ce);me<M.length;me++)_e=ne(ce,B,me,M[me],j),_e!==null&&(i&&_e.alternate!==null&&ce.delete(_e.key===null?me:_e.key),P=_(_e,P,me),Z===null?J=_e:Z.sibling=_e,Z=_e);return i&&ce.forEach(function(Ye){return s(B,Ye)}),Zt&&ea(B,me),J}function ie(B,P,M,j){var J=Sd(M);if(typeof J!="function")throw Error(fe(150));if(M=J.call(M),M==null)throw Error(fe(151));for(var Z=J=null,ce=P,me=P=0,_e=null,Ne=M.next();ce!==null&&!Ne.done;me++,Ne=M.next()){ce.index>me?(_e=ce,ce=null):_e=ce.sibling;var Ye=H(B,ce,Ne.value,j);if(Ye===null){ce===null&&(ce=_e);break}i&&ce&&Ye.alternate===null&&s(B,ce),P=_(Ye,P,me),Z===null?J=Ye:Z.sibling=Ye,Z=Ye,ce=_e}if(Ne.done)return c(B,ce),Zt&&ea(B,me),J;if(ce===null){for(;!Ne.done;me++,Ne=M.next())Ne=F(B,Ne.value,j),Ne!==null&&(P=_(Ne,P,me),Z===null?J=Ne:Z.sibling=Ne,Z=Ne);return Zt&&ea(B,me),J}for(ce=l(B,ce);!Ne.done;me++,Ne=M.next())Ne=ne(ce,B,me,Ne.value,j),Ne!==null&&(i&&Ne.alternate!==null&&ce.delete(Ne.key===null?me:Ne.key),P=_(Ne,P,me),Z===null?J=Ne:Z.sibling=Ne,Z=Ne);return i&&ce.forEach(function(en){return s(B,en)}),Zt&&ea(B,me),J}function Ie(B,P,M,j){if(typeof M=="object"&&M!==null&&M.type===sc&&M.key===null&&(M=M.props.children),typeof M=="object"&&M!==null){switch(M.$$typeof){case $u:e:{for(var J=M.key,Z=P;Z!==null;){if(Z.key===J){if(J=M.type,J===sc){if(Z.tag===7){c(B,Z.sibling),P=p(Z,M.props.children),P.return=B,B=P;break e}}else if(Z.elementType===J||typeof J=="object"&&J!==null&&J.$$typeof===ls&&fN(J)===Z.type){c(B,Z.sibling),P=p(Z,M.props),P.ref=Cd(B,Z,M),P.return=B,B=P;break e}c(B,Z);break}else s(B,Z);Z=Z.sibling}M.type===sc?(P=sa(M.props.children,B.mode,j,M.key),P.return=B,B=P):(j=Ah(M.type,M.key,M.props,null,B.mode,j),j.ref=Cd(B,P,M),j.return=B,B=j)}return y(B);case oc:e:{for(Z=M.key;P!==null;){if(P.key===Z)if(P.tag===4&&P.stateNode.containerInfo===M.containerInfo&&P.stateNode.implementation===M.implementation){c(B,P.sibling),P=p(P,M.children||[]),P.return=B,B=P;break e}else{c(B,P);break}else s(B,P);P=P.sibling}P=A_(M,B.mode,j),P.return=B,B=P}return y(B);case ls:return Z=M._init,Ie(B,P,Z(M._payload),j)}if(Dd(M))return W(B,P,M,j);if(Sd(M))return ie(B,P,M,j);dh(B,M)}return typeof M=="string"&&M!==""||typeof M=="number"?(M=""+M,P!==null&&P.tag===6?(c(B,P.sibling),P=p(P,M),P.return=B,B=P):(c(B,P),P=I_(M,B.mode,j),P.return=B,B=P),y(B)):c(B,P)}return Ie}var Ac=_D(!0),gD=_D(!1),pl={},oo=Os(pl),nl=Os(pl),rl=Os(pl);function ia(i){if(i===pl)throw Error(fe(174));return i}function rS(i,s){switch(Kt(rl,s),Kt(nl,i),Kt(oo,pl),i=s.nodeType,i){case 9:case 11:s=(s=s.documentElement)?s.namespaceURI:G_(null,"");break;default:i=i===8?s.parentNode:s,s=i.namespaceURI||null,i=i.tagName,s=G_(s,i)}Xt(oo),Kt(oo,s)}function Oc(){Xt(oo),Xt(nl),Xt(rl)}function SD(i){ia(rl.current);var s=ia(oo.current),c=G_(s,i.type);s!==c&&(Kt(nl,i),Kt(oo,c))}function iS(i){nl.current===i&&(Xt(oo),Xt(nl))}var rn=Os(0);function Xh(i){for(var s=i;s!==null;){if(s.tag===13){var c=s.memoizedState;if(c!==null&&(c=c.dehydrated,c===null||c.data==="$?"||c.data==="$!"))return s}else if(s.tag===19&&s.memoizedProps.revealOrder!==void 0){if(s.flags&128)return s}else if(s.child!==null){s.child.return=s,s=s.child;continue}if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return null;s=s.return}s.sibling.return=s.return,s=s.sibling}return null}var S_=[];function oS(){for(var i=0;i<S_.length;i++)S_[i]._workInProgressVersionPrimary=null;S_.length=0}var vh=Po.ReactCurrentDispatcher,T_=Po.ReactCurrentBatchConfig,da=0,on=null,Dn=null,jn=null,Qh=!1,Bd=!1,il=0,eW=0;function ar(){throw Error(fe(321))}function sS(i,s){if(s===null)return!1;for(var c=0;c<s.length&&c<i.length;c++)if(!Gi(i[c],s[c]))return!1;return!0}function aS(i,s,c,l,p,_){if(da=_,on=s,s.memoizedState=null,s.updateQueue=null,s.lanes=0,vh.current=i===null||i.memoizedState===null?iW:oW,i=c(l,p),Bd){_=0;do{if(Bd=!1,il=0,25<=_)throw Error(fe(301));_+=1,jn=Dn=null,s.updateQueue=null,vh.current=sW,i=c(l,p)}while(Bd)}if(vh.current=$h,s=Dn!==null&&Dn.next!==null,da=0,jn=Dn=on=null,Qh=!1,s)throw Error(fe(300));return i}function cS(){var i=il!==0;return il=0,i}function to(){var i={memoizedState:null,baseState:null,baseQueue:null,queue:null,next:null};return jn===null?on.memoizedState=jn=i:jn=jn.next=i,jn}function yi(){if(Dn===null){var i=on.alternate;i=i!==null?i.memoizedState:null}else i=Dn.next;var s=jn===null?on.memoizedState:jn.next;if(s!==null)jn=s,Dn=i;else{if(i===null)throw Error(fe(310));Dn=i,i={memoizedState:Dn.memoizedState,baseState:Dn.baseState,baseQueue:Dn.baseQueue,queue:Dn.queue,next:null},jn===null?on.memoizedState=jn=i:jn=jn.next=i}return jn}function ol(i,s){return typeof s=="function"?s(i):s}function v_(i){var s=yi(),c=s.queue;if(c===null)throw Error(fe(311));c.lastRenderedReducer=i;var l=Dn,p=l.baseQueue,_=c.pending;if(_!==null){if(p!==null){var y=p.next;p.next=_.next,_.next=y}l.baseQueue=p=_,c.pending=null}if(p!==null){_=p.next,l=l.baseState;var C=y=null,L=null,U=_;do{var G=U.lane;if((da&G)===G)L!==null&&(L=L.next={lane:0,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null}),l=U.hasEagerState?U.eagerState:i(l,U.action);else{var F={lane:G,action:U.action,hasEagerState:U.hasEagerState,eagerState:U.eagerState,next:null};L===null?(C=L=F,y=l):L=L.next=F,on.lanes|=G,la|=G}U=U.next}while(U!==null&&U!==_);L===null?y=l:L.next=C,Gi(l,s.memoizedState)||(kr=!0),s.memoizedState=l,s.baseState=y,s.baseQueue=L,c.lastRenderedState=l}if(i=c.interleaved,i!==null){p=i;do _=p.lane,on.lanes|=_,la|=_,p=p.next;while(p!==i)}else p===null&&(c.lanes=0);return[s.memoizedState,c.dispatch]}function y_(i){var s=yi(),c=s.queue;if(c===null)throw Error(fe(311));c.lastRenderedReducer=i;var l=c.dispatch,p=c.pending,_=s.memoizedState;if(p!==null){c.pending=null;var y=p=p.next;do _=i(_,y.action),y=y.next;while(y!==p);Gi(_,s.memoizedState)||(kr=!0),s.memoizedState=_,s.baseQueue===null&&(s.baseState=_),c.lastRenderedState=_}return[_,l]}function TD(){}function vD(i,s){var c=on,l=yi(),p=s(),_=!Gi(l.memoizedState,p);if(_&&(l.memoizedState=p,kr=!0),l=l.queue,dS(CD.bind(null,c,l,i),[i]),l.getSnapshot!==s||_||jn!==null&&jn.memoizedState.tag&1){if(c.flags|=2048,sl(9,RD.bind(null,c,l,p,s),void 0,null),Bn===null)throw Error(fe(349));da&30||yD(c,s,p)}return p}function yD(i,s,c){i.flags|=16384,i={getSnapshot:s,value:c},s=on.updateQueue,s===null?(s={lastEffect:null,stores:null},on.updateQueue=s,s.stores=[i]):(c=s.stores,c===null?s.stores=[i]:c.push(i))}function RD(i,s,c,l){s.value=c,s.getSnapshot=l,ID(s)&&AD(i)}function CD(i,s,c){return c(function(){ID(s)&&AD(i)})}function ID(i){var s=i.getSnapshot;i=i.value;try{var c=s();return!Gi(i,c)}catch{return!0}}function AD(i){var s=bo(i,1);s!==null&&Bi(s,i,1,-1)}function mN(i){var s=to();return typeof i=="function"&&(i=i()),s.memoizedState=s.baseState=i,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:ol,lastRenderedState:i},s.queue=i,i=i.dispatch=rW.bind(null,on,i),[s.memoizedState,i]}function sl(i,s,c,l){return i={tag:i,create:s,destroy:c,deps:l,next:null},s=on.updateQueue,s===null?(s={lastEffect:null,stores:null},on.updateQueue=s,s.lastEffect=i.next=i):(c=s.lastEffect,c===null?s.lastEffect=i.next=i:(l=c.next,c.next=i,i.next=l,s.lastEffect=i)),i}function OD(){return yi().memoizedState}function yh(i,s,c,l){var p=to();on.flags|=i,p.memoizedState=sl(1|s,c,void 0,l===void 0?null:l)}function pp(i,s,c,l){var p=yi();l=l===void 0?null:l;var _=void 0;if(Dn!==null){var y=Dn.memoizedState;if(_=y.destroy,l!==null&&sS(l,y.deps)){p.memoizedState=sl(s,c,_,l);return}}on.flags|=i,p.memoizedState=sl(1|s,c,_,l)}function EN(i,s){return yh(8390656,8,i,s)}function dS(i,s){return pp(2048,8,i,s)}function wD(i,s){return pp(4,2,i,s)}function ND(i,s){return pp(4,4,i,s)}function bD(i,s){if(typeof s=="function")return i=i(),s(i),function(){s(null)};if(s!=null)return i=i(),s.current=i,function(){s.current=null}}function DD(i,s,c){return c=c!=null?c.concat([i]):null,pp(4,4,bD.bind(null,s,i),c)}function lS(){}function PD(i,s){var c=yi();s=s===void 0?null:s;var l=c.memoizedState;return l!==null&&s!==null&&sS(s,l[1])?l[0]:(c.memoizedState=[i,s],i)}function LD(i,s){var c=yi();s=s===void 0?null:s;var l=c.memoizedState;return l!==null&&s!==null&&sS(s,l[1])?l[0]:(i=i(),c.memoizedState=[i,s],i)}function kD(i,s,c){return da&21?(Gi(c,s)||(c=xb(),on.lanes|=c,la|=c,i.baseState=!0),s):(i.baseState&&(i.baseState=!1,kr=!0),i.memoizedState=c)}function tW(i,s){var c=wt;wt=c!==0&&4>c?c:4,i(!0);var l=T_.transition;T_.transition={};try{i(!1),s()}finally{wt=c,T_.transition=l}}function MD(){return yi().memoizedState}function nW(i,s,c){var l=ys(i);if(c={lane:l,action:c,hasEagerState:!1,eagerState:null,next:null},UD(i))xD(s,c);else if(c=pD(i,s,c,l),c!==null){var p=gr();Bi(c,i,l,p),VD(c,s,l)}}function rW(i,s,c){var l=ys(i),p={lane:l,action:c,hasEagerState:!1,eagerState:null,next:null};if(UD(i))xD(s,p);else{var _=i.alternate;if(i.lanes===0&&(_===null||_.lanes===0)&&(_=s.lastRenderedReducer,_!==null))try{var y=s.lastRenderedState,C=_(y,c);if(p.hasEagerState=!0,p.eagerState=C,Gi(C,y)){var L=s.interleaved;L===null?(p.next=p,tS(s)):(p.next=L.next,L.next=p),s.interleaved=p;return}}catch{}finally{}c=pD(i,s,p,l),c!==null&&(p=gr(),Bi(c,i,l,p),VD(c,s,l))}}function UD(i){var s=i.alternate;return i===on||s!==null&&s===on}function xD(i,s){Bd=Qh=!0;var c=i.pending;c===null?s.next=s:(s.next=c.next,c.next=s),i.pending=s}function VD(i,s,c){if(c&4194240){var l=s.lanes;l&=i.pendingLanes,c|=l,s.lanes=c,Bg(i,c)}}var $h={readContext:vi,useCallback:ar,useContext:ar,useEffect:ar,useImperativeHandle:ar,useInsertionEffect:ar,useLayoutEffect:ar,useMemo:ar,useReducer:ar,useRef:ar,useState:ar,useDebugValue:ar,useDeferredValue:ar,useTransition:ar,useMutableSource:ar,useSyncExternalStore:ar,useId:ar,unstable_isNewReconciler:!1},iW={readContext:vi,useCallback:function(i,s){return to().memoizedState=[i,s===void 0?null:s],i},useContext:vi,useEffect:EN,useImperativeHandle:function(i,s,c){return c=c!=null?c.concat([i]):null,yh(4194308,4,bD.bind(null,s,i),c)},useLayoutEffect:function(i,s){return yh(4194308,4,i,s)},useInsertionEffect:function(i,s){return yh(4,2,i,s)},useMemo:function(i,s){var c=to();return s=s===void 0?null:s,i=i(),c.memoizedState=[i,s],i},useReducer:function(i,s,c){var l=to();return s=c!==void 0?c(s):s,l.memoizedState=l.baseState=s,i={pending:null,interleaved:null,lanes:0,dispatch:null,lastRenderedReducer:i,lastRenderedState:s},l.queue=i,i=i.dispatch=nW.bind(null,on,i),[l.memoizedState,i]},useRef:function(i){var s=to();return i={current:i},s.memoizedState=i},useState:mN,useDebugValue:lS,useDeferredValue:function(i){return to().memoizedState=i},useTransition:function(){var i=mN(!1),s=i[0];return i=tW.bind(null,i[1]),to().memoizedState=i,[s,i]},useMutableSource:function(){},useSyncExternalStore:function(i,s,c){var l=on,p=to();if(Zt){if(c===void 0)throw Error(fe(407));c=c()}else{if(c=s(),Bn===null)throw Error(fe(349));da&30||yD(l,s,c)}p.memoizedState=c;var _={value:c,getSnapshot:s};return p.queue=_,EN(CD.bind(null,l,_,i),[i]),l.flags|=2048,sl(9,RD.bind(null,l,_,c,s),void 0,null),c},useId:function(){var i=to(),s=Bn.identifierPrefix;if(Zt){var c=Io,l=Co;c=(l&~(1<<32-ji(l)-1)).toString(32)+c,s=":"+s+"R"+c,c=il++,0<c&&(s+="H"+c.toString(32)),s+=":"}else c=eW++,s=":"+s+"r"+c.toString(32)+":";return i.memoizedState=s},unstable_isNewReconciler:!1},oW={readContext:vi,useCallback:PD,useContext:vi,useEffect:dS,useImperativeHandle:DD,useInsertionEffect:wD,useLayoutEffect:ND,useMemo:LD,useReducer:v_,useRef:OD,useState:function(){return v_(ol)},useDebugValue:lS,useDeferredValue:function(i){var s=yi();return kD(s,Dn.memoizedState,i)},useTransition:function(){var i=v_(ol)[0],s=yi().memoizedState;return[i,s]},useMutableSource:TD,useSyncExternalStore:vD,useId:MD,unstable_isNewReconciler:!1},sW={readContext:vi,useCallback:PD,useContext:vi,useEffect:dS,useImperativeHandle:DD,useInsertionEffect:wD,useLayoutEffect:ND,useMemo:LD,useReducer:y_,useRef:OD,useState:function(){return y_(ol)},useDebugValue:lS,useDeferredValue:function(i){var s=yi();return Dn===null?s.memoizedState=i:kD(s,Dn.memoizedState,i)},useTransition:function(){var i=y_(ol)[0],s=yi().memoizedState;return[i,s]},useMutableSource:TD,useSyncExternalStore:vD,useId:MD,unstable_isNewReconciler:!1};function wc(i,s){try{var c="",l=s;do c+=k3(l),l=l.return;while(l);var p=c}catch(_){p=`
Error generating stack: `+_.message+`
`+_.stack}return{value:i,source:s,stack:p,digest:null}}function R_(i,s,c){return{value:i,source:null,stack:c??null,digest:s??null}}function ug(i,s){try{console.error(s.value)}catch(c){setTimeout(function(){throw c})}}var aW=typeof WeakMap=="function"?WeakMap:Map;function FD(i,s,c){c=Ao(-1,c),c.tag=3,c.payload={element:null};var l=s.value;return c.callback=function(){ep||(ep=!0,vg=l),ug(i,s)},c}function jD(i,s,c){c=Ao(-1,c),c.tag=3;var l=i.type.getDerivedStateFromError;if(typeof l=="function"){var p=s.value;c.payload=function(){return l(p)},c.callback=function(){ug(i,s)}}var _=i.stateNode;return _!==null&&typeof _.componentDidCatch=="function"&&(c.callback=function(){ug(i,s),typeof l!="function"&&(vs===null?vs=new Set([this]):vs.add(this));var y=s.stack;this.componentDidCatch(s.value,{componentStack:y!==null?y:""})}),c}function _N(i,s,c){var l=i.pingCache;if(l===null){l=i.pingCache=new aW;var p=new Set;l.set(s,p)}else p=l.get(s),p===void 0&&(p=new Set,l.set(s,p));p.has(c)||(p.add(c),i=vW.bind(null,i,s,c),s.then(i,i))}function gN(i){do{var s;if((s=i.tag===13)&&(s=i.memoizedState,s=s!==null?s.dehydrated!==null:!0),s)return i;i=i.return}while(i!==null);return null}function SN(i,s,c,l,p){return i.mode&1?(i.flags|=65536,i.lanes=p,i):(i===s?i.flags|=65536:(i.flags|=128,c.flags|=131072,c.flags&=-52805,c.tag===1&&(c.alternate===null?c.tag=17:(s=Ao(-1,1),s.tag=2,Ts(c,s,1))),c.lanes|=1),i)}var cW=Po.ReactCurrentOwner,kr=!1;function _r(i,s,c,l){s.child=i===null?gD(s,null,c,l):Ac(s,i.child,c,l)}function TN(i,s,c,l,p){c=c.render;var _=s.ref;return vc(s,p),l=aS(i,s,c,l,_,p),c=cS(),i!==null&&!kr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~p,Do(i,s,p)):(Zt&&c&&Jg(s),s.flags|=1,_r(i,s,l,p),s.child)}function vN(i,s,c,l,p){if(i===null){var _=c.type;return typeof _=="function"&&!gS(_)&&_.defaultProps===void 0&&c.compare===null&&c.defaultProps===void 0?(s.tag=15,s.type=_,BD(i,s,_,l,p)):(i=Ah(c.type,null,l,s,s.mode,p),i.ref=s.ref,i.return=s,s.child=i)}if(_=i.child,!(i.lanes&p)){var y=_.memoizedProps;if(c=c.compare,c=c!==null?c:$d,c(y,l)&&i.ref===s.ref)return Do(i,s,p)}return s.flags|=1,i=Rs(_,l),i.ref=s.ref,i.return=s,s.child=i}function BD(i,s,c,l,p){if(i!==null){var _=i.memoizedProps;if($d(_,l)&&i.ref===s.ref)if(kr=!1,s.pendingProps=l=_,(i.lanes&p)!==0)i.flags&131072&&(kr=!0);else return s.lanes=i.lanes,Do(i,s,p)}return hg(i,s,c,l,p)}function GD(i,s,c){var l=s.pendingProps,p=l.children,_=i!==null?i.memoizedState:null;if(l.mode==="hidden")if(!(s.mode&1))s.memoizedState={baseLanes:0,cachePool:null,transitions:null},Kt(Ec,ei),ei|=c;else{if(!(c&1073741824))return i=_!==null?_.baseLanes|c:c,s.lanes=s.childLanes=1073741824,s.memoizedState={baseLanes:i,cachePool:null,transitions:null},s.updateQueue=null,Kt(Ec,ei),ei|=i,null;s.memoizedState={baseLanes:0,cachePool:null,transitions:null},l=_!==null?_.baseLanes:c,Kt(Ec,ei),ei|=l}else _!==null?(l=_.baseLanes|c,s.memoizedState=null):l=c,Kt(Ec,ei),ei|=l;return _r(i,s,p,c),s.child}function WD(i,s){var c=s.ref;(i===null&&c!==null||i!==null&&i.ref!==c)&&(s.flags|=512,s.flags|=2097152)}function hg(i,s,c,l,p){var _=Ur(c)?aa:ur.current;return _=Cc(s,_),vc(s,p),c=aS(i,s,c,l,_,p),l=cS(),i!==null&&!kr?(s.updateQueue=i.updateQueue,s.flags&=-2053,i.lanes&=~p,Do(i,s,p)):(Zt&&l&&Jg(s),s.flags|=1,_r(i,s,c,p),s.child)}function yN(i,s,c,l,p){if(Ur(c)){var _=!0;Hh(s)}else _=!1;if(vc(s,p),s.stateNode===null)Rh(i,s),ED(s,c,l),lg(s,c,l,p),l=!0;else if(i===null){var y=s.stateNode,C=s.memoizedProps;y.props=C;var L=y.context,U=c.contextType;typeof U=="object"&&U!==null?U=vi(U):(U=Ur(c)?aa:ur.current,U=Cc(s,U));var G=c.getDerivedStateFromProps,F=typeof G=="function"||typeof y.getSnapshotBeforeUpdate=="function";F||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(C!==l||L!==U)&&pN(s,y,l,U),us=!1;var H=s.memoizedState;y.state=H,Jh(s,l,y,p),L=s.memoizedState,C!==l||H!==L||Mr.current||us?(typeof G=="function"&&(dg(s,c,G,l),L=s.memoizedState),(C=us||hN(s,c,C,l,H,L,U))?(F||typeof y.UNSAFE_componentWillMount!="function"&&typeof y.componentWillMount!="function"||(typeof y.componentWillMount=="function"&&y.componentWillMount(),typeof y.UNSAFE_componentWillMount=="function"&&y.UNSAFE_componentWillMount()),typeof y.componentDidMount=="function"&&(s.flags|=4194308)):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),s.memoizedProps=l,s.memoizedState=L),y.props=l,y.state=L,y.context=U,l=C):(typeof y.componentDidMount=="function"&&(s.flags|=4194308),l=!1)}else{y=s.stateNode,fD(i,s),C=s.memoizedProps,U=s.type===s.elementType?C:xi(s.type,C),y.props=U,F=s.pendingProps,H=y.context,L=c.contextType,typeof L=="object"&&L!==null?L=vi(L):(L=Ur(c)?aa:ur.current,L=Cc(s,L));var ne=c.getDerivedStateFromProps;(G=typeof ne=="function"||typeof y.getSnapshotBeforeUpdate=="function")||typeof y.UNSAFE_componentWillReceiveProps!="function"&&typeof y.componentWillReceiveProps!="function"||(C!==F||H!==L)&&pN(s,y,l,L),us=!1,H=s.memoizedState,y.state=H,Jh(s,l,y,p);var W=s.memoizedState;C!==F||H!==W||Mr.current||us?(typeof ne=="function"&&(dg(s,c,ne,l),W=s.memoizedState),(U=us||hN(s,c,U,l,H,W,L)||!1)?(G||typeof y.UNSAFE_componentWillUpdate!="function"&&typeof y.componentWillUpdate!="function"||(typeof y.componentWillUpdate=="function"&&y.componentWillUpdate(l,W,L),typeof y.UNSAFE_componentWillUpdate=="function"&&y.UNSAFE_componentWillUpdate(l,W,L)),typeof y.componentDidUpdate=="function"&&(s.flags|=4),typeof y.getSnapshotBeforeUpdate=="function"&&(s.flags|=1024)):(typeof y.componentDidUpdate!="function"||C===i.memoizedProps&&H===i.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&H===i.memoizedState||(s.flags|=1024),s.memoizedProps=l,s.memoizedState=W),y.props=l,y.state=W,y.context=L,l=U):(typeof y.componentDidUpdate!="function"||C===i.memoizedProps&&H===i.memoizedState||(s.flags|=4),typeof y.getSnapshotBeforeUpdate!="function"||C===i.memoizedProps&&H===i.memoizedState||(s.flags|=1024),l=!1)}return pg(i,s,c,l,_,p)}function pg(i,s,c,l,p,_){WD(i,s);var y=(s.flags&128)!==0;if(!l&&!y)return p&&aN(s,c,!1),Do(i,s,_);l=s.stateNode,cW.current=s;var C=y&&typeof c.getDerivedStateFromError!="function"?null:l.render();return s.flags|=1,i!==null&&y?(s.child=Ac(s,i.child,null,_),s.child=Ac(s,null,C,_)):_r(i,s,C,_),s.memoizedState=l.state,p&&aN(s,c,!0),s.child}function HD(i){var s=i.stateNode;s.pendingContext?sN(i,s.pendingContext,s.pendingContext!==s.context):s.context&&sN(i,s.context,!1),rS(i,s.containerInfo)}function RN(i,s,c,l,p){return Ic(),Qg(p),s.flags|=256,_r(i,s,c,l),s.child}var fg={dehydrated:null,treeContext:null,retryLane:0};function mg(i){return{baseLanes:i,cachePool:null,transitions:null}}function KD(i,s,c){var l=s.pendingProps,p=rn.current,_=!1,y=(s.flags&128)!==0,C;if((C=y)||(C=i!==null&&i.memoizedState===null?!1:(p&2)!==0),C?(_=!0,s.flags&=-129):(i===null||i.memoizedState!==null)&&(p|=1),Kt(rn,p&1),i===null)return ag(s),i=s.memoizedState,i!==null&&(i=i.dehydrated,i!==null)?(s.mode&1?i.data==="$!"?s.lanes=8:s.lanes=1073741824:s.lanes=1,null):(y=l.children,i=l.fallback,_?(l=s.mode,_=s.child,y={mode:"hidden",children:y},!(l&1)&&_!==null?(_.childLanes=0,_.pendingProps=y):_=Ep(y,l,0,null),i=sa(i,l,c,null),_.return=s,i.return=s,_.sibling=i,s.child=_,s.child.memoizedState=mg(c),s.memoizedState=fg,i):uS(s,y));if(p=i.memoizedState,p!==null&&(C=p.dehydrated,C!==null))return dW(i,s,y,l,C,p,c);if(_){_=l.fallback,y=s.mode,p=i.child,C=p.sibling;var L={mode:"hidden",children:l.children};return!(y&1)&&s.child!==p?(l=s.child,l.childLanes=0,l.pendingProps=L,s.deletions=null):(l=Rs(p,L),l.subtreeFlags=p.subtreeFlags&14680064),C!==null?_=Rs(C,_):(_=sa(_,y,c,null),_.flags|=2),_.return=s,l.return=s,l.sibling=_,s.child=l,l=_,_=s.child,y=i.child.memoizedState,y=y===null?mg(c):{baseLanes:y.baseLanes|c,cachePool:null,transitions:y.transitions},_.memoizedState=y,_.childLanes=i.childLanes&~c,s.memoizedState=fg,l}return _=i.child,i=_.sibling,l=Rs(_,{mode:"visible",children:l.children}),!(s.mode&1)&&(l.lanes=c),l.return=s,l.sibling=null,i!==null&&(c=s.deletions,c===null?(s.deletions=[i],s.flags|=16):c.push(i)),s.child=l,s.memoizedState=null,l}function uS(i,s){return s=Ep({mode:"visible",children:s},i.mode,0,null),s.return=i,i.child=s}function lh(i,s,c,l){return l!==null&&Qg(l),Ac(s,i.child,null,c),i=uS(s,s.pendingProps.children),i.flags|=2,s.memoizedState=null,i}function dW(i,s,c,l,p,_,y){if(c)return s.flags&256?(s.flags&=-257,l=R_(Error(fe(422))),lh(i,s,y,l)):s.memoizedState!==null?(s.child=i.child,s.flags|=128,null):(_=l.fallback,p=s.mode,l=Ep({mode:"visible",children:l.children},p,0,null),_=sa(_,p,y,null),_.flags|=2,l.return=s,_.return=s,l.sibling=_,s.child=l,s.mode&1&&Ac(s,i.child,null,y),s.child.memoizedState=mg(y),s.memoizedState=fg,_);if(!(s.mode&1))return lh(i,s,y,null);if(p.data==="$!"){if(l=p.nextSibling&&p.nextSibling.dataset,l)var C=l.dgst;return l=C,_=Error(fe(419)),l=R_(_,l,void 0),lh(i,s,y,l)}if(C=(y&i.childLanes)!==0,kr||C){if(l=Bn,l!==null){switch(y&-y){case 4:p=2;break;case 16:p=8;break;case 64:case 128:case 256:case 512:case 1024:case 2048:case 4096:case 8192:case 16384:case 32768:case 65536:case 131072:case 262144:case 524288:case 1048576:case 2097152:case 4194304:case 8388608:case 16777216:case 33554432:case 67108864:p=32;break;case 536870912:p=268435456;break;default:p=0}p=p&(l.suspendedLanes|y)?0:p,p!==0&&p!==_.retryLane&&(_.retryLane=p,bo(i,p),Bi(l,i,p,-1))}return _S(),l=R_(Error(fe(421))),lh(i,s,y,l)}return p.data==="$?"?(s.flags|=128,s.child=i.child,s=yW.bind(null,i),p._reactRetry=s,null):(i=_.treeContext,ti=Ss(p.nextSibling),ni=s,Zt=!0,Fi=null,i!==null&&(Ei[_i++]=Co,Ei[_i++]=Io,Ei[_i++]=ca,Co=i.id,Io=i.overflow,ca=s),s=uS(s,l.children),s.flags|=4096,s)}function CN(i,s,c){i.lanes|=s;var l=i.alternate;l!==null&&(l.lanes|=s),cg(i.return,s,c)}function C_(i,s,c,l,p){var _=i.memoizedState;_===null?i.memoizedState={isBackwards:s,rendering:null,renderingStartTime:0,last:l,tail:c,tailMode:p}:(_.isBackwards=s,_.rendering=null,_.renderingStartTime=0,_.last=l,_.tail=c,_.tailMode=p)}function zD(i,s,c){var l=s.pendingProps,p=l.revealOrder,_=l.tail;if(_r(i,s,l.children,c),l=rn.current,l&2)l=l&1|2,s.flags|=128;else{if(i!==null&&i.flags&128)e:for(i=s.child;i!==null;){if(i.tag===13)i.memoizedState!==null&&CN(i,c,s);else if(i.tag===19)CN(i,c,s);else if(i.child!==null){i.child.return=i,i=i.child;continue}if(i===s)break e;for(;i.sibling===null;){if(i.return===null||i.return===s)break e;i=i.return}i.sibling.return=i.return,i=i.sibling}l&=1}if(Kt(rn,l),!(s.mode&1))s.memoizedState=null;else switch(p){case"forwards":for(c=s.child,p=null;c!==null;)i=c.alternate,i!==null&&Xh(i)===null&&(p=c),c=c.sibling;c=p,c===null?(p=s.child,s.child=null):(p=c.sibling,c.sibling=null),C_(s,!1,p,c,_);break;case"backwards":for(c=null,p=s.child,s.child=null;p!==null;){if(i=p.alternate,i!==null&&Xh(i)===null){s.child=p;break}i=p.sibling,p.sibling=c,c=p,p=i}C_(s,!0,c,null,_);break;case"together":C_(s,!1,null,null,void 0);break;default:s.memoizedState=null}return s.child}function Rh(i,s){!(s.mode&1)&&i!==null&&(i.alternate=null,s.alternate=null,s.flags|=2)}function Do(i,s,c){if(i!==null&&(s.dependencies=i.dependencies),la|=s.lanes,!(c&s.childLanes))return null;if(i!==null&&s.child!==i.child)throw Error(fe(153));if(s.child!==null){for(i=s.child,c=Rs(i,i.pendingProps),s.child=c,c.return=s;i.sibling!==null;)i=i.sibling,c=c.sibling=Rs(i,i.pendingProps),c.return=s;c.sibling=null}return s.child}function lW(i,s,c){switch(s.tag){case 3:HD(s),Ic();break;case 5:SD(s);break;case 1:Ur(s.type)&&Hh(s);break;case 4:rS(s,s.stateNode.containerInfo);break;case 10:var l=s.type._context,p=s.memoizedProps.value;Kt(Yh,l._currentValue),l._currentValue=p;break;case 13:if(l=s.memoizedState,l!==null)return l.dehydrated!==null?(Kt(rn,rn.current&1),s.flags|=128,null):c&s.child.childLanes?KD(i,s,c):(Kt(rn,rn.current&1),i=Do(i,s,c),i!==null?i.sibling:null);Kt(rn,rn.current&1);break;case 19:if(l=(c&s.childLanes)!==0,i.flags&128){if(l)return zD(i,s,c);s.flags|=128}if(p=s.memoizedState,p!==null&&(p.rendering=null,p.tail=null,p.lastEffect=null),Kt(rn,rn.current),l)break;return null;case 22:case 23:return s.lanes=0,GD(i,s,c)}return Do(i,s,c)}var YD,Eg,qD,JD;YD=function(i,s){for(var c=s.child;c!==null;){if(c.tag===5||c.tag===6)i.appendChild(c.stateNode);else if(c.tag!==4&&c.child!==null){c.child.return=c,c=c.child;continue}if(c===s)break;for(;c.sibling===null;){if(c.return===null||c.return===s)return;c=c.return}c.sibling.return=c.return,c=c.sibling}};Eg=function(){};qD=function(i,s,c,l){var p=i.memoizedProps;if(p!==l){i=s.stateNode,ia(oo.current);var _=null;switch(c){case"input":p=V_(i,p),l=V_(i,l),_=[];break;case"select":p=sn({},p,{value:void 0}),l=sn({},l,{value:void 0}),_=[];break;case"textarea":p=B_(i,p),l=B_(i,l),_=[];break;default:typeof p.onClick!="function"&&typeof l.onClick=="function"&&(i.onclick=Gh)}W_(c,l);var y;c=null;for(U in p)if(!l.hasOwnProperty(U)&&p.hasOwnProperty(U)&&p[U]!=null)if(U==="style"){var C=p[U];for(y in C)C.hasOwnProperty(y)&&(c||(c={}),c[y]="")}else U!=="dangerouslySetInnerHTML"&&U!=="children"&&U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&U!=="autoFocus"&&(Kd.hasOwnProperty(U)?_||(_=[]):(_=_||[]).push(U,null));for(U in l){var L=l[U];if(C=p!=null?p[U]:void 0,l.hasOwnProperty(U)&&L!==C&&(L!=null||C!=null))if(U==="style")if(C){for(y in C)!C.hasOwnProperty(y)||L&&L.hasOwnProperty(y)||(c||(c={}),c[y]="");for(y in L)L.hasOwnProperty(y)&&C[y]!==L[y]&&(c||(c={}),c[y]=L[y])}else c||(_||(_=[]),_.push(U,c)),c=L;else U==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,C=C?C.__html:void 0,L!=null&&C!==L&&(_=_||[]).push(U,L)):U==="children"?typeof L!="string"&&typeof L!="number"||(_=_||[]).push(U,""+L):U!=="suppressContentEditableWarning"&&U!=="suppressHydrationWarning"&&(Kd.hasOwnProperty(U)?(L!=null&&U==="onScroll"&&Jt("scroll",i),_||C===L||(_=[])):(_=_||[]).push(U,L))}c&&(_=_||[]).push("style",c);var U=_;(s.updateQueue=U)&&(s.flags|=4)}};JD=function(i,s,c,l){c!==l&&(s.flags|=4)};function Id(i,s){if(!Zt)switch(i.tailMode){case"hidden":s=i.tail;for(var c=null;s!==null;)s.alternate!==null&&(c=s),s=s.sibling;c===null?i.tail=null:c.sibling=null;break;case"collapsed":c=i.tail;for(var l=null;c!==null;)c.alternate!==null&&(l=c),c=c.sibling;l===null?s||i.tail===null?i.tail=null:i.tail.sibling=null:l.sibling=null}}function cr(i){var s=i.alternate!==null&&i.alternate.child===i.child,c=0,l=0;if(s)for(var p=i.child;p!==null;)c|=p.lanes|p.childLanes,l|=p.subtreeFlags&14680064,l|=p.flags&14680064,p.return=i,p=p.sibling;else for(p=i.child;p!==null;)c|=p.lanes|p.childLanes,l|=p.subtreeFlags,l|=p.flags,p.return=i,p=p.sibling;return i.subtreeFlags|=l,i.childLanes=c,s}function uW(i,s,c){var l=s.pendingProps;switch(Xg(s),s.tag){case 2:case 16:case 15:case 0:case 11:case 7:case 8:case 12:case 9:case 14:return cr(s),null;case 1:return Ur(s.type)&&Wh(),cr(s),null;case 3:return l=s.stateNode,Oc(),Xt(Mr),Xt(ur),oS(),l.pendingContext&&(l.context=l.pendingContext,l.pendingContext=null),(i===null||i.child===null)&&(ch(s)?s.flags|=4:i===null||i.memoizedState.isDehydrated&&!(s.flags&256)||(s.flags|=1024,Fi!==null&&(Cg(Fi),Fi=null))),Eg(i,s),cr(s),null;case 5:iS(s);var p=ia(rl.current);if(c=s.type,i!==null&&s.stateNode!=null)qD(i,s,c,l,p),i.ref!==s.ref&&(s.flags|=512,s.flags|=2097152);else{if(!l){if(s.stateNode===null)throw Error(fe(166));return cr(s),null}if(i=ia(oo.current),ch(s)){l=s.stateNode,c=s.type;var _=s.memoizedProps;switch(l[no]=s,l[tl]=_,i=(s.mode&1)!==0,c){case"dialog":Jt("cancel",l),Jt("close",l);break;case"iframe":case"object":case"embed":Jt("load",l);break;case"video":case"audio":for(p=0;p<Ld.length;p++)Jt(Ld[p],l);break;case"source":Jt("error",l);break;case"img":case"image":case"link":Jt("error",l),Jt("load",l);break;case"details":Jt("toggle",l);break;case"input":L0(l,_),Jt("invalid",l);break;case"select":l._wrapperState={wasMultiple:!!_.multiple},Jt("invalid",l);break;case"textarea":M0(l,_),Jt("invalid",l)}W_(c,_),p=null;for(var y in _)if(_.hasOwnProperty(y)){var C=_[y];y==="children"?typeof C=="string"?l.textContent!==C&&(_.suppressHydrationWarning!==!0&&ah(l.textContent,C,i),p=["children",C]):typeof C=="number"&&l.textContent!==""+C&&(_.suppressHydrationWarning!==!0&&ah(l.textContent,C,i),p=["children",""+C]):Kd.hasOwnProperty(y)&&C!=null&&y==="onScroll"&&Jt("scroll",l)}switch(c){case"input":Zu(l),k0(l,_,!0);break;case"textarea":Zu(l),U0(l);break;case"select":case"option":break;default:typeof _.onClick=="function"&&(l.onclick=Gh)}l=p,s.updateQueue=l,l!==null&&(s.flags|=4)}else{y=p.nodeType===9?p:p.ownerDocument,i==="http://www.w3.org/1999/xhtml"&&(i=yb(c)),i==="http://www.w3.org/1999/xhtml"?c==="script"?(i=y.createElement("div"),i.innerHTML="<script><\/script>",i=i.removeChild(i.firstChild)):typeof l.is=="string"?i=y.createElement(c,{is:l.is}):(i=y.createElement(c),c==="select"&&(y=i,l.multiple?y.multiple=!0:l.size&&(y.size=l.size))):i=y.createElementNS(i,c),i[no]=s,i[tl]=l,YD(i,s,!1,!1),s.stateNode=i;e:{switch(y=H_(c,l),c){case"dialog":Jt("cancel",i),Jt("close",i),p=l;break;case"iframe":case"object":case"embed":Jt("load",i),p=l;break;case"video":case"audio":for(p=0;p<Ld.length;p++)Jt(Ld[p],i);p=l;break;case"source":Jt("error",i),p=l;break;case"img":case"image":case"link":Jt("error",i),Jt("load",i),p=l;break;case"details":Jt("toggle",i),p=l;break;case"input":L0(i,l),p=V_(i,l),Jt("invalid",i);break;case"option":p=l;break;case"select":i._wrapperState={wasMultiple:!!l.multiple},p=sn({},l,{value:void 0}),Jt("invalid",i);break;case"textarea":M0(i,l),p=B_(i,l),Jt("invalid",i);break;default:p=l}W_(c,p),C=p;for(_ in C)if(C.hasOwnProperty(_)){var L=C[_];_==="style"?Ib(i,L):_==="dangerouslySetInnerHTML"?(L=L?L.__html:void 0,L!=null&&Rb(i,L)):_==="children"?typeof L=="string"?(c!=="textarea"||L!=="")&&zd(i,L):typeof L=="number"&&zd(i,""+L):_!=="suppressContentEditableWarning"&&_!=="suppressHydrationWarning"&&_!=="autoFocus"&&(Kd.hasOwnProperty(_)?L!=null&&_==="onScroll"&&Jt("scroll",i):L!=null&&Mg(i,_,L,y))}switch(c){case"input":Zu(i),k0(i,l,!1);break;case"textarea":Zu(i),U0(i);break;case"option":l.value!=null&&i.setAttribute("value",""+Cs(l.value));break;case"select":i.multiple=!!l.multiple,_=l.value,_!=null?_c(i,!!l.multiple,_,!1):l.defaultValue!=null&&_c(i,!!l.multiple,l.defaultValue,!0);break;default:typeof p.onClick=="function"&&(i.onclick=Gh)}switch(c){case"button":case"input":case"select":case"textarea":l=!!l.autoFocus;break e;case"img":l=!0;break e;default:l=!1}}l&&(s.flags|=4)}s.ref!==null&&(s.flags|=512,s.flags|=2097152)}return cr(s),null;case 6:if(i&&s.stateNode!=null)JD(i,s,i.memoizedProps,l);else{if(typeof l!="string"&&s.stateNode===null)throw Error(fe(166));if(c=ia(rl.current),ia(oo.current),ch(s)){if(l=s.stateNode,c=s.memoizedProps,l[no]=s,(_=l.nodeValue!==c)&&(i=ni,i!==null))switch(i.tag){case 3:ah(l.nodeValue,c,(i.mode&1)!==0);break;case 5:i.memoizedProps.suppressHydrationWarning!==!0&&ah(l.nodeValue,c,(i.mode&1)!==0)}_&&(s.flags|=4)}else l=(c.nodeType===9?c:c.ownerDocument).createTextNode(l),l[no]=s,s.stateNode=l}return cr(s),null;case 13:if(Xt(rn),l=s.memoizedState,i===null||i.memoizedState!==null&&i.memoizedState.dehydrated!==null){if(Zt&&ti!==null&&s.mode&1&&!(s.flags&128))hD(),Ic(),s.flags|=98560,_=!1;else if(_=ch(s),l!==null&&l.dehydrated!==null){if(i===null){if(!_)throw Error(fe(318));if(_=s.memoizedState,_=_!==null?_.dehydrated:null,!_)throw Error(fe(317));_[no]=s}else Ic(),!(s.flags&128)&&(s.memoizedState=null),s.flags|=4;cr(s),_=!1}else Fi!==null&&(Cg(Fi),Fi=null),_=!0;if(!_)return s.flags&65536?s:null}return s.flags&128?(s.lanes=c,s):(l=l!==null,l!==(i!==null&&i.memoizedState!==null)&&l&&(s.child.flags|=8192,s.mode&1&&(i===null||rn.current&1?Pn===0&&(Pn=3):_S())),s.updateQueue!==null&&(s.flags|=4),cr(s),null);case 4:return Oc(),Eg(i,s),i===null&&Zd(s.stateNode.containerInfo),cr(s),null;case 10:return eS(s.type._context),cr(s),null;case 17:return Ur(s.type)&&Wh(),cr(s),null;case 19:if(Xt(rn),_=s.memoizedState,_===null)return cr(s),null;if(l=(s.flags&128)!==0,y=_.rendering,y===null)if(l)Id(_,!1);else{if(Pn!==0||i!==null&&i.flags&128)for(i=s.child;i!==null;){if(y=Xh(i),y!==null){for(s.flags|=128,Id(_,!1),l=y.updateQueue,l!==null&&(s.updateQueue=l,s.flags|=4),s.subtreeFlags=0,l=c,c=s.child;c!==null;)_=c,i=l,_.flags&=14680066,y=_.alternate,y===null?(_.childLanes=0,_.lanes=i,_.child=null,_.subtreeFlags=0,_.memoizedProps=null,_.memoizedState=null,_.updateQueue=null,_.dependencies=null,_.stateNode=null):(_.childLanes=y.childLanes,_.lanes=y.lanes,_.child=y.child,_.subtreeFlags=0,_.deletions=null,_.memoizedProps=y.memoizedProps,_.memoizedState=y.memoizedState,_.updateQueue=y.updateQueue,_.type=y.type,i=y.dependencies,_.dependencies=i===null?null:{lanes:i.lanes,firstContext:i.firstContext}),c=c.sibling;return Kt(rn,rn.current&1|2),s.child}i=i.sibling}_.tail!==null&&pn()>Nc&&(s.flags|=128,l=!0,Id(_,!1),s.lanes=4194304)}else{if(!l)if(i=Xh(y),i!==null){if(s.flags|=128,l=!0,c=i.updateQueue,c!==null&&(s.updateQueue=c,s.flags|=4),Id(_,!0),_.tail===null&&_.tailMode==="hidden"&&!y.alternate&&!Zt)return cr(s),null}else 2*pn()-_.renderingStartTime>Nc&&c!==1073741824&&(s.flags|=128,l=!0,Id(_,!1),s.lanes=4194304);_.isBackwards?(y.sibling=s.child,s.child=y):(c=_.last,c!==null?c.sibling=y:s.child=y,_.last=y)}return _.tail!==null?(s=_.tail,_.rendering=s,_.tail=s.sibling,_.renderingStartTime=pn(),s.sibling=null,c=rn.current,Kt(rn,l?c&1|2:c&1),s):(cr(s),null);case 22:case 23:return ES(),l=s.memoizedState!==null,i!==null&&i.memoizedState!==null!==l&&(s.flags|=8192),l&&s.mode&1?ei&1073741824&&(cr(s),s.subtreeFlags&6&&(s.flags|=8192)):cr(s),null;case 24:return null;case 25:return null}throw Error(fe(156,s.tag))}function hW(i,s){switch(Xg(s),s.tag){case 1:return Ur(s.type)&&Wh(),i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 3:return Oc(),Xt(Mr),Xt(ur),oS(),i=s.flags,i&65536&&!(i&128)?(s.flags=i&-65537|128,s):null;case 5:return iS(s),null;case 13:if(Xt(rn),i=s.memoizedState,i!==null&&i.dehydrated!==null){if(s.alternate===null)throw Error(fe(340));Ic()}return i=s.flags,i&65536?(s.flags=i&-65537|128,s):null;case 19:return Xt(rn),null;case 4:return Oc(),null;case 10:return eS(s.type._context),null;case 22:case 23:return ES(),null;case 24:return null;default:return null}}var uh=!1,lr=!1,pW=typeof WeakSet=="function"?WeakSet:Set,we=null;function mc(i,s){var c=i.ref;if(c!==null)if(typeof c=="function")try{c(null)}catch(l){an(i,s,l)}else c.current=null}function _g(i,s,c){try{c()}catch(l){an(i,s,l)}}var IN=!1;function fW(i,s){if(eg=Fh,i=Zb(),qg(i)){if("selectionStart"in i)var c={start:i.selectionStart,end:i.selectionEnd};else e:{c=(c=i.ownerDocument)&&c.defaultView||window;var l=c.getSelection&&c.getSelection();if(l&&l.rangeCount!==0){c=l.anchorNode;var p=l.anchorOffset,_=l.focusNode;l=l.focusOffset;try{c.nodeType,_.nodeType}catch{c=null;break e}var y=0,C=-1,L=-1,U=0,G=0,F=i,H=null;t:for(;;){for(var ne;F!==c||p!==0&&F.nodeType!==3||(C=y+p),F!==_||l!==0&&F.nodeType!==3||(L=y+l),F.nodeType===3&&(y+=F.nodeValue.length),(ne=F.firstChild)!==null;)H=F,F=ne;for(;;){if(F===i)break t;if(H===c&&++U===p&&(C=y),H===_&&++G===l&&(L=y),(ne=F.nextSibling)!==null)break;F=H,H=F.parentNode}F=ne}c=C===-1||L===-1?null:{start:C,end:L}}else c=null}c=c||{start:0,end:0}}else c=null;for(tg={focusedElem:i,selectionRange:c},Fh=!1,we=s;we!==null;)if(s=we,i=s.child,(s.subtreeFlags&1028)!==0&&i!==null)i.return=s,we=i;else for(;we!==null;){s=we;try{var W=s.alternate;if(s.flags&1024)switch(s.tag){case 0:case 11:case 15:break;case 1:if(W!==null){var ie=W.memoizedProps,Ie=W.memoizedState,B=s.stateNode,P=B.getSnapshotBeforeUpdate(s.elementType===s.type?ie:xi(s.type,ie),Ie);B.__reactInternalSnapshotBeforeUpdate=P}break;case 3:var M=s.stateNode.containerInfo;M.nodeType===1?M.textContent="":M.nodeType===9&&M.documentElement&&M.removeChild(M.documentElement);break;case 5:case 6:case 4:case 17:break;default:throw Error(fe(163))}}catch(j){an(s,s.return,j)}if(i=s.sibling,i!==null){i.return=s.return,we=i;break}we=s.return}return W=IN,IN=!1,W}function Gd(i,s,c){var l=s.updateQueue;if(l=l!==null?l.lastEffect:null,l!==null){var p=l=l.next;do{if((p.tag&i)===i){var _=p.destroy;p.destroy=void 0,_!==void 0&&_g(s,c,_)}p=p.next}while(p!==l)}}function fp(i,s){if(s=s.updateQueue,s=s!==null?s.lastEffect:null,s!==null){var c=s=s.next;do{if((c.tag&i)===i){var l=c.create;c.destroy=l()}c=c.next}while(c!==s)}}function gg(i){var s=i.ref;if(s!==null){var c=i.stateNode;switch(i.tag){case 5:i=c;break;default:i=c}typeof s=="function"?s(i):s.current=i}}function XD(i){var s=i.alternate;s!==null&&(i.alternate=null,XD(s)),i.child=null,i.deletions=null,i.sibling=null,i.tag===5&&(s=i.stateNode,s!==null&&(delete s[no],delete s[tl],delete s[ig],delete s[XG],delete s[QG])),i.stateNode=null,i.return=null,i.dependencies=null,i.memoizedProps=null,i.memoizedState=null,i.pendingProps=null,i.stateNode=null,i.updateQueue=null}function QD(i){return i.tag===5||i.tag===3||i.tag===4}function AN(i){e:for(;;){for(;i.sibling===null;){if(i.return===null||QD(i.return))return null;i=i.return}for(i.sibling.return=i.return,i=i.sibling;i.tag!==5&&i.tag!==6&&i.tag!==18;){if(i.flags&2||i.child===null||i.tag===4)continue e;i.child.return=i,i=i.child}if(!(i.flags&2))return i.stateNode}}function Sg(i,s,c){var l=i.tag;if(l===5||l===6)i=i.stateNode,s?c.nodeType===8?c.parentNode.insertBefore(i,s):c.insertBefore(i,s):(c.nodeType===8?(s=c.parentNode,s.insertBefore(i,c)):(s=c,s.appendChild(i)),c=c._reactRootContainer,c!=null||s.onclick!==null||(s.onclick=Gh));else if(l!==4&&(i=i.child,i!==null))for(Sg(i,s,c),i=i.sibling;i!==null;)Sg(i,s,c),i=i.sibling}function Tg(i,s,c){var l=i.tag;if(l===5||l===6)i=i.stateNode,s?c.insertBefore(i,s):c.appendChild(i);else if(l!==4&&(i=i.child,i!==null))for(Tg(i,s,c),i=i.sibling;i!==null;)Tg(i,s,c),i=i.sibling}var qn=null,Vi=!1;function cs(i,s,c){for(c=c.child;c!==null;)$D(i,s,c),c=c.sibling}function $D(i,s,c){if(io&&typeof io.onCommitFiberUnmount=="function")try{io.onCommitFiberUnmount(sp,c)}catch{}switch(c.tag){case 5:lr||mc(c,s);case 6:var l=qn,p=Vi;qn=null,cs(i,s,c),qn=l,Vi=p,qn!==null&&(Vi?(i=qn,c=c.stateNode,i.nodeType===8?i.parentNode.removeChild(c):i.removeChild(c)):qn.removeChild(c.stateNode));break;case 18:qn!==null&&(Vi?(i=qn,c=c.stateNode,i.nodeType===8?__(i.parentNode,c):i.nodeType===1&&__(i,c),Xd(i)):__(qn,c.stateNode));break;case 4:l=qn,p=Vi,qn=c.stateNode.containerInfo,Vi=!0,cs(i,s,c),qn=l,Vi=p;break;case 0:case 11:case 14:case 15:if(!lr&&(l=c.updateQueue,l!==null&&(l=l.lastEffect,l!==null))){p=l=l.next;do{var _=p,y=_.destroy;_=_.tag,y!==void 0&&(_&2||_&4)&&_g(c,s,y),p=p.next}while(p!==l)}cs(i,s,c);break;case 1:if(!lr&&(mc(c,s),l=c.stateNode,typeof l.componentWillUnmount=="function"))try{l.props=c.memoizedProps,l.state=c.memoizedState,l.componentWillUnmount()}catch(C){an(c,s,C)}cs(i,s,c);break;case 21:cs(i,s,c);break;case 22:c.mode&1?(lr=(l=lr)||c.memoizedState!==null,cs(i,s,c),lr=l):cs(i,s,c);break;default:cs(i,s,c)}}function ON(i){var s=i.updateQueue;if(s!==null){i.updateQueue=null;var c=i.stateNode;c===null&&(c=i.stateNode=new pW),s.forEach(function(l){var p=RW.bind(null,i,l);c.has(l)||(c.add(l),l.then(p,p))})}}function Ui(i,s){var c=s.deletions;if(c!==null)for(var l=0;l<c.length;l++){var p=c[l];try{var _=i,y=s,C=y;e:for(;C!==null;){switch(C.tag){case 5:qn=C.stateNode,Vi=!1;break e;case 3:qn=C.stateNode.containerInfo,Vi=!0;break e;case 4:qn=C.stateNode.containerInfo,Vi=!0;break e}C=C.return}if(qn===null)throw Error(fe(160));$D(_,y,p),qn=null,Vi=!1;var L=p.alternate;L!==null&&(L.return=null),p.return=null}catch(U){an(p,s,U)}}if(s.subtreeFlags&12854)for(s=s.child;s!==null;)ZD(s,i),s=s.sibling}function ZD(i,s){var c=i.alternate,l=i.flags;switch(i.tag){case 0:case 11:case 14:case 15:if(Ui(s,i),eo(i),l&4){try{Gd(3,i,i.return),fp(3,i)}catch(ie){an(i,i.return,ie)}try{Gd(5,i,i.return)}catch(ie){an(i,i.return,ie)}}break;case 1:Ui(s,i),eo(i),l&512&&c!==null&&mc(c,c.return);break;case 5:if(Ui(s,i),eo(i),l&512&&c!==null&&mc(c,c.return),i.flags&32){var p=i.stateNode;try{zd(p,"")}catch(ie){an(i,i.return,ie)}}if(l&4&&(p=i.stateNode,p!=null)){var _=i.memoizedProps,y=c!==null?c.memoizedProps:_,C=i.type,L=i.updateQueue;if(i.updateQueue=null,L!==null)try{C==="input"&&_.type==="radio"&&_.name!=null&&Tb(p,_),H_(C,y);var U=H_(C,_);for(y=0;y<L.length;y+=2){var G=L[y],F=L[y+1];G==="style"?Ib(p,F):G==="dangerouslySetInnerHTML"?Rb(p,F):G==="children"?zd(p,F):Mg(p,G,F,U)}switch(C){case"input":F_(p,_);break;case"textarea":vb(p,_);break;case"select":var H=p._wrapperState.wasMultiple;p._wrapperState.wasMultiple=!!_.multiple;var ne=_.value;ne!=null?_c(p,!!_.multiple,ne,!1):H!==!!_.multiple&&(_.defaultValue!=null?_c(p,!!_.multiple,_.defaultValue,!0):_c(p,!!_.multiple,_.multiple?[]:"",!1))}p[tl]=_}catch(ie){an(i,i.return,ie)}}break;case 6:if(Ui(s,i),eo(i),l&4){if(i.stateNode===null)throw Error(fe(162));p=i.stateNode,_=i.memoizedProps;try{p.nodeValue=_}catch(ie){an(i,i.return,ie)}}break;case 3:if(Ui(s,i),eo(i),l&4&&c!==null&&c.memoizedState.isDehydrated)try{Xd(s.containerInfo)}catch(ie){an(i,i.return,ie)}break;case 4:Ui(s,i),eo(i);break;case 13:Ui(s,i),eo(i),p=i.child,p.flags&8192&&(_=p.memoizedState!==null,p.stateNode.isHidden=_,!_||p.alternate!==null&&p.alternate.memoizedState!==null||(fS=pn())),l&4&&ON(i);break;case 22:if(G=c!==null&&c.memoizedState!==null,i.mode&1?(lr=(U=lr)||G,Ui(s,i),lr=U):Ui(s,i),eo(i),l&8192){if(U=i.memoizedState!==null,(i.stateNode.isHidden=U)&&!G&&i.mode&1)for(we=i,G=i.child;G!==null;){for(F=we=G;we!==null;){switch(H=we,ne=H.child,H.tag){case 0:case 11:case 14:case 15:Gd(4,H,H.return);break;case 1:mc(H,H.return);var W=H.stateNode;if(typeof W.componentWillUnmount=="function"){l=H,c=H.return;try{s=l,W.props=s.memoizedProps,W.state=s.memoizedState,W.componentWillUnmount()}catch(ie){an(l,c,ie)}}break;case 5:mc(H,H.return);break;case 22:if(H.memoizedState!==null){NN(F);continue}}ne!==null?(ne.return=H,we=ne):NN(F)}G=G.sibling}e:for(G=null,F=i;;){if(F.tag===5){if(G===null){G=F;try{p=F.stateNode,U?(_=p.style,typeof _.setProperty=="function"?_.setProperty("display","none","important"):_.display="none"):(C=F.stateNode,L=F.memoizedProps.style,y=L!=null&&L.hasOwnProperty("display")?L.display:null,C.style.display=Cb("display",y))}catch(ie){an(i,i.return,ie)}}}else if(F.tag===6){if(G===null)try{F.stateNode.nodeValue=U?"":F.memoizedProps}catch(ie){an(i,i.return,ie)}}else if((F.tag!==22&&F.tag!==23||F.memoizedState===null||F===i)&&F.child!==null){F.child.return=F,F=F.child;continue}if(F===i)break e;for(;F.sibling===null;){if(F.return===null||F.return===i)break e;G===F&&(G=null),F=F.return}G===F&&(G=null),F.sibling.return=F.return,F=F.sibling}}break;case 19:Ui(s,i),eo(i),l&4&&ON(i);break;case 21:break;default:Ui(s,i),eo(i)}}function eo(i){var s=i.flags;if(s&2){try{e:{for(var c=i.return;c!==null;){if(QD(c)){var l=c;break e}c=c.return}throw Error(fe(160))}switch(l.tag){case 5:var p=l.stateNode;l.flags&32&&(zd(p,""),l.flags&=-33);var _=AN(i);Tg(i,_,p);break;case 3:case 4:var y=l.stateNode.containerInfo,C=AN(i);Sg(i,C,y);break;default:throw Error(fe(161))}}catch(L){an(i,i.return,L)}i.flags&=-3}s&4096&&(i.flags&=-4097)}function mW(i,s,c){we=i,eP(i)}function eP(i,s,c){for(var l=(i.mode&1)!==0;we!==null;){var p=we,_=p.child;if(p.tag===22&&l){var y=p.memoizedState!==null||uh;if(!y){var C=p.alternate,L=C!==null&&C.memoizedState!==null||lr;C=uh;var U=lr;if(uh=y,(lr=L)&&!U)for(we=p;we!==null;)y=we,L=y.child,y.tag===22&&y.memoizedState!==null?bN(p):L!==null?(L.return=y,we=L):bN(p);for(;_!==null;)we=_,eP(_),_=_.sibling;we=p,uh=C,lr=U}wN(i)}else p.subtreeFlags&8772&&_!==null?(_.return=p,we=_):wN(i)}}function wN(i){for(;we!==null;){var s=we;if(s.flags&8772){var c=s.alternate;try{if(s.flags&8772)switch(s.tag){case 0:case 11:case 15:lr||fp(5,s);break;case 1:var l=s.stateNode;if(s.flags&4&&!lr)if(c===null)l.componentDidMount();else{var p=s.elementType===s.type?c.memoizedProps:xi(s.type,c.memoizedProps);l.componentDidUpdate(p,c.memoizedState,l.__reactInternalSnapshotBeforeUpdate)}var _=s.updateQueue;_!==null&&uN(s,_,l);break;case 3:var y=s.updateQueue;if(y!==null){if(c=null,s.child!==null)switch(s.child.tag){case 5:c=s.child.stateNode;break;case 1:c=s.child.stateNode}uN(s,y,c)}break;case 5:var C=s.stateNode;if(c===null&&s.flags&4){c=C;var L=s.memoizedProps;switch(s.type){case"button":case"input":case"select":case"textarea":L.autoFocus&&c.focus();break;case"img":L.src&&(c.src=L.src)}}break;case 6:break;case 4:break;case 12:break;case 13:if(s.memoizedState===null){var U=s.alternate;if(U!==null){var G=U.memoizedState;if(G!==null){var F=G.dehydrated;F!==null&&Xd(F)}}}break;case 19:case 17:case 21:case 22:case 23:case 25:break;default:throw Error(fe(163))}lr||s.flags&512&&gg(s)}catch(H){an(s,s.return,H)}}if(s===i){we=null;break}if(c=s.sibling,c!==null){c.return=s.return,we=c;break}we=s.return}}function NN(i){for(;we!==null;){var s=we;if(s===i){we=null;break}var c=s.sibling;if(c!==null){c.return=s.return,we=c;break}we=s.return}}function bN(i){for(;we!==null;){var s=we;try{switch(s.tag){case 0:case 11:case 15:var c=s.return;try{fp(4,s)}catch(L){an(s,c,L)}break;case 1:var l=s.stateNode;if(typeof l.componentDidMount=="function"){var p=s.return;try{l.componentDidMount()}catch(L){an(s,p,L)}}var _=s.return;try{gg(s)}catch(L){an(s,_,L)}break;case 5:var y=s.return;try{gg(s)}catch(L){an(s,y,L)}}}catch(L){an(s,s.return,L)}if(s===i){we=null;break}var C=s.sibling;if(C!==null){C.return=s.return,we=C;break}we=s.return}}var EW=Math.ceil,Zh=Po.ReactCurrentDispatcher,hS=Po.ReactCurrentOwner,Si=Po.ReactCurrentBatchConfig,ft=0,Bn=null,An=null,Xn=0,ei=0,Ec=Os(0),Pn=0,al=null,la=0,mp=0,pS=0,Wd=null,Lr=null,fS=0,Nc=1/0,yo=null,ep=!1,vg=null,vs=null,hh=!1,ms=null,tp=0,Hd=0,yg=null,Ch=-1,Ih=0;function gr(){return ft&6?pn():Ch!==-1?Ch:Ch=pn()}function ys(i){return i.mode&1?ft&2&&Xn!==0?Xn&-Xn:ZG.transition!==null?(Ih===0&&(Ih=xb()),Ih):(i=wt,i!==0||(i=window.event,i=i===void 0?16:Hb(i.type)),i):1}function Bi(i,s,c,l){if(50<Hd)throw Hd=0,yg=null,Error(fe(185));ll(i,c,l),(!(ft&2)||i!==Bn)&&(i===Bn&&(!(ft&2)&&(mp|=c),Pn===4&&ps(i,Xn)),xr(i,l),c===1&&ft===0&&!(s.mode&1)&&(Nc=pn()+500,up&&ws()))}function xr(i,s){var c=i.callbackNode;Z3(i,s);var l=Vh(i,i===Bn?Xn:0);if(l===0)c!==null&&F0(c),i.callbackNode=null,i.callbackPriority=0;else if(s=l&-l,i.callbackPriority!==s){if(c!=null&&F0(c),s===1)i.tag===0?$G(DN.bind(null,i)):dD(DN.bind(null,i)),qG(function(){!(ft&6)&&ws()}),c=null;else{switch(Vb(l)){case 1:c=jg;break;case 4:c=Mb;break;case 16:c=xh;break;case 536870912:c=Ub;break;default:c=xh}c=cP(c,tP.bind(null,i))}i.callbackPriority=s,i.callbackNode=c}}function tP(i,s){if(Ch=-1,Ih=0,ft&6)throw Error(fe(327));var c=i.callbackNode;if(yc()&&i.callbackNode!==c)return null;var l=Vh(i,i===Bn?Xn:0);if(l===0)return null;if(l&30||l&i.expiredLanes||s)s=np(i,l);else{s=l;var p=ft;ft|=2;var _=rP();(Bn!==i||Xn!==s)&&(yo=null,Nc=pn()+500,oa(i,s));do try{SW();break}catch(C){nP(i,C)}while(1);Zg(),Zh.current=_,ft=p,An!==null?s=0:(Bn=null,Xn=0,s=Pn)}if(s!==0){if(s===2&&(p=J_(i),p!==0&&(l=p,s=Rg(i,p))),s===1)throw c=al,oa(i,0),ps(i,l),xr(i,pn()),c;if(s===6)ps(i,l);else{if(p=i.current.alternate,!(l&30)&&!_W(p)&&(s=np(i,l),s===2&&(_=J_(i),_!==0&&(l=_,s=Rg(i,_))),s===1))throw c=al,oa(i,0),ps(i,l),xr(i,pn()),c;switch(i.finishedWork=p,i.finishedLanes=l,s){case 0:case 1:throw Error(fe(345));case 2:ta(i,Lr,yo);break;case 3:if(ps(i,l),(l&130023424)===l&&(s=fS+500-pn(),10<s)){if(Vh(i,0)!==0)break;if(p=i.suspendedLanes,(p&l)!==l){gr(),i.pingedLanes|=i.suspendedLanes&p;break}i.timeoutHandle=rg(ta.bind(null,i,Lr,yo),s);break}ta(i,Lr,yo);break;case 4:if(ps(i,l),(l&4194240)===l)break;for(s=i.eventTimes,p=-1;0<l;){var y=31-ji(l);_=1<<y,y=s[y],y>p&&(p=y),l&=~_}if(l=p,l=pn()-l,l=(120>l?120:480>l?480:1080>l?1080:1920>l?1920:3e3>l?3e3:4320>l?4320:1960*EW(l/1960))-l,10<l){i.timeoutHandle=rg(ta.bind(null,i,Lr,yo),l);break}ta(i,Lr,yo);break;case 5:ta(i,Lr,yo);break;default:throw Error(fe(329))}}}return xr(i,pn()),i.callbackNode===c?tP.bind(null,i):null}function Rg(i,s){var c=Wd;return i.current.memoizedState.isDehydrated&&(oa(i,s).flags|=256),i=np(i,s),i!==2&&(s=Lr,Lr=c,s!==null&&Cg(s)),i}function Cg(i){Lr===null?Lr=i:Lr.push.apply(Lr,i)}function _W(i){for(var s=i;;){if(s.flags&16384){var c=s.updateQueue;if(c!==null&&(c=c.stores,c!==null))for(var l=0;l<c.length;l++){var p=c[l],_=p.getSnapshot;p=p.value;try{if(!Gi(_(),p))return!1}catch{return!1}}}if(c=s.child,s.subtreeFlags&16384&&c!==null)c.return=s,s=c;else{if(s===i)break;for(;s.sibling===null;){if(s.return===null||s.return===i)return!0;s=s.return}s.sibling.return=s.return,s=s.sibling}}return!0}function ps(i,s){for(s&=~pS,s&=~mp,i.suspendedLanes|=s,i.pingedLanes&=~s,i=i.expirationTimes;0<s;){var c=31-ji(s),l=1<<c;i[c]=-1,s&=~l}}function DN(i){if(ft&6)throw Error(fe(327));yc();var s=Vh(i,0);if(!(s&1))return xr(i,pn()),null;var c=np(i,s);if(i.tag!==0&&c===2){var l=J_(i);l!==0&&(s=l,c=Rg(i,l))}if(c===1)throw c=al,oa(i,0),ps(i,s),xr(i,pn()),c;if(c===6)throw Error(fe(345));return i.finishedWork=i.current.alternate,i.finishedLanes=s,ta(i,Lr,yo),xr(i,pn()),null}function mS(i,s){var c=ft;ft|=1;try{return i(s)}finally{ft=c,ft===0&&(Nc=pn()+500,up&&ws())}}function ua(i){ms!==null&&ms.tag===0&&!(ft&6)&&yc();var s=ft;ft|=1;var c=Si.transition,l=wt;try{if(Si.transition=null,wt=1,i)return i()}finally{wt=l,Si.transition=c,ft=s,!(ft&6)&&ws()}}function ES(){ei=Ec.current,Xt(Ec)}function oa(i,s){i.finishedWork=null,i.finishedLanes=0;var c=i.timeoutHandle;if(c!==-1&&(i.timeoutHandle=-1,YG(c)),An!==null)for(c=An.return;c!==null;){var l=c;switch(Xg(l),l.tag){case 1:l=l.type.childContextTypes,l!=null&&Wh();break;case 3:Oc(),Xt(Mr),Xt(ur),oS();break;case 5:iS(l);break;case 4:Oc();break;case 13:Xt(rn);break;case 19:Xt(rn);break;case 10:eS(l.type._context);break;case 22:case 23:ES()}c=c.return}if(Bn=i,An=i=Rs(i.current,null),Xn=ei=s,Pn=0,al=null,pS=mp=la=0,Lr=Wd=null,ra!==null){for(s=0;s<ra.length;s++)if(c=ra[s],l=c.interleaved,l!==null){c.interleaved=null;var p=l.next,_=c.pending;if(_!==null){var y=_.next;_.next=p,l.next=y}c.pending=l}ra=null}return i}function nP(i,s){do{var c=An;try{if(Zg(),vh.current=$h,Qh){for(var l=on.memoizedState;l!==null;){var p=l.queue;p!==null&&(p.pending=null),l=l.next}Qh=!1}if(da=0,jn=Dn=on=null,Bd=!1,il=0,hS.current=null,c===null||c.return===null){Pn=1,al=s,An=null;break}e:{var _=i,y=c.return,C=c,L=s;if(s=Xn,C.flags|=32768,L!==null&&typeof L=="object"&&typeof L.then=="function"){var U=L,G=C,F=G.tag;if(!(G.mode&1)&&(F===0||F===11||F===15)){var H=G.alternate;H?(G.updateQueue=H.updateQueue,G.memoizedState=H.memoizedState,G.lanes=H.lanes):(G.updateQueue=null,G.memoizedState=null)}var ne=gN(y);if(ne!==null){ne.flags&=-257,SN(ne,y,C,_,s),ne.mode&1&&_N(_,U,s),s=ne,L=U;var W=s.updateQueue;if(W===null){var ie=new Set;ie.add(L),s.updateQueue=ie}else W.add(L);break e}else{if(!(s&1)){_N(_,U,s),_S();break e}L=Error(fe(426))}}else if(Zt&&C.mode&1){var Ie=gN(y);if(Ie!==null){!(Ie.flags&65536)&&(Ie.flags|=256),SN(Ie,y,C,_,s),Qg(wc(L,C));break e}}_=L=wc(L,C),Pn!==4&&(Pn=2),Wd===null?Wd=[_]:Wd.push(_),_=y;do{switch(_.tag){case 3:_.flags|=65536,s&=-s,_.lanes|=s;var B=FD(_,L,s);lN(_,B);break e;case 1:C=L;var P=_.type,M=_.stateNode;if(!(_.flags&128)&&(typeof P.getDerivedStateFromError=="function"||M!==null&&typeof M.componentDidCatch=="function"&&(vs===null||!vs.has(M)))){_.flags|=65536,s&=-s,_.lanes|=s;var j=jD(_,C,s);lN(_,j);break e}}_=_.return}while(_!==null)}oP(c)}catch(J){s=J,An===c&&c!==null&&(An=c=c.return);continue}break}while(1)}function rP(){var i=Zh.current;return Zh.current=$h,i===null?$h:i}function _S(){(Pn===0||Pn===3||Pn===2)&&(Pn=4),Bn===null||!(la&268435455)&&!(mp&268435455)||ps(Bn,Xn)}function np(i,s){var c=ft;ft|=2;var l=rP();(Bn!==i||Xn!==s)&&(yo=null,oa(i,s));do try{gW();break}catch(p){nP(i,p)}while(1);if(Zg(),ft=c,Zh.current=l,An!==null)throw Error(fe(261));return Bn=null,Xn=0,Pn}function gW(){for(;An!==null;)iP(An)}function SW(){for(;An!==null&&!H3();)iP(An)}function iP(i){var s=aP(i.alternate,i,ei);i.memoizedProps=i.pendingProps,s===null?oP(i):An=s,hS.current=null}function oP(i){var s=i;do{var c=s.alternate;if(i=s.return,s.flags&32768){if(c=hW(c,s),c!==null){c.flags&=32767,An=c;return}if(i!==null)i.flags|=32768,i.subtreeFlags=0,i.deletions=null;else{Pn=6,An=null;return}}else if(c=uW(c,s,ei),c!==null){An=c;return}if(s=s.sibling,s!==null){An=s;return}An=s=i}while(s!==null);Pn===0&&(Pn=5)}function ta(i,s,c){var l=wt,p=Si.transition;try{Si.transition=null,wt=1,TW(i,s,c,l)}finally{Si.transition=p,wt=l}return null}function TW(i,s,c,l){do yc();while(ms!==null);if(ft&6)throw Error(fe(327));c=i.finishedWork;var p=i.finishedLanes;if(c===null)return null;if(i.finishedWork=null,i.finishedLanes=0,c===i.current)throw Error(fe(177));i.callbackNode=null,i.callbackPriority=0;var _=c.lanes|c.childLanes;if(eG(i,_),i===Bn&&(An=Bn=null,Xn=0),!(c.subtreeFlags&2064)&&!(c.flags&2064)||hh||(hh=!0,cP(xh,function(){return yc(),null})),_=(c.flags&15990)!==0,c.subtreeFlags&15990||_){_=Si.transition,Si.transition=null;var y=wt;wt=1;var C=ft;ft|=4,hS.current=null,fW(i,c),ZD(c,i),jG(tg),Fh=!!eg,tg=eg=null,i.current=c,mW(c),K3(),ft=C,wt=y,Si.transition=_}else i.current=c;if(hh&&(hh=!1,ms=i,tp=p),_=i.pendingLanes,_===0&&(vs=null),q3(c.stateNode),xr(i,pn()),s!==null)for(l=i.onRecoverableError,c=0;c<s.length;c++)p=s[c],l(p.value,{componentStack:p.stack,digest:p.digest});if(ep)throw ep=!1,i=vg,vg=null,i;return tp&1&&i.tag!==0&&yc(),_=i.pendingLanes,_&1?i===yg?Hd++:(Hd=0,yg=i):Hd=0,ws(),null}function yc(){if(ms!==null){var i=Vb(tp),s=Si.transition,c=wt;try{if(Si.transition=null,wt=16>i?16:i,ms===null)var l=!1;else{if(i=ms,ms=null,tp=0,ft&6)throw Error(fe(331));var p=ft;for(ft|=4,we=i.current;we!==null;){var _=we,y=_.child;if(we.flags&16){var C=_.deletions;if(C!==null){for(var L=0;L<C.length;L++){var U=C[L];for(we=U;we!==null;){var G=we;switch(G.tag){case 0:case 11:case 15:Gd(8,G,_)}var F=G.child;if(F!==null)F.return=G,we=F;else for(;we!==null;){G=we;var H=G.sibling,ne=G.return;if(XD(G),G===U){we=null;break}if(H!==null){H.return=ne,we=H;break}we=ne}}}var W=_.alternate;if(W!==null){var ie=W.child;if(ie!==null){W.child=null;do{var Ie=ie.sibling;ie.sibling=null,ie=Ie}while(ie!==null)}}we=_}}if(_.subtreeFlags&2064&&y!==null)y.return=_,we=y;else e:for(;we!==null;){if(_=we,_.flags&2048)switch(_.tag){case 0:case 11:case 15:Gd(9,_,_.return)}var B=_.sibling;if(B!==null){B.return=_.return,we=B;break e}we=_.return}}var P=i.current;for(we=P;we!==null;){y=we;var M=y.child;if(y.subtreeFlags&2064&&M!==null)M.return=y,we=M;else e:for(y=P;we!==null;){if(C=we,C.flags&2048)try{switch(C.tag){case 0:case 11:case 15:fp(9,C)}}catch(J){an(C,C.return,J)}if(C===y){we=null;break e}var j=C.sibling;if(j!==null){j.return=C.return,we=j;break e}we=C.return}}if(ft=p,ws(),io&&typeof io.onPostCommitFiberRoot=="function")try{io.onPostCommitFiberRoot(sp,i)}catch{}l=!0}return l}finally{wt=c,Si.transition=s}}return!1}function PN(i,s,c){s=wc(c,s),s=FD(i,s,1),i=Ts(i,s,1),s=gr(),i!==null&&(ll(i,1,s),xr(i,s))}function an(i,s,c){if(i.tag===3)PN(i,i,c);else for(;s!==null;){if(s.tag===3){PN(s,i,c);break}else if(s.tag===1){var l=s.stateNode;if(typeof s.type.getDerivedStateFromError=="function"||typeof l.componentDidCatch=="function"&&(vs===null||!vs.has(l))){i=wc(c,i),i=jD(s,i,1),s=Ts(s,i,1),i=gr(),s!==null&&(ll(s,1,i),xr(s,i));break}}s=s.return}}function vW(i,s,c){var l=i.pingCache;l!==null&&l.delete(s),s=gr(),i.pingedLanes|=i.suspendedLanes&c,Bn===i&&(Xn&c)===c&&(Pn===4||Pn===3&&(Xn&130023424)===Xn&&500>pn()-fS?oa(i,0):pS|=c),xr(i,s)}function sP(i,s){s===0&&(i.mode&1?(s=nh,nh<<=1,!(nh&130023424)&&(nh=4194304)):s=1);var c=gr();i=bo(i,s),i!==null&&(ll(i,s,c),xr(i,c))}function yW(i){var s=i.memoizedState,c=0;s!==null&&(c=s.retryLane),sP(i,c)}function RW(i,s){var c=0;switch(i.tag){case 13:var l=i.stateNode,p=i.memoizedState;p!==null&&(c=p.retryLane);break;case 19:l=i.stateNode;break;default:throw Error(fe(314))}l!==null&&l.delete(s),sP(i,c)}var aP;aP=function(i,s,c){if(i!==null)if(i.memoizedProps!==s.pendingProps||Mr.current)kr=!0;else{if(!(i.lanes&c)&&!(s.flags&128))return kr=!1,lW(i,s,c);kr=!!(i.flags&131072)}else kr=!1,Zt&&s.flags&1048576&&lD(s,zh,s.index);switch(s.lanes=0,s.tag){case 2:var l=s.type;Rh(i,s),i=s.pendingProps;var p=Cc(s,ur.current);vc(s,c),p=aS(null,s,l,i,p,c);var _=cS();return s.flags|=1,typeof p=="object"&&p!==null&&typeof p.render=="function"&&p.$$typeof===void 0?(s.tag=1,s.memoizedState=null,s.updateQueue=null,Ur(l)?(_=!0,Hh(s)):_=!1,s.memoizedState=p.state!==null&&p.state!==void 0?p.state:null,nS(s),p.updater=hp,s.stateNode=p,p._reactInternals=s,lg(s,l,i,c),s=pg(null,s,l,!0,_,c)):(s.tag=0,Zt&&_&&Jg(s),_r(null,s,p,c),s=s.child),s;case 16:l=s.elementType;e:{switch(Rh(i,s),i=s.pendingProps,p=l._init,l=p(l._payload),s.type=l,p=s.tag=IW(l),i=xi(l,i),p){case 0:s=hg(null,s,l,i,c);break e;case 1:s=yN(null,s,l,i,c);break e;case 11:s=TN(null,s,l,i,c);break e;case 14:s=vN(null,s,l,xi(l.type,i),c);break e}throw Error(fe(306,l,""))}return s;case 0:return l=s.type,p=s.pendingProps,p=s.elementType===l?p:xi(l,p),hg(i,s,l,p,c);case 1:return l=s.type,p=s.pendingProps,p=s.elementType===l?p:xi(l,p),yN(i,s,l,p,c);case 3:e:{if(HD(s),i===null)throw Error(fe(387));l=s.pendingProps,_=s.memoizedState,p=_.element,fD(i,s),Jh(s,l,null,c);var y=s.memoizedState;if(l=y.element,_.isDehydrated)if(_={element:l,isDehydrated:!1,cache:y.cache,pendingSuspenseBoundaries:y.pendingSuspenseBoundaries,transitions:y.transitions},s.updateQueue.baseState=_,s.memoizedState=_,s.flags&256){p=wc(Error(fe(423)),s),s=RN(i,s,l,c,p);break e}else if(l!==p){p=wc(Error(fe(424)),s),s=RN(i,s,l,c,p);break e}else for(ti=Ss(s.stateNode.containerInfo.firstChild),ni=s,Zt=!0,Fi=null,c=gD(s,null,l,c),s.child=c;c;)c.flags=c.flags&-3|4096,c=c.sibling;else{if(Ic(),l===p){s=Do(i,s,c);break e}_r(i,s,l,c)}s=s.child}return s;case 5:return SD(s),i===null&&ag(s),l=s.type,p=s.pendingProps,_=i!==null?i.memoizedProps:null,y=p.children,ng(l,p)?y=null:_!==null&&ng(l,_)&&(s.flags|=32),WD(i,s),_r(i,s,y,c),s.child;case 6:return i===null&&ag(s),null;case 13:return KD(i,s,c);case 4:return rS(s,s.stateNode.containerInfo),l=s.pendingProps,i===null?s.child=Ac(s,null,l,c):_r(i,s,l,c),s.child;case 11:return l=s.type,p=s.pendingProps,p=s.elementType===l?p:xi(l,p),TN(i,s,l,p,c);case 7:return _r(i,s,s.pendingProps,c),s.child;case 8:return _r(i,s,s.pendingProps.children,c),s.child;case 12:return _r(i,s,s.pendingProps.children,c),s.child;case 10:e:{if(l=s.type._context,p=s.pendingProps,_=s.memoizedProps,y=p.value,Kt(Yh,l._currentValue),l._currentValue=y,_!==null)if(Gi(_.value,y)){if(_.children===p.children&&!Mr.current){s=Do(i,s,c);break e}}else for(_=s.child,_!==null&&(_.return=s);_!==null;){var C=_.dependencies;if(C!==null){y=_.child;for(var L=C.firstContext;L!==null;){if(L.context===l){if(_.tag===1){L=Ao(-1,c&-c),L.tag=2;var U=_.updateQueue;if(U!==null){U=U.shared;var G=U.pending;G===null?L.next=L:(L.next=G.next,G.next=L),U.pending=L}}_.lanes|=c,L=_.alternate,L!==null&&(L.lanes|=c),cg(_.return,c,s),C.lanes|=c;break}L=L.next}}else if(_.tag===10)y=_.type===s.type?null:_.child;else if(_.tag===18){if(y=_.return,y===null)throw Error(fe(341));y.lanes|=c,C=y.alternate,C!==null&&(C.lanes|=c),cg(y,c,s),y=_.sibling}else y=_.child;if(y!==null)y.return=_;else for(y=_;y!==null;){if(y===s){y=null;break}if(_=y.sibling,_!==null){_.return=y.return,y=_;break}y=y.return}_=y}_r(i,s,p.children,c),s=s.child}return s;case 9:return p=s.type,l=s.pendingProps.children,vc(s,c),p=vi(p),l=l(p),s.flags|=1,_r(i,s,l,c),s.child;case 14:return l=s.type,p=xi(l,s.pendingProps),p=xi(l.type,p),vN(i,s,l,p,c);case 15:return BD(i,s,s.type,s.pendingProps,c);case 17:return l=s.type,p=s.pendingProps,p=s.elementType===l?p:xi(l,p),Rh(i,s),s.tag=1,Ur(l)?(i=!0,Hh(s)):i=!1,vc(s,c),ED(s,l,p),lg(s,l,p,c),pg(null,s,l,!0,i,c);case 19:return zD(i,s,c);case 22:return GD(i,s,c)}throw Error(fe(156,s.tag))};function cP(i,s){return kb(i,s)}function CW(i,s,c,l){this.tag=i,this.key=c,this.sibling=this.child=this.return=this.stateNode=this.type=this.elementType=null,this.index=0,this.ref=null,this.pendingProps=s,this.dependencies=this.memoizedState=this.updateQueue=this.memoizedProps=null,this.mode=l,this.subtreeFlags=this.flags=0,this.deletions=null,this.childLanes=this.lanes=0,this.alternate=null}function gi(i,s,c,l){return new CW(i,s,c,l)}function gS(i){return i=i.prototype,!(!i||!i.isReactComponent)}function IW(i){if(typeof i=="function")return gS(i)?1:0;if(i!=null){if(i=i.$$typeof,i===xg)return 11;if(i===Vg)return 14}return 2}function Rs(i,s){var c=i.alternate;return c===null?(c=gi(i.tag,s,i.key,i.mode),c.elementType=i.elementType,c.type=i.type,c.stateNode=i.stateNode,c.alternate=i,i.alternate=c):(c.pendingProps=s,c.type=i.type,c.flags=0,c.subtreeFlags=0,c.deletions=null),c.flags=i.flags&14680064,c.childLanes=i.childLanes,c.lanes=i.lanes,c.child=i.child,c.memoizedProps=i.memoizedProps,c.memoizedState=i.memoizedState,c.updateQueue=i.updateQueue,s=i.dependencies,c.dependencies=s===null?null:{lanes:s.lanes,firstContext:s.firstContext},c.sibling=i.sibling,c.index=i.index,c.ref=i.ref,c}function Ah(i,s,c,l,p,_){var y=2;if(l=i,typeof i=="function")gS(i)&&(y=1);else if(typeof i=="string")y=5;else e:switch(i){case sc:return sa(c.children,p,_,s);case Ug:y=8,p|=8;break;case k_:return i=gi(12,c,s,p|2),i.elementType=k_,i.lanes=_,i;case M_:return i=gi(13,c,s,p),i.elementType=M_,i.lanes=_,i;case U_:return i=gi(19,c,s,p),i.elementType=U_,i.lanes=_,i;case _b:return Ep(c,p,_,s);default:if(typeof i=="object"&&i!==null)switch(i.$$typeof){case mb:y=10;break e;case Eb:y=9;break e;case xg:y=11;break e;case Vg:y=14;break e;case ls:y=16,l=null;break e}throw Error(fe(130,i==null?i:typeof i,""))}return s=gi(y,c,s,p),s.elementType=i,s.type=l,s.lanes=_,s}function sa(i,s,c,l){return i=gi(7,i,l,s),i.lanes=c,i}function Ep(i,s,c,l){return i=gi(22,i,l,s),i.elementType=_b,i.lanes=c,i.stateNode={isHidden:!1},i}function I_(i,s,c){return i=gi(6,i,null,s),i.lanes=c,i}function A_(i,s,c){return s=gi(4,i.children!==null?i.children:[],i.key,s),s.lanes=c,s.stateNode={containerInfo:i.containerInfo,pendingChildren:null,implementation:i.implementation},s}function AW(i,s,c,l,p){this.tag=s,this.containerInfo=i,this.finishedWork=this.pingCache=this.current=this.pendingChildren=null,this.timeoutHandle=-1,this.callbackNode=this.pendingContext=this.context=null,this.callbackPriority=0,this.eventTimes=s_(0),this.expirationTimes=s_(-1),this.entangledLanes=this.finishedLanes=this.mutableReadLanes=this.expiredLanes=this.pingedLanes=this.suspendedLanes=this.pendingLanes=0,this.entanglements=s_(0),this.identifierPrefix=l,this.onRecoverableError=p,this.mutableSourceEagerHydrationData=null}function SS(i,s,c,l,p,_,y,C,L){return i=new AW(i,s,c,C,L),s===1?(s=1,_===!0&&(s|=8)):s=0,_=gi(3,null,null,s),i.current=_,_.stateNode=i,_.memoizedState={element:l,isDehydrated:c,cache:null,transitions:null,pendingSuspenseBoundaries:null},nS(_),i}function OW(i,s,c){var l=3<arguments.length&&arguments[3]!==void 0?arguments[3]:null;return{$$typeof:oc,key:l==null?null:""+l,children:i,containerInfo:s,implementation:c}}function dP(i){if(!i)return Is;i=i._reactInternals;e:{if(pa(i)!==i||i.tag!==1)throw Error(fe(170));var s=i;do{switch(s.tag){case 3:s=s.stateNode.context;break e;case 1:if(Ur(s.type)){s=s.stateNode.__reactInternalMemoizedMergedChildContext;break e}}s=s.return}while(s!==null);throw Error(fe(171))}if(i.tag===1){var c=i.type;if(Ur(c))return cD(i,c,s)}return s}function lP(i,s,c,l,p,_,y,C,L){return i=SS(c,l,!0,i,p,_,y,C,L),i.context=dP(null),c=i.current,l=gr(),p=ys(c),_=Ao(l,p),_.callback=s??null,Ts(c,_,p),i.current.lanes=p,ll(i,p,l),xr(i,l),i}function _p(i,s,c,l){var p=s.current,_=gr(),y=ys(p);return c=dP(c),s.context===null?s.context=c:s.pendingContext=c,s=Ao(_,y),s.payload={element:i},l=l===void 0?null:l,l!==null&&(s.callback=l),i=Ts(p,s,y),i!==null&&(Bi(i,p,y,_),Th(i,p,y)),y}function rp(i){if(i=i.current,!i.child)return null;switch(i.child.tag){case 5:return i.child.stateNode;default:return i.child.stateNode}}function LN(i,s){if(i=i.memoizedState,i!==null&&i.dehydrated!==null){var c=i.retryLane;i.retryLane=c!==0&&c<s?c:s}}function TS(i,s){LN(i,s),(i=i.alternate)&&LN(i,s)}function wW(){return null}var uP=typeof reportError=="function"?reportError:function(i){console.error(i)};function vS(i){this._internalRoot=i}gp.prototype.render=vS.prototype.render=function(i){var s=this._internalRoot;if(s===null)throw Error(fe(409));_p(i,s,null,null)};gp.prototype.unmount=vS.prototype.unmount=function(){var i=this._internalRoot;if(i!==null){this._internalRoot=null;var s=i.containerInfo;ua(function(){_p(null,i,null,null)}),s[No]=null}};function gp(i){this._internalRoot=i}gp.prototype.unstable_scheduleHydration=function(i){if(i){var s=Bb();i={blockedOn:null,target:i,priority:s};for(var c=0;c<hs.length&&s!==0&&s<hs[c].priority;c++);hs.splice(c,0,i),c===0&&Wb(i)}};function yS(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11)}function Sp(i){return!(!i||i.nodeType!==1&&i.nodeType!==9&&i.nodeType!==11&&(i.nodeType!==8||i.nodeValue!==" react-mount-point-unstable "))}function kN(){}function NW(i,s,c,l,p){if(p){if(typeof l=="function"){var _=l;l=function(){var U=rp(y);_.call(U)}}var y=lP(s,l,i,0,null,!1,!1,"",kN);return i._reactRootContainer=y,i[No]=y.current,Zd(i.nodeType===8?i.parentNode:i),ua(),y}for(;p=i.lastChild;)i.removeChild(p);if(typeof l=="function"){var C=l;l=function(){var U=rp(L);C.call(U)}}var L=SS(i,0,!1,null,null,!1,!1,"",kN);return i._reactRootContainer=L,i[No]=L.current,Zd(i.nodeType===8?i.parentNode:i),ua(function(){_p(s,L,c,l)}),L}function Tp(i,s,c,l,p){var _=c._reactRootContainer;if(_){var y=_;if(typeof p=="function"){var C=p;p=function(){var L=rp(y);C.call(L)}}_p(s,y,i,p)}else y=NW(c,s,i,p,l);return rp(y)}Fb=function(i){switch(i.tag){case 3:var s=i.stateNode;if(s.current.memoizedState.isDehydrated){var c=Pd(s.pendingLanes);c!==0&&(Bg(s,c|1),xr(s,pn()),!(ft&6)&&(Nc=pn()+500,ws()))}break;case 13:ua(function(){var l=bo(i,1);if(l!==null){var p=gr();Bi(l,i,1,p)}}),TS(i,1)}};Gg=function(i){if(i.tag===13){var s=bo(i,134217728);if(s!==null){var c=gr();Bi(s,i,134217728,c)}TS(i,134217728)}};jb=function(i){if(i.tag===13){var s=ys(i),c=bo(i,s);if(c!==null){var l=gr();Bi(c,i,s,l)}TS(i,s)}};Bb=function(){return wt};Gb=function(i,s){var c=wt;try{return wt=i,s()}finally{wt=c}};z_=function(i,s,c){switch(s){case"input":if(F_(i,c),s=c.name,c.type==="radio"&&s!=null){for(c=i;c.parentNode;)c=c.parentNode;for(c=c.querySelectorAll("input[name="+JSON.stringify(""+s)+'][type="radio"]'),s=0;s<c.length;s++){var l=c[s];if(l!==i&&l.form===i.form){var p=lp(l);if(!p)throw Error(fe(90));Sb(l),F_(l,p)}}}break;case"textarea":vb(i,c);break;case"select":s=c.value,s!=null&&_c(i,!!c.multiple,s,!1)}};wb=mS;Nb=ua;var bW={usingClientEntryPoint:!1,Events:[hl,lc,lp,Ab,Ob,mS]},Ad={findFiberByHostInstance:na,bundleType:0,version:"18.2.0",rendererPackageName:"react-dom"},DW={bundleType:Ad.bundleType,version:Ad.version,rendererPackageName:Ad.rendererPackageName,rendererConfig:Ad.rendererConfig,overrideHookState:null,overrideHookStateDeletePath:null,overrideHookStateRenamePath:null,overrideProps:null,overridePropsDeletePath:null,overridePropsRenamePath:null,setErrorHandler:null,setSuspenseHandler:null,scheduleUpdate:null,currentDispatcherRef:Po.ReactCurrentDispatcher,findHostInstanceByFiber:function(i){return i=Pb(i),i===null?null:i.stateNode},findFiberByHostInstance:Ad.findFiberByHostInstance||wW,findHostInstancesForRefresh:null,scheduleRefresh:null,scheduleRoot:null,setRefreshHandler:null,getCurrentFiber:null,reconcilerVersion:"18.2.0-next-9e3b772b8-20220608"};if(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__<"u"){var ph=__REACT_DEVTOOLS_GLOBAL_HOOK__;if(!ph.isDisabled&&ph.supportsFiber)try{sp=ph.inject(DW),io=ph}catch{}}ii.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED=bW;ii.createPortal=function(i,s){var c=2<arguments.length&&arguments[2]!==void 0?arguments[2]:null;if(!yS(s))throw Error(fe(200));return OW(i,s,null,c)};ii.createRoot=function(i,s){if(!yS(i))throw Error(fe(299));var c=!1,l="",p=uP;return s!=null&&(s.unstable_strictMode===!0&&(c=!0),s.identifierPrefix!==void 0&&(l=s.identifierPrefix),s.onRecoverableError!==void 0&&(p=s.onRecoverableError)),s=SS(i,1,!1,null,null,c,!1,l,p),i[No]=s.current,Zd(i.nodeType===8?i.parentNode:i),new vS(s)};ii.findDOMNode=function(i){if(i==null)return null;if(i.nodeType===1)return i;var s=i._reactInternals;if(s===void 0)throw typeof i.render=="function"?Error(fe(188)):(i=Object.keys(i).join(","),Error(fe(268,i)));return i=Pb(s),i=i===null?null:i.stateNode,i};ii.flushSync=function(i){return ua(i)};ii.hydrate=function(i,s,c){if(!Sp(s))throw Error(fe(200));return Tp(null,i,s,!0,c)};ii.hydrateRoot=function(i,s,c){if(!yS(i))throw Error(fe(405));var l=c!=null&&c.hydratedSources||null,p=!1,_="",y=uP;if(c!=null&&(c.unstable_strictMode===!0&&(p=!0),c.identifierPrefix!==void 0&&(_=c.identifierPrefix),c.onRecoverableError!==void 0&&(y=c.onRecoverableError)),s=lP(s,null,i,1,c??null,p,!1,_,y),i[No]=s.current,Zd(i),l)for(i=0;i<l.length;i++)c=l[i],p=c._getVersion,p=p(c._source),s.mutableSourceEagerHydrationData==null?s.mutableSourceEagerHydrationData=[c,p]:s.mutableSourceEagerHydrationData.push(c,p);return new gp(s)};ii.render=function(i,s,c){if(!Sp(s))throw Error(fe(200));return Tp(null,i,s,!1,c)};ii.unmountComponentAtNode=function(i){if(!Sp(i))throw Error(fe(40));return i._reactRootContainer?(ua(function(){Tp(null,null,i,!1,function(){i._reactRootContainer=null,i[No]=null})}),!0):!1};ii.unstable_batchedUpdates=mS;ii.unstable_renderSubtreeIntoContainer=function(i,s,c,l){if(!Sp(c))throw Error(fe(200));if(i==null||i._reactInternals===void 0)throw Error(fe(38));return Tp(i,s,c,!1,l)};ii.version="18.2.0-next-9e3b772b8-20220608";function hP(){if(!(typeof __REACT_DEVTOOLS_GLOBAL_HOOK__>"u"||typeof __REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE!="function"))try{__REACT_DEVTOOLS_GLOBAL_HOOK__.checkDCE(hP)}catch(i){console.error(i)}}hP(),lb.exports=ii;var PW=lb.exports,MN=PW;P_.createRoot=MN.createRoot,P_.hydrateRoot=MN.hydrateRoot;var pP={exports:{}};(function(i,s){(function(c,l){i.exports=l()})(Jn,function(){function c(e,t){return t.forEach(function(n){n&&typeof n!="string"&&!Array.isArray(n)&&Object.keys(n).forEach(function(r){if(r!=="default"&&!(r in e)){var o=Object.getOwnPropertyDescriptor(n,r);Object.defineProperty(e,r,o.get?o:{enumerable:!0,get:function(){return n[r]}})}})}),Object.freeze(e)}var l=typeof globalThis<"u"?globalThis:typeof window<"u"?window:typeof Jn<"u"?Jn:typeof self<"u"?self:{},p=function(e){try{return!!e()}catch{return!0}},_=!p(function(){var e=(function(){}).bind();return typeof e!="function"||e.hasOwnProperty("prototype")}),y=_,C=Function.prototype,L=C.bind,U=C.call,G=y&&L.bind(U,U),F=y?function(e){return e&&G(e)}:function(e){return e&&function(){return U.apply(e,arguments)}},H=F({}.isPrototypeOf),ne=function(e){return e&&e.Math==Math&&e},W=ne(typeof globalThis=="object"&&globalThis)||ne(typeof window=="object"&&window)||ne(typeof self=="object"&&self)||ne(typeof l=="object"&&l)||function(){return this}()||Function("return this")(),ie=_,Ie=Function.prototype,B=Ie.apply,P=Ie.call,M=typeof Reflect=="object"&&Reflect.apply||(ie?P.bind(B):function(){return P.apply(B,arguments)}),j=function(e){return typeof e=="function"},J={},Z=!p(function(){return Object.defineProperty({},1,{get:function(){return 7}})[1]!=7}),ce=_,me=Function.prototype.call,_e=ce?me.bind(me):function(){return me.apply(me,arguments)},Ne={},Ye={}.propertyIsEnumerable,en=Object.getOwnPropertyDescriptor,Vr=en&&!Ye.call({1:2},1);Ne.f=Vr?function(e){var t=en(this,e);return!!t&&t.enumerable}:Ye;var Gn,Ri,Fr=function(e,t){return{enumerable:!(1&e),configurable:!(2&e),writable:!(4&e),value:t}},ao=F,ge=ao({}.toString),Le=ao("".slice),Ve=function(e){return Le(ge(e),8,-1)},Nt=F,mt=p,Lo=Ve,fn=W.Object,Ci=Nt("".split),$n=mt(function(){return!fn("z").propertyIsEnumerable(0)})?function(e){return Lo(e)=="String"?Ci(e,""):fn(e)}:fn,Ii=W.TypeError,ko=function(e){if(e==null)throw Ii("Can't call method on "+e);return e},El=$n,Mc=ko,jr=function(e){return El(Mc(e))},Op=j,Zn=function(e){return typeof e=="object"?e!==null:Op(e)},Mo={},wp=Mo,Np=W,xP=j,wS=function(e){return xP(e)?e:void 0},Wi=function(e,t){return arguments.length<2?wS(wp[e])||wS(Np[e]):wp[e]&&wp[e][t]||Np[e]&&Np[e][t]},Ns=Wi("navigator","userAgent")||"",NS=W,bp=Ns,bS=NS.process,DS=NS.Deno,PS=bS&&bS.versions||DS&&DS.version,LS=PS&&PS.v8;LS&&(Ri=(Gn=LS.split("."))[0]>0&&Gn[0]<4?1:+(Gn[0]+Gn[1])),!Ri&&bp&&(!(Gn=bp.match(/Edge\/(\d+)/))||Gn[1]>=74)&&(Gn=bp.match(/Chrome\/(\d+)/))&&(Ri=+Gn[1]);var fa=Ri,kS=fa,VP=p,Dp=!!Object.getOwnPropertySymbols&&!VP(function(){var e=Symbol();return!String(e)||!(Object(e)instanceof Symbol)||!Symbol.sham&&kS&&kS<41}),MS=Dp&&!Symbol.sham&&typeof Symbol.iterator=="symbol",FP=Wi,jP=j,BP=H,GP=MS,WP=W.Object,Pp=GP?function(e){return typeof e=="symbol"}:function(e){var t=FP("Symbol");return jP(t)&&BP(t.prototype,WP(e))},HP=W.String,_l=function(e){try{return HP(e)}catch{return"Object"}},KP=j,zP=_l,YP=W.TypeError,co=function(e){if(KP(e))return e;throw YP(zP(e)+" is not a function")},qP=co,Lp=function(e,t){var n=e[t];return n==null?void 0:qP(n)},kp=_e,Mp=j,Up=Zn,JP=W.TypeError,gl={exports:{}},US=W,XP=Object.defineProperty,QP=function(e,t){try{XP(US,e,{value:t,configurable:!0,writable:!0})}catch{US[e]=t}return t},xS="__core-js_shared__",xp=W[xS]||QP(xS,{}),VS=xp;(gl.exports=function(e,t){return VS[e]||(VS[e]=t!==void 0?t:{})})("versions",[]).push({version:"3.20.3",mode:"pure",copyright:"© 2014-2022 Denis Pushkarev (zloirock.ru)",license:"https://github.com/zloirock/core-js/blob/v3.20.3/LICENSE",source:"https://github.com/zloirock/core-js"});var $P=ko,ZP=W.Object,Uo=function(e){return ZP($P(e))},eL=Uo,tL=F({}.hasOwnProperty),hr=Object.hasOwn||function(e,t){return tL(eL(e),t)},nL=F,rL=0,iL=Math.random(),oL=nL(1 .toString),Vp=function(e){return"Symbol("+(e===void 0?"":e)+")_"+oL(++rL+iL,36)},sL=W,aL=gl.exports,FS=hr,cL=Vp,jS=Dp,BS=MS,Uc=aL("wks"),bs=sL.Symbol,GS=bs&&bs.for,dL=BS?bs:bs&&bs.withoutSetter||cL,mn=function(e){if(!FS(Uc,e)||!jS&&typeof Uc[e]!="string"){var t="Symbol."+e;jS&&FS(bs,e)?Uc[e]=bs[e]:Uc[e]=BS&&GS?GS(t):dL(t)}return Uc[e]},lL=_e,WS=Zn,HS=Pp,uL=Lp,hL=function(e,t){var n,r;if(t==="string"&&Mp(n=e.toString)&&!Up(r=kp(n,e))||Mp(n=e.valueOf)&&!Up(r=kp(n,e))||t!=="string"&&Mp(n=e.toString)&&!Up(r=kp(n,e)))return r;throw JP("Can't convert object to primitive value")},pL=mn,fL=W.TypeError,mL=pL("toPrimitive"),EL=function(e,t){if(!WS(e)||HS(e))return e;var n,r=uL(e,mL);if(r){if(t===void 0&&(t="default"),n=lL(r,e,t),!WS(n)||HS(n))return n;throw fL("Can't convert object to primitive value")}return t===void 0&&(t="number"),hL(e,t)},_L=Pp,Sl=function(e){var t=EL(e,"string");return _L(t)?t:t+""},KS=Zn,Fp=W.document,gL=KS(Fp)&&KS(Fp.createElement),jp=function(e){return gL?Fp.createElement(e):{}},SL=jp,zS=!Z&&!p(function(){return Object.defineProperty(SL("div"),"a",{get:function(){return 7}}).a!=7}),TL=Z,vL=_e,yL=Ne,RL=Fr,CL=jr,IL=Sl,AL=hr,OL=zS,YS=Object.getOwnPropertyDescriptor;J.f=TL?YS:function(e,t){if(e=CL(e),t=IL(t),OL)try{return YS(e,t)}catch{}if(AL(e,t))return RL(!vL(yL.f,e,t),e[t])};var wL=p,NL=j,bL=/#|\.prototype\./,xc=function(e,t){var n=PL[DL(e)];return n==kL||n!=LL&&(NL(t)?wL(t):!!t)},DL=xc.normalize=function(e){return String(e).replace(bL,".").toLowerCase()},PL=xc.data={},LL=xc.NATIVE="N",kL=xc.POLYFILL="P",qS=xc,ML=co,UL=_,xL=F(F.bind),Vc=function(e,t){return ML(e),t===void 0?e:UL?xL(e,t):function(){return e.apply(t,arguments)}},Ai={},JS=Z&&p(function(){return Object.defineProperty(function(){},"prototype",{value:42,writable:!1}).prototype!=42}),XS=W,VL=Zn,FL=XS.String,jL=XS.TypeError,Oi=function(e){if(VL(e))return e;throw jL(FL(e)+" is not an object")},BL=Z,GL=zS,WL=JS,Tl=Oi,QS=Sl,HL=W.TypeError,Bp=Object.defineProperty,KL=Object.getOwnPropertyDescriptor,zL="enumerable",YL="configurable",qL="writable";Ai.f=BL?WL?function(e,t,n){if(Tl(e),t=QS(t),Tl(n),typeof e=="function"&&t==="prototype"&&"value"in n&&qL in n&&!n.writable){var r=KL(e,t);r&&r.writable&&(e[t]=n.value,n={configurable:YL in n?n.configurable:r.configurable,enumerable:zL in n?n.enumerable:r.enumerable,writable:!1})}return Bp(e,t,n)}:Bp:function(e,t,n){if(Tl(e),t=QS(t),Tl(n),GL)try{return Bp(e,t,n)}catch{}if("get"in n||"set"in n)throw HL("Accessors not supported");return"value"in n&&(e[t]=n.value),e};var JL=Ai,XL=Fr,Ds=Z?function(e,t,n){return JL.f(e,t,XL(1,n))}:function(e,t,n){return e[t]=n,e},vl=W,QL=M,$L=F,ZL=j,ek=J.f,tk=qS,ma=Mo,nk=Vc,Ea=Ds,$S=hr,rk=function(e){var t=function(n,r,o){if(this instanceof t){switch(arguments.length){case 0:return new e;case 1:return new e(n);case 2:return new e(n,r)}return new e(n,r,o)}return QL(e,this,arguments)};return t.prototype=e.prototype,t},Wn=function(e,t){var n,r,o,a,d,u,h,m,f=e.target,E=e.global,T=e.stat,R=e.proto,A=E?vl:T?vl[f]:(vl[f]||{}).prototype,O=E?ma:ma[f]||Ea(ma,f,{})[f],w=O.prototype;for(o in t)n=!tk(E?o:f+(T?".":"#")+o,e.forced)&&A&&$S(A,o),d=O[o],n&&(u=e.noTargetGet?(m=ek(A,o))&&m.value:A[o]),a=n&&u?u:t[o],n&&typeof d==typeof a||(h=e.bind&&n?nk(a,vl):e.wrap&&n?rk(a):R&&ZL(a)?$L(a):a,(e.sham||a&&a.sham||d&&d.sham)&&Ea(h,"sham",!0),Ea(O,o,h),R&&($S(ma,r=f+"Prototype")||Ea(ma,r,{}),Ea(ma[r],o,a),e.real&&w&&!w[o]&&Ea(w,o,a)))},ik=Math.ceil,ok=Math.floor,Gp=function(e){var t=+e;return t!=t||t===0?0:(t>0?ok:ik)(t)},sk=Gp,ak=Math.min,ck=function(e){return e>0?ak(sk(e),9007199254740991):0},xo=function(e){return ck(e.length)},dk=co,lk=Uo,uk=$n,hk=xo,pk=W.TypeError,ZS=function(e){return function(t,n,r,o){dk(n);var a=lk(t),d=uk(a),u=hk(a),h=e?u-1:0,m=e?-1:1;if(r<2)for(;;){if(h in d){o=d[h],h+=m;break}if(h+=m,e?h<0:u<=h)throw pk("Reduce of empty array with no initial value")}for(;e?h>=0:u>h;h+=m)h in d&&(o=n(o,d[h],h,a));return o}},fk={left:ZS(!1),right:ZS(!0)},mk=p,Wp=function(e,t){var n=[][e];return!!n&&mk(function(){n.call(null,t||function(){throw 1},1)})},yl=Ve(W.process)=="process",Ek=fk.left,eT=fa,_k=yl;Wn({target:"Array",proto:!0,forced:!Wp("reduce")||!_k&&eT>79&&eT<83},{reduce:function(e){var t=arguments.length;return Ek(this,e,t,t>1?arguments[1]:void 0)}});var gk=Mo,Vo=function(e){return gk[e+"Prototype"]},Sk=Vo("Array").reduce,Tk=H,vk=Sk,Hp=Array.prototype,tT=function(e){var t=e.reduce;return e===Hp||Tk(Hp,e)&&t===Hp.reduce?vk:t},Fo=tT;let nT=!0,rT=!0;function Rl(e,t,n){const r=e.match(t);return r&&r.length>=n&&parseInt(r[n],10)}function Ps(e,t,n){if(!e.RTCPeerConnection)return;const r=e.RTCPeerConnection.prototype,o=r.addEventListener;r.addEventListener=function(d,u){if(d!==t)return o.apply(this,arguments);const h=m=>{const f=n(m);f&&(u.handleEvent?u.handleEvent(f):u(f))};return this._eventMap=this._eventMap||{},this._eventMap[t]||(this._eventMap[t]=new Map),this._eventMap[t].set(u,h),o.apply(this,[d,h])};const a=r.removeEventListener;r.removeEventListener=function(d,u){if(d!==t||!this._eventMap||!this._eventMap[t])return a.apply(this,arguments);if(!this._eventMap[t].has(u))return a.apply(this,arguments);const h=this._eventMap[t].get(u);return this._eventMap[t].delete(u),this._eventMap[t].size===0&&delete this._eventMap[t],Object.keys(this._eventMap).length===0&&delete this._eventMap,a.apply(this,[d,h])},Object.defineProperty(r,"on"+t,{get(){return this["_on"+t]},set(d){this["_on"+t]&&(this.removeEventListener(t,this["_on"+t]),delete this["_on"+t]),d&&this.addEventListener(t,this["_on"+t]=d)},enumerable:!0,configurable:!0})}function yk(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(nT=e,e?"adapter.js logging disabled":"adapter.js logging enabled")}function Rk(e){return typeof e!="boolean"?new Error("Argument type: "+typeof e+". Please use a boolean."):(rT=!e,"adapter.js deprecation warnings "+(e?"disabled":"enabled"))}function iT(){if(typeof window=="object"){if(nT)return;typeof console<"u"&&typeof console.log=="function"&&console.log.apply(console,arguments)}}function Kp(e,t){rT&&console.warn(e+" is deprecated, please use "+t+" instead.")}function Ck(e){const t={browser:null,version:null};if(e===void 0||!e.navigator)return t.browser="Not a browser.",t;const{navigator:n}=e;if(n.mozGetUserMedia)t.browser="firefox",t.version=Rl(n.userAgent,/Firefox\/(\d+)\./,1);else if(n.webkitGetUserMedia||e.isSecureContext===!1&&e.webkitRTCPeerConnection)t.browser="chrome",t.version=Rl(n.userAgent,/Chrom(e|ium)\/(\d+)\./,2);else{if(!e.RTCPeerConnection||!n.userAgent.match(/AppleWebKit\/(\d+)\./))return t.browser="Not a supported browser.",t;t.browser="safari",t.version=Rl(n.userAgent,/AppleWebKit\/(\d+)\./,1),t.supportsUnifiedPlan=e.RTCRtpTransceiver&&"currentDirection"in e.RTCRtpTransceiver.prototype}return t}function oT(e){return Object.prototype.toString.call(e)==="[object Object]"}function sT(e){var t;return oT(e)?Fo(t=Object.keys(e)).call(t,function(n,r){const o=oT(e[r]),a=o?sT(e[r]):e[r],d=o&&!Object.keys(a).length;return a===void 0||d?n:Object.assign(n,{[r]:a})},{}):e}function aT(e,t,n){const r=n?"outbound-rtp":"inbound-rtp",o=new Map;if(t===null)return o;const a=[];return e.forEach(d=>{d.type==="track"&&d.trackIdentifier===t.id&&a.push(d)}),a.forEach(d=>{e.forEach(u=>{u.type===r&&u.trackId===d.id&&function h(m,f,E){f&&!E.has(f.id)&&(E.set(f.id,f),Object.keys(f).forEach(T=>{T.endsWith("Id")?h(m,m.get(f[T]),E):T.endsWith("Ids")&&f[T].forEach(R=>{h(m,m.get(R),E)})}))}(e,u,o)})}),o}var Ik=gl.exports,Ak=Vp,cT=Ik("keys"),Cl=function(e){return cT[e]||(cT[e]=Ak(e))},Ok=!p(function(){function e(){}return e.prototype.constructor=null,Object.getPrototypeOf(new e)!==e.prototype}),wk=W,Nk=hr,bk=j,Dk=Uo,Pk=Ok,dT=Cl("IE_PROTO"),zp=wk.Object,Lk=zp.prototype,Yp=Pk?zp.getPrototypeOf:function(e){var t=Dk(e);if(Nk(t,dT))return t[dT];var n=t.constructor;return bk(n)&&t instanceof n?n.prototype:t instanceof zp?Lk:null},lT=W,kk=j,Mk=lT.String,Uk=lT.TypeError,xk=F,Vk=Oi,Fk=function(e){if(typeof e=="object"||kk(e))return e;throw Uk("Can't set "+Mk(e)+" as a prototype")},jk=Object.setPrototypeOf||("__proto__"in{}?function(){var e,t=!1,n={};try{(e=xk(Object.getOwnPropertyDescriptor(Object.prototype,"__proto__").set))(n,[]),t=n instanceof Array}catch{}return function(r,o){return Vk(r),Fk(o),t?e(r,o):r.__proto__=o,r}}():void 0),Il={},Bk=Gp,Gk=Math.max,Wk=Math.min,qp=function(e,t){var n=Bk(e);return n<0?Gk(n+t,0):Wk(n,t)},Hk=jr,Kk=qp,zk=xo,uT=function(e){return function(t,n,r){var o,a=Hk(t),d=zk(a),u=Kk(r,d);if(e&&n!=n){for(;d>u;)if((o=a[u++])!=o)return!0}else for(;d>u;u++)if((e||u in a)&&a[u]===n)return e||u||0;return!e&&-1}},Yk={includes:uT(!0),indexOf:uT(!1)},Al={},Jp=hr,qk=jr,Jk=Yk.indexOf,Xk=Al,hT=F([].push),pT=function(e,t){var n,r=qk(e),o=0,a=[];for(n in r)!Jp(Xk,n)&&Jp(r,n)&&hT(a,n);for(;t.length>o;)Jp(r,n=t[o++])&&(~Jk(a,n)||hT(a,n));return a},Xp=["constructor","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","toLocaleString","toString","valueOf"],Qk=pT,$k=Xp.concat("length","prototype");Il.f=Object.getOwnPropertyNames||function(e){return Qk(e,$k)};var Qp={};Qp.f=Object.getOwnPropertySymbols;var Zk=Wi,e1=Il,t1=Qp,n1=Oi,r1=F([].concat),i1=Zk("Reflect","ownKeys")||function(e){var t=e1.f(n1(e)),n=t1.f;return n?r1(t,n(e)):t},fT=hr,o1=i1,s1=J,a1=Ai,$p={},c1=pT,d1=Xp,Zp=Object.keys||function(e){return c1(e,d1)},l1=Z,u1=JS,h1=Ai,p1=Oi,f1=jr,m1=Zp;$p.f=l1&&!u1?Object.defineProperties:function(e,t){p1(e);for(var n,r=f1(t),o=m1(t),a=o.length,d=0;a>d;)h1.f(e,n=o[d++],r[n]);return e};var Ol,mT=Wi("document","documentElement"),E1=Oi,_1=$p,ET=Xp,g1=Al,S1=mT,T1=jp,_T=Cl("IE_PROTO"),ef=function(){},gT=function(e){return"<script>"+e+"<\/script>"},ST=function(e){e.write(gT("")),e.close();var t=e.parentWindow.Object;return e=null,t},wl=function(){try{Ol=new ActiveXObject("htmlfile")}catch{}var e,t;wl=typeof document<"u"?document.domain&&Ol?ST(Ol):((t=T1("iframe")).style.display="none",S1.appendChild(t),t.src="javascript:",(e=t.contentWindow.document).open(),e.write(gT("document.F=Object")),e.close(),e.F):ST(Ol);for(var n=ET.length;n--;)delete wl.prototype[ET[n]];return wl()};g1[_T]=!0;var Nl=Object.create||function(e,t){var n;return e!==null?(ef.prototype=E1(e),n=new ef,ef.prototype=null,n[_T]=e):n=wl(),t===void 0?n:_1.f(n,t)},v1=F("".replace),y1=String(Error("zxcasd").stack),TT=/\n\s*at [^:]*:[^\n]*/,R1=TT.test(y1),C1=Zn,I1=Ds,_a={},A1=_a,O1=mn("iterator"),w1=Array.prototype,vT={};vT[mn("toStringTag")]="z";var tf=String(vT)==="[object z]",N1=W,b1=tf,D1=j,bl=Ve,P1=mn("toStringTag"),L1=N1.Object,k1=bl(function(){return arguments}())=="Arguments",jo=b1?bl:function(e){var t,n,r;return e===void 0?"Undefined":e===null?"Null":typeof(n=function(o,a){try{return o[a]}catch{}}(t=L1(e),P1))=="string"?n:k1?bl(t):(r=bl(t))=="Object"&&D1(t.callee)?"Arguments":r},M1=jo,yT=Lp,U1=_a,x1=mn("iterator"),RT=function(e){if(e!=null)return yT(e,x1)||yT(e,"@@iterator")||U1[M1(e)]},V1=_e,F1=co,j1=Oi,B1=_l,G1=RT,W1=W.TypeError,H1=_e,CT=Oi,K1=Lp,z1=Vc,Y1=_e,q1=Oi,J1=_l,X1=function(e){return e!==void 0&&(A1.Array===e||w1[O1]===e)},Q1=xo,IT=H,$1=function(e,t){var n=arguments.length<2?G1(e):t;if(F1(n))return j1(V1(n,e));throw W1(B1(e)+" is not iterable")},Z1=RT,AT=function(e,t,n){var r,o;CT(e);try{if(!(r=K1(e,"return"))){if(t==="throw")throw n;return n}r=H1(r,e)}catch(a){o=!0,r=a}if(t==="throw")throw n;if(o)throw r;return CT(r),n},eM=W.TypeError,Dl=function(e,t){this.stopped=e,this.result=t},OT=Dl.prototype,Pl=function(e,t,n){var r,o,a,d,u,h,m,f=n&&n.that,E=!(!n||!n.AS_ENTRIES),T=!(!n||!n.IS_ITERATOR),R=!(!n||!n.INTERRUPTED),A=z1(t,f),O=function(x){return r&&AT(r,"normal",x),new Dl(!0,x)},w=function(x){return E?(q1(x),R?A(x[0],x[1],O):A(x[0],x[1])):R?A(x,O):A(x)};if(T)r=e;else{if(!(o=Z1(e)))throw eM(J1(e)+" is not iterable");if(X1(o)){for(a=0,d=Q1(e);d>a;a++)if((u=w(e[a]))&&IT(OT,u))return u;return new Dl(!1)}r=$1(e,o)}for(h=r.next;!(m=Y1(h,r)).done;){try{u=w(m.value)}catch(x){AT(r,"throw",x)}if(typeof u=="object"&&u&&IT(OT,u))return u}return new Dl(!1)},tM=jo,nM=W.String,ga=function(e){if(tM(e)==="Symbol")throw TypeError("Cannot convert a Symbol value to a string");return nM(e)},rM=ga,iM=Fr,oM=!p(function(){var e=Error("a");return!("stack"in e)||(Object.defineProperty(e,"stack",iM(1,7)),e.stack!==7)}),sM=Wn,aM=W,cM=H,dM=Yp,Ll=jk,lM=function(e,t,n){for(var r=o1(t),o=a1.f,a=s1.f,d=0;d<r.length;d++){var u=r[d];fT(e,u)||n&&fT(n,u)||o(e,u,a(t,u))}},wT=Nl,kl=Ds,nf=Fr,uM=function(e,t){if(R1&&typeof e=="string")for(;t--;)e=v1(e,TT,"");return e},hM=function(e,t){C1(t)&&"cause"in t&&I1(e,"cause",t.cause)},pM=Pl,fM=function(e,t){return e===void 0?arguments.length<2?"":t:rM(e)},mM=oM,EM=mn("toStringTag"),Ml=aM.Error,_M=[].push,Fc=function(e,t){var n,r=arguments.length>2?arguments[2]:void 0,o=cM(rf,this);Ll?n=Ll(new Ml,o?dM(this):rf):(n=o?this:wT(rf),kl(n,EM,"Error")),t!==void 0&&kl(n,"message",fM(t)),mM&&kl(n,"stack",uM(n.stack,1)),hM(n,r);var a=[];return pM(e,_M,{that:a}),kl(n,"errors",a),n};Ll?Ll(Fc,Ml):lM(Fc,Ml,{name:!0});var rf=Fc.prototype=wT(Ml.prototype,{constructor:nf(1,Fc),message:nf(1,""),name:nf(1,"AggregateError")});sM({global:!0},{AggregateError:Fc});var gM=j,of=xp,SM=F(Function.toString);gM(of.inspectSource)||(of.inspectSource=function(e){return SM(e)});var Ul,jc,xl,sf=of.inspectSource,TM=j,vM=sf,NT=W.WeakMap,yM=TM(NT)&&/native code/.test(vM(NT)),bT=W,af=F,RM=Zn,CM=Ds,cf=hr,df=xp,IM=Cl,AM=Al,DT="Object already initialized",lf=bT.TypeError,OM=bT.WeakMap;if(yM||df.state){var Ls=df.state||(df.state=new OM),wM=af(Ls.get),PT=af(Ls.has),NM=af(Ls.set);Ul=function(e,t){if(PT(Ls,e))throw new lf(DT);return t.facade=e,NM(Ls,e,t),t},jc=function(e){return wM(Ls,e)||{}},xl=function(e){return PT(Ls,e)}}else{var Sa=IM("state");AM[Sa]=!0,Ul=function(e,t){if(cf(e,Sa))throw new lf(DT);return t.facade=e,CM(e,Sa,t),t},jc=function(e){return cf(e,Sa)?e[Sa]:{}},xl=function(e){return cf(e,Sa)}}var ks,LT,kT,Vl={set:Ul,get:jc,has:xl,enforce:function(e){return xl(e)?jc(e):Ul(e,{})},getterFor:function(e){return function(t){var n;if(!RM(t)||(n=jc(t)).type!==e)throw lf("Incompatible receiver, "+e+" required");return n}}},uf=Z,bM=hr,MT=Function.prototype,DM=uf&&Object.getOwnPropertyDescriptor,hf=bM(MT,"name"),UT={EXISTS:hf,PROPER:hf&&(function(){}).name==="something",CONFIGURABLE:hf&&(!uf||uf&&DM(MT,"name").configurable)},PM=Ds,Fl=function(e,t,n,r){r&&r.enumerable?e[t]=n:PM(e,t,n)},LM=p,kM=j,MM=Nl,xT=Yp,UM=Fl,pf=mn("iterator"),VT=!1;[].keys&&("next"in(kT=[].keys())?(LT=xT(xT(kT)))!==Object.prototype&&(ks=LT):VT=!0);var xM=ks==null||LM(function(){var e={};return ks[pf].call(e)!==e});kM((ks=xM?{}:MM(ks))[pf])||UM(ks,pf,function(){return this});var FT={IteratorPrototype:ks,BUGGY_SAFARI_ITERATORS:VT},VM=jo,FM=tf?{}.toString:function(){return"[object "+VM(this)+"]"},jM=tf,BM=Ai.f,GM=Ds,WM=hr,HM=FM,jT=mn("toStringTag"),Bc=function(e,t,n,r){if(e){var o=n?e:e.prototype;WM(o,jT)||BM(o,jT,{configurable:!0,value:t}),r&&!jM&&GM(o,"toString",HM)}},KM=FT.IteratorPrototype,zM=Nl,YM=Fr,qM=Bc,JM=_a,XM=function(){return this},QM=Wn,$M=_e,ZM=function(e,t,n,r){var o=t+" Iterator";return e.prototype=zM(KM,{next:YM(+!r,n)}),qM(e,o,!1,!0),JM[o]=XM,e},eU=Yp,tU=Bc,BT=Fl,GT=_a,nU=UT.PROPER,jl=FT.BUGGY_SAFARI_ITERATORS,ff=mn("iterator"),WT="keys",Bl="values",HT="entries",rU=function(){return this},KT=function(e,t,n,r,o,a,d){ZM(n,t,r);var u,h,m,f=function(x){if(x===o&&O)return O;if(!jl&&x in R)return R[x];switch(x){case WT:case Bl:case HT:return function(){return new n(this,x)}}return function(){return new n(this)}},E=t+" Iterator",T=!1,R=e.prototype,A=R[ff]||R["@@iterator"]||o&&R[o],O=!jl&&A||f(o),w=t=="Array"&&R.entries||A;if(w&&(u=eU(w.call(new e)))!==Object.prototype&&u.next&&(tU(u,E,!0,!0),GT[E]=rU),nU&&o==Bl&&A&&A.name!==Bl&&(T=!0,O=function(){return $M(A,this)}),o)if(h={values:f(Bl),keys:a?O:f(WT),entries:f(HT)},d)for(m in h)(jl||T||!(m in R))&&BT(R,m,h[m]);else QM({target:t,proto:!0,forced:jl||T},h);return d&&R[ff]!==O&&BT(R,ff,O,{name:o}),GT[t]=O,h},iU=jr,zT=_a,YT=Vl;Ai.f;var oU=KT,qT="Array Iterator",sU=YT.set,aU=YT.getterFor(qT);oU(Array,"Array",function(e,t){sU(this,{type:qT,target:iU(e),index:0,kind:t})},function(){var e=aU(this),t=e.target,n=e.kind,r=e.index++;return!t||r>=t.length?(e.target=void 0,{value:void 0,done:!0}):n=="keys"?{value:r,done:!1}:n=="values"?{value:t[r],done:!1}:{value:[r,t[r]],done:!1}},"values"),zT.Arguments=zT.Array;var JT=W.Promise,cU=Fl,dU=Wi,lU=Ai,uU=Z,XT=mn("species"),hU=H,pU=W.TypeError,QT=mn("iterator"),$T=!1;try{var fU=0,ZT={next:function(){return{done:!!fU++}},return:function(){$T=!0}};ZT[QT]=function(){return this},Array.from(ZT,function(){throw 2})}catch{}var mU=F,EU=p,ev=j,_U=jo,gU=sf,tv=function(){},SU=[],nv=Wi("Reflect","construct"),mf=/^\s*(?:class|function)\b/,TU=mU(mf.exec),vU=!mf.exec(tv),Gc=function(e){if(!ev(e))return!1;try{return nv(tv,SU,e),!0}catch{return!1}},rv=function(e){if(!ev(e))return!1;switch(_U(e)){case"AsyncFunction":case"GeneratorFunction":case"AsyncGeneratorFunction":return!1}try{return vU||!!TU(mf,gU(e))}catch{return!0}};rv.sham=!0;var Wc,Ta,iv,Ef,_f=!nv||EU(function(){var e;return Gc(Gc.call)||!Gc(Object)||!Gc(function(){e=!0})||e})?rv:Gc,yU=_f,RU=_l,CU=W.TypeError,ov=Oi,IU=function(e){if(yU(e))return e;throw CU(RU(e)+" is not a constructor")},AU=mn("species"),sv=function(e,t){var n,r=ov(e).constructor;return r===void 0||(n=ov(r)[AU])==null?t:IU(n)},gf=F([].slice),av=/(?:ipad|iphone|ipod).*applewebkit/i.test(Ns),Br=W,OU=M,wU=Vc,cv=j,NU=hr,bU=p,dv=mT,DU=gf,lv=jp,PU=av,LU=yl,Sf=Br.setImmediate,Tf=Br.clearImmediate,kU=Br.process,vf=Br.Dispatch,MU=Br.Function,uv=Br.MessageChannel,UU=Br.String,yf=0,Hc={},xU="onreadystatechange";try{Wc=Br.location}catch{}var Rf=function(e){if(NU(Hc,e)){var t=Hc[e];delete Hc[e],t()}},Cf=function(e){return function(){Rf(e)}},hv=function(e){Rf(e.data)},pv=function(e){Br.postMessage(UU(e),Wc.protocol+"//"+Wc.host)};Sf&&Tf||(Sf=function(e){var t=DU(arguments,1);return Hc[++yf]=function(){OU(cv(e)?e:MU(e),void 0,t)},Ta(yf),yf},Tf=function(e){delete Hc[e]},LU?Ta=function(e){kU.nextTick(Cf(e))}:vf&&vf.now?Ta=function(e){vf.now(Cf(e))}:uv&&!PU?(Ef=(iv=new uv).port2,iv.port1.onmessage=hv,Ta=wU(Ef.postMessage,Ef)):Br.addEventListener&&cv(Br.postMessage)&&!Br.importScripts&&Wc&&Wc.protocol!=="file:"&&!bU(pv)?(Ta=pv,Br.addEventListener("message",hv,!1)):Ta=xU in lv("script")?function(e){dv.appendChild(lv("script")).onreadystatechange=function(){dv.removeChild(this),Rf(e)}}:function(e){setTimeout(Cf(e),0)});var Kc,Ms,zc,va,If,Af,Of,fv,mv={set:Sf,clear:Tf},VU=W,FU=/ipad|iphone|ipod/i.test(Ns)&&VU.Pebble!==void 0,jU=/web0s(?!.*chrome)/i.test(Ns),Us=W,Ev=Vc,BU=J.f,wf=mv.set,GU=av,WU=FU,HU=jU,Nf=yl,_v=Us.MutationObserver||Us.WebKitMutationObserver,gv=Us.document,Sv=Us.process,Gl=Us.Promise,Tv=BU(Us,"queueMicrotask"),vv=Tv&&Tv.value;vv||(Kc=function(){var e,t;for(Nf&&(e=Sv.domain)&&e.exit();Ms;){t=Ms.fn,Ms=Ms.next;try{t()}catch(n){throw Ms?va():zc=void 0,n}}zc=void 0,e&&e.enter()},GU||Nf||HU||!_v||!gv?!WU&&Gl&&Gl.resolve?((Of=Gl.resolve(void 0)).constructor=Gl,fv=Ev(Of.then,Of),va=function(){fv(Kc)}):Nf?va=function(){Sv.nextTick(Kc)}:(wf=Ev(wf,Us),va=function(){wf(Kc)}):(If=!0,Af=gv.createTextNode(""),new _v(Kc).observe(Af,{characterData:!0}),va=function(){Af.data=If=!If}));var KU=vv||function(e){var t={fn:e,next:void 0};zc&&(zc.next=t),Ms||(Ms=t,va()),zc=t},ya={},yv=co,zU=function(e){var t,n;this.promise=new e(function(r,o){if(t!==void 0||n!==void 0)throw TypeError("Bad Promise constructor");t=r,n=o}),this.resolve=yv(t),this.reject=yv(n)};ya.f=function(e){return new zU(e)};var YU=Oi,qU=Zn,JU=ya,Rv=function(e,t){if(YU(e),qU(t)&&t.constructor===e)return t;var n=JU.f(e);return(0,n.resolve)(t),n.promise},XU=W,Wl=function(e){try{return{error:!1,value:e()}}catch(t){return{error:!0,value:t}}},Cv=function(){this.head=null,this.tail=null};Cv.prototype={add:function(e){var t={item:e,next:null};this.head?this.tail.next=t:this.head=t,this.tail=t},get:function(){var e=this.head;if(e)return this.head=e.next,this.tail===e&&(this.tail=null),e.item}};var bf,Iv,Df,QU=typeof window=="object",Hl=Wn,lo=W,$U=Wi,Bo=_e,Pf=JT,ZU=function(e,t,n){for(var r in t)n&&n.unsafe&&e[r]?e[r]=t[r]:cU(e,r,t[r],n);return e},ex=Bc,tx=function(e){var t=dU(e),n=lU.f;uU&&t&&!t[XT]&&n(t,XT,{configurable:!0,get:function(){return this}})},Lf=co,Kl=j,nx=Zn,rx=function(e,t){if(hU(t,e))return e;throw pU("Incorrect invocation")},ix=sf,Av=Pl,ox=function(e,t){if(!t&&!$T)return!1;var n=!1;try{var r={};r[QT]=function(){return{next:function(){return{done:n=!0}}}},e(r)}catch{}return n},sx=sv,Ov=mv.set,kf=KU,ax=Rv,cx=function(e,t){var n=XU.console;n&&n.error&&(arguments.length==1?n.error(e):n.error(e,t))},wv=ya,Mf=Wl,dx=Cv,Uf=Vl,lx=qS,ux=QU,zl=yl,Nv=fa,hx=mn("species"),Hi="Promise",bv=Uf.getterFor(Hi),px=Uf.set,fx=Uf.getterFor(Hi),mx=Pf&&Pf.prototype,Ki=Pf,Yl=mx,Dv=lo.TypeError,xf=lo.document,Vf=lo.process,Ra=wv.f,Ex=Ra,_x=!!(xf&&xf.createEvent&&lo.dispatchEvent),Pv=Kl(lo.PromiseRejectionEvent),Lv="unhandledrejection",ql=lx(Hi,function(){var e=ix(Ki),t=e!==String(Ki);if(!t&&Nv===66||!Yl.finally)return!0;if(Nv>=51&&/native code/.test(e))return!1;var n=new Ki(function(o){o(1)}),r=function(o){o(function(){},function(){})};return(n.constructor={})[hx]=r,!(n.then(function(){})instanceof r)||!t&&ux&&!Pv}),gx=ql||!ox(function(e){Ki.all(e).catch(function(){})}),kv=function(e){var t;return!(!nx(e)||!Kl(t=e.then))&&t},Mv=function(e,t){var n,r,o,a=t.value,d=t.state==1,u=d?e.ok:e.fail,h=e.resolve,m=e.reject,f=e.domain;try{u?(d||(t.rejection===2&&Tx(t),t.rejection=1),u===!0?n=a:(f&&f.enter(),n=u(a),f&&(f.exit(),o=!0)),n===e.promise?m(Dv("Promise-chain cycle")):(r=kv(n))?Bo(r,n,h,m):h(n)):m(a)}catch(E){f&&!o&&f.exit(),m(E)}},Uv=function(e,t){e.notified||(e.notified=!0,kf(function(){for(var n,r=e.reactions;n=r.get();)Mv(n,e);e.notified=!1,t&&!e.rejection&&Sx(e)}))},xv=function(e,t,n){var r,o;_x?((r=xf.createEvent("Event")).promise=t,r.reason=n,r.initEvent(e,!1,!0),lo.dispatchEvent(r)):r={promise:t,reason:n},!Pv&&(o=lo["on"+e])?o(r):e===Lv&&cx("Unhandled promise rejection",n)},Sx=function(e){Bo(Ov,lo,function(){var t,n=e.facade,r=e.value;if(Vv(e)&&(t=Mf(function(){zl?Vf.emit("unhandledRejection",r,n):xv(Lv,n,r)}),e.rejection=zl||Vv(e)?2:1,t.error))throw t.value})},Vv=function(e){return e.rejection!==1&&!e.parent},Tx=function(e){Bo(Ov,lo,function(){var t=e.facade;zl?Vf.emit("rejectionHandled",t):xv("rejectionhandled",t,e.value)})},Ca=function(e,t,n){return function(r){e(t,r,n)}},Ia=function(e,t,n){e.done||(e.done=!0,n&&(e=n),e.value=t,e.state=2,Uv(e,!0))},Ff=function(e,t,n){if(!e.done){e.done=!0,n&&(e=n);try{if(e.facade===t)throw Dv("Promise can't be resolved itself");var r=kv(t);r?kf(function(){var o={done:!1};try{Bo(r,t,Ca(Ff,o,e),Ca(Ia,o,e))}catch(a){Ia(o,a,e)}}):(e.value=t,e.state=1,Uv(e,!1))}catch(o){Ia({done:!1},o,e)}}};ql&&(Yl=(Ki=function(e){rx(this,Yl),Lf(e),Bo(bf,this);var t=bv(this);try{e(Ca(Ff,t),Ca(Ia,t))}catch(n){Ia(t,n)}}).prototype,(bf=function(e){px(this,{type:Hi,done:!1,notified:!1,parent:!1,reactions:new dx,rejection:!1,state:0,value:void 0})}).prototype=ZU(Yl,{then:function(e,t){var n=fx(this),r=Ra(sx(this,Ki));return n.parent=!0,r.ok=!Kl(e)||e,r.fail=Kl(t)&&t,r.domain=zl?Vf.domain:void 0,n.state==0?n.reactions.add(r):kf(function(){Mv(r,n)}),r.promise},catch:function(e){return this.then(void 0,e)}}),Iv=function(){var e=new bf,t=bv(e);this.promise=e,this.resolve=Ca(Ff,t),this.reject=Ca(Ia,t)},wv.f=Ra=function(e){return e===Ki||e===Df?new Iv(e):Ex(e)}),Hl({global:!0,wrap:!0,forced:ql},{Promise:Ki}),ex(Ki,Hi,!1,!0),tx(Hi),Df=$U(Hi),Hl({target:Hi,stat:!0,forced:ql},{reject:function(e){var t=Ra(this);return Bo(t.reject,void 0,e),t.promise}}),Hl({target:Hi,stat:!0,forced:!0},{resolve:function(e){return ax(this===Df?Ki:this,e)}}),Hl({target:Hi,stat:!0,forced:gx},{all:function(e){var t=this,n=Ra(t),r=n.resolve,o=n.reject,a=Mf(function(){var d=Lf(t.resolve),u=[],h=0,m=1;Av(e,function(f){var E=h++,T=!1;m++,Bo(d,t,f).then(function(R){T||(T=!0,u[E]=R,--m||r(u))},o)}),--m||r(u)});return a.error&&o(a.value),n.promise},race:function(e){var t=this,n=Ra(t),r=n.reject,o=Mf(function(){var a=Lf(t.resolve);Av(e,function(d){Bo(a,t,d).then(n.resolve,r)})});return o.error&&r(o.value),n.promise}});var vx=_e,yx=co,Rx=ya,Cx=Wl,Ix=Pl;Wn({target:"Promise",stat:!0},{allSettled:function(e){var t=this,n=Rx.f(t),r=n.resolve,o=n.reject,a=Cx(function(){var d=yx(t.resolve),u=[],h=0,m=1;Ix(e,function(f){var E=h++,T=!1;m++,vx(d,t,f).then(function(R){T||(T=!0,u[E]={status:"fulfilled",value:R},--m||r(u))},function(R){T||(T=!0,u[E]={status:"rejected",reason:R},--m||r(u))})}),--m||r(u)});return a.error&&o(a.value),n.promise}});var Ax=co,Ox=Wi,wx=_e,Nx=ya,bx=Wl,Dx=Pl,Fv="No one promise resolved";Wn({target:"Promise",stat:!0},{any:function(e){var t=this,n=Ox("AggregateError"),r=Nx.f(t),o=r.resolve,a=r.reject,d=bx(function(){var u=Ax(t.resolve),h=[],m=0,f=1,E=!1;Dx(e,function(T){var R=m++,A=!1;f++,wx(u,t,T).then(function(O){A||E||(E=!0,o(O))},function(O){A||E||(A=!0,h[R]=O,--f||a(new n(h,Fv)))})}),--f||a(new n(h,Fv))});return d.error&&a(d.value),r.promise}});var jv=JT,Px=Wi,Lx=j,kx=sv,Bv=Rv;Wn({target:"Promise",proto:!0,real:!0,forced:!!jv&&p(function(){jv.prototype.finally.call({then:function(){}},function(){})})},{finally:function(e){var t=kx(this,Px("Promise")),n=Lx(e);return this.then(n?function(r){return Bv(t,e()).then(function(){return r})}:e,n?function(r){return Bv(t,e()).then(function(){throw r})}:e)}});var jf=F,Mx=Gp,Ux=ga,xx=ko,Vx=jf("".charAt),Gv=jf("".charCodeAt),Fx=jf("".slice),Wv=function(e){return function(t,n){var r,o,a=Ux(xx(t)),d=Mx(n),u=a.length;return d<0||d>=u?e?"":void 0:(r=Gv(a,d))<55296||r>56319||d+1===u||(o=Gv(a,d+1))<56320||o>57343?e?Vx(a,d):r:e?Fx(a,d,d+2):o-56320+(r-55296<<10)+65536}},jx={codeAt:Wv(!1),charAt:Wv(!0)}.charAt,Bx=ga,Hv=Vl,Gx=KT,Kv="String Iterator",Wx=Hv.set,Hx=Hv.getterFor(Kv);Gx(String,"String",function(e){Wx(this,{type:Kv,string:Bx(e),index:0})},function(){var e,t=Hx(this),n=t.string,r=t.index;return r>=n.length?{value:void 0,done:!0}:(e=jx(n,r),t.index+=e.length,{value:e,done:!1})});var Kx=Mo.Promise,zx={CSSRuleList:0,CSSStyleDeclaration:0,CSSValueList:0,ClientRectList:0,DOMRectList:0,DOMStringList:0,DOMTokenList:1,DataTransferItemList:0,FileList:0,HTMLAllCollection:0,HTMLCollection:0,HTMLFormElement:0,HTMLSelectElement:0,MediaList:0,MimeTypeArray:0,NamedNodeMap:0,NodeList:1,PaintRequestList:0,Plugin:0,PluginArray:0,SVGLengthList:0,SVGNumberList:0,SVGPathSegList:0,SVGPointList:0,SVGStringList:0,SVGTransformList:0,SourceBufferList:0,StyleSheetList:0,TextTrackCueList:0,TextTrackList:0,TouchList:0},Yx=W,qx=jo,Jx=Ds,zv=_a,Yv=mn("toStringTag");for(var Bf in zx){var qv=Yx[Bf],Gf=qv&&qv.prototype;Gf&&qx(Gf)!==Yv&&Jx(Gf,Yv,Bf),zv[Bf]=zv.Array}var Jv=Kx,de=Jv;const Xv=iT;function Qv(e,t){const n=e&&e.navigator;if(!n.mediaDevices)return;const r=function(d){if(typeof d!="object"||d.mandatory||d.optional)return d;const u={};return Object.keys(d).forEach(h=>{if(h==="require"||h==="advanced"||h==="mediaSource")return;const m=typeof d[h]=="object"?d[h]:{ideal:d[h]};m.exact!==void 0&&typeof m.exact=="number"&&(m.min=m.max=m.exact);const f=function(E,T){return E?E+T.charAt(0).toUpperCase()+T.slice(1):T==="deviceId"?"sourceId":T};if(m.ideal!==void 0){u.optional=u.optional||[];let E={};typeof m.ideal=="number"?(E[f("min",h)]=m.ideal,u.optional.push(E),E={},E[f("max",h)]=m.ideal,u.optional.push(E)):(E[f("",h)]=m.ideal,u.optional.push(E))}m.exact!==void 0&&typeof m.exact!="number"?(u.mandatory=u.mandatory||{},u.mandatory[f("",h)]=m.exact):["min","max"].forEach(E=>{m[E]!==void 0&&(u.mandatory=u.mandatory||{},u.mandatory[f(E,h)]=m[E])})}),d.advanced&&(u.optional=(u.optional||[]).concat(d.advanced)),u},o=function(d,u){if(t.version>=61)return u(d);if((d=JSON.parse(JSON.stringify(d)))&&typeof d.audio=="object"){const h=function(m,f,E){f in m&&!(E in m)&&(m[E]=m[f],delete m[f])};h((d=JSON.parse(JSON.stringify(d))).audio,"autoGainControl","googAutoGainControl"),h(d.audio,"noiseSuppression","googNoiseSuppression"),d.audio=r(d.audio)}if(d&&typeof d.video=="object"){let h=d.video.facingMode;h=h&&(typeof h=="object"?h:{ideal:h});const m=t.version<66;if(h&&(h.exact==="user"||h.exact==="environment"||h.ideal==="user"||h.ideal==="environment")&&(!n.mediaDevices.getSupportedConstraints||!n.mediaDevices.getSupportedConstraints().facingMode||m)){let f;if(delete d.video.facingMode,h.exact==="environment"||h.ideal==="environment"?f=["back","rear"]:h.exact!=="user"&&h.ideal!=="user"||(f=["front"]),f)return n.mediaDevices.enumerateDevices().then(E=>{let T=(E=E.filter(R=>R.kind==="videoinput")).find(R=>f.some(A=>R.label.toLowerCase().includes(A)));return!T&&E.length&&f.includes("back")&&(T=E[E.length-1]),T&&(d.video.deviceId=h.exact?{exact:T.deviceId}:{ideal:T.deviceId}),d.video=r(d.video),Xv("chrome: "+JSON.stringify(d)),u(d)})}d.video=r(d.video)}return Xv("chrome: "+JSON.stringify(d)),u(d)},a=function(d){return t.version>=64?d:{name:{PermissionDeniedError:"NotAllowedError",PermissionDismissedError:"NotAllowedError",InvalidStateError:"NotAllowedError",DevicesNotFoundError:"NotFoundError",ConstraintNotSatisfiedError:"OverconstrainedError",TrackStartError:"NotReadableError",MediaDeviceFailedDueToShutdown:"NotAllowedError",MediaDeviceKillSwitchOn:"NotAllowedError",TabCaptureError:"AbortError",ScreenCaptureError:"AbortError",DeviceCaptureError:"AbortError"}[d.name]||d.name,message:d.message,constraint:d.constraint||d.constraintName,toString(){return this.name+(this.message&&": ")+this.message}}};if(n.getUserMedia=(function(d,u,h){o(d,m=>{n.webkitGetUserMedia(m,u,f=>{h&&h(a(f))})})}).bind(n),n.mediaDevices.getUserMedia){const d=n.mediaDevices.getUserMedia.bind(n.mediaDevices);n.mediaDevices.getUserMedia=function(u){return o(u,h=>d(h).then(m=>{if(h.audio&&!m.getAudioTracks().length||h.video&&!m.getVideoTracks().length)throw m.getTracks().forEach(f=>{f.stop()}),new DOMException("","NotFoundError");return m},m=>de.reject(a(m))))}}}function $v(e){e.MediaStream=e.MediaStream||e.webkitMediaStream}function Zv(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("ontrack"in e.RTCPeerConnection.prototype)){Object.defineProperty(e.RTCPeerConnection.prototype,"ontrack",{get(){return this._ontrack},set(n){this._ontrack&&this.removeEventListener("track",this._ontrack),this.addEventListener("track",this._ontrack=n)},enumerable:!0,configurable:!0});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){return this._ontrackpoly||(this._ontrackpoly=n=>{n.stream.addEventListener("addtrack",r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===r.track.id):{track:r.track};const a=new Event("track");a.track=r.track,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)}),n.stream.getTracks().forEach(r=>{let o;o=e.RTCPeerConnection.prototype.getReceivers?this.getReceivers().find(d=>d.track&&d.track.id===r.id):{track:r};const a=new Event("track");a.track=r,a.receiver=o,a.transceiver={receiver:o},a.streams=[n.stream],this.dispatchEvent(a)})},this.addEventListener("addstream",this._ontrackpoly)),t.apply(this,arguments)}}else Ps(e,"track",t=>(t.transceiver||Object.defineProperty(t,"transceiver",{value:{receiver:t.receiver}}),t))}function ey(e){if(typeof e=="object"&&e.RTCPeerConnection&&!("getSenders"in e.RTCPeerConnection.prototype)&&"createDTMFSender"in e.RTCPeerConnection.prototype){const t=function(o,a){return{track:a,get dtmf(){return this._dtmf===void 0&&(a.kind==="audio"?this._dtmf=o.createDTMFSender(a):this._dtmf=null),this._dtmf},_pc:o}};if(!e.RTCPeerConnection.prototype.getSenders){e.RTCPeerConnection.prototype.getSenders=function(){return this._senders=this._senders||[],this._senders.slice()};const o=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(d,u){let h=o.apply(this,arguments);return h||(h=t(this,d),this._senders.push(h)),h};const a=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(d){a.apply(this,arguments);const u=this._senders.indexOf(d);u!==-1&&this._senders.splice(u,1)}}const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(o){this._senders=this._senders||[],n.apply(this,[o]),o.getTracks().forEach(a=>{this._senders.push(t(this,a))})};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(o){this._senders=this._senders||[],r.apply(this,[o]),o.getTracks().forEach(a=>{const d=this._senders.find(u=>u.track===a);d&&this._senders.splice(this._senders.indexOf(d),1)})}}else if(typeof e=="object"&&e.RTCPeerConnection&&"getSenders"in e.RTCPeerConnection.prototype&&"createDTMFSender"in e.RTCPeerConnection.prototype&&e.RTCRtpSender&&!("dtmf"in e.RTCRtpSender.prototype)){const t=e.RTCPeerConnection.prototype.getSenders;e.RTCPeerConnection.prototype.getSenders=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n},Object.defineProperty(e.RTCRtpSender.prototype,"dtmf",{get(){return this._dtmf===void 0&&(this.track.kind==="audio"?this._dtmf=this._pc.createDTMFSender(this.track):this._dtmf=null),this._dtmf}})}}function ty(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[n,r,o]=arguments;if(arguments.length>0&&typeof n=="function")return t.apply(this,arguments);if(t.length===0&&(arguments.length===0||typeof n!="function"))return t.apply(this,[]);const a=function(u){const h={};return u.result().forEach(m=>{const f={id:m.id,timestamp:m.timestamp,type:{localcandidate:"local-candidate",remotecandidate:"remote-candidate"}[m.type]||m.type};m.names().forEach(E=>{f[E]=m.stat(E)}),h[f.id]=f}),h},d=function(u){return new Map(Object.keys(u).map(h=>[h,u[h]]))};if(arguments.length>=2){const u=function(h){r(d(a(h)))};return t.apply(this,[u,n])}return new de((u,h)=>{t.apply(this,[function(m){u(d(a(m)))},h])}).then(r,o)}}function ny(e){if(!(typeof e=="object"&&e.RTCPeerConnection&&e.RTCRtpSender&&e.RTCRtpReceiver))return;if(!("getStats"in e.RTCRtpSender.prototype)){const n=e.RTCPeerConnection.prototype.getSenders;n&&(e.RTCPeerConnection.prototype.getSenders=function(){const o=n.apply(this,[]);return o.forEach(a=>a._pc=this),o});const r=e.RTCPeerConnection.prototype.addTrack;r&&(e.RTCPeerConnection.prototype.addTrack=function(){const o=r.apply(this,arguments);return o._pc=this,o}),e.RTCRtpSender.prototype.getStats=function(){const o=this;return this._pc.getStats().then(a=>aT(a,o.track,!0))}}if(!("getStats"in e.RTCRtpReceiver.prototype)){const n=e.RTCPeerConnection.prototype.getReceivers;n&&(e.RTCPeerConnection.prototype.getReceivers=function(){const r=n.apply(this,[]);return r.forEach(o=>o._pc=this),r}),Ps(e,"track",r=>(r.receiver._pc=r.srcElement,r)),e.RTCRtpReceiver.prototype.getStats=function(){const r=this;return this._pc.getStats().then(o=>aT(o,r.track,!1))}}if(!("getStats"in e.RTCRtpSender.prototype)||!("getStats"in e.RTCRtpReceiver.prototype))return;const t=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){if(arguments.length>0&&arguments[0]instanceof e.MediaStreamTrack){const n=arguments[0];let r,o,a;return this.getSenders().forEach(d=>{d.track===n&&(r?a=!0:r=d)}),this.getReceivers().forEach(d=>(d.track===n&&(o?a=!0:o=d),d.track===n)),a||r&&o?de.reject(new DOMException("There are more than one sender or receiver for the track.","InvalidAccessError")):r?r.getStats():o?o.getStats():de.reject(new DOMException("There is no sender or receiver for the track.","InvalidAccessError"))}return t.apply(this,arguments)}}function ry(e){e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},Object.keys(this._shimmedLocalStreams).map(a=>this._shimmedLocalStreams[a][0])};const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addTrack=function(a,d){if(!d)return t.apply(this,arguments);this._shimmedLocalStreams=this._shimmedLocalStreams||{};const u=t.apply(this,arguments);return this._shimmedLocalStreams[d.id]?this._shimmedLocalStreams[d.id].indexOf(u)===-1&&this._shimmedLocalStreams[d.id].push(u):this._shimmedLocalStreams[d.id]=[d,u],u};const n=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(a){this._shimmedLocalStreams=this._shimmedLocalStreams||{},a.getTracks().forEach(h=>{if(this.getSenders().find(m=>m.track===h))throw new DOMException("Track already exists.","InvalidAccessError")});const d=this.getSenders();n.apply(this,arguments);const u=this.getSenders().filter(h=>d.indexOf(h)===-1);this._shimmedLocalStreams[a.id]=[a].concat(u)};const r=e.RTCPeerConnection.prototype.removeStream;e.RTCPeerConnection.prototype.removeStream=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},delete this._shimmedLocalStreams[a.id],r.apply(this,arguments)};const o=e.RTCPeerConnection.prototype.removeTrack;e.RTCPeerConnection.prototype.removeTrack=function(a){return this._shimmedLocalStreams=this._shimmedLocalStreams||{},a&&Object.keys(this._shimmedLocalStreams).forEach(d=>{const u=this._shimmedLocalStreams[d].indexOf(a);u!==-1&&this._shimmedLocalStreams[d].splice(u,1),this._shimmedLocalStreams[d].length===1&&delete this._shimmedLocalStreams[d]}),o.apply(this,arguments)}}function iy(e,t){if(!e.RTCPeerConnection)return;if(e.RTCPeerConnection.prototype.addTrack&&t.version>=65)return ry(e);const n=e.RTCPeerConnection.prototype.getLocalStreams;e.RTCPeerConnection.prototype.getLocalStreams=function(){const m=n.apply(this);return this._reverseStreams=this._reverseStreams||{},m.map(f=>this._reverseStreams[f.id])};const r=e.RTCPeerConnection.prototype.addStream;e.RTCPeerConnection.prototype.addStream=function(m){if(this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},m.getTracks().forEach(f=>{if(this.getSenders().find(E=>E.track===f))throw new DOMException("Track already exists.","InvalidAccessError")}),!this._reverseStreams[m.id]){const f=new e.MediaStream(m.getTracks());this._streams[m.id]=f,this._reverseStreams[f.id]=m,m=f}r.apply(this,[m])};const o=e.RTCPeerConnection.prototype.removeStream;function a(m,f){let E=f.sdp;return Object.keys(m._reverseStreams||[]).forEach(T=>{const R=m._reverseStreams[T],A=m._streams[R.id];E=E.replace(new RegExp(A.id,"g"),R.id)}),new RTCSessionDescription({type:f.type,sdp:E})}function d(m,f){let E=f.sdp;return Object.keys(m._reverseStreams||[]).forEach(T=>{const R=m._reverseStreams[T],A=m._streams[R.id];E=E.replace(new RegExp(R.id,"g"),A.id)}),new RTCSessionDescription({type:f.type,sdp:E})}e.RTCPeerConnection.prototype.removeStream=function(m){this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{},o.apply(this,[this._streams[m.id]||m]),delete this._reverseStreams[this._streams[m.id]?this._streams[m.id].id:m.id],delete this._streams[m.id]},e.RTCPeerConnection.prototype.addTrack=function(m,f){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");const E=[].slice.call(arguments,1);if(E.length!==1||!E[0].getTracks().find(A=>A===m))throw new DOMException("The adapter.js addTrack polyfill only supports a single  stream which is associated with the specified track.","NotSupportedError");if(this.getSenders().find(A=>A.track===m))throw new DOMException("Track already exists.","InvalidAccessError");this._streams=this._streams||{},this._reverseStreams=this._reverseStreams||{};const R=this._streams[f.id];if(R)R.addTrack(m),de.resolve().then(()=>{this.dispatchEvent(new Event("negotiationneeded"))});else{const A=new e.MediaStream([m]);this._streams[f.id]=A,this._reverseStreams[A.id]=f,this.addStream(A)}return this.getSenders().find(A=>A.track===m)},["createOffer","createAnswer"].forEach(function(m){const f=e.RTCPeerConnection.prototype[m],E={[m](){const T=arguments;return arguments.length&&typeof arguments[0]=="function"?f.apply(this,[R=>{const A=a(this,R);T[0].apply(null,[A])},R=>{T[1]&&T[1].apply(null,R)},arguments[2]]):f.apply(this,arguments).then(R=>a(this,R))}};e.RTCPeerConnection.prototype[m]=E[m]});const u=e.RTCPeerConnection.prototype.setLocalDescription;e.RTCPeerConnection.prototype.setLocalDescription=function(){return arguments.length&&arguments[0].type?(arguments[0]=d(this,arguments[0]),u.apply(this,arguments)):u.apply(this,arguments)};const h=Object.getOwnPropertyDescriptor(e.RTCPeerConnection.prototype,"localDescription");Object.defineProperty(e.RTCPeerConnection.prototype,"localDescription",{get(){const m=h.get.apply(this);return m.type===""?m:a(this,m)}}),e.RTCPeerConnection.prototype.removeTrack=function(m){if(this.signalingState==="closed")throw new DOMException("The RTCPeerConnection's signalingState is 'closed'.","InvalidStateError");if(!m._pc)throw new DOMException("Argument 1 of RTCPeerConnection.removeTrack does not implement interface RTCRtpSender.","TypeError");if(m._pc!==this)throw new DOMException("Sender was not created by this connection.","InvalidAccessError");let f;this._streams=this._streams||{},Object.keys(this._streams).forEach(E=>{this._streams[E].getTracks().find(T=>m.track===T)&&(f=this._streams[E])}),f&&(f.getTracks().length===1?this.removeStream(this._reverseStreams[f.id]):f.removeTrack(m.track),this.dispatchEvent(new Event("negotiationneeded")))}}function Wf(e,t){!e.RTCPeerConnection&&e.webkitRTCPeerConnection&&(e.RTCPeerConnection=e.webkitRTCPeerConnection),e.RTCPeerConnection&&t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(n){const r=e.RTCPeerConnection.prototype[n],o={[n](){return arguments[0]=new(n==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),r.apply(this,arguments)}};e.RTCPeerConnection.prototype[n]=o[n]})}function oy(e,t){Ps(e,"negotiationneeded",n=>{const r=n.target;if(!(t.version<72||r.getConfiguration&&r.getConfiguration().sdpSemantics==="plan-b")||r.signalingState==="stable")return n})}var sy=Object.freeze({__proto__:null,shimMediaStream:$v,shimOnTrack:Zv,shimGetSendersWithDtmf:ey,shimGetStats:ty,shimSenderReceiverGetStats:ny,shimAddTrackRemoveTrackWithNative:ry,shimAddTrackRemoveTrack:iy,shimPeerConnection:Wf,fixNegotiationNeeded:oy,shimGetUserMedia:Qv,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(typeof t=="function"?e.navigator.mediaDevices.getDisplayMedia=function(n){return t(n).then(r=>{const o=n.video&&n.video.width,a=n.video&&n.video.height,d=n.video&&n.video.frameRate;return n.video={mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:r,maxFrameRate:d||3}},o&&(n.video.mandatory.maxWidth=o),a&&(n.video.mandatory.maxHeight=a),e.navigator.mediaDevices.getUserMedia(n)})}:console.error("shimGetDisplayMedia: getSourceId argument is not a function"))}});function ay(e,t){const n=e&&e.navigator,r=e&&e.MediaStreamTrack;if(n.getUserMedia=function(o,a,d){Kp("navigator.getUserMedia","navigator.mediaDevices.getUserMedia"),n.mediaDevices.getUserMedia(o).then(a,d)},!(t.version>55&&"autoGainControl"in n.mediaDevices.getSupportedConstraints())){const o=function(d,u,h){u in d&&!(h in d)&&(d[h]=d[u],delete d[u])},a=n.mediaDevices.getUserMedia.bind(n.mediaDevices);if(n.mediaDevices.getUserMedia=function(d){return typeof d=="object"&&typeof d.audio=="object"&&(d=JSON.parse(JSON.stringify(d)),o(d.audio,"autoGainControl","mozAutoGainControl"),o(d.audio,"noiseSuppression","mozNoiseSuppression")),a(d)},r&&r.prototype.getSettings){const d=r.prototype.getSettings;r.prototype.getSettings=function(){const u=d.apply(this,arguments);return o(u,"mozAutoGainControl","autoGainControl"),o(u,"mozNoiseSuppression","noiseSuppression"),u}}if(r&&r.prototype.applyConstraints){const d=r.prototype.applyConstraints;r.prototype.applyConstraints=function(u){return this.kind==="audio"&&typeof u=="object"&&(u=JSON.parse(JSON.stringify(u)),o(u,"autoGainControl","mozAutoGainControl"),o(u,"noiseSuppression","mozNoiseSuppression")),d.apply(this,[u])}}}}function cy(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Hf(e,t){if(typeof e!="object"||!e.RTCPeerConnection&&!e.mozRTCPeerConnection)return;!e.RTCPeerConnection&&e.mozRTCPeerConnection&&(e.RTCPeerConnection=e.mozRTCPeerConnection),t.version<53&&["setLocalDescription","setRemoteDescription","addIceCandidate"].forEach(function(o){const a=e.RTCPeerConnection.prototype[o],d={[o](){return arguments[0]=new(o==="addIceCandidate"?e.RTCIceCandidate:e.RTCSessionDescription)(arguments[0]),a.apply(this,arguments)}};e.RTCPeerConnection.prototype[o]=d[o]});const n={inboundrtp:"inbound-rtp",outboundrtp:"outbound-rtp",candidatepair:"candidate-pair",localcandidate:"local-candidate",remotecandidate:"remote-candidate"},r=e.RTCPeerConnection.prototype.getStats;e.RTCPeerConnection.prototype.getStats=function(){const[o,a,d]=arguments;return r.apply(this,[o||null]).then(u=>{if(t.version<53&&!a)try{u.forEach(h=>{h.type=n[h.type]||h.type})}catch(h){if(h.name!=="TypeError")throw h;u.forEach((m,f)=>{u.set(f,Object.assign({},m,{type:n[m.type]||m.type}))})}return u}).then(a,d)}}function dy(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpSender.prototype)return;const t=e.RTCPeerConnection.prototype.getSenders;t&&(e.RTCPeerConnection.prototype.getSenders=function(){const r=t.apply(this,[]);return r.forEach(o=>o._pc=this),r});const n=e.RTCPeerConnection.prototype.addTrack;n&&(e.RTCPeerConnection.prototype.addTrack=function(){const r=n.apply(this,arguments);return r._pc=this,r}),e.RTCRtpSender.prototype.getStats=function(){return this.track?this._pc.getStats(this.track):de.resolve(new Map)}}function ly(e){if(typeof e!="object"||!e.RTCPeerConnection||!e.RTCRtpSender||e.RTCRtpSender&&"getStats"in e.RTCRtpReceiver.prototype)return;const t=e.RTCPeerConnection.prototype.getReceivers;t&&(e.RTCPeerConnection.prototype.getReceivers=function(){const n=t.apply(this,[]);return n.forEach(r=>r._pc=this),n}),Ps(e,"track",n=>(n.receiver._pc=n.srcElement,n)),e.RTCRtpReceiver.prototype.getStats=function(){return this._pc.getStats(this.track)}}function uy(e){e.RTCPeerConnection&&!("removeStream"in e.RTCPeerConnection.prototype)&&(e.RTCPeerConnection.prototype.removeStream=function(t){Kp("removeStream","removeTrack"),this.getSenders().forEach(n=>{n.track&&t.getTracks().includes(n.track)&&this.removeTrack(n)})})}function hy(e){e.DataChannel&&!e.RTCDataChannel&&(e.RTCDataChannel=e.DataChannel)}function py(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.addTransceiver;t&&(e.RTCPeerConnection.prototype.addTransceiver=function(){this.setParametersPromises=[];let n=arguments[1]&&arguments[1].sendEncodings;n===void 0&&(n=[]),n=[...n];const r=n.length>0;r&&n.forEach(a=>{if("rid"in a&&!/^[a-z0-9]{0,16}$/i.test(a.rid))throw new TypeError("Invalid RID value provided.");if("scaleResolutionDownBy"in a&&!(parseFloat(a.scaleResolutionDownBy)>=1))throw new RangeError("scale_resolution_down_by must be >= 1.0");if("maxFramerate"in a&&!(parseFloat(a.maxFramerate)>=0))throw new RangeError("max_framerate must be >= 0.0")});const o=t.apply(this,arguments);if(r){const{sender:a}=o,d=a.getParameters();(!("encodings"in d)||d.encodings.length===1&&Object.keys(d.encodings[0]).length===0)&&(d.encodings=n,a.sendEncodings=n,this.setParametersPromises.push(a.setParameters(d).then(()=>{delete a.sendEncodings}).catch(()=>{delete a.sendEncodings})))}return o})}function fy(e){if(typeof e!="object"||!e.RTCRtpSender)return;const t=e.RTCRtpSender.prototype.getParameters;t&&(e.RTCRtpSender.prototype.getParameters=function(){const n=t.apply(this,arguments);return"encodings"in n||(n.encodings=[].concat(this.sendEncodings||[{}])),n})}function my(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(){return this.setParametersPromises&&this.setParametersPromises.length?de.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}function Ey(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype.createAnswer;e.RTCPeerConnection.prototype.createAnswer=function(){return this.setParametersPromises&&this.setParametersPromises.length?de.all(this.setParametersPromises).then(()=>t.apply(this,arguments)).finally(()=>{this.setParametersPromises=[]}):t.apply(this,arguments)}}var _y=Object.freeze({__proto__:null,shimOnTrack:cy,shimPeerConnection:Hf,shimSenderGetStats:dy,shimReceiverGetStats:ly,shimRemoveStream:uy,shimRTCDataChannel:hy,shimAddTransceiver:py,shimGetParameters:fy,shimCreateOffer:my,shimCreateAnswer:Ey,shimGetUserMedia:ay,shimGetDisplayMedia:function(e,t){e.navigator.mediaDevices&&"getDisplayMedia"in e.navigator.mediaDevices||e.navigator.mediaDevices&&(e.navigator.mediaDevices.getDisplayMedia=function(n){if(!n||!n.video){const r=new DOMException("getDisplayMedia without video constraints is undefined");return r.name="NotFoundError",r.code=8,de.reject(r)}return n.video===!0?n.video={mediaSource:t}:n.video.mediaSource=t,e.navigator.mediaDevices.getUserMedia(n)})}});function gy(e){if(typeof e=="object"&&e.RTCPeerConnection){if("getLocalStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getLocalStreams=function(){return this._localStreams||(this._localStreams=[]),this._localStreams}),!("addStream"in e.RTCPeerConnection.prototype)){const t=e.RTCPeerConnection.prototype.addTrack;e.RTCPeerConnection.prototype.addStream=function(n){this._localStreams||(this._localStreams=[]),this._localStreams.includes(n)||this._localStreams.push(n),n.getAudioTracks().forEach(r=>t.call(this,r,n)),n.getVideoTracks().forEach(r=>t.call(this,r,n))},e.RTCPeerConnection.prototype.addTrack=function(n){for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];return o&&o.forEach(d=>{this._localStreams?this._localStreams.includes(d)||this._localStreams.push(d):this._localStreams=[d]}),t.apply(this,arguments)}}"removeStream"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.removeStream=function(t){this._localStreams||(this._localStreams=[]);const n=this._localStreams.indexOf(t);if(n===-1)return;this._localStreams.splice(n,1);const r=t.getTracks();this.getSenders().forEach(o=>{r.includes(o.track)&&this.removeTrack(o)})})}}function Sy(e){if(typeof e=="object"&&e.RTCPeerConnection&&("getRemoteStreams"in e.RTCPeerConnection.prototype||(e.RTCPeerConnection.prototype.getRemoteStreams=function(){return this._remoteStreams?this._remoteStreams:[]}),!("onaddstream"in e.RTCPeerConnection.prototype))){Object.defineProperty(e.RTCPeerConnection.prototype,"onaddstream",{get(){return this._onaddstream},set(n){this._onaddstream&&(this.removeEventListener("addstream",this._onaddstream),this.removeEventListener("track",this._onaddstreampoly)),this.addEventListener("addstream",this._onaddstream=n),this.addEventListener("track",this._onaddstreampoly=r=>{r.streams.forEach(o=>{if(this._remoteStreams||(this._remoteStreams=[]),this._remoteStreams.includes(o))return;this._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,this.dispatchEvent(a)})})}});const t=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){const n=this;return this._onaddstreampoly||this.addEventListener("track",this._onaddstreampoly=function(r){r.streams.forEach(o=>{if(n._remoteStreams||(n._remoteStreams=[]),n._remoteStreams.indexOf(o)>=0)return;n._remoteStreams.push(o);const a=new Event("addstream");a.stream=o,n.dispatchEvent(a)})}),t.apply(n,arguments)}}}function Ty(e){if(typeof e!="object"||!e.RTCPeerConnection)return;const t=e.RTCPeerConnection.prototype,n=t.createOffer,r=t.createAnswer,o=t.setLocalDescription,a=t.setRemoteDescription,d=t.addIceCandidate;t.createOffer=function(h,m){const f=arguments.length>=2?arguments[2]:arguments[0],E=n.apply(this,[f]);return m?(E.then(h,m),de.resolve()):E},t.createAnswer=function(h,m){const f=arguments.length>=2?arguments[2]:arguments[0],E=r.apply(this,[f]);return m?(E.then(h,m),de.resolve()):E};let u=function(h,m,f){const E=o.apply(this,[h]);return f?(E.then(m,f),de.resolve()):E};t.setLocalDescription=u,u=function(h,m,f){const E=a.apply(this,[h]);return f?(E.then(m,f),de.resolve()):E},t.setRemoteDescription=u,u=function(h,m,f){const E=d.apply(this,[h]);return f?(E.then(m,f),de.resolve()):E},t.addIceCandidate=u}function vy(e){const t=e&&e.navigator;if(t.mediaDevices&&t.mediaDevices.getUserMedia){const n=t.mediaDevices,r=n.getUserMedia.bind(n);t.mediaDevices.getUserMedia=o=>r(yy(o))}!t.getUserMedia&&t.mediaDevices&&t.mediaDevices.getUserMedia&&(t.getUserMedia=(function(n,r,o){t.mediaDevices.getUserMedia(n).then(r,o)}).bind(t))}function yy(e){return e&&e.video!==void 0?Object.assign({},e,{video:sT(e.video)}):e}function Ry(e){if(!e.RTCPeerConnection)return;const t=e.RTCPeerConnection;e.RTCPeerConnection=function(n,r){if(n&&n.iceServers){const o=[];for(let a=0;a<n.iceServers.length;a++){let d=n.iceServers[a];!d.hasOwnProperty("urls")&&d.hasOwnProperty("url")?(Kp("RTCIceServer.url","RTCIceServer.urls"),d=JSON.parse(JSON.stringify(d)),d.urls=d.url,delete d.url,o.push(d)):o.push(n.iceServers[a])}n.iceServers=o}return new t(n,r)},e.RTCPeerConnection.prototype=t.prototype,"generateCertificate"in t&&Object.defineProperty(e.RTCPeerConnection,"generateCertificate",{get:()=>t.generateCertificate})}function Cy(e){typeof e=="object"&&e.RTCTrackEvent&&"receiver"in e.RTCTrackEvent.prototype&&!("transceiver"in e.RTCTrackEvent.prototype)&&Object.defineProperty(e.RTCTrackEvent.prototype,"transceiver",{get(){return{receiver:this.receiver}}})}function Iy(e){const t=e.RTCPeerConnection.prototype.createOffer;e.RTCPeerConnection.prototype.createOffer=function(n){if(n){n.offerToReceiveAudio!==void 0&&(n.offerToReceiveAudio=!!n.offerToReceiveAudio);const r=this.getTransceivers().find(a=>a.receiver.track.kind==="audio");n.offerToReceiveAudio===!1&&r?r.direction==="sendrecv"?r.setDirection?r.setDirection("sendonly"):r.direction="sendonly":r.direction==="recvonly"&&(r.setDirection?r.setDirection("inactive"):r.direction="inactive"):n.offerToReceiveAudio!==!0||r||this.addTransceiver("audio",{direction:"recvonly"}),n.offerToReceiveVideo!==void 0&&(n.offerToReceiveVideo=!!n.offerToReceiveVideo);const o=this.getTransceivers().find(a=>a.receiver.track.kind==="video");n.offerToReceiveVideo===!1&&o?o.direction==="sendrecv"?o.setDirection?o.setDirection("sendonly"):o.direction="sendonly":o.direction==="recvonly"&&(o.setDirection?o.setDirection("inactive"):o.direction="inactive"):n.offerToReceiveVideo!==!0||o||this.addTransceiver("video",{direction:"recvonly"})}return t.apply(this,arguments)}}function Ay(e){typeof e!="object"||e.AudioContext||(e.AudioContext=e.webkitAudioContext)}var Oy=Object.freeze({__proto__:null,shimLocalStreamsAPI:gy,shimRemoteStreamsAPI:Sy,shimCallbacksAPI:Ty,shimGetUserMedia:vy,shimConstraints:yy,shimRTCIceServerUrls:Ry,shimTrackEventTransceiver:Cy,shimCreateOfferLegacy:Iy,shimAudioContext:Ay}),Xx=`	
\v\f\r                　\u2028\u2029\uFEFF`,Qx=ko,$x=ga,wy=F("".replace),Jl=`[	
\v\f\r                　\u2028\u2029\uFEFF]`,Zx=RegExp("^"+Jl+Jl+"*"),e2=RegExp(Jl+Jl+"*$"),Kf=function(e){return function(t){var n=$x(Qx(t));return 1&e&&(n=wy(n,Zx,"")),2&e&&(n=wy(n,e2,"")),n}},t2={start:Kf(1),end:Kf(2),trim:Kf(3)},n2=UT.PROPER,r2=p,Ny=Xx,i2=t2.trim;Wn({target:"String",proto:!0,forced:function(e){return r2(function(){return!!Ny[e]()||"​᠎"[e]()!=="​᠎"||n2&&Ny[e].name!==e})}("trim")},{trim:function(){return i2(this)}});var o2=Vo("String").trim,s2=H,a2=o2,zf=String.prototype,uo=function(e){var t=e.trim;return typeof e=="string"||e===zf||s2(zf,e)&&t===zf.trim?a2:t},Yf={exports:{}};(function(e){const t={generateIdentifier:function(){return Math.random().toString(36).substr(2,10)}};t.localCName=t.generateIdentifier(),t.splitLines=function(n){return uo(n).call(n).split(`
`).map(r=>uo(r).call(r))},t.splitSections=function(n){return n.split(`
m=`).map((r,o)=>{var a;return uo(a=o>0?"m="+r:r).call(a)+`\r
`})},t.getDescription=function(n){const r=t.splitSections(n);return r&&r[0]},t.getMediaSections=function(n){const r=t.splitSections(n);return r.shift(),r},t.matchPrefix=function(n,r){return t.splitLines(n).filter(o=>o.indexOf(r)===0)},t.parseCandidate=function(n){let r;r=n.indexOf("a=candidate:")===0?n.substring(12).split(" "):n.substring(10).split(" ");const o={foundation:r[0],component:{1:"rtp",2:"rtcp"}[r[1]]||r[1],protocol:r[2].toLowerCase(),priority:parseInt(r[3],10),ip:r[4],address:r[4],port:parseInt(r[5],10),type:r[7]};for(let a=8;a<r.length;a+=2)switch(r[a]){case"raddr":o.relatedAddress=r[a+1];break;case"rport":o.relatedPort=parseInt(r[a+1],10);break;case"tcptype":o.tcpType=r[a+1];break;case"ufrag":o.ufrag=r[a+1],o.usernameFragment=r[a+1];break;default:o[r[a]]===void 0&&(o[r[a]]=r[a+1])}return o},t.writeCandidate=function(n){const r=[];r.push(n.foundation);const o=n.component;o==="rtp"?r.push(1):o==="rtcp"?r.push(2):r.push(o),r.push(n.protocol.toUpperCase()),r.push(n.priority),r.push(n.address||n.ip),r.push(n.port);const a=n.type;return r.push("typ"),r.push(a),a!=="host"&&n.relatedAddress&&n.relatedPort&&(r.push("raddr"),r.push(n.relatedAddress),r.push("rport"),r.push(n.relatedPort)),n.tcpType&&n.protocol.toLowerCase()==="tcp"&&(r.push("tcptype"),r.push(n.tcpType)),(n.usernameFragment||n.ufrag)&&(r.push("ufrag"),r.push(n.usernameFragment||n.ufrag)),"candidate:"+r.join(" ")},t.parseIceOptions=function(n){return n.substr(14).split(" ")},t.parseRtpMap=function(n){let r=n.substr(9).split(" ");const o={payloadType:parseInt(r.shift(),10)};return r=r[0].split("/"),o.name=r[0],o.clockRate=parseInt(r[1],10),o.channels=r.length===3?parseInt(r[2],10):1,o.numChannels=o.channels,o},t.writeRtpMap=function(n){let r=n.payloadType;n.preferredPayloadType!==void 0&&(r=n.preferredPayloadType);const o=n.channels||n.numChannels||1;return"a=rtpmap:"+r+" "+n.name+"/"+n.clockRate+(o!==1?"/"+o:"")+`\r
`},t.parseExtmap=function(n){const r=n.substr(9).split(" ");return{id:parseInt(r[0],10),direction:r[0].indexOf("/")>0?r[0].split("/")[1]:"sendrecv",uri:r[1]}},t.writeExtmap=function(n){return"a=extmap:"+(n.id||n.preferredId)+(n.direction&&n.direction!=="sendrecv"?"/"+n.direction:"")+" "+n.uri+`\r
`},t.parseFmtp=function(n){const r={};let o;const a=n.substr(n.indexOf(" ")+1).split(";");for(let h=0;h<a.length;h++){var d,u;o=uo(d=a[h]).call(d).split("="),r[uo(u=o[0]).call(u)]=o[1]}return r},t.writeFmtp=function(n){let r="",o=n.payloadType;if(n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.parameters&&Object.keys(n.parameters).length){const a=[];Object.keys(n.parameters).forEach(d=>{n.parameters[d]!==void 0?a.push(d+"="+n.parameters[d]):a.push(d)}),r+="a=fmtp:"+o+" "+a.join(";")+`\r
`}return r},t.parseRtcpFb=function(n){const r=n.substr(n.indexOf(" ")+1).split(" ");return{type:r.shift(),parameter:r.join(" ")}},t.writeRtcpFb=function(n){let r="",o=n.payloadType;return n.preferredPayloadType!==void 0&&(o=n.preferredPayloadType),n.rtcpFeedback&&n.rtcpFeedback.length&&n.rtcpFeedback.forEach(a=>{r+="a=rtcp-fb:"+o+" "+a.type+(a.parameter&&a.parameter.length?" "+a.parameter:"")+`\r
`}),r},t.parseSsrcMedia=function(n){const r=n.indexOf(" "),o={ssrc:parseInt(n.substr(7,r-7),10)},a=n.indexOf(":",r);return a>-1?(o.attribute=n.substr(r+1,a-r-1),o.value=n.substr(a+1)):o.attribute=n.substr(r+1),o},t.parseSsrcGroup=function(n){const r=n.substr(13).split(" ");return{semantics:r.shift(),ssrcs:r.map(o=>parseInt(o,10))}},t.getMid=function(n){const r=t.matchPrefix(n,"a=mid:")[0];if(r)return r.substr(6)},t.parseFingerprint=function(n){const r=n.substr(14).split(" ");return{algorithm:r[0].toLowerCase(),value:r[1].toUpperCase()}},t.getDtlsParameters=function(n,r){return{role:"auto",fingerprints:t.matchPrefix(n+r,"a=fingerprint:").map(t.parseFingerprint)}},t.writeDtlsParameters=function(n,r){let o="a=setup:"+r+`\r
`;return n.fingerprints.forEach(a=>{o+="a=fingerprint:"+a.algorithm+" "+a.value+`\r
`}),o},t.parseCryptoLine=function(n){const r=n.substr(9).split(" ");return{tag:parseInt(r[0],10),cryptoSuite:r[1],keyParams:r[2],sessionParams:r.slice(3)}},t.writeCryptoLine=function(n){return"a=crypto:"+n.tag+" "+n.cryptoSuite+" "+(typeof n.keyParams=="object"?t.writeCryptoKeyParams(n.keyParams):n.keyParams)+(n.sessionParams?" "+n.sessionParams.join(" "):"")+`\r
`},t.parseCryptoKeyParams=function(n){if(n.indexOf("inline:")!==0)return null;const r=n.substr(7).split("|");return{keyMethod:"inline",keySalt:r[0],lifeTime:r[1],mkiValue:r[2]?r[2].split(":")[0]:void 0,mkiLength:r[2]?r[2].split(":")[1]:void 0}},t.writeCryptoKeyParams=function(n){return n.keyMethod+":"+n.keySalt+(n.lifeTime?"|"+n.lifeTime:"")+(n.mkiValue&&n.mkiLength?"|"+n.mkiValue+":"+n.mkiLength:"")},t.getCryptoParameters=function(n,r){return t.matchPrefix(n+r,"a=crypto:").map(t.parseCryptoLine)},t.getIceParameters=function(n,r){const o=t.matchPrefix(n+r,"a=ice-ufrag:")[0],a=t.matchPrefix(n+r,"a=ice-pwd:")[0];return o&&a?{usernameFragment:o.substr(12),password:a.substr(10)}:null},t.writeIceParameters=function(n){let r="a=ice-ufrag:"+n.usernameFragment+`\r
a=ice-pwd:`+n.password+`\r
`;return n.iceLite&&(r+=`a=ice-lite\r
`),r},t.parseRtpParameters=function(n){const r={codecs:[],headerExtensions:[],fecMechanisms:[],rtcp:[]},o=t.splitLines(n)[0].split(" ");for(let a=3;a<o.length;a++){const d=o[a],u=t.matchPrefix(n,"a=rtpmap:"+d+" ")[0];if(u){const h=t.parseRtpMap(u),m=t.matchPrefix(n,"a=fmtp:"+d+" ");switch(h.parameters=m.length?t.parseFmtp(m[0]):{},h.rtcpFeedback=t.matchPrefix(n,"a=rtcp-fb:"+d+" ").map(t.parseRtcpFb),r.codecs.push(h),h.name.toUpperCase()){case"RED":case"ULPFEC":r.fecMechanisms.push(h.name.toUpperCase())}}}return t.matchPrefix(n,"a=extmap:").forEach(a=>{r.headerExtensions.push(t.parseExtmap(a))}),r},t.writeRtpDescription=function(n,r){let o="";o+="m="+n+" ",o+=r.codecs.length>0?"9":"0",o+=" UDP/TLS/RTP/SAVPF ",o+=r.codecs.map(d=>d.preferredPayloadType!==void 0?d.preferredPayloadType:d.payloadType).join(" ")+`\r
`,o+=`c=IN IP4 0.0.0.0\r
`,o+=`a=rtcp:9 IN IP4 0.0.0.0\r
`,r.codecs.forEach(d=>{o+=t.writeRtpMap(d),o+=t.writeFmtp(d),o+=t.writeRtcpFb(d)});let a=0;return r.codecs.forEach(d=>{d.maxptime>a&&(a=d.maxptime)}),a>0&&(o+="a=maxptime:"+a+`\r
`),r.headerExtensions&&r.headerExtensions.forEach(d=>{o+=t.writeExtmap(d)}),o},t.parseRtpEncodingParameters=function(n){const r=[],o=t.parseRtpParameters(n),a=o.fecMechanisms.indexOf("RED")!==-1,d=o.fecMechanisms.indexOf("ULPFEC")!==-1,u=t.matchPrefix(n,"a=ssrc:").map(T=>t.parseSsrcMedia(T)).filter(T=>T.attribute==="cname"),h=u.length>0&&u[0].ssrc;let m;const f=t.matchPrefix(n,"a=ssrc-group:FID").map(T=>T.substr(17).split(" ").map(R=>parseInt(R,10)));f.length>0&&f[0].length>1&&f[0][0]===h&&(m=f[0][1]),o.codecs.forEach(T=>{if(T.name.toUpperCase()==="RTX"&&T.parameters.apt){let R={ssrc:h,codecPayloadType:parseInt(T.parameters.apt,10)};h&&m&&(R.rtx={ssrc:m}),r.push(R),a&&(R=JSON.parse(JSON.stringify(R)),R.fec={ssrc:h,mechanism:d?"red+ulpfec":"red"},r.push(R))}}),r.length===0&&h&&r.push({ssrc:h});let E=t.matchPrefix(n,"b=");return E.length&&(E=E[0].indexOf("b=TIAS:")===0?parseInt(E[0].substr(7),10):E[0].indexOf("b=AS:")===0?1e3*parseInt(E[0].substr(5),10)*.95-16e3:void 0,r.forEach(T=>{T.maxBitrate=E})),r},t.parseRtcpParameters=function(n){const r={},o=t.matchPrefix(n,"a=ssrc:").map(u=>t.parseSsrcMedia(u)).filter(u=>u.attribute==="cname")[0];o&&(r.cname=o.value,r.ssrc=o.ssrc);const a=t.matchPrefix(n,"a=rtcp-rsize");r.reducedSize=a.length>0,r.compound=a.length===0;const d=t.matchPrefix(n,"a=rtcp-mux");return r.mux=d.length>0,r},t.writeRtcpParameters=function(n){let r="";return n.reducedSize&&(r+=`a=rtcp-rsize\r
`),n.mux&&(r+=`a=rtcp-mux\r
`),n.ssrc!==void 0&&n.cname&&(r+="a=ssrc:"+n.ssrc+" cname:"+n.cname+`\r
`),r},t.parseMsid=function(n){let r;const o=t.matchPrefix(n,"a=msid:");if(o.length===1)return r=o[0].substr(7).split(" "),{stream:r[0],track:r[1]};const a=t.matchPrefix(n,"a=ssrc:").map(d=>t.parseSsrcMedia(d)).filter(d=>d.attribute==="msid");return a.length>0?(r=a[0].value.split(" "),{stream:r[0],track:r[1]}):void 0},t.parseSctpDescription=function(n){const r=t.parseMLine(n),o=t.matchPrefix(n,"a=max-message-size:");let a;o.length>0&&(a=parseInt(o[0].substr(19),10)),isNaN(a)&&(a=65536);const d=t.matchPrefix(n,"a=sctp-port:");if(d.length>0)return{port:parseInt(d[0].substr(12),10),protocol:r.fmt,maxMessageSize:a};const u=t.matchPrefix(n,"a=sctpmap:");if(u.length>0){const h=u[0].substr(10).split(" ");return{port:parseInt(h[0],10),protocol:h[1],maxMessageSize:a}}},t.writeSctpDescription=function(n,r){let o=[];return o=n.protocol!=="DTLS/SCTP"?["m="+n.kind+" 9 "+n.protocol+" "+r.protocol+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctp-port:"+r.port+`\r
`]:["m="+n.kind+" 9 "+n.protocol+" "+r.port+`\r
`,`c=IN IP4 0.0.0.0\r
`,"a=sctpmap:"+r.port+" "+r.protocol+` 65535\r
`],r.maxMessageSize!==void 0&&o.push("a=max-message-size:"+r.maxMessageSize+`\r
`),o.join("")},t.generateSessionId=function(){return Math.random().toString().substr(2,21)},t.writeSessionBoilerplate=function(n,r,o){let a;const d=r!==void 0?r:2;return a=n||t.generateSessionId(),`v=0\r
o=`+(o||"thisisadapterortc")+" "+a+" "+d+` IN IP4 127.0.0.1\r
s=-\r
t=0 0\r
`},t.getDirection=function(n,r){const o=t.splitLines(n);for(let a=0;a<o.length;a++)switch(o[a]){case"a=sendrecv":case"a=sendonly":case"a=recvonly":case"a=inactive":return o[a].substr(2)}return r?t.getDirection(r):"sendrecv"},t.getKind=function(n){return t.splitLines(n)[0].split(" ")[0].substr(2)},t.isRejected=function(n){return n.split(" ",2)[1]==="0"},t.parseMLine=function(n){const r=t.splitLines(n)[0].substr(2).split(" ");return{kind:r[0],port:parseInt(r[1],10),protocol:r[2],fmt:r.slice(3).join(" ")}},t.parseOLine=function(n){const r=t.matchPrefix(n,"o=")[0].substr(2).split(" ");return{username:r[0],sessionId:r[1],sessionVersion:parseInt(r[2],10),netType:r[3],addressType:r[4],address:r[5]}},t.isValidSDP=function(n){if(typeof n!="string"||n.length===0)return!1;const r=t.splitLines(n);for(let o=0;o<r.length;o++)if(r[o].length<2||r[o].charAt(1)!=="=")return!1;return!0},e.exports=t})(Yf);var Aa=Yf.exports,c2=Object.freeze(c({__proto__:null,default:Aa},[Yf.exports]));function Xl(e){if(!e.RTCIceCandidate||e.RTCIceCandidate&&"foundation"in e.RTCIceCandidate.prototype)return;const t=e.RTCIceCandidate;e.RTCIceCandidate=function(n){if(typeof n=="object"&&n.candidate&&n.candidate.indexOf("a=")===0&&((n=JSON.parse(JSON.stringify(n))).candidate=n.candidate.substr(2)),n.candidate&&n.candidate.length){const r=new t(n),o=Aa.parseCandidate(n.candidate),a=Object.assign(r,o);return a.toJSON=function(){return{candidate:a.candidate,sdpMid:a.sdpMid,sdpMLineIndex:a.sdpMLineIndex,usernameFragment:a.usernameFragment}},a}return new t(n)},e.RTCIceCandidate.prototype=t.prototype,Ps(e,"icecandidate",n=>(n.candidate&&Object.defineProperty(n,"candidate",{value:new e.RTCIceCandidate(n.candidate),writable:"false"}),n))}function qf(e){!e.RTCIceCandidate||e.RTCIceCandidate&&"relayProtocol"in e.RTCIceCandidate.prototype||Ps(e,"icecandidate",t=>{if(t.candidate){const n=Aa.parseCandidate(t.candidate.candidate);n.type==="relay"&&(t.candidate.relayProtocol={0:"tls",1:"tcp",2:"udp"}[n.priority>>24])}return t})}function Ql(e,t){if(!e.RTCPeerConnection)return;"sctp"in e.RTCPeerConnection.prototype||Object.defineProperty(e.RTCPeerConnection.prototype,"sctp",{get(){return this._sctp===void 0?null:this._sctp}});const n=function(u){if(!u||!u.sdp)return!1;const h=Aa.splitSections(u.sdp);return h.shift(),h.some(m=>{const f=Aa.parseMLine(m);return f&&f.kind==="application"&&f.protocol.indexOf("SCTP")!==-1})},r=function(u){const h=u.sdp.match(/mozilla...THIS_IS_SDPARTA-(\d+)/);if(h===null||h.length<2)return-1;const m=parseInt(h[1],10);return m!=m?-1:m},o=function(u){let h=65536;return t.browser==="firefox"&&(h=t.version<57?u===-1?16384:2147483637:t.version<60?t.version===57?65535:65536:2147483637),h},a=function(u,h){let m=65536;t.browser==="firefox"&&t.version===57&&(m=65535);const f=Aa.matchPrefix(u.sdp,"a=max-message-size:");return f.length>0?m=parseInt(f[0].substr(19),10):t.browser==="firefox"&&h!==-1&&(m=2147483637),m},d=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(){if(this._sctp=null,t.browser==="chrome"&&t.version>=76){const{sdpSemantics:u}=this.getConfiguration();u==="plan-b"&&Object.defineProperty(this,"sctp",{get(){return this._sctp===void 0?null:this._sctp},enumerable:!0,configurable:!0})}if(n(arguments[0])){const u=r(arguments[0]),h=o(u),m=a(arguments[0],u);let f;f=h===0&&m===0?Number.POSITIVE_INFINITY:h===0||m===0?Math.max(h,m):Math.min(h,m);const E={};Object.defineProperty(E,"maxMessageSize",{get:()=>f}),this._sctp=E}return d.apply(this,arguments)}}function $l(e){if(!e.RTCPeerConnection||!("createDataChannel"in e.RTCPeerConnection.prototype))return;function t(r,o){const a=r.send;r.send=function(){const d=arguments[0],u=d.length||d.size||d.byteLength;if(r.readyState==="open"&&o.sctp&&u>o.sctp.maxMessageSize)throw new TypeError("Message too large (can send a maximum of "+o.sctp.maxMessageSize+" bytes)");return a.apply(r,arguments)}}const n=e.RTCPeerConnection.prototype.createDataChannel;e.RTCPeerConnection.prototype.createDataChannel=function(){const r=n.apply(this,arguments);return t(r,this),r},Ps(e,"datachannel",r=>(t(r.channel,r.target),r))}function Jf(e){if(!e.RTCPeerConnection||"connectionState"in e.RTCPeerConnection.prototype)return;const t=e.RTCPeerConnection.prototype;Object.defineProperty(t,"connectionState",{get(){return{completed:"connected",checking:"connecting"}[this.iceConnectionState]||this.iceConnectionState},enumerable:!0,configurable:!0}),Object.defineProperty(t,"onconnectionstatechange",{get(){return this._onconnectionstatechange||null},set(n){this._onconnectionstatechange&&(this.removeEventListener("connectionstatechange",this._onconnectionstatechange),delete this._onconnectionstatechange),n&&this.addEventListener("connectionstatechange",this._onconnectionstatechange=n)},enumerable:!0,configurable:!0}),["setLocalDescription","setRemoteDescription"].forEach(n=>{const r=t[n];t[n]=function(){return this._connectionstatechangepoly||(this._connectionstatechangepoly=o=>{const a=o.target;if(a._lastConnectionState!==a.connectionState){a._lastConnectionState=a.connectionState;const d=new Event("connectionstatechange",o);a.dispatchEvent(d)}return o},this.addEventListener("iceconnectionstatechange",this._connectionstatechangepoly)),r.apply(this,arguments)}})}function Xf(e,t){if(!e.RTCPeerConnection||t.browser==="chrome"&&t.version>=71||t.browser==="safari"&&t.version>=605)return;const n=e.RTCPeerConnection.prototype.setRemoteDescription;e.RTCPeerConnection.prototype.setRemoteDescription=function(r){if(r&&r.sdp&&r.sdp.indexOf(`
a=extmap-allow-mixed`)!==-1){const o=r.sdp.split(`
`).filter(a=>uo(a).call(a)!=="a=extmap-allow-mixed").join(`
`);e.RTCSessionDescription&&r instanceof e.RTCSessionDescription?arguments[0]=new e.RTCSessionDescription({type:r.type,sdp:o}):r.sdp=o}return n.apply(this,arguments)}}function Zl(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.addIceCandidate;n&&n.length!==0&&(e.RTCPeerConnection.prototype.addIceCandidate=function(){return arguments[0]?(t.browser==="chrome"&&t.version<78||t.browser==="firefox"&&t.version<68||t.browser==="safari")&&arguments[0]&&arguments[0].candidate===""?de.resolve():n.apply(this,arguments):(arguments[1]&&arguments[1].apply(null),de.resolve())})}function eu(e,t){if(!e.RTCPeerConnection||!e.RTCPeerConnection.prototype)return;const n=e.RTCPeerConnection.prototype.setLocalDescription;n&&n.length!==0&&(e.RTCPeerConnection.prototype.setLocalDescription=function(){let r=arguments[0]||{};if(typeof r!="object"||r.type&&r.sdp)return n.apply(this,arguments);if(r={type:r.type,sdp:r.sdp},!r.type)switch(this.signalingState){case"stable":case"have-local-offer":case"have-remote-pranswer":r.type="offer";break;default:r.type="answer"}return r.sdp||r.type!=="offer"&&r.type!=="answer"?n.apply(this,[r]):(r.type==="offer"?this.createOffer:this.createAnswer).apply(this).then(a=>n.apply(this,[a]))})}var d2=Object.freeze({__proto__:null,shimRTCIceCandidate:Xl,shimRTCIceCandidateRelayProtocol:qf,shimMaxMessageSize:Ql,shimSendThrowTypeError:$l,shimConnectionState:Jf,removeExtmapAllowMixed:Xf,shimAddIceCandidateNullOrEmpty:Zl,shimParameterlessSetLocalDescription:eu});let En,Ze;(function(){let{window:e}=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{shimChrome:!0,shimFirefox:!0,shimSafari:!0};const n=iT,r=Ck(e),o={browserDetails:r,commonShim:d2,extractVersion:Rl,disableLog:yk,disableWarnings:Rk,sdp:c2};switch(r.browser){case"chrome":if(!sy||!Wf||!t.shimChrome)return n("Chrome shim is not included in this adapter release."),o;if(r.version===null)return n("Chrome shim can not determine version, not shimming."),o;n("adapter.js shimming chrome."),o.browserShim=sy,Zl(e,r),eu(e),Qv(e,r),$v(e),Wf(e,r),Zv(e),iy(e,r),ey(e),ty(e),ny(e),oy(e,r),Xl(e),qf(e),Jf(e),Ql(e,r),$l(e),Xf(e,r);break;case"firefox":if(!_y||!Hf||!t.shimFirefox)return n("Firefox shim is not included in this adapter release."),o;n("adapter.js shimming firefox."),o.browserShim=_y,Zl(e,r),eu(e),ay(e,r),Hf(e,r),cy(e),uy(e),dy(e),ly(e),hy(e),py(e),fy(e),my(e),Ey(e),Xl(e),Jf(e),Ql(e,r),$l(e);break;case"safari":if(!Oy||!t.shimSafari)return n("Safari shim is not included in this adapter release."),o;n("adapter.js shimming safari."),o.browserShim=Oy,Zl(e,r),eu(e),Ry(e),Iy(e),Ty(e),gy(e),Sy(e),Cy(e),vy(e),Ay(e),Xl(e),qf(e),Ql(e,r),$l(e),Xf(e,r);break;default:n("Unsupported browser!")}})({window:typeof window>"u"?void 0:window}),function(e){e.WIN_10="Windows 10",e.WIN_81="Windows 8.1",e.WIN_8="Windows 8",e.WIN_7="Windows 7",e.WIN_VISTA="Windows Vista",e.WIN_SERVER_2003="Windows Server 2003",e.WIN_XP="Windows XP",e.WIN_2000="Windows 2000",e.ANDROID="Android",e.HARMONY_OS="HarmonyOS",e.OPEN_BSD="Open BSD",e.SUN_OS="Sun OS",e.LINUX="Linux",e.IOS="iOS",e.MAC_OS="Mac OS",e.QNX="QNX",e.UNIX="UNIX",e.BEOS="BeOS",e.OS_2="OS/2",e.SEARCH_BOT="Search Bot"}(En||(En={})),function(e){e.CHROME="Chrome",e.SAFARI="Safari",e.EDGE="Edge",e.FIREFOX="Firefox",e.OPERA="OPR",e.QQ="QQBrowser",e.WECHAT="MicroMessenger"}(Ze||(Ze={}));var Qf={exports:{}};(function(e,t){(function(n,r){var o="function",a="undefined",d="object",u="string",h="major",m="model",f="name",E="type",T="vendor",R="version",A="architecture",O="console",w="mobile",x="tablet",V="smarttv",X="wearable",le="embedded",$="Amazon",ee="Apple",q="ASUS",re="BlackBerry",ze="Firefox",Se="Google",ct="Huawei",tt="LG",Pt="Microsoft",un="Motorola",Ot="Opera",or="Samsung",K="Sharp",Q="Sony",ae="Xiaomi",Ce="Zebra",We="Facebook",te="Chromium OS",S="Mac OS",N=function(Ct){for(var Bt={},ot=0;ot<Ct.length;ot++)Bt[Ct[ot].toUpperCase()]=Ct[ot];return Bt},D=function(Ct,Bt){return typeof Ct===u&&z(Bt).indexOf(z(Ct))!==-1},z=function(Ct){return Ct.toLowerCase()},Oe=function(Ct,Bt){if(typeof Ct===u)return Ct=Ct.replace(/^\s\s*/,""),typeof Bt===a?Ct:Ct.substring(0,350)},dt=function(Ct,Bt){for(var ot,Yn,Zi,It,Ge,sr,as=0;as<Bt.length&&!Ge;){var Mi=Bt[as],A0=Bt[as+1];for(ot=Yn=0;ot<Mi.length&&!Ge&&Mi[ot];)if(Ge=Mi[ot++].exec(Ct))for(Zi=0;Zi<A0.length;Zi++)sr=Ge[++Yn],typeof(It=A0[Zi])===d&&It.length>0?It.length===2?typeof It[1]==o?this[It[0]]=It[1].call(this,sr):this[It[0]]=It[1]:It.length===3?typeof It[1]!==o||It[1].exec&&It[1].test?this[It[0]]=sr?sr.replace(It[1],It[2]):r:this[It[0]]=sr?It[1].call(this,sr,It[2]):r:It.length===4&&(this[It[0]]=sr?It[3].call(this,sr.replace(It[1],It[2])):r):this[It]=sr||r;as+=2}},hn=function(Ct,Bt){for(var ot in Bt)if(typeof Bt[ot]===d&&Bt[ot].length>0){for(var Yn=0;Yn<Bt[ot].length;Yn++)if(D(Bt[ot][Yn],Ct))return ot==="?"?r:ot}else if(D(Bt[ot],Ct))return ot==="?"?r:ot;return Ct},mi={ME:"4.90","NT 3.11":"NT3.51","NT 4.0":"NT4.0",2e3:"NT 5.0",XP:["NT 5.1","NT 5.2"],Vista:"NT 6.0",7:"NT 6.1",8:"NT 6.2",8.1:"NT 6.3",10:["NT 6.4","NT 10.0"],RT:"ARM"},os={browser:[[/\b(?:crmo|crios)\/([\w\.]+)/i],[R,[f,"Chrome"]],[/edg(?:e|ios|a)?\/([\w\.]+)/i],[R,[f,"Edge"]],[/(opera mini)\/([-\w\.]+)/i,/(opera [mobiletab]{3,6})\b.+version\/([-\w\.]+)/i,/(opera)(?:.+version\/|[\/ ]+)([\w\.]+)/i],[f,R],[/opios[\/ ]+([\w\.]+)/i],[R,[f,"Opera Mini"]],[/\bopr\/([\w\.]+)/i],[R,[f,Ot]],[/(kindle)\/([\w\.]+)/i,/(lunascape|maxthon|netfront|jasmine|blazer)[\/ ]?([\w\.]*)/i,/(avant |iemobile|slim)(?:browser)?[\/ ]?([\w\.]*)/i,/(ba?idubrowser)[\/ ]?([\w\.]+)/i,/(?:ms|\()(ie) ([\w\.]+)/i,/(flock|rockmelt|midori|epiphany|silk|skyfire|ovibrowser|bolt|iron|vivaldi|iridium|phantomjs|bowser|quark|qupzilla|falkon|rekonq|puffin|brave|whale(?!.+naver)|qqbrowserlite|qq|duckduckgo)\/([-\w\.]+)/i,/(weibo)__([\d\.]+)/i],[f,R],[/(?:\buc? ?browser|(?:juc.+)ucweb)[\/ ]?([\w\.]+)/i],[R,[f,"UCBrowser"]],[/microm.+\bqbcore\/([\w\.]+)/i,/\bqbcore\/([\w\.]+).+microm/i],[R,[f,"WeChat(Win) Desktop"]],[/micromessenger\/([\w\.]+)/i],[R,[f,"WeChat"]],[/konqueror\/([\w\.]+)/i],[R,[f,"Konqueror"]],[/trident.+rv[: ]([\w\.]{1,9})\b.+like gecko/i],[R,[f,"IE"]],[/yabrowser\/([\w\.]+)/i],[R,[f,"Yandex"]],[/(avast|avg)\/([\w\.]+)/i],[[f,/(.+)/,"$1 Secure Browser"],R],[/\bfocus\/([\w\.]+)/i],[R,[f,"Firefox Focus"]],[/\bopt\/([\w\.]+)/i],[R,[f,"Opera Touch"]],[/coc_coc\w+\/([\w\.]+)/i],[R,[f,"Coc Coc"]],[/dolfin\/([\w\.]+)/i],[R,[f,"Dolphin"]],[/coast\/([\w\.]+)/i],[R,[f,"Opera Coast"]],[/miuibrowser\/([\w\.]+)/i],[R,[f,"MIUI Browser"]],[/fxios\/([-\w\.]+)/i],[R,[f,ze]],[/\bqihu|(qi?ho?o?|360)browser/i],[[f,"360 Browser"]],[/(oculus|samsung|sailfish|huawei)browser\/([\w\.]+)/i],[[f,/(.+)/,"$1 Browser"],R],[/(comodo_dragon)\/([\w\.]+)/i],[[f,/_/g," "],R],[/(electron)\/([\w\.]+) safari/i,/(tesla)(?: qtcarbrowser|\/(20\d\d\.[-\w\.]+))/i,/m?(qqbrowser|baiduboxapp|2345Explorer)[\/ ]?([\w\.]+)/i],[f,R],[/(metasr)[\/ ]?([\w\.]+)/i,/(lbbrowser)/i,/\[(linkedin)app\]/i],[f],[/((?:fban\/fbios|fb_iab\/fb4a)(?!.+fbav)|;fbav\/([\w\.]+);)/i],[[f,We],R],[/(kakao(?:talk|story))[\/ ]([\w\.]+)/i,/(naver)\(.*?(\d+\.[\w\.]+).*\)/i,/safari (line)\/([\w\.]+)/i,/\b(line)\/([\w\.]+)\/iab/i,/(chromium|instagram)[\/ ]([-\w\.]+)/i],[f,R],[/\bgsa\/([\w\.]+) .*safari\//i],[R,[f,"GSA"]],[/headlesschrome(?:\/([\w\.]+)| )/i],[R,[f,"Chrome Headless"]],[/ wv\).+(chrome)\/([\w\.]+)/i],[[f,"Chrome WebView"],R],[/droid.+ version\/([\w\.]+)\b.+(?:mobile safari|safari)/i],[R,[f,"Android Browser"]],[/(chrome|omniweb|arora|[tizenoka]{5} ?browser)\/v?([\w\.]+)/i],[f,R],[/version\/([\w\.\,]+) .*mobile\/\w+ (safari)/i],[R,[f,"Mobile Safari"]],[/version\/([\w(\.|\,)]+) .*(mobile ?safari|safari)/i],[R,f],[/webkit.+?(mobile ?safari|safari)(\/[\w\.]+)/i],[f,[R,hn,{"1.0":"/8",1.2:"/1",1.3:"/3","2.0":"/412","2.0.2":"/416","2.0.3":"/417","2.0.4":"/419","?":"/"}]],[/(webkit|khtml)\/([\w\.]+)/i],[f,R],[/(navigator|netscape\d?)\/([-\w\.]+)/i],[[f,"Netscape"],R],[/mobile vr; rv:([\w\.]+)\).+firefox/i],[R,[f,"Firefox Reality"]],[/ekiohf.+(flow)\/([\w\.]+)/i,/(swiftfox)/i,/(icedragon|iceweasel|camino|chimera|fennec|maemo browser|minimo|conkeror|klar)[\/ ]?([\w\.\+]+)/i,/(seamonkey|k-meleon|icecat|iceape|firebird|phoenix|palemoon|basilisk|waterfox)\/([-\w\.]+)$/i,/(firefox)\/([\w\.]+)/i,/(mozilla)\/([\w\.]+) .+rv\:.+gecko\/\d+/i,/(polaris|lynx|dillo|icab|doris|amaya|w3m|netsurf|sleipnir|obigo|mosaic|(?:go|ice|up)[\. ]?browser)[-\/ ]?v?([\w\.]+)/i,/(links) \(([\w\.]+)/i,/panasonic;(viera)/i],[f,R],[/(cobalt)\/([\w\.]+)/i],[f,[R,/master.|lts./,""]]],cpu:[[/(?:(amd|x(?:(?:86|64)[-_])?|wow|win)64)[;\)]/i],[[A,"amd64"]],[/(ia32(?=;))/i],[[A,z]],[/((?:i[346]|x)86)[;\)]/i],[[A,"ia32"]],[/\b(aarch64|arm(v?8e?l?|_?64))\b/i],[[A,"arm64"]],[/\b(arm(?:v[67])?ht?n?[fl]p?)\b/i],[[A,"armhf"]],[/windows (ce|mobile); ppc;/i],[[A,"arm"]],[/((?:ppc|powerpc)(?:64)?)(?: mac|;|\))/i],[[A,/ower/,"",z]],[/(sun4\w)[;\)]/i],[[A,"sparc"]],[/((?:avr32|ia64(?=;))|68k(?=\))|\barm(?=v(?:[1-7]|[5-7]1)l?|;|eabi)|(?=atmel )avr|(?:irix|mips|sparc)(?:64)?\b|pa-risc)/i],[[A,z]]],device:[[/\b(sch-i[89]0\d|shw-m380s|sm-[ptx]\w{2,4}|gt-[pn]\d{2,4}|sgh-t8[56]9|nexus 10)/i],[m,[T,or],[E,x]],[/\b((?:s[cgp]h|gt|sm)-\w+|sc[g-]?[\d]+a?|galaxy nexus)/i,/samsung[- ]([-\w]+)/i,/sec-(sgh\w+)/i],[m,[T,or],[E,w]],[/\((ip(?:hone|od)[\w ]*);/i],[m,[T,ee],[E,w]],[/\((ipad);[-\w\),; ]+apple/i,/applecoremedia\/[\w\.]+ \((ipad)/i,/\b(ipad)\d\d?,\d\d?[;\]].+ios/i],[m,[T,ee],[E,x]],[/(macintosh);/i],[m,[T,ee]],[/\b(sh-?[altvz]?\d\d[a-ekm]?)/i],[m,[T,K],[E,w]],[/\b((?:ag[rs][23]?|bah2?|sht?|btv)-a?[lw]\d{2})\b(?!.+d\/s)/i],[m,[T,ct],[E,x]],[/(?:huawei|honor)([-\w ]+)[;\)]/i,/\b(nexus 6p|\w{2,4}e?-[atu]?[ln][\dx][012359c][adn]?)\b(?!.+d\/s)/i],[m,[T,ct],[E,w]],[/\b(poco[\w ]+)(?: bui|\))/i,/\b; (\w+) build\/hm\1/i,/\b(hm[-_ ]?note?[_ ]?(?:\d\w)?) bui/i,/\b(redmi[\-_ ]?(?:note|k)?[\w_ ]+)(?: bui|\))/i,/\b(mi[-_ ]?(?:a\d|one|one[_ ]plus|note lte|max|cc)?[_ ]?(?:\d?\w?)[_ ]?(?:plus|se|lite)?)(?: bui|\))/i],[[m,/_/g," "],[T,ae],[E,w]],[/\b(mi[-_ ]?(?:pad)(?:[\w_ ]+))(?: bui|\))/i],[[m,/_/g," "],[T,ae],[E,x]],[/; (\w+) bui.+ oppo/i,/\b(cph[12]\d{3}|p(?:af|c[al]|d\w|e[ar])[mt]\d0|x9007|a101op)\b/i],[m,[T,"OPPO"],[E,w]],[/vivo (\w+)(?: bui|\))/i,/\b(v[12]\d{3}\w?[at])(?: bui|;)/i],[m,[T,"Vivo"],[E,w]],[/\b(rmx[12]\d{3})(?: bui|;|\))/i],[m,[T,"Realme"],[E,w]],[/\b(milestone|droid(?:[2-4x]| (?:bionic|x2|pro|razr))?:?( 4g)?)\b[\w ]+build\//i,/\bmot(?:orola)?[- ](\w*)/i,/((?:moto[\w\(\) ]+|xt\d{3,4}|nexus 6)(?= bui|\)))/i],[m,[T,un],[E,w]],[/\b(mz60\d|xoom[2 ]{0,2}) build\//i],[m,[T,un],[E,x]],[/((?=lg)?[vl]k\-?\d{3}) bui| 3\.[-\w; ]{10}lg?-([06cv9]{3,4})/i],[m,[T,tt],[E,x]],[/(lm(?:-?f100[nv]?|-[\w\.]+)(?= bui|\))|nexus [45])/i,/\blg[-e;\/ ]+((?!browser|netcast|android tv)\w+)/i,/\blg-?([\d\w]+) bui/i],[m,[T,tt],[E,w]],[/(ideatab[-\w ]+)/i,/lenovo ?(s[56]000[-\w]+|tab(?:[\w ]+)|yt[-\d\w]{6}|tb[-\d\w]{6})/i],[m,[T,"Lenovo"],[E,x]],[/(?:maemo|nokia).*(n900|lumia \d+)/i,/nokia[-_ ]?([-\w\.]*)/i],[[m,/_/g," "],[T,"Nokia"],[E,w]],[/(pixel c)\b/i],[m,[T,Se],[E,x]],[/droid.+; (pixel[\daxl ]{0,6})(?: bui|\))/i],[m,[T,Se],[E,w]],[/droid.+ (a?\d[0-2]{2}so|[c-g]\d{4}|so[-gl]\w+|xq-a\w[4-7][12])(?= bui|\).+chrome\/(?![1-6]{0,1}\d\.))/i],[m,[T,Q],[E,w]],[/sony tablet [ps]/i,/\b(?:sony)?sgp\w+(?: bui|\))/i],[[m,"Xperia Tablet"],[T,Q],[E,x]],[/ (kb2005|in20[12]5|be20[12][59])\b/i,/(?:one)?(?:plus)? (a\d0\d\d)(?: b|\))/i],[m,[T,"OnePlus"],[E,w]],[/(alexa)webm/i,/(kf[a-z]{2}wi)( bui|\))/i,/(kf[a-z]+)( bui|\)).+silk\//i],[m,[T,$],[E,x]],[/((?:sd|kf)[0349hijorstuw]+)( bui|\)).+silk\//i],[[m,/(.+)/g,"Fire Phone $1"],[T,$],[E,w]],[/(playbook);[-\w\),; ]+(rim)/i],[m,T,[E,x]],[/\b((?:bb[a-f]|st[hv])100-\d)/i,/\(bb10; (\w+)/i],[m,[T,re],[E,w]],[/(?:\b|asus_)(transfo[prime ]{4,10} \w+|eeepc|slider \w+|nexus 7|padfone|p00[cj])/i],[m,[T,q],[E,x]],[/ (z[bes]6[027][012][km][ls]|zenfone \d\w?)\b/i],[m,[T,q],[E,w]],[/(nexus 9)/i],[m,[T,"HTC"],[E,x]],[/(htc)[-;_ ]{1,2}([\w ]+(?=\)| bui)|\w+)/i,/(zte)[- ]([\w ]+?)(?: bui|\/|\))/i,/(alcatel|geeksphone|nexian|panasonic(?!(?:;|\.))|sony(?!-bra))[-_ ]?([-\w]*)/i],[T,[m,/_/g," "],[E,w]],[/droid.+; ([ab][1-7]-?[0178a]\d\d?)/i],[m,[T,"Acer"],[E,x]],[/droid.+; (m[1-5] note) bui/i,/\bmz-([-\w]{2,})/i],[m,[T,"Meizu"],[E,w]],[/(blackberry|benq|palm(?=\-)|sonyericsson|acer|asus|dell|meizu|motorola|polytron)[-_ ]?([-\w]*)/i,/(hp) ([\w ]+\w)/i,/(asus)-?(\w+)/i,/(microsoft); (lumia[\w ]+)/i,/(lenovo)[-_ ]?([-\w]+)/i,/(jolla)/i,/(oppo) ?([\w ]+) bui/i],[T,m,[E,w]],[/(kobo)\s(ereader|touch)/i,/(archos) (gamepad2?)/i,/(hp).+(touchpad(?!.+tablet)|tablet)/i,/(kindle)\/([\w\.]+)/i,/(nook)[\w ]+build\/(\w+)/i,/(dell) (strea[kpr\d ]*[\dko])/i,/(le[- ]+pan)[- ]+(\w{1,9}) bui/i,/(trinity)[- ]*(t\d{3}) bui/i,/(gigaset)[- ]+(q\w{1,9}) bui/i,/(vodafone) ([\w ]+)(?:\)| bui)/i],[T,m,[E,x]],[/(surface duo)/i],[m,[T,Pt],[E,x]],[/droid [\d\.]+; (fp\du?)(?: b|\))/i],[m,[T,"Fairphone"],[E,w]],[/(u304aa)/i],[m,[T,"AT&T"],[E,w]],[/\bsie-(\w*)/i],[m,[T,"Siemens"],[E,w]],[/\b(rct\w+) b/i],[m,[T,"RCA"],[E,x]],[/\b(venue[\d ]{2,7}) b/i],[m,[T,"Dell"],[E,x]],[/\b(q(?:mv|ta)\w+) b/i],[m,[T,"Verizon"],[E,x]],[/\b(?:barnes[& ]+noble |bn[rt])([\w\+ ]*) b/i],[m,[T,"Barnes & Noble"],[E,x]],[/\b(tm\d{3}\w+) b/i],[m,[T,"NuVision"],[E,x]],[/\b(k88) b/i],[m,[T,"ZTE"],[E,x]],[/\b(nx\d{3}j) b/i],[m,[T,"ZTE"],[E,w]],[/\b(gen\d{3}) b.+49h/i],[m,[T,"Swiss"],[E,w]],[/\b(zur\d{3}) b/i],[m,[T,"Swiss"],[E,x]],[/\b((zeki)?tb.*\b) b/i],[m,[T,"Zeki"],[E,x]],[/\b([yr]\d{2}) b/i,/\b(dragon[- ]+touch |dt)(\w{5}) b/i],[[T,"Dragon Touch"],m,[E,x]],[/\b(ns-?\w{0,9}) b/i],[m,[T,"Insignia"],[E,x]],[/\b((nxa|next)-?\w{0,9}) b/i],[m,[T,"NextBook"],[E,x]],[/\b(xtreme\_)?(v(1[045]|2[015]|[3469]0|7[05])) b/i],[[T,"Voice"],m,[E,w]],[/\b(lvtel\-)?(v1[12]) b/i],[[T,"LvTel"],m,[E,w]],[/\b(ph-1) /i],[m,[T,"Essential"],[E,w]],[/\b(v(100md|700na|7011|917g).*\b) b/i],[m,[T,"Envizen"],[E,x]],[/\b(trio[-\w\. ]+) b/i],[m,[T,"MachSpeed"],[E,x]],[/\btu_(1491) b/i],[m,[T,"Rotor"],[E,x]],[/(shield[\w ]+) b/i],[m,[T,"Nvidia"],[E,x]],[/(sprint) (\w+)/i],[T,m,[E,w]],[/(kin\.[onetw]{3})/i],[[m,/\./g," "],[T,Pt],[E,w]],[/droid.+; (cc6666?|et5[16]|mc[239][23]x?|vc8[03]x?)\)/i],[m,[T,Ce],[E,x]],[/droid.+; (ec30|ps20|tc[2-8]\d[kx])\)/i],[m,[T,Ce],[E,w]],[/smart-tv.+(samsung)/i],[T,[E,V]],[/hbbtv.+maple;(\d+)/i],[[m,/^/,"SmartTV"],[T,or],[E,V]],[/(nux; netcast.+smarttv|lg (netcast\.tv-201\d|android tv))/i],[[T,tt],[E,V]],[/(apple) ?tv/i],[T,[m,"Apple TV"],[E,V]],[/crkey/i],[[m,"Chromecast"],[T,Se],[E,V]],[/droid.+aft(\w)( bui|\))/i],[m,[T,$],[E,V]],[/\(dtv[\);].+(aquos)/i,/(aquos-tv[\w ]+)\)/i],[m,[T,K],[E,V]],[/(bravia[\w ]+)( bui|\))/i],[m,[T,Q],[E,V]],[/(mitv-\w{5}) bui/i],[m,[T,ae],[E,V]],[/Hbbtv.*(technisat) (.*);/i],[T,m,[E,V]],[/\b(roku)[\dx]*[\)\/]((?:dvp-)?[\d\.]*)/i,/hbbtv\/\d+\.\d+\.\d+ +\([\w\+ ]*; *([\w\d][^;]*);([^;]*)/i],[[T,Oe],[m,Oe],[E,V]],[/\b(android tv|smart[- ]?tv|opera tv|tv; rv:)\b/i],[[E,V]],[/(ouya)/i,/(nintendo) ([wids3utch]+)/i],[T,m,[E,O]],[/droid.+; (shield) bui/i],[m,[T,"Nvidia"],[E,O]],[/(playstation [345portablevi]+)/i],[m,[T,Q],[E,O]],[/\b(xbox(?: one)?(?!; xbox))[\); ]/i],[m,[T,Pt],[E,O]],[/((pebble))app/i],[T,m,[E,X]],[/(watch)(?: ?os[,\/]|\d,\d\/)[\d\.]+/i],[m,[T,ee],[E,X]],[/droid.+; (glass) \d/i],[m,[T,Se],[E,X]],[/droid.+; (wt63?0{2,3})\)/i],[m,[T,Ce],[E,X]],[/(quest( 2| pro)?)/i],[m,[T,We],[E,X]],[/(tesla)(?: qtcarbrowser|\/[-\w\.]+)/i],[T,[E,le]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+? mobile safari/i],[m,[E,w]],[/droid .+?; ([^;]+?)(?: bui|\) applew).+?(?! mobile) safari/i],[m,[E,x]],[/\b((tablet|tab)[;\/]|focus\/\d(?!.+mobile))/i],[[E,x]],[/(phone|mobile(?:[;\/]| [ \w\/\.]*safari)|pda(?=.+windows ce))/i],[[E,w]],[/(android[-\w\. ]{0,9});.+buil/i],[m,[T,"Generic"]]],engine:[[/windows.+ edge\/([\w\.]+)/i],[R,[f,"EdgeHTML"]],[/webkit\/537\.36.+chrome\/(?!27)([\w\.]+)/i],[R,[f,"Blink"]],[/(presto)\/([\w\.]+)/i,/(webkit|trident|netfront|netsurf|amaya|lynx|w3m|goanna)\/([\w\.]+)/i,/ekioh(flow)\/([\w\.]+)/i,/(khtml|tasman|links)[\/ ]\(?([\w\.]+)/i,/(icab)[\/ ]([23]\.[\d\.]+)/i],[f,R],[/rv\:([\w\.]{1,9})\b.+(gecko)/i],[R,f]],os:[[/microsoft (windows) (vista|xp)/i],[f,R],[/(windows) nt 6\.2; (arm)/i,/(windows (?:phone(?: os)?|mobile))[\/ ]?([\d\.\w ]*)/i,/(windows)[\/ ]?([ntce\d\. ]+\w)(?!.+xbox)/i],[f,[R,hn,mi]],[/(win(?=3|9|n)|win 9x )([nt\d\.]+)/i],[[f,"Windows"],[R,hn,mi]],[/ip[honead]{2,4}\b(?:.*os ([\w]+) like mac|; opera)/i,/cfnetwork\/.+darwin/i],[[R,/_/g,"."],[f,"iOS"]],[/(mac os x) ?([\w\. ]*)/i,/(macintosh|mac_powerpc\b)(?!.+haiku)/i],[[f,S],[R,/_/g,"."]],[/droid ([\w\.]+)\b.+(android[- ]x86|harmonyos)/i],[R,f],[/(android|webos|qnx|bada|rim tablet os|maemo|meego|sailfish)[-\/ ]?([\w\.]*)/i,/(blackberry)\w*\/([\w\.]*)/i,/(tizen|kaios)[\/ ]([\w\.]+)/i,/\((series40);/i],[f,R],[/\(bb(10);/i],[R,[f,re]],[/(?:symbian ?os|symbos|s60(?=;)|series60)[-\/ ]?([\w\.]*)/i],[R,[f,"Symbian"]],[/mozilla\/[\d\.]+ \((?:mobile|tablet|tv|mobile; [\w ]+); rv:.+ gecko\/([\w\.]+)/i],[R,[f,"Firefox OS"]],[/web0s;.+rt(tv)/i,/\b(?:hp)?wos(?:browser)?\/([\w\.]+)/i],[R,[f,"webOS"]],[/watch(?: ?os[,\/]|\d,\d\/)([\d\.]+)/i],[R,[f,"watchOS"]],[/crkey\/([\d\.]+)/i],[R,[f,"Chromecast"]],[/(cros) [\w]+(?:\)| ([\w\.]+)\b)/i],[[f,te],R],[/panasonic;(viera)/i,/(netrange)mmh/i,/(nettv)\/(\d+\.[\w\.]+)/i,/(nintendo|playstation) ([wids345portablevuch]+)/i,/(xbox); +xbox ([^\);]+)/i,/\b(joli|palm)\b ?(?:os)?\/?([\w\.]*)/i,/(mint)[\/\(\) ]?(\w*)/i,/(mageia|vectorlinux)[; ]/i,/([kxln]?ubuntu|debian|suse|opensuse|gentoo|arch(?= linux)|slackware|fedora|mandriva|centos|pclinuxos|red ?hat|zenwalk|linpus|raspbian|plan 9|minix|risc os|contiki|deepin|manjaro|elementary os|sabayon|linspire)(?: gnu\/linux)?(?: enterprise)?(?:[- ]linux)?(?:-gnu)?[-\/ ]?(?!chrom|package)([-\w\.]*)/i,/(hurd|linux) ?([\w\.]*)/i,/(gnu) ?([\w\.]*)/i,/\b([-frentopcghs]{0,5}bsd|dragonfly)[\/ ]?(?!amd|[ix346]{1,2}86)([\w\.]*)/i,/(haiku) (\w+)/i],[f,R],[/(sunos) ?([\w\.\d]*)/i],[[f,"Solaris"],R],[/((?:open)?solaris)[-\/ ]?([\w\.]*)/i,/(aix) ((\d)(?=\.|\)| )[\w\.])*/i,/\b(beos|os\/2|amigaos|morphos|openvms|fuchsia|hp-ux)/i,/(unix) ?([\w\.]*)/i],[f,R]]},Zr=function(Ct,Bt){if(typeof Ct===d&&(Bt=Ct,Ct=r),!(this instanceof Zr))return new Zr(Ct,Bt).getResult();var ot=typeof n!==a&&n.navigator?n.navigator:r,Yn=Ct||(ot&&ot.userAgent?ot.userAgent:""),Zi=ot&&ot.userAgentData?ot.userAgentData:r,It=Bt?function(Ge,sr){var as={};for(var Mi in Ge)sr[Mi]&&sr[Mi].length%2==0?as[Mi]=sr[Mi].concat(Ge[Mi]):as[Mi]=Ge[Mi];return as}(os,Bt):os;return this.getBrowser=function(){var Ge={};return Ge.name=r,Ge.version=r,dt.call(Ge,Yn,It.browser),Ge.major=function(sr){return typeof sr===u?sr.replace(/[^\d\.]/g,"").split(".")[0]:r}(Ge.version),ot&&ot.brave&&typeof ot.brave.isBrave==o&&(Ge.name="Brave"),Ge},this.getCPU=function(){var Ge={};return Ge.architecture=r,dt.call(Ge,Yn,It.cpu),Ge},this.getDevice=function(){var Ge={};return Ge.vendor=r,Ge.model=r,Ge.type=r,dt.call(Ge,Yn,It.device),!Ge.type&&Zi&&Zi.mobile&&(Ge.type=w),Ge.model=="Macintosh"&&ot&&typeof ot.standalone!==a&&ot.maxTouchPoints&&ot.maxTouchPoints>2&&(Ge.model="iPad",Ge.type=x),Ge},this.getEngine=function(){var Ge={};return Ge.name=r,Ge.version=r,dt.call(Ge,Yn,It.engine),Ge},this.getOS=function(){var Ge={};return Ge.name=r,Ge.version=r,dt.call(Ge,Yn,It.os),!Ge.name&&Zi&&Zi.platform!="Unknown"&&(Ge.name=Zi.platform.replace(/chrome os/i,te).replace(/macos/i,S)),Ge},this.getResult=function(){return{ua:this.getUA(),browser:this.getBrowser(),engine:this.getEngine(),os:this.getOS(),device:this.getDevice(),cpu:this.getCPU()}},this.getUA=function(){return Yn},this.setUA=function(Ge){return Yn=typeof Ge===u&&Ge.length>350?Oe(Ge,350):Ge,this},this.setUA(Yn),this};Zr.VERSION="0.7.34",Zr.BROWSER=N([f,R,h]),Zr.CPU=N([A]),Zr.DEVICE=N([m,T,E,O,w,V,x,X,le]),Zr.ENGINE=Zr.OS=N([f,R]),e.exports&&(t=e.exports=Zr),t.UAParser=Zr;var ss=typeof n!==a&&(n.jQuery||n.Zepto);if(ss&&!ss.ua){var rc=new Zr;ss.ua=rc.getResult(),ss.ua.get=function(){return rc.getUA()},ss.ua.set=function(Ct){rc.setUA(Ct);var Bt=rc.getResult();for(var ot in Bt)ss.ua[ot]=Bt[ot]}}})(typeof window=="object"?window:l)})(Qf,Qf.exports);const $f=new Qf.exports;let Zf,vr,ho=$f.getResult(),em=null;function qe(e){if(!em){e&&$f.setUA(e),ho=$f.getResult();const t=function(a){if(a.engine.name==="Blink"&&a.browser.name!=="WeChat")return Ze.CHROME;switch(a.browser.name){case"Chrome Headless":case"Chrome":case"Chromium":return Ze.CHROME;case"Safari":case"Mobile Safari":return Ze.SAFARI;case"Edge":return Ze.EDGE;case"Firefox":return Ze.FIREFOX;case"QQBrowser":return Ze.QQ;case"Opera":return Ze.OPERA;case"WeChat":return Ze.WECHAT;default:return a.browser.name||""}}(ho),n=function(a){let d;return d=a.engine.name==="Blink"?a.engine.version||"":a.browser.version||"",d.split(".")[0]}(ho),r=function(a){switch(a.os.name){case"Windows":return a.os.version?a.os.name+" "+a.os.version:a.os.name;default:return a.os.name||""}}(ho),o=ho.os.version;if(!(t&&n&&r&&o))return{name:t,version:n,os:r,osVersion:o};em={name:t,version:n,os:r,osVersion:o}}return em}function by(){return qe().os}function Dy(){const e=qe();return"".concat(e.os," ").concat(e.osVersion)}function tu(){const e=qe();return!!(ho.engine.name==="WebKit"&&e.os===En.MAC_OS&&navigator.maxTouchPoints&&navigator.maxTouchPoints>0&&e.name!==Ze.SAFARI||Mn()&&e.name!==Ze.SAFARI)}function l2(){const e=qe();if(tu()){if(e.os===En.MAC_OS)return!0;if(e.os===En.IOS){const t=ho.os.version&&ho.os.version.split(".");if(t&&Number(t[0])===14&&t[1]&&Number(t[1])>=3||t&&Number(t[0])>14)return!0}}return!1}function u2(){return ho.engine.name==="WebKit"}function tm(){return qe().name===Ze.CHROME}function kn(){return qe().name===Ze.SAFARI}function Tt(){return qe().name===Ze.FIREFOX}function Mn(){return qe().os===En.IOS}function nm(e){const t=qe();return!(t.name!==Ze.CHROME||!t.osVersion)&&Number(t.version)>=e}function Py(e){const t=qe();return!(t.name!==Ze.EDGE||!t.osVersion)&&Number(t.version)>=e}function Ly(e){const t=qe();return!(t.name!==Ze.OPERA||!t.osVersion)&&Number(t.version)>=e}function ky(){const e=qe();return!(e.name!==Ze.CHROME||!e.osVersion)&&Number(e.version)<=90}function My(){const e=qe();if(e.os!==En.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])<14||Number(t[0])===14&&Number(t[1])<=6}function Oa(){const e=qe();if(e.os!==En.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15}function rm(){const e=qe();if(e.os!==En.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===16}function Uy(){const e=qe();if(e.os!==En.IOS||!e.osVersion)return!1;const t=e.osVersion.split(".");return Number(t[0])===15&&Number(t[1])>=1}function zi(){return kn()&&navigator.maxTouchPoints>0}function xy(){return qe().name===Ze.WECHAT}function Vy(){return window.navigator.appVersion&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)!==null&&window.navigator.appVersion.match(/Chrome\/([\w\W]*?)\./)[1]<=35}function xs(){const e=qe();return e.name===Ze.EDGE||e.name===Ze.SAFARI?!1:!!navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]./i)}function nu(){return by()===En.ANDROID}function Yc(){const e=qe();return nu()&&(e.name===Ze.CHROME||e.name===Ze.WECHAT||/chrome|chromium/i.test(navigator.userAgent))}(function(e){e.L1T1="L1T1",e.L1T2="L1T2",e.L1T3="L1T3",e.L2T1_KEY="L2T1_KEY",e.L2T2_KEY="L2T2_KEY",e.L2T3_KEY="L2T3_KEY",e.L3T1_KEY="L3T1_KEY",e.L3T2_KEY="L3T2_KEY",e.L3T3_KEY="L3T3_KEY"})(Zf||(Zf={})),function(e){e.CERTIFICATE="certificate",e.CODEC="codec",e.CANDIDATE_PAIR="candidate-pair",e.LOCAL_CANDIDATE="local-candidate",e.REMOTE_CANDIDATE="remote-candidate",e.INBOUND="inbound-rtp",e.TRACK="track",e.OUTBOUND="outbound-rtp",e.PC="peer-connection",e.REMOTE_INBOUND="remote-inbound-rtp",e.REMOTE_OUTBOUND="remote-outbound-rtp",e.TRANSPORT="transport",e.CSRC="csrc",e.DATA_CHANNEL="data-channel",e.STREAM="stream",e.SENDER="sender",e.RECEIVER="receiver"}(vr||(vr={}));var Fy={exports:{}},h2=Wn,p2=Z,jy=Ai.f;h2({target:"Object",stat:!0,forced:Object.defineProperty!==jy,sham:!p2},{defineProperty:jy});var By=Mo.Object,f2=Fy.exports=function(e,t,n){return By.defineProperty(e,t,n)};By.defineProperty.sham&&(f2.sham=!0);var Gy=Fy.exports;function g(e,t,n){return t in e?Gy(e,t,{value:n,enumerable:!0,configurable:!0,writable:!0}):e[t]=n,e}var im,om={exports:{}},Wy=function(e,t){return function(){for(var n=new Array(arguments.length),r=0;r<n.length;r++)n[r]=arguments[r];return e.apply(t,n)}},m2=Wy,sm=Object.prototype.toString,am=(im=Object.create(null),function(e){var t=sm.call(e);return im[t]||(im[t]=t.slice(8,-1).toLowerCase())});function Vs(e){return e=e.toLowerCase(),function(t){return am(t)===e}}function cm(e){return Array.isArray(e)}function ru(e){return e===void 0}var Hy=Vs("ArrayBuffer");function Ky(e){return e!==null&&typeof e=="object"}function iu(e){if(am(e)!=="object")return!1;var t=Object.getPrototypeOf(e);return t===null||t===Object.prototype}var E2=Vs("Date"),_2=Vs("File"),g2=Vs("Blob"),S2=Vs("FileList");function dm(e){return sm.call(e)==="[object Function]"}var T2=Vs("URLSearchParams");function lm(e,t){if(e!=null)if(typeof e!="object"&&(e=[e]),cm(e))for(var n=0,r=e.length;n<r;n++)t.call(null,e[n],n,e);else for(var o in e)Object.prototype.hasOwnProperty.call(e,o)&&t.call(null,e[o],o,e)}var um,v2=(um=typeof Uint8Array<"u"&&Object.getPrototypeOf(Uint8Array),function(e){return um&&e instanceof um}),Hn={isArray:cm,isArrayBuffer:Hy,isBuffer:function(e){return e!==null&&!ru(e)&&e.constructor!==null&&!ru(e.constructor)&&typeof e.constructor.isBuffer=="function"&&e.constructor.isBuffer(e)},isFormData:function(e){var t="[object FormData]";return e&&(typeof FormData=="function"&&e instanceof FormData||sm.call(e)===t||dm(e.toString)&&e.toString()===t)},isArrayBufferView:function(e){return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?ArrayBuffer.isView(e):e&&e.buffer&&Hy(e.buffer)},isString:function(e){return typeof e=="string"},isNumber:function(e){return typeof e=="number"},isObject:Ky,isPlainObject:iu,isUndefined:ru,isDate:E2,isFile:_2,isBlob:g2,isFunction:dm,isStream:function(e){return Ky(e)&&dm(e.pipe)},isURLSearchParams:T2,isStandardBrowserEnv:function(){return(typeof navigator>"u"||navigator.product!=="ReactNative"&&navigator.product!=="NativeScript"&&navigator.product!=="NS")&&typeof window<"u"&&typeof document<"u"},forEach:lm,merge:function e(){var t={};function n(a,d){iu(t[d])&&iu(a)?t[d]=e(t[d],a):iu(a)?t[d]=e({},a):cm(a)?t[d]=a.slice():t[d]=a}for(var r=0,o=arguments.length;r<o;r++)lm(arguments[r],n);return t},extend:function(e,t,n){return lm(t,function(r,o){e[o]=n&&typeof r=="function"?m2(r,n):r}),e},trim:function(e){return e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},stripBOM:function(e){return e.charCodeAt(0)===65279&&(e=e.slice(1)),e},inherits:function(e,t,n,r){e.prototype=Object.create(t.prototype,r),e.prototype.constructor=e,n&&Object.assign(e.prototype,n)},toFlatObject:function(e,t,n){var r,o,a,d={};t=t||{};do{for(o=(r=Object.getOwnPropertyNames(e)).length;o-- >0;)d[a=r[o]]||(t[a]=e[a],d[a]=!0);e=Object.getPrototypeOf(e)}while(e&&(!n||n(e,t))&&e!==Object.prototype);return t},kindOf:am,kindOfTest:Vs,endsWith:function(e,t,n){e=String(e),(n===void 0||n>e.length)&&(n=e.length),n-=t.length;var r=e.indexOf(t,n);return r!==-1&&r===n},toArray:function(e){if(!e)return null;var t=e.length;if(ru(t))return null;for(var n=new Array(t);t-- >0;)n[t]=e[t];return n},isTypedArray:v2,isFileList:S2},wa=Hn;function zy(e){return encodeURIComponent(e).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}var Yy=function(e,t,n){if(!t)return e;var r;if(n)r=n(t);else if(wa.isURLSearchParams(t))r=t.toString();else{var o=[];wa.forEach(t,function(d,u){d!=null&&(wa.isArray(d)?u+="[]":d=[d],wa.forEach(d,function(h){wa.isDate(h)?h=h.toISOString():wa.isObject(h)&&(h=JSON.stringify(h)),o.push(zy(u)+"="+zy(h))}))}),r=o.join("&")}if(r){var a=e.indexOf("#");a!==-1&&(e=e.slice(0,a)),e+=(e.indexOf("?")===-1?"?":"&")+r}return e},y2=Hn;function ou(){this.handlers=[]}ou.prototype.use=function(e,t,n){return this.handlers.push({fulfilled:e,rejected:t,synchronous:!!n&&n.synchronous,runWhen:n?n.runWhen:null}),this.handlers.length-1},ou.prototype.eject=function(e){this.handlers[e]&&(this.handlers[e]=null)},ou.prototype.forEach=function(e){y2.forEach(this.handlers,function(t){t!==null&&e(t)})};var R2=ou,C2=Hn,qy=Hn;function Na(e,t,n,r,o){Error.call(this),this.message=e,this.name="AxiosError",t&&(this.code=t),n&&(this.config=n),r&&(this.request=r),o&&(this.response=o)}qy.inherits(Na,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:this.config,code:this.code,status:this.response&&this.response.status?this.response.status:null}}});var Jy=Na.prototype,Xy={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED"].forEach(function(e){Xy[e]={value:e}}),Object.defineProperties(Na,Xy),Object.defineProperty(Jy,"isAxiosError",{value:!0}),Na.from=function(e,t,n,r,o,a){var d=Object.create(Jy);return qy.toFlatObject(e,d,function(u){return u!==Error.prototype}),Na.call(d,e.message,t,n,r,o),d.name=e.name,a&&Object.assign(d,a),d};var ba=Na,Qy={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},wi=Hn,$y=function(e,t){t=t||new FormData;var n=[];function r(o){return o===null?"":wi.isDate(o)?o.toISOString():wi.isArrayBuffer(o)||wi.isTypedArray(o)?typeof Blob=="function"?new Blob([o]):Buffer.from(o):o}return function o(a,d){if(wi.isPlainObject(a)||wi.isArray(a)){if(n.indexOf(a)!==-1)throw Error("Circular reference detected in "+d);n.push(a),wi.forEach(a,function(u,h){if(!wi.isUndefined(u)){var m,f=d?d+"."+h:h;if(u&&!d&&typeof u=="object"){if(wi.endsWith(h,"{}"))u=JSON.stringify(u);else if(wi.endsWith(h,"[]")&&(m=wi.toArray(u)))return void m.forEach(function(E){!wi.isUndefined(E)&&t.append(f,r(E))})}o(u,f)}}),n.pop()}else t.append(d,r(a))}(e),t},hm=ba,su=Hn,I2=su.isStandardBrowserEnv()?{write:function(e,t,n,r,o,a){var d=[];d.push(e+"="+encodeURIComponent(t)),su.isNumber(n)&&d.push("expires="+new Date(n).toGMTString()),su.isString(r)&&d.push("path="+r),su.isString(o)&&d.push("domain="+o),a===!0&&d.push("secure"),document.cookie=d.join("; ")},read:function(e){var t=document.cookie.match(new RegExp("(^|;\\s*)("+e+")=([^;]*)"));return t?decodeURIComponent(t[3]):null},remove:function(e){this.write(e,"",Date.now()-864e5)}}:{write:function(){},read:function(){return null},remove:function(){}},A2=function(e){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(e)},O2=function(e,t){return t?e.replace(/\/+$/,"")+"/"+t.replace(/^\/+/,""):e},Zy=function(e,t){return e&&!A2(t)?O2(e,t):t},pm=Hn,w2=["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"],eR=Hn,N2=eR.isStandardBrowserEnv()?function(){var e,t=/(msie|trident)/i.test(navigator.userAgent),n=document.createElement("a");function r(o){var a=o;return t&&(n.setAttribute("href",a),a=n.href),n.setAttribute("href",a),{href:n.href,protocol:n.protocol?n.protocol.replace(/:$/,""):"",host:n.host,search:n.search?n.search.replace(/^\?/,""):"",hash:n.hash?n.hash.replace(/^#/,""):"",hostname:n.hostname,port:n.port,pathname:n.pathname.charAt(0)==="/"?n.pathname:"/"+n.pathname}}return e=r(window.location.href),function(o){var a=eR.isString(o)?r(o):o;return a.protocol===e.protocol&&a.host===e.host}}():function(){return!0},fm=ba;function tR(e){fm.call(this,e??"canceled",fm.ERR_CANCELED),this.name="CanceledError"}Hn.inherits(tR,fm,{__CANCEL__:!0});var au=tR,qc=Hn,b2=function(e,t,n){var r=n.config.validateStatus;n.status&&r&&!r(n.status)?t(new hm("Request failed with status code "+n.status,[hm.ERR_BAD_REQUEST,hm.ERR_BAD_RESPONSE][Math.floor(n.status/100)-4],n.config,n.request,n)):e(n)},D2=I2,P2=Yy,L2=Zy,k2=function(e){var t,n,r,o={};return e&&pm.forEach(e.split(`
`),function(a){if(r=a.indexOf(":"),t=pm.trim(a.substr(0,r)).toLowerCase(),n=pm.trim(a.substr(r+1)),t){if(o[t]&&w2.indexOf(t)>=0)return;o[t]=t==="set-cookie"?(o[t]?o[t]:[]).concat([n]):o[t]?o[t]+", "+n:n}}),o},M2=N2,U2=Qy,po=ba,x2=au,V2=function(e){var t=/^([-+\w]{1,25})(:?\/\/|:)/.exec(e);return t&&t[1]||""},F2=function(e){return new Promise(function(t,n){var r,o=e.data,a=e.headers,d=e.responseType;function u(){e.cancelToken&&e.cancelToken.unsubscribe(r),e.signal&&e.signal.removeEventListener("abort",r)}qc.isFormData(o)&&qc.isStandardBrowserEnv()&&delete a["Content-Type"];var h=new XMLHttpRequest;if(e.auth){var m=e.auth.username||"",f=e.auth.password?unescape(encodeURIComponent(e.auth.password)):"";a.Authorization="Basic "+btoa(m+":"+f)}var E=L2(e.baseURL,e.url);function T(){if(h){var O="getAllResponseHeaders"in h?k2(h.getAllResponseHeaders()):null,w={data:d&&d!=="text"&&d!=="json"?h.response:h.responseText,status:h.status,statusText:h.statusText,headers:O,config:e,request:h};b2(function(x){t(x),u()},function(x){n(x),u()},w),h=null}}if(h.open(e.method.toUpperCase(),P2(E,e.params,e.paramsSerializer),!0),h.timeout=e.timeout,"onloadend"in h?h.onloadend=T:h.onreadystatechange=function(){h&&h.readyState===4&&(h.status!==0||h.responseURL&&h.responseURL.indexOf("file:")===0)&&setTimeout(T)},h.onabort=function(){h&&(n(new po("Request aborted",po.ECONNABORTED,e,h)),h=null)},h.onerror=function(){n(new po("Network Error",po.ERR_NETWORK,e,h,h)),h=null},h.ontimeout=function(){var O=e.timeout?"timeout of "+e.timeout+"ms exceeded":"timeout exceeded",w=e.transitional||U2;e.timeoutErrorMessage&&(O=e.timeoutErrorMessage),n(new po(O,w.clarifyTimeoutError?po.ETIMEDOUT:po.ECONNABORTED,e,h)),h=null},qc.isStandardBrowserEnv()){var R=(e.withCredentials||M2(E))&&e.xsrfCookieName?D2.read(e.xsrfCookieName):void 0;R&&(a[e.xsrfHeaderName]=R)}"setRequestHeader"in h&&qc.forEach(a,function(O,w){o===void 0&&w.toLowerCase()==="content-type"?delete a[w]:h.setRequestHeader(w,O)}),qc.isUndefined(e.withCredentials)||(h.withCredentials=!!e.withCredentials),d&&d!=="json"&&(h.responseType=e.responseType),typeof e.onDownloadProgress=="function"&&h.addEventListener("progress",e.onDownloadProgress),typeof e.onUploadProgress=="function"&&h.upload&&h.upload.addEventListener("progress",e.onUploadProgress),(e.cancelToken||e.signal)&&(r=function(O){h&&(n(!O||O&&O.type?new x2:O),h.abort(),h=null)},e.cancelToken&&e.cancelToken.subscribe(r),e.signal&&(e.signal.aborted?r():e.signal.addEventListener("abort",r))),o||(o=null);var A=V2(E);A&&["http","https","file"].indexOf(A)===-1?n(new po("Unsupported protocol "+A+":",po.ERR_BAD_REQUEST,e)):h.send(o)})},Un=Hn,nR=function(e,t){C2.forEach(e,function(n,r){r!==t&&r.toUpperCase()===t.toUpperCase()&&(e[t]=n,delete e[r])})},rR=ba,j2=$y,B2={"Content-Type":"application/x-www-form-urlencoded"};function iR(e,t){!Un.isUndefined(e)&&Un.isUndefined(e["Content-Type"])&&(e["Content-Type"]=t)}var oR,cu={transitional:Qy,adapter:((typeof XMLHttpRequest<"u"||typeof process<"u"&&Object.prototype.toString.call(process)==="[object process]")&&(oR=F2),oR),transformRequest:[function(e,t){if(nR(t,"Accept"),nR(t,"Content-Type"),Un.isFormData(e)||Un.isArrayBuffer(e)||Un.isBuffer(e)||Un.isStream(e)||Un.isFile(e)||Un.isBlob(e))return e;if(Un.isArrayBufferView(e))return e.buffer;if(Un.isURLSearchParams(e))return iR(t,"application/x-www-form-urlencoded;charset=utf-8"),e.toString();var n,r=Un.isObject(e),o=t&&t["Content-Type"];if((n=Un.isFileList(e))||r&&o==="multipart/form-data"){var a=this.env&&this.env.FormData;return j2(n?{"files[]":e}:e,a&&new a)}return r||o==="application/json"?(iR(t,"application/json"),function(d,u,h){if(Un.isString(d))try{return(u||JSON.parse)(d),Un.trim(d)}catch(m){if(m.name!=="SyntaxError")throw m}return(h||JSON.stringify)(d)}(e)):e}],transformResponse:[function(e){var t=this.transitional||cu.transitional,n=t&&t.silentJSONParsing,r=t&&t.forcedJSONParsing,o=!n&&this.responseType==="json";if(o||r&&Un.isString(e)&&e.length)try{return JSON.parse(e)}catch(a){if(o)throw a.name==="SyntaxError"?rR.from(a,rR.ERR_BAD_RESPONSE,this,null,this.response):a}return e}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:null},validateStatus:function(e){return e>=200&&e<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};Un.forEach(["delete","get","head"],function(e){cu.headers[e]={}}),Un.forEach(["post","put","patch"],function(e){cu.headers[e]=Un.merge(B2)});var mm=cu,G2=Hn,W2=mm,sR=function(e){return!(!e||!e.__CANCEL__)},aR=Hn,Em=function(e,t,n){var r=this||W2;return G2.forEach(n,function(o){e=o.call(r,e,t)}),e},H2=sR,K2=mm,z2=au;function _m(e){if(e.cancelToken&&e.cancelToken.throwIfRequested(),e.signal&&e.signal.aborted)throw new z2}var Gr=Hn,cR=function(e,t){t=t||{};var n={};function r(m,f){return Gr.isPlainObject(m)&&Gr.isPlainObject(f)?Gr.merge(m,f):Gr.isPlainObject(f)?Gr.merge({},f):Gr.isArray(f)?f.slice():f}function o(m){return Gr.isUndefined(t[m])?Gr.isUndefined(e[m])?void 0:r(void 0,e[m]):r(e[m],t[m])}function a(m){if(!Gr.isUndefined(t[m]))return r(void 0,t[m])}function d(m){return Gr.isUndefined(t[m])?Gr.isUndefined(e[m])?void 0:r(void 0,e[m]):r(void 0,t[m])}function u(m){return m in t?r(e[m],t[m]):m in e?r(void 0,e[m]):void 0}var h={url:a,method:a,data:a,baseURL:d,transformRequest:d,transformResponse:d,paramsSerializer:d,timeout:d,timeoutMessage:d,withCredentials:d,adapter:d,responseType:d,xsrfCookieName:d,xsrfHeaderName:d,onUploadProgress:d,onDownloadProgress:d,decompress:d,maxContentLength:d,maxBodyLength:d,beforeRedirect:d,transport:d,httpAgent:d,httpsAgent:d,cancelToken:d,socketPath:d,responseEncoding:d,validateStatus:u};return Gr.forEach(Object.keys(e).concat(Object.keys(t)),function(m){var f=h[m]||o,E=f(m);Gr.isUndefined(E)&&f!==u||(n[m]=E)}),n},dR="0.27.2",Y2=dR,Go=ba,gm={};["object","boolean","number","function","string","symbol"].forEach(function(e,t){gm[e]=function(n){return typeof n===e||"a"+(t<1?"n ":" ")+e}});var lR={};gm.transitional=function(e,t,n){function r(o,a){return"[Axios v"+Y2+"] Transitional option '"+o+"'"+a+(n?". "+n:"")}return function(o,a,d){if(e===!1)throw new Go(r(a," has been removed"+(t?" in "+t:"")),Go.ERR_DEPRECATED);return t&&!lR[a]&&(lR[a]=!0,console.warn(r(a," has been deprecated since v"+t+" and will be removed in the near future"))),!e||e(o,a,d)}};var uR=Hn,q2=Yy,hR=R2,pR=function(e){return _m(e),e.headers=e.headers||{},e.data=Em.call(e,e.data,e.headers,e.transformRequest),e.headers=aR.merge(e.headers.common||{},e.headers[e.method]||{},e.headers),aR.forEach(["delete","get","head","post","put","patch","common"],function(t){delete e.headers[t]}),(e.adapter||K2.adapter)(e).then(function(t){return _m(e),t.data=Em.call(e,t.data,t.headers,e.transformResponse),t},function(t){return H2(t)||(_m(e),t&&t.response&&(t.response.data=Em.call(e,t.response.data,t.response.headers,e.transformResponse))),Promise.reject(t)})},du=cR,J2=Zy,fR={assertOptions:function(e,t,n){if(typeof e!="object")throw new Go("options must be an object",Go.ERR_BAD_OPTION_VALUE);for(var r=Object.keys(e),o=r.length;o-- >0;){var a=r[o],d=t[a];if(d){var u=e[a],h=u===void 0||d(u,a,e);if(h!==!0)throw new Go("option "+a+" must be "+h,Go.ERR_BAD_OPTION_VALUE)}else if(n!==!0)throw new Go("Unknown option "+a,Go.ERR_BAD_OPTION)}},validators:gm},Da=fR.validators;function Pa(e){this.defaults=e,this.interceptors={request:new hR,response:new hR}}Pa.prototype.request=function(e,t){typeof e=="string"?(t=t||{}).url=e:t=e||{},(t=du(this.defaults,t)).method?t.method=t.method.toLowerCase():this.defaults.method?t.method=this.defaults.method.toLowerCase():t.method="get";var n=t.transitional;n!==void 0&&fR.assertOptions(n,{silentJSONParsing:Da.transitional(Da.boolean),forcedJSONParsing:Da.transitional(Da.boolean),clarifyTimeoutError:Da.transitional(Da.boolean)},!1);var r=[],o=!0;this.interceptors.request.forEach(function(E){typeof E.runWhen=="function"&&E.runWhen(t)===!1||(o=o&&E.synchronous,r.unshift(E.fulfilled,E.rejected))});var a,d=[];if(this.interceptors.response.forEach(function(E){d.push(E.fulfilled,E.rejected)}),!o){var u=[pR,void 0];for(Array.prototype.unshift.apply(u,r),u=u.concat(d),a=Promise.resolve(t);u.length;)a=a.then(u.shift(),u.shift());return a}for(var h=t;r.length;){var m=r.shift(),f=r.shift();try{h=m(h)}catch(E){f(E);break}}try{a=pR(h)}catch(E){return Promise.reject(E)}for(;d.length;)a=a.then(d.shift(),d.shift());return a},Pa.prototype.getUri=function(e){e=du(this.defaults,e);var t=J2(e.baseURL,e.url);return q2(t,e.params,e.paramsSerializer)},uR.forEach(["delete","get","head","options"],function(e){Pa.prototype[e]=function(t,n){return this.request(du(n||{},{method:e,url:t,data:(n||{}).data}))}}),uR.forEach(["post","put","patch"],function(e){function t(n){return function(r,o,a){return this.request(du(a||{},{method:e,headers:n?{"Content-Type":"multipart/form-data"}:{},url:r,data:o}))}}Pa.prototype[e]=t(),Pa.prototype[e+"Form"]=t(!0)});var X2=Pa,Q2=au;function La(e){if(typeof e!="function")throw new TypeError("executor must be a function.");var t;this.promise=new Promise(function(r){t=r});var n=this;this.promise.then(function(r){if(n._listeners){var o,a=n._listeners.length;for(o=0;o<a;o++)n._listeners[o](r);n._listeners=null}}),this.promise.then=function(r){var o,a=new Promise(function(d){n.subscribe(d),o=d}).then(r);return a.cancel=function(){n.unsubscribe(o)},a},e(function(r){n.reason||(n.reason=new Q2(r),t(n.reason))})}La.prototype.throwIfRequested=function(){if(this.reason)throw this.reason},La.prototype.subscribe=function(e){this.reason?e(this.reason):this._listeners?this._listeners.push(e):this._listeners=[e]},La.prototype.unsubscribe=function(e){if(this._listeners){var t=this._listeners.indexOf(e);t!==-1&&this._listeners.splice(t,1)}},La.source=function(){var e;return{token:new La(function(t){e=t}),cancel:e}};var $2=La,Z2=Hn,mR=Hn,eV=Wy,lu=X2,tV=cR,yr=function e(t){var n=new lu(t),r=eV(lu.prototype.request,n);return mR.extend(r,lu.prototype,n),mR.extend(r,n),r.create=function(o){return e(tV(t,o))},r}(mm);yr.Axios=lu,yr.CanceledError=au,yr.CancelToken=$2,yr.isCancel=sR,yr.VERSION=dR,yr.toFormData=$y,yr.AxiosError=ba,yr.Cancel=yr.CanceledError,yr.all=function(e){return Promise.all(e)},yr.spread=function(e){return function(t){return e.apply(null,t)}},yr.isAxiosError=function(e){return Z2.isObject(e)&&e.isAxiosError===!0},om.exports=yr,om.exports.default=yr;var Rr=om.exports;class nV{constructor(t){g(this,"logger",void 0),g(this,"prefixLists",[]),this.logger=t}debug(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.debug(...this.prefixLists,...n)}info(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.info(...this.prefixLists,...n)}warning(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.warning(...this.prefixLists,...n)}error(){for(var t=arguments.length,n=new Array(t),r=0;r<t;r++)n[r]=arguments[r];this.logger.error(...this.prefixLists,...n)}prefix(t){return this.prefixLists.push(t),this}popPrefix(){return this.prefixLists.pop(),this}}class gt{constructor(){g(this,"_events",{}),g(this,"addListener",this.on)}getListeners(t){return this._events[t]?this._events[t].map(n=>n.listener):[]}on(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!1})}once(t,n){this._events[t]||(this._events[t]=[]);const r=this._events[t];this._indexOfListener(r,n)===-1&&r.push({listener:n,once:!0})}off(t,n){if(!this._events[t])return;const r=this._events[t],o=this._indexOfListener(r,n);o!==-1&&r.splice(o,1),this._events[t].length===0&&delete this._events[t]}removeAllListeners(t){t?delete this._events[t]:this._events={}}emit(t){this._events[t]||(this._events[t]=[]);const n=this._events[t].map(d=>d);for(var r=arguments.length,o=new Array(r>1?r-1:0),a=1;a<r;a++)o[a-1]=arguments[a];for(let d=0;d<n.length;d+=1){const u=n[d];u.once&&this.off(t,u.listener),u.listener.apply(this,o||[])}}safeEmit(t){for(var n=arguments.length,r=new Array(n>1?n-1:0),o=1;o<n;o++)r[o-1]=arguments[o];[...this._events[t]||[]].forEach(a=>{a.once&&this.off(t,a.listener);try{a.listener.apply(this,r)}catch(d){v.error("safeEmit event:".concat(t," error ").concat(d==null?void 0:d.toString()))}})}_indexOfListener(t,n){let r=t.length;for(;r--;)if(t[r].listener===n)return r;return-1}}const uu=new class extends gt{reportLogUploadError(e){this.emit("REPORT_LOG_UPLOAD",e)}};let I;(function(e){e.UNEXPECTED_ERROR="UNEXPECTED_ERROR",e.UNEXPECTED_RESPONSE="UNEXPECTED_RESPONSE",e.TIMEOUT="TIMEOUT",e.INVALID_PARAMS="INVALID_PARAMS",e.NOT_READABLE="NOT_READABLE",e.NOT_SUPPORTED="NOT_SUPPORTED",e.INVALID_OPERATION="INVALID_OPERATION",e.OPERATION_ABORTED="OPERATION_ABORTED",e.WEB_SECURITY_RESTRICT="WEB_SECURITY_RESTRICT",e.EXCHANGE_SDP_FAILED="EXCHANGE_SDP_FAILED",e.NETWORK_ERROR="NETWORK_ERROR",e.NETWORK_TIMEOUT="NETWORK_TIMEOUT",e.NETWORK_RESPONSE_ERROR="NETWORK_RESPONSE_ERROR",e.API_INVOKE_TIMEOUT="API_INVOKE_TIMEOUT",e.ENUMERATE_DEVICES_FAILED="ENUMERATE_DEVICES_FAILED",e.DEVICE_NOT_FOUND="DEVICE_NOT_FOUND",e.ELECTRON_IS_NULL="ELECTRON_IS_NULL",e.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR="ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR",e.CHROME_PLUGIN_NO_RESPONSE="CHROME_PLUGIN_NO_RESPONSE",e.CHROME_PLUGIN_NOT_INSTALL="CHROME_PLUGIN_NOT_INSTALL",e.MEDIA_OPTION_INVALID="MEDIA_OPTION_INVALID",e.PERMISSION_DENIED="PERMISSION_DENIED",e.CONSTRAINT_NOT_SATISFIED="CONSTRAINT_NOT_SATISFIED",e.TRACK_IS_DISABLED="TRACK_IS_DISABLED",e.GET_VIDEO_ELEMENT_VISIBLE_ERROR="GET_VIDEO_ELEMENT_VISIBLE_ERROR",e.SHARE_AUDIO_NOT_ALLOWED="SHARE_AUDIO_NOT_ALLOWED",e.LOW_STREAM_ENCODING_ERROR="LOW_STREAM_ENCODING_ERROR",e.SET_ENCODING_PARAMETER_ERROR="SET_ENCODING_PARAMETER_ERROR",e.TRACK_STATE_UNREACHABLE="TRACK_STATE_UNREACHABLE",e.INVALID_UINT_UID_FROM_STRING_UID="INVALID_UINT_UID_FROM_STRING_UID",e.CAN_NOT_GET_PROXY_SERVER="CAN_NOT_GET_PROXY_SERVER",e.CAN_NOT_GET_GATEWAY_SERVER="CAN_NOT_GET_GATEWAY_SERVER",e.VOID_GATEWAY_ADDRESS="VOID_GATEWAY_ADDRESS",e.UID_CONFLICT="UID_CONFLICT",e.MULTI_UNILBS_RESPONSE_ERROR="MULTI_UNILBS_RESPONSE_ERROR",e.UPDATE_TICKET_FAILED="UPDATE_TICKET_FAILED",e.INVALID_LOCAL_TRACK="INVALID_LOCAL_TRACK",e.INVALID_TRACK="INVALID_TRACK",e.SENDER_NOT_FOUND="SENDER_NOT_FOUND",e.CREATE_OFFER_FAILED="CREATE_OFFER_FAILED",e.SET_ANSWER_FAILED="SET_ANSWER_FAILED",e.ICE_FAILED="ICE_FAILED",e.PC_CLOSED="PC_CLOSED",e.SENDER_REPLACE_FAILED="SENDER_REPLACE_FAILED",e.GET_LOCAL_CAPABILITIES_FAILED="GET_LOCAL_CAPABILITIES_FAILED",e.GET_LOCAL_CONNECTION_PARAMS_FAILED="GET_LOCAL_CONNECTION_PARAMS_FAILED",e.SUBSCRIBE_FAILED="SUBSCRIBE_FAILED",e.UNSUBSCRIBE_FAILED="UNSUBSCRIBE_FAILED",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NO_ICE_CANDIDATE="NO_ICE_CANDIDATE",e.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS="CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS",e.EXIST_DISABLED_VIDEO_TRACK="EXIST_DISABLED_VIDEO_TRACK",e.INVALID_REMOTE_USER="INVALID_REMOTE_USER",e.REMOTE_USER_IS_NOT_PUBLISHED="REMOTE_USER_IS_NOT_PUBLISHED",e.CUSTOM_REPORT_SEND_FAILED="CUSTOM_REPORT_SEND_FAILED",e.CUSTOM_REPORT_FREQUENCY_TOO_HIGH="CUSTOM_REPORT_FREQUENCY_TOO_HIGH",e.FETCH_AUDIO_FILE_FAILED="FETCH_AUDIO_FILE_FAILED",e.READ_LOCAL_AUDIO_FILE_ERROR="READ_LOCAL_AUDIO_FILE_ERROR",e.DECODE_AUDIO_FILE_FAILED="DECODE_AUDIO_FILE_FAILED",e.WS_ABORT="WS_ABORT",e.WS_DISCONNECT="WS_DISCONNECT",e.WS_ERR="WS_ERR",e.LIVE_STREAMING_TASK_CONFLICT="LIVE_STREAMING_TASK_CONFLICT",e.LIVE_STREAMING_INVALID_ARGUMENT="LIVE_STREAMING_INVALID_ARGUMENT",e.LIVE_STREAMING_INTERNAL_SERVER_ERROR="LIVE_STREAMING_INTERNAL_SERVER_ERROR",e.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED="LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED",e.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED="LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED",e.LIVE_STREAMING_CDN_ERROR="LIVE_STREAMING_CDN_ERROR",e.LIVE_STREAMING_INVALID_RAW_STREAM="LIVE_STREAMING_INVALID_RAW_STREAM",e.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT="LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT",e.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE="LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE",e.LIVE_STREAMING_WARN_FREQUENT_REQUEST="LIVE_STREAMING_WARN_FREQUENT_REQUEST",e.WEBGL_INTERNAL_ERROR="WEBGL_INTERNAL_ERROR",e.BEAUTY_PROCESSOR_INTERNAL_ERROR="BEAUTY_PROCESSOR_INTERNAL_ERROR",e.CROSS_CHANNEL_WAIT_STATUS_ERROR="CROSS_CHANNEL_WAIT_STATUS_ERROR",e.CROSS_CHANNEL_FAILED_JOIN_SRC="CROSS_CHANNEL_FAILED_JOIN_SEC",e.CROSS_CHANNEL_FAILED_JOIN_DEST="CROSS_CHANNEL_FAILED_JOIN_DEST",e.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST="CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST",e.CROSS_CHANNEL_SERVER_ERROR_RESPONSE="CROSS_CHANNEL_SERVER_ERROR_RESPONSE",e.METADATA_OUT_OF_RANGE="METADATA_OUT_OF_RANGE",e.LOCAL_AEC_ERROR="LOCAL_AEC_ERROR",e.INVALID_PLUGIN="INVALID_PLUGIN",e.DISCONNECT_P2P="DISCONNECT_P2P",e.INIT_WEBSOCKET_TIMEOUT="INIT_WEBSOCKET_TIMEOUT",e.CONVERTING_IMAGEDATA_TO_BLOB_FAILED="CONVERTING_IMAGEDATA_TO_BLOB_FAILED",e.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED="CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED",e.INIT_DATACHANNEL_TIMEOUT="INIT_DATACHANNEL_TIMEOUT",e.DATACHANNEL_CONNECTION_TIMEOUT="DATACHANNEL_CONNECTION_TIMEOUT",e.PROHIBITED_OPERATION="PROHIBITED_OPERATION",e.IMAGE_MODERATION_UPLOAD_FAILED="IMAGE_MODERATION_UPLOAD_FAILED"})(I||(I={}));class b extends Error{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"",r=arguments.length>2?arguments[2]:void 0;super(n),g(this,"code",void 0),g(this,"message",void 0),g(this,"data",void 0),g(this,"name","AgoraRTCException"),this.code=t,this.message="AgoraRTCError ".concat(this.code,": ").concat(n),this.data=r}toString(){return this.data?"data: ".concat(JSON.stringify(this.data),`
`).concat(this.stack):"".concat(this.stack)}print(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:"error";return t==="error"&&v.error(this.toString()),t==="warning"&&v.warning(this.toString()),this}throw(){throw this.print(),this}}const kt={timeout:500,timeoutFactor:1.5,maxRetryCount:1/0,maxRetryTimeout:1e4};function Sm(e,t){const n=Math.floor(t.timeout*Math.pow(t.timeoutFactor,e));return Math.min(t.maxRetryTimeout,n)}function Ni(e,t,n,r){const o=Object.assign({},kt,r);let a=o.timeout;const d=async()=>{await function(m){return new de(f=>{window.setTimeout(f,m)})}(a),a*=o.timeoutFactor,a=Math.min(o.maxRetryTimeout,a)};let u=!1;const h=new de(async(m,f)=>{t=t||(()=>!1),n=n||(()=>!0);for(let E=0;E<o.maxRetryCount;E+=1){if(u)return f(new b(I.OPERATION_ABORTED));try{const T=await e();if(!t(T,E)||E+1===o.maxRetryCount)return m(T);await d()}catch(T){if(!n(T,E)||E+1===o.maxRetryCount)return f(T);await d()}}});return h.cancel=()=>u=!0,h}function Tm(){const e=new Date;return e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}function ER(){const e=new Date,t=/((\d+:){2}\d+)/.exec(new Date().toUTCString());return t?(t==null?void 0:t[0])+":"+e.getUTCMilliseconds():e.toTimeString().split(" ")[0]+":"+e.getMilliseconds()}const Wr={DEBUG:0,INFO:1,WARNING:2,ERROR:3,NONE:4},hu=Date.now(),Jc=e=>{for(const t in Wr)if(Object.prototype.hasOwnProperty.call(Wr,t)&&Wr[t]===e)return t;return"DEFAULT"},v=new class{constructor(){g(this,"proxyServerURL",void 0),g(this,"logLevel",Wr.DEBUG),g(this,"uploadState","collecting"),g(this,"uploadLogWaitingList",[]),g(this,"uploadLogUploadingList",[]),g(this,"uploadErrorCount",0),g(this,"currentLogID",0),g(this,"url",void 0),g(this,"extLog",(e,t)=>{this.appendLogToWaitingList(e,...t)})}debug(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Wr.DEBUG].concat(t);this.log.apply(this,r)}info(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Wr.INFO].concat(t);this.log.apply(this,r)}warning(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Wr.WARNING].concat(t);this.log.apply(this,r)}error(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Wr.ERROR].concat(t);this.log.apply(this,r)}upload(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];const r=[Wr.DEBUG].concat(t);this.uploadLog.apply(this,r)}setLogLevel(e){e=Math.min(Math.max(0,e),4),this.logLevel=e}enableLogUpload(){it("UPLOAD_LOG",!0)}disableLogUpload(){it("UPLOAD_LOG",!1),this.uploadLogUploadingList=[],this.uploadLogWaitingList=[]}setProxyServer(e){this.proxyServerURL=e}prefix(e){return new nV(this).prefix(e)}log(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hu<100)return void setTimeout(()=>{this.log(...t)},Date.now()-hu);const r=Math.max(0,Math.min(4,t[0]));if(t[0]=Tm()+" Agora-SDK [".concat(Jc(r),"]:"),this.appendLogToWaitingList(r,...t),r<this.logLevel)return;const o=Tm()+" %cAgora-SDK [".concat(Jc(r),"]:");let a=[];if(!k("USE_NEW_LOG"))switch(r){case Wr.DEBUG:a=[o,"color: #64B5F6;"].concat(t.slice(1)),console.log.apply(console,a);break;case Wr.INFO:a=[o,"color: #1E88E5; font-weight: bold;"].concat(t.slice(1)),console.log.apply(console,a);break;case Wr.WARNING:a=[o,"color: #FB8C00; font-weight: bold;"].concat(t.slice(1)),console.warn.apply(console,a);break;case Wr.ERROR:a=[o,"color: #B00020; font-weight: bold;"].concat(t.slice(1)),console.error.apply(console,a)}}uploadLog(){for(var e=arguments.length,t=new Array(e),n=0;n<e;n++)t[n]=arguments[n];if(Date.now()-hu<100)return void setTimeout(()=>{this.uploadLog(...t)},Date.now()-hu);const r=Math.max(0,Math.min(4,t[0]));t[0]=Tm()+" Agora-SDK [".concat(Jc(r),"]:"),this.appendLogToWaitingList(r,...t)}appendLogToWaitingList(e){if(!k("UPLOAD_LOG"))return;for(var t=arguments.length,n=new Array(t>1?t-1:0),r=1;r<t;r++)n[r-1]=arguments[r];Array.isArray(n[0])?n[0][0]=ER()+" Agora-SDK [".concat(Jc(e),"]:"):n[0]=ER()+" Agora-SDK [".concat(Jc(e),"]:");let o="";n.forEach(a=>{typeof a=="object"&&(a=JSON.stringify(a)),o+="".concat(a," ")}),this.uploadLogWaitingList.push({payload_str:o,log_level:e,log_item_id:this.currentLogID++}),this.uploadState==="uploading"&&this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}startUpload(){this.uploadState="uploading",this.uploadLogUploadingList.length===0&&this.uploadLogInterval()}async uploadLogs(){const e=this.uploadLogUploadingList,t={sdk_version:Hr,process_id:k("PROCESS_ID"),payload:JSON.stringify(e)};return Ni(async()=>{const n=await Rr.post(this.url||(this.proxyServerURL?"https://".concat(this.proxyServerURL,"/ls/?h=").concat(k("LOG_UPLOAD_SERVER"),"&p=443&d=upload/v1"):"https://".concat(k("LOG_UPLOAD_SERVER"),"/upload/v1")),t,{responseType:"text"});if(n.data!=="OK"){const r=new Error("unexpected upload log response");throw r.response=n,r}},()=>(this.uploadLogUploadingList=[],!1),n=>(n.response?uu.reportLogUploadError({status:n.response.status,data:n.response.data,headers:n.response.headers,message:n.message}):n.request?uu.reportLogUploadError({status:n.request.status,message:n.message}):uu.reportLogUploadError({status:-1,message:n.message}),!0),{timeout:k("UPLOAD_LOG_REQUEST_RETRY_INTERVAL"),maxRetryTimeout:k("UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL")})}uploadLogInterval(){this.uploadLogUploadingList.length===0&&this.uploadLogWaitingList.length===0||(this.uploadLogUploadingList.length===0&&(this.uploadLogUploadingList=this.uploadLogWaitingList.splice(0,k("UPLOAD_LOG_LENGTH_EACH_TIME"))),this.uploadLogs().then(()=>{this.uploadErrorCount=0,this.uploadLogWaitingList.length>0&&window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_INTERVAL"))}).catch(e=>{this.uploadErrorCount+=1,this.uploadErrorCount<2?window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1")):window.setTimeout(()=>this.uploadLogInterval(),k("UPLOAD_LOG_RETRY_INTERVAL_V1"))}))}},vm="v4.18.1-0-ge3033d03-dirty(7/7/2023, 4:00:56 PM)",Hr=function(e){if(e.match(/[0-9]+\.[0-9]+\.[0-9]+$/))return e;const t=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-alpha\.([0-9]+)/);if(t&&t[1]&&t[2]){const r=t[1],o=t[2];return"".concat(r,".").concat(o)}const n=e.match(/([0-9]+\.[0-9]+\.[0-9]+)\-special\.([0-9]+)/);if(n&&n[1]&&n[2]){const r=n[1],o=n[2];return"".concat(r,".").concat(100*(Number(o)+1))}return"4.0.0.999"}("4.18.1"),ym=function(){try{return JSON.parse("true")===!0}catch{return!0}}(),_R=["CHINA","GLOBAL"],Cr=function(){const e="us".concat("erna","me"),t="pa".concat("sswo","rd"),n=["t","s","t"];n.splice(1,0,"e");const r=n.join(""),o=[];for(let u=0;u<6;u++)o.push("1");const a=o.join(""),d={};return d[e]=r,d[t]=a,Object.assign(d,{turnServerURL:"",tcpport:3433,udpport:3478,forceturn:!1})}();window.DEFAULT_TURN_CONFIG=Cr;const rV={"90p":Fe(160,90),"90p_1":Fe(160,90),"120p":Fe(160,120,15,30,65),"120p_1":Fe(160,120,15,30,65),"120p_3":Fe(120,120,15,30,50),"120p_4":Fe(212,120),"180p":Fe(320,180,15,30,140),"180p_1":Fe(320,180,15,30,140),"180p_3":Fe(180,180,15,30,100),"180p_4":Fe(240,180,15,30,120),"240p":Fe(320,240,15,40,200),"240p_1":Fe(320,240,15,40,200),"240p_3":Fe(240,240,15,40,140),"240p_4":Fe(424,240,15,40,220),"360p":Fe(640,360,15,80,400),"360p_1":Fe(640,360,15,80,400),"360p_3":Fe(360,360,15,80,260),"360p_4":Fe(640,360,30,80,600),"360p_6":Fe(360,360,30,80,400),"360p_7":Fe(480,360,15,80,320),"360p_8":Fe(480,360,30,80,490),"360p_9":Fe(640,360,15,80,800),"360p_10":Fe(640,360,24,80,800),"360p_11":Fe(640,360,24,80,1e3),"480p":Fe(640,480,15,100,500),"480p_1":Fe(640,480,15,100,500),"480p_2":Fe(640,480,30,100,1e3),"480p_3":Fe(480,480,15,100,400),"480p_4":Fe(640,480,30,100,750),"480p_6":Fe(480,480,30,100,600),"480p_8":Fe(848,480,15,100,610),"480p_9":Fe(848,480,30,100,930),"480p_10":Fe(640,480,10,100,400),"720p":Fe(1280,720,15,120,1130),"720p_1":Fe(1280,720,15,120,1130),"720p_2":Fe(1280,720,30,120,2e3),"720p_3":Fe(1280,720,30,120,1710),"720p_5":Fe(960,720,15,120,910),"720p_6":Fe(960,720,30,120,1380),"1080p":Fe(1920,1080,15,120,2080),"1080p_1":Fe(1920,1080,15,120,2080),"1080p_2":Fe(1920,1080,30,120,3e3),"1080p_3":Fe(1920,1080,30,120,3150),"1080p_5":Fe(1920,1080,60,120,4780),"1440p":Fe(2560,1440,30,120,4850),"1440p_1":Fe(2560,1440,30,120,4850),"1440p_2":Fe(2560,1440,60,120,7350),"4k":Fe(3840,2160,30,120,8910),"4k_1":Fe(3840,2160,30,120,8910),"4k_3":Fe(3840,2160,60,120,13500)},iV={"480p":si(640,480,5),"480p_1":si(640,480,5),"480p_2":si(640,480,30),"480p_3":si(640,480,15),"720p":si(1280,720,5),"720p_1":si(1280,720,5),"720p_2":si(1280,720,30),"720p_3":si(1280,720,15),"1080p":si(1920,1080,5),"1080p_1":si(1920,1080,5),"1080p_2":si(1920,1080,30),"1080p_3":si(1920,1080,15)},oV={"1SL1TL":Cm(1,1),"3SL3TL":Cm(3,3),"2SL3TL":Cm(2,3)};function Fs(e){return e||(e="480p_1"),typeof e=="string"?Object.assign({},rV[e]):e}function Rm(e){return typeof e=="string"?Object.assign({},iV[e]):e}function pu(e){return typeof e=="string"?Object.assign({},oV[e]):e}const sV={speech_low_quality:ka(16e3,!1),speech_standard:ka(32e3,!1,18),music_standard:ka(48e3,!1),standard_stereo:ka(48e3,!0,56),high_quality:ka(48e3,!1,128),high_quality_stereo:ka(48e3,!0,192)};function fu(e){return typeof e=="string"?Object.assign({},sV[e]):e}function it(e,t,n){Object.keys(er).includes(e)&&(!n&&Object.keys(js).includes(e)||(er[e]=t))}function k(e){return er[e]}const er={PROCESS_ID:"",ENCRYPT_AES:!0,AREAS:_R,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io","webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io","webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-web-2.ap.sd-rtn.com","cds-ap-web-3.agora.io","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-web-2.ap.sd-rtn.com","sua-ap-web-3.agora.io","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-ap-web-1.agora.io","uap-web-2.ap.sd-rtn.com","uap-ap-web-3.agora.io","uap-web-4.ap.sd-rtn.com"],LOG_UPLOAD_SERVER:"logservice.agora.io",EVENT_REPORT_DOMAIN:"statscollector-1.agora.io",EVENT_REPORT_BACKUP_DOMAIN:"web-2.statscollector.sd-rtn.com",ENABLE_EVENT_REPORT:!0,GATEWAY_ADDRESS:[],GATEWAY_WSS_ADDRESS:"",LIVE_STREAMING_ADDRESS:"",HTTP_CONNECT_TIMEOUT:5e3,SIGNAL_REQUEST_TIMEOUT:1e4,REPORT_STATS:!0,UPLOAD_LOG:!1,NOT_REPORT_EVENT:[],SUBSCRIBE_TWCC:!1,PUBLISH_TWCC:!1,PING_PONG_TIME_OUT:10,WEBSOCKET_TIMEOUT_MIN:1e4,EVENT_REPORT_SEND_INTERVAL:3e3,CONFIG_DISTRIBUTE_INTERVAL:3e5,ENABLE_CONFIG_DISTRIBUTE:!0,CANDIDATE_TIMEOUT:5e3,SHOW_REPORT_INVOKER_LOG:!1,JOIN_EXTEND:"",PUB_EXTEND:"",SUB_EXTEND:"",FORCE_TURN:!1,TURN_ENABLE_TCP:!0,TURN_ENABLE_UDP:!0,MAX_UPLOAD_CACHE:50,UPLOAD_CACHE_INTERVAL:2e3,AJAX_REQUEST_CONCURRENT:3,REPORT_APP_SCENARIO:void 0,GATEWAY_DOMAINS:["edge.agora.io","edge.sd-rtn.com"],WORKER_DOMAIN:"edge.agora.io",TURN_DOMAIN:"edge.agora.io",EVENT_REPORT_RETRY:!0,CHROME_FORCE_PLAN_B:!1,AUDIO_SOURCE_VOLUME_UPDATE_INTERVAL:400,AUDIO_SOURCE_AVG_VOLUME_DURATION:3e3,AUDIO_VOLUME_INDICATION_INTERVAL:2e3,VOLUME_VOICE_WEIGHT:10,GET_VOLUME_OF_MUTED_AUDIO_TRACK:!1,STATS_UPDATE_INTERVAL:250,NORMAL_EVENT_QUEUE_CAPACITY:100,CUSTOM_REPORT:!0,CUSTOM_REPORT_LIMIT:20,PROXY_SERVER_TYPE2:"webnginx-proxy.agora.io",PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com","webrtc-cloud-proxy.agora.io"],CUSTOM_PUB_ANSWER_MODIFIER:null,CUSTOM_SUB_ANSWER_MODIFIER:null,CUSTOM_PUB_OFFER_MODIFIER:null,CUSTOM_SUB_OFFER_MODIFIER:null,DSCP_TYPE:"high",REMOVE_NEW_CODECS:!0,FRAGEMENT_LENGTH:3,WEBSOCKET_COMPRESS:!1,SIMULCAST:!1,PRELOAD_MEDIA_COUNT:0,USE_PUB_RTX:!1,USE_SUB_RTX:!1,CHECK_VIDEO_VISIBLE_INTERVAL:3e4,ENUMERATE_DEVICES_INTERVAL:!1,ENUMERATE_DEVICES_INTERVAL_TIME:1e4,USE_NEW_TOKEN:!1,CLOSE_AFB_FOR_LOCAL_AP:!0,JOIN_WITH_FALLBACK_SIGNAL_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY:!0,JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE:!1,JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION:2e3,USE_TURN_SERVER_OF_GATEWAY:!1,H264_PROFILE_LEVEL_ID:"",USE_NEW_LOG:!1,LOG_VERSION:3,MEDIA_DEVICE_CONSTRAINTS:null,ENCRYPT_PROXY_USERNAME_AND_PSW:!0,SDP_LOGGING:!1,CSP_DETECTED_HOSTNAME_LIST:["agora.io","sd-rtn.com"],REMOTE_AUDIO_TRACK_USES_WEB_AUDIO:!1,LOCAL_AUDIO_TRACK_USES_WEB_AUDIO:!0,BITRATE_ADAPTER_TYPE:"STANDARD_BITRATE",AI_DENOISER_PARAMETERS:{},ADJUST_3A_FROM_PLUGINS:!0,RAISE_H264_BASELINE_PRIORITY:!0,FILTER_SEND_H264_BASELINE:!1,ENABLE_PUBLISHED_USER_LIST:!0,MAX_SUBSCRIPTION:50,X_GOOGLE_START_BITRATE:void 0,NEW_REPORT_SERVER:!1,NEW_REPORT_SERVER_DOMAINS:["data-reporting.agora.io","data-reporting.agora.io"],VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT:3e5,VIDEO_INSPECT_INTERVAL_MINIMUM:1e3,VIDEO_INSPECT_QUALITY_RATIO:.9,VIDEO_INSPECT_WORKER_MANAGER_HOST:"edge.agora.io",VIDEO_INSPECT_WORKER_MANAGER_PORT:"",VIDEO_INSPECT_WORKER_PORT:"",SHOW_VIDEO_INSPECT_WORKER_MESSAGE:!1,STATS_COLLECTOR_PORT:443,FORCE_TURN_TCP:!1,SUBSCRIBE_AUDIO_FILTER_TOPN:void 0,ENABLE_PUBLISH_AUDIO_FILTER:void 0,WEBAUDIO_INIT_OPTIONS:void 0,FILTER_VIDEO_FEC:!0,FILTER_AUDIO_FEC:!1,CHROME_DUAL_STREAM_USE_ENCODING:!0,EXTENSION_USAGE_UPLOAD_INTERVAL:1e4,ICE_RESTART:!0,ICE_RESTART_INTERVAL:1e4,NEW_ICE_RESTART:!1,ENABLE_USER_LICENSE_CHECK:!0,SIGNAL_CHANNEL:0,TRANSMITTER_INITIAL_RTT:30,TRANSMITTER_INITIAL_RTO:30,TRANSMITTER_MAX_BATCH_ACK_COUNT:2,TRANSMITTER_MAX_RTO:500,DATACHANNEL_COMPRESS:!1,FINGERPRINT:null,DC_JOIN_WITH_FAILBACK:5e3,ENABLE_VIDEO_FRAME_CALLBACK:!0,VIDEO_FREEZE_DURATION:500,SPATIALIZER_PARAMETERS:{},UPLOAD_LOG_INTERVAL:3e3,UPLOAD_LOG_REQUEST_RETRY_INTERVAL:2e3,UPLOAD_LOG_REQUEST_MAX_RETRY_INTERVAL:2e4,UPLOAD_LOG_TRY_INTERVAL_WHILE_OFF:5e3,UPLOAD_LOG_RETRY_INTERVAL_V1:1e4,UPLOAD_LOG_TWICE_RETRY_INTERVAL_V1:200,UPLOAD_LOG_LENGTH_EACH_TIME:10,APP_TYPE:0,DISABLE_WEBAUDIO:!1,CHANNEL_MEDIA_RELAY_SERVERS:void 0,KEEP_LAST_FRAME:!0,FORWARD_P2P_CREATION:!0,SYNC_GROUP:!0,BLOCK_LOCAL_CLIENT:!1,AP_AREA:!0,SVC:[],ENABLE_ENCODED_TRANSFORM:!1,IMAGE_MODERATION_WORKER_HOST:"edge.agora.io",IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT:3e5,IMAGE_MODERATION_INTERVAL_MINIMUM:1e3,SHOW_IMAGE_MODERATION_WORKER_MESSAGE:!1,IMAGE_MODERATION_QUALITY_RATIO:.9,IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL:5e3,ACCOUNT_REGISTER_RETRY_TIMEOUT:1,ACCOUNT_REGISTER_RETRY_RATIO:2,ACCOUNT_REGISTER_RETRY_TIMEOUT_MAX:6e4,ACCOUNT_REGISTER_RETRY_COUNT_MAX:1e5,AUDIO_CONTEXT:null,WEBCS_BACKUP_CONNECT_TIMEOUT:6e3,PLAYER_STATE_DEFER:2e3,SIGNAL_REQUEST_WATCH_INTERVAL:1e3,FILEPATH_LENMAX:255,DUALSTREAM_OPERATION_CHECK:!0,MEDIA_ELEMENT_EXISTS_DEPTH:3,SHIM_CANDIDATE:!1,LEAVE_MSG_TIMEOUT:2e3,STATS_FILTER:{transportId:!0,googTrackId:!0}},js={};function ka(e,t,n){return{sampleRate:e,stereo:t,bitrate:n}}function Fe(e,t,n,r,o){return{width:e,height:t,frameRate:n,bitrateMin:r,bitrateMax:o}}function si(e,t,n,r,o){return{width:{max:e},height:{max:t},frameRate:n,bitrateMin:r,bitrateMax:o}}function Cm(e,t){return{numSpatialLayers:e,numTemporalLayers:t}}ym||(er.WEBCS_DOMAIN=["ap-web-1-oversea.agora.io","ap-web-1-north-america.agora.io"],er.WEBCS_DOMAIN_BACKUP_LIST=["ap-web-2-oversea.agora.io","ap-web-2-north-america.agora.io"],er.PROXY_CS=["proxy-ap-web-oversea.agora.io","proxy-ap-web-america.agora.io"],er.CDS_AP=["cds-ap-web-oversea.agora.io","cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],er.ACCOUNT_REGISTER=["sua-ap-web-oversea.agora.io","sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],er.UAP_AP=["uap-ap-web-oversea.agora.io","uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],er.LOG_UPLOAD_SERVER="logservice-oversea.agora.io",er.EVENT_REPORT_DOMAIN="statscollector-1-oversea.agora.io",er.EVENT_REPORT_BACKUP_DOMAIN="statscollector-2-oversea.agora.io",er.PROXY_SERVER_TYPE3="webrtc-cloud-proxy.agora.io",er.AREAS=["NORTH_AMERICA","OVERSEA"]);const aV=[[0,1,2,3,4,5,5],[0,2,2,3,4,5,5],[0,3,3,3,4,5,5],[0,4,4,4,4,5,5],[0,5,5,5,5,5,5]],Bs=[],Xc=[];function Gs(e,t){return!!t&&Bs.some(n=>n.uid===e&&n.channelName===t)}var cV=Sl,dV=Ai,lV=Fr,Im=function(e,t,n){var r=cV(t);r in e?dV.f(e,r,lV(0,n)):e[r]=n},gR=qp,uV=xo,hV=Im,pV=W.Array,fV=Math.max,SR=function(e,t,n){for(var r=uV(e),o=gR(t,r),a=gR(n===void 0?r:n,r),d=pV(fV(a-o,0)),u=0;o<a;o++,u++)hV(d,u,e[o]);return d.length=u,d},TR=SR,mV=Math.floor,Am=function(e,t){var n=e.length,r=mV(n/2);return n<8?EV(e,t):_V(e,Am(TR(e,0,r),t),Am(TR(e,r),t),t)},EV=function(e,t){for(var n,r,o=e.length,a=1;a<o;){for(r=a,n=e[a];r&&t(e[r-1],n)>0;)e[r]=e[--r];r!==a++&&(e[r]=n)}return e},_V=function(e,t,n,r){for(var o=t.length,a=n.length,d=0,u=0;d<o||u<a;)e[d+u]=d<o&&u<a?r(t[d],n[u])<=0?t[d++]:n[u++]:d<o?t[d++]:n[u++];return e},gV=Am,vR=Ns.match(/firefox\/(\d+)/i),SV=!!vR&&+vR[1],TV=/MSIE|Trident/.test(Ns),yR=Ns.match(/AppleWebKit\/(\d+)\./),vV=!!yR&&+yR[1],yV=Wn,RR=F,RV=co,CV=Uo,IV=xo,CR=ga,Om=p,AV=gV,OV=Wp,IR=SV,wV=TV,AR=fa,OR=vV,Wo=[],wR=RR(Wo.sort),NV=RR(Wo.push),bV=Om(function(){Wo.sort(void 0)}),DV=Om(function(){Wo.sort(null)}),PV=OV("sort"),NR=!Om(function(){if(AR)return AR<70;if(!(IR&&IR>3)){if(wV)return!0;if(OR)return OR<603;var e,t,n,r,o="";for(e=65;e<76;e++){switch(t=String.fromCharCode(e),e){case 66:case 69:case 70:case 72:n=3;break;case 68:case 71:n=4;break;default:n=2}for(r=0;r<47;r++)Wo.push({k:t+r,v:n})}for(Wo.sort(function(a,d){return d.v-a.v}),r=0;r<Wo.length;r++)t=Wo[r].k.charAt(0),o.charAt(o.length-1)!==t&&(o+=t);return o!=="DGBEFHACIJK"}});yV({target:"Array",proto:!0,forced:bV||!DV||!PV||!NR},{sort:function(e){e!==void 0&&RV(e);var t=CV(this);if(NR)return e===void 0?wR(t):wR(t,e);var n,r,o=[],a=IV(t);for(r=0;r<a;r++)r in t&&NV(o,t[r]);for(AV(o,function(d){return function(u,h){return h===void 0?-1:u===void 0?1:d!==void 0?+d(u,h)||0:CR(u)>CR(h)?1:-1}}(e)),n=o.length,r=0;r<n;)t[r]=o[r++];for(;r<a;)delete t[r++];return t}});var LV=Vo("Array").sort,kV=H,MV=LV,wm=Array.prototype,Nm=function(e){var t=e.sort;return e===wm||kV(wm,e)&&t===wm.sort?MV:t};function Ma(e,t){if(typeof e!="boolean")throw new b(I.INVALID_PARAMS,"Invalid ".concat(t,": The value is of the boolean type."))}function tn(e,t,n){if(!n.includes(e))throw new b(I.INVALID_PARAMS,"".concat(t," can only be set as ").concat(JSON.stringify(n)))}function st(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:1e4,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e<n||e>r||o&&!UV(e))throw new b(I.INVALID_PARAMS,"invalid ".concat(t,": the value range is [").concat(n,", ").concat(r,"]. integer only"))}function bm(e,t){if(typeof e!="number"){if(!(e.min||e.max||e.ideal||e.exact))throw new b(I.INVALID_PARAMS,"".concat(t," is not a valid ConstrainLong"));e.min!==void 0&&st(e.min,"".concat(t,".min"),0,1/0),e.max!==void 0&&st(e.max,"".concat(t,".max"),1,1/0),e.exact!==void 0&&st(e.exact,"".concat(t,".exact"),1,1/0),e.ideal!==void 0&&st(e.ideal,"".concat(t,".ideal"),1,1/0)}else st(e,t,1,1/0)}function _n(e,t){let n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:1,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:255,o=!(arguments.length>4&&arguments[4]!==void 0)||arguments[4];if(e==null)throw new b(I.INVALID_PARAMS,"".concat(t||"param"," cannot be empty"));if(!bR(e,n,r,o))throw new b(I.INVALID_PARAMS,"Invalid ".concat(t||"string param",": Length of the string: [").concat(n,",").concat(r,"].").concat(o?" ASCII characters only.":""))}function fo(e,t){if(!Array.isArray(e))throw new b(I.INVALID_PARAMS,"".concat(t," should be an array"))}function Dm(e){if(typeof e!="string"||!/^[a-zA-Z0-9 \!\#\$\%\&\(\)\+\-\:\;\<\=\.\>\?\@\[\]\^\_\{\}\|\~\,]{1,64}$/.test(e))throw v.error("Invalid Channel Name ".concat(e)),new b(I.INVALID_PARAMS,"The length must be within 64 bytes. The supported characters: a-z,A-Z,0-9,space,!, #, $, %, &, (, ), +, -, :, ;, <, =, ., >, ?, @, [, ], ^, _,  {, }, |, ~, ,")}function Pm(e){if(t=e,!(typeof t=="number"&&Math.floor(t)===t&&0<=t&&t<=4294967295||bR(e,1,255)))throw v.error("Invalid UID ".concat(e," ").concat(typeof e)),new b(I.INVALID_PARAMS,"[String uid] Length of the string: [1,255]. ASCII characters only. [Number uid] The value range is [0,10000]");var t;typeof e=="string"&&v.warning("You input a string as the user ID, to ensure better end-user experience, Agora highly suggests not using a string as the user ID.")}function ht(e){return e==null}function bR(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:255,r=!(arguments.length>3&&arguments[3]!==void 0)||arguments[3];return typeof e=="string"&&e.length<=n&&e.length>=t&&(!r||xV(e))}function UV(e){return typeof e=="number"&&e%1==0}function xV(e){if(typeof e!="string")return!1;for(let t=0;t<e.length;t+=1){const n=e.charCodeAt(t);if(n<0||n>255)return!1}return!0}let DR,PR,gn;(function(e){e.FREE="free",e.UPLOADING="uploading"})(DR||(DR={})),function(e){e[e.MISC=0]="MISC",e[e.INTERNAL_EVENT=1]="INTERNAL_EVENT",e[e.PUBLIC_EVENT=2]="PUBLIC_EVENT",e[e.WEB_EVENT=3]="WEB_EVENT",e[e.INTERNAL_API=4]="INTERNAL_API",e[e.WEB_API=5]="WEB_API",e[e.PUBLIC_API=6]="PUBLIC_API"}(PR||(PR={})),function(e){e.NONE="none",e.INIT="init",e.CANPLAY="canplay",e.PLAYING="playing",e.PAUSED="paused",e.SUSPEND="suspend",e.STALLED="stalled",e.WAITING="waiting",e.ERROR="error",e.DESTROYED="destroyed",e.ABORT="abort",e.ENDED="ended",e.EMPTIED="emptied",e.LOADEDDATA="loadeddata"}(gn||(gn={}));const Lm={uninit:100,none:110,init:120,loadeddata:130,canplay:200,playing:210,paused:220,suspend:300,stalled:310,waiting:320,error:330,destroyed:340,abort:350,ended:360,emptied:370};function VV(e){return _n(e.reportId,"params.reportId",0,100,!1),_n(e.category,"params.category",0,100,!1),_n(e.event,"params.event",0,100,!1),_n(e.label,"params.label",0,100,!1),st(e.value,"params.value",Number.MIN_SAFE_INTEGER,Number.MAX_SAFE_INTEGER,!1),!0}const FV={sid:"",lts:0,success:null,cname:null,uid:null,peer:null,cid:null,elapse:null,extend:null,vid:0};let cn,St,LR,km,Mt,Et,Ho,mo,Ua,Qc,Ir,Sn,ve,Mm,Je,Me,Kn,et,Ee,ye,pr,Pe,kR,tr;function MR(e){return st(e.timeout,"config.timeout",0,1e5),st(e.timeoutFactor,"config.timeoutFactor",0,100,!1),st(e.maxRetryCount,"config.maxRetryConfig",0,1/0),st(e.maxRetryTimeout,"config.maxRetryTimeout",0,1/0),!0}function jV(e){return tn(e.codec,"config.codec",["vp8","vp9","av1","h264","h265"]),tn(e.mode,"config.mode",["rtc","live"]),e.audioCodec!==void 0&&tn(e.audioCodec,"config.audioCodec",["opus","pcmu","pcma","g722"]),e.proxyServer!==void 0&&_n(e.proxyServer,"config.proxyServer",1,1e4),e.turnServer!==void 0&&UR(e.turnServer),e.httpRetryConfig!==void 0&&MR(e.httpRetryConfig),e.websocketRetryConfig!==void 0&&MR(e.websocketRetryConfig),!0}function $c(e){if(!Array.isArray(e)||e.length<1)return!1;try{e.forEach(t=>{if(!t.urls)throw Error()})}catch{return!1}return!0}function UR(e){return _n(e.turnServerURL,"turnServerURL"),_n(e.username,"username"),_n(e.password,"password"),e.udpport&&st(e.udpport,"udpport",1,99999,!0),e.forceturn&&Ma(e.forceturn,"forceturn"),e.security&&Ma(e.security,"security"),e.tcpport&&st(e.tcpport,"tcpport",1,99999,!0),!0}function xR(e){return e.level!==void 0&&tn(e.level,"level",[1,2,3]),!0}(function(e){e.PUBLISH="publish",e.SUBSCRIBE="subscribe",e.WS_COMPRESSOR_INIT="ws_compressor_init",e.SESSION_INIT="session_init",e.JOIN_CHOOSE_SERVER="join_choose_server",e.REQ_USER_ACCOUNT="req_user_account",e.JOIN_GATEWAY="join_gateway",e.REJOIN_GATEWAY="rejoin_gateway",e.STREAM_SWITCH="stream_switch",e.REQUEST_PROXY_WORKER_MANAGER="request_proxy_worker_manager",e.REQUEST_PROXY_APPCENTER="request_proxy_appcenter",e.FIRST_VIDEO_RECEIVED="first_video_received",e.FIRST_AUDIO_RECEIVED="first_audio_received",e.FIRST_VIDEO_DECODE="first_video_decode",e.FIRST_AUDIO_DECODE="first_audio_decode",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_UPDATE_STREAM="on_update_stream",e.ON_REMOVE_STREAM="on_remove_stream",e.USER_ANALYTICS="req_user_analytics",e.PC_STATS="pc_stats"})(cn||(cn={})),function(e){e.SESSION="io.agora.pb.Wrtc.Session",e.JOIN_CHOOSE_SERVER="io.agora.pb.Wrtc.JoinChooseServer",e.REQ_USER_ACCOUNT="io.agora.pb.Wrtc.ReqUserAccount",e.JOIN_GATEWAY="io.agora.pb.Wrtc.JoinGateway",e.RE_JOIN_GATEWAY="io.agora.pb.Wrtc.ReJoinGateway",e.PUBLISH="io.agora.pb.Wrtc.Publish",e.SUBSCRIBE="io.agora.pb.Wrtc.Subscribe",e.WS_COMPRESSOR_INIT="io.agora.pb.Wrtc.WsCompressorInit",e.STREAM_SWITCH="io.agora.pb.Wrtc.StreamSwitch",e.AUDIO_SENDING_STOPPED="io.agora.pb.Wrtc.AudioSendingStopped",e.VIDEO_SENDING_STOPPED="io.agora.pb.Wrtc.VideoSendingStopped",e.REQUEST_PROXY_APPCENTER="io.agora.pb.Wrtc.RequestProxyAppCenter",e.REQUEST_PROXY_WORKER_MANAGER="io.agora.pb.Wrtc.RequestProxyWorkerManager",e.API_INVOKE="io.agora.pb.Wrtc.ApiInvoke",e.FIRST_VIDEO_RECEIVED="io.agora.pb.Wrtc.FirstVideoReceived",e.FIRST_AUDIO_RECEIVED="io.agora.pb.Wrtc.FirstAudioReceived",e.FIRST_VIDEO_DECODE="io.agora.pb.Wrtc.FirstVideoDecode",e.FIRST_AUDIO_DECODE="io.agora.pb.Wrtc.FirstAudioDecode",e.ON_ADD_AUDIO_STREAM="io.agora.pb.Wrtc.OnAddAudioStream",e.ON_ADD_VIDEO_STREAM="io.agora.pb.Wrtc.OnAddVideoStream",e.ON_UPDATE_STREAM="io.agora.pb.Wrtc.OnUpdateStream",e.ON_REMOVE_STREAM="io.agora.pb.Wrtc.OnRemoveStream",e.JOIN_CHANNEL_TIMEOUT="io.agora.pb.Wrtc.JoinChannelTimeout",e.PEER_PUBLISH_STATUS="io.agora.pb.Wrtc.PeerPublishStatus",e.WORKER_EVENT="io.agora.pb.Wrtc.WorkerEvent",e.AP_WORKER_EVENT="io.agora.pb.Wrtc.APWorkerEvent",e.JOIN_WEB_PROXY_AP="io.agora.pb.Wrtc.JoinWebProxyAP",e.WEBSOCKET_QUIT="io.agora.pb.Wrtc.WebSocketQuit",e.USER_ANALYTICS="io.agora.pb.Wrtc.UserAnalytics",e.AUTOPLAY_FAILED="io.agora.pb.Wrtc.AutoplayFailed",e.PC_STATS="io.agora.pb.Wrtc.PCStats"}(St||(St={})),function(e){e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT"}(LR||(LR={})),function(e){e[e.SESSION=26]="SESSION",e[e.JOIN_CHOOSE_SERVER=27]="JOIN_CHOOSE_SERVER",e[e.REQ_USER_ACCOUNT=196]="REQ_USER_ACCOUNT",e[e.JOIN_GATEWAY=28]="JOIN_GATEWAY",e[e.PUBLISH=30]="PUBLISH",e[e.SUBSCRIBE=29]="SUBSCRIBE",e[e.WS_COMPRESSOR_INIT=9430]="WS_COMPRESSOR_INIT",e[e.STREAM_SWITCH=32]="STREAM_SWITCH",e[e.AUDIO_SENDING_STOPPED=33]="AUDIO_SENDING_STOPPED",e[e.VIDEO_SENDING_STOPPED=34]="VIDEO_SENDING_STOPPED",e[e.REQUEST_PROXY_APPCENTER=35]="REQUEST_PROXY_APPCENTER",e[e.REQUEST_PROXY_WORKER_MANAGER=36]="REQUEST_PROXY_WORKER_MANAGER",e[e.API_INVOKE=41]="API_INVOKE",e[e.FIRST_VIDEO_RECEIVED=348]="FIRST_VIDEO_RECEIVED",e[e.FIRST_AUDIO_RECEIVED=349]="FIRST_AUDIO_RECEIVED",e[e.FIRST_VIDEO_DECODE=350]="FIRST_VIDEO_DECODE",e[e.FIRST_AUDIO_DECODE=351]="FIRST_AUDIO_DECODE",e[e.ON_ADD_AUDIO_STREAM=352]="ON_ADD_AUDIO_STREAM",e[e.ON_ADD_VIDEO_STREAM=353]="ON_ADD_VIDEO_STREAM",e[e.ON_UPDATE_STREAM=356]="ON_UPDATE_STREAM",e[e.ON_REMOVE_STREAM=355]="ON_REMOVE_STREAM",e[e.JOIN_CHANNEL_TIMEOUT=407]="JOIN_CHANNEL_TIMEOUT",e[e.PEER_PUBLISH_STATUS=408]="PEER_PUBLISH_STATUS",e[e.WORKER_EVENT=156]="WORKER_EVENT",e[e.AP_WORKER_EVENT=160]="AP_WORKER_EVENT",e[e.JOIN_WEB_PROXY_AP=700]="JOIN_WEB_PROXY_AP",e[e.WEBSOCKET_QUIT=671]="WEBSOCKET_QUIT",e[e.USER_ANALYTICS=1e4]="USER_ANALYTICS",e[e.AUTOPLAY_FAILED=9178]="AUTOPLAY_FAILED"}(km||(km={})),function(e){e.CREATE_CLIENT="createClient",e.CHECK_SYSTEM_REQUIREMENTS="checkSystemRequirements",e.SET_AREA="setArea",e.CHECK_VIDEO_TRACK_IS_ACTIVE="checkVideoTrackIsActive",e.CHECK_AUDIO_TRACK_IS_ACTIVE="checkAudioTrackIsActive",e.CREATE_MIC_AUDIO_TRACK="createMicrophoneAudioTrack",e.CREATE_CUSTOM_AUDIO_TRACK="createCustomAudioTrack",e.CREATE_BUFFER_AUDIO_TRACK="createBufferSourceAudioTrack",e.CREATE_CAM_VIDEO_TRACK="createCameraVideoTrack",e.CREATE_CUSTOM_VIDEO_TRACK="createCustomVideoTrack",e.CREATE_MIC_AND_CAM_TRACKS="createMicrophoneAndCameraTracks",e.CREATE_SCREEN_VIDEO_TRACK="createScreenVideoTrack",e.SET_ENCRYPTION_CONFIG="Client.setEncryptionConfig",e.START_PROXY_SERVER="Client.startProxyServer",e.STOP_PROXY_SERVER="Client.stopProxyServer",e.SET_PROXY_SERVER="Client.setProxyServer",e.SET_TURN_SERVER="Client.setTurnServer",e.SET_CLIENT_ROLE="Client.setClientRole",e.SET_LOW_STREAM_PARAMETER="Client.setLowStreamParameter",e.ENABLE_DUAL_STREAM="Client.enableDualStream",e.DISABLE_DUAL_STREAM="Client.disableDualStream",e.JOIN="Client.join",e.LEAVE="Client.leave",e.PUBLISH="Client.publish",e.UNPUBLISH="Client.unpublish",e.SUBSCRIBE="Client.subscribe",e.MASS_SUBSCRIBE="Client.massSubscribe",e.MASS_UNSUBSCRIBE="Client.massUnsubscribe",e.UNSUBSCRIBE="Client.unsubscribe",e.RENEW_TOKEN="Client.renewToken",e.SET_REMOTE_VIDEO_STREAM_TYPE="Client.setRemoteVideoStreamType",e.SET_STREAM_FALLBACK_OPTION="Client.setStreamFallbackOption",e.ENABLE_AUDIO_VOLUME_INDICATOR="Client.enableAudioVolumeIndicator",e.SEND_CUSTOM_REPORT_MESSAGE="Client.sendCustomReportMessage",e.INSPECT_VIDEO_CONTENT="Client.inspectVideoContent",e.STOP_INSPECT_VIDEO_CONTENT="Client.stopInspectVideoContent",e.JOIN_FALLBACK_TO_PROXY="Client._joinFallbackToProxy",e.DATACHANNEL_FAILBACK="Client._datachannelFailback",e.ON_LIVE_STREAM_WARNING="Client.onLiveStreamWarning",e.ON_LIVE_STREAM_ERROR="Client.onLiveStreamingError",e.START_LIVE_STREAMING="Client.startLiveStreaming",e.SET_LIVE_TRANSCODING="Client.setLiveTranscoding",e.STOP_LIVE_STREAMING="Client.stopLiveStreaming",e.ADD_INJECT_STREAM_URL="Client.addInjectStreamUrl",e.REMOVE_INJECT_STREAM_URL="Client.removeInjectStreamUrl",e.START_CHANNEL_MEDIA_RELAY="Client.startChannelMediaRelay",e.UPDATE_CHANNEL_MEDIA_RELAY="Client.updateChannelMediaRelay",e.STOP_CHANNEL_MEDIA_RELAY="Client.stopChannelMediaRelay",e.REQUEST_CONFIG_DISTRIBUTE="_config-distribute-request",e.SET_CONFIG_DISTRIBUTE="_configDistribute",e.LOCAL_TRACK_SET_MUTED="LocalTrack.setMute",e.LOCAL_AUDIO_TRACK_PLAY="LocalAudioTrack.play",e.LOCAL_AUDIO_TRACK_PLAY_IN_ELEMENT="LocalAudioTrack.playInElement",e.LOCAL_AUDIO_TRACK_STOP="LocalAudioTrack.stop",e.LOCAL_AUDIO_TRACK_SET_VOLUME="LocalAudioTrack.setVolume",e.MIC_AUDIO_TRACK_SET_DEVICE="MicrophoneAudioTrack.setDevice",e.BUFFER_AUDIO_TRACK_START="BufferSourceAudioTrack.startProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_STOP="BufferSourceAudioTrack.stopProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_PAUSE="BufferSourceAudioTrack.pauseProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_RESUME="BufferSourceAudioTrack.resumeProcessAudioBuffer",e.BUFFER_AUDIO_TRACK_SEEK="BufferSourceAudioTrack.seekAudioBuffer",e.LOCAL_VIDEO_TRACK_PLAY="LocalVideoTrack.play",e.LOCAL_VIDEO_TRACK_STOP="LocalVideoTrack.stop",e.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE="LocalVideoTrack.getVideoElementVisibleStatus",e.LOCAL_VIDEO_TRACK_BEAUTY="LocalVideoTrack.setBeautyEffect",e.CAM_VIDEO_TRACK_SET_DEVICE="CameraVideoTrack.setDevice",e.CAM_VIDEO_TRACK_SET_ENCODER_CONFIG="CameraVideoTrack.setEncoderConfiguration",e.REMOTE_VIDEO_TRACK_PLAY="RemoteVideoTrack.play",e.REMOTE_VIDEO_TRACK_STOP="RemoteVideoTrack.stop",e.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE="RemoteVideoTrack.getVideoElementVisibleStatus",e.REMOTE_AUDIO_TRACK_PLAY="RemoteAudioTrack.play",e.REMOTE_AUDIO_TRACK_STOP="RemoteAudioTrack.stop",e.REMOTE_AUDIO_SET_VOLUME="RemoteAudioTrack.setVolume",e.REMOTE_AUDIO_SET_OUTPUT_DEVICE="RemoteAudioTrack.setOutputDevice",e.GET_MEDIA_STREAM_TRACK="Track.getMediaStreamTrack",e.STREAM_TYPE_CHANGE="streamTypeChange",e.CONNECTION_STATE_CHANGE="connectionStateChange",e.LOAD_CONFIG_FROM_LOCALSTORAGE="loadConfigFromLocalStorage",e.IMAGE_MODERATION_UPLOAD="imageModerationUpload"}(Mt||(Mt={})),function(e){e.TRACER="tracer"}(Et||(Et={})),function(e){e.IDLE="IDLE",e.INITING="INITING",e.INITEND="INITEND"}(Ho||(Ho={})),function(e){e.STATE_CHANGE="state_change",e.RECORDING_DEVICE_CHANGED="recordingDeviceChanged",e.PLAYOUT_DEVICE_CHANGED="playoutDeviceChanged",e.CAMERA_DEVICE_CHANGED="cameraDeviceChanged"}(mo||(mo={})),function(e){e[e.ACCESS_POINT=101]="ACCESS_POINT",e[e.UNILBS=201]="UNILBS",e[e.STRING_UID_ALLOCATOR=901]="STRING_UID_ALLOCATOR"}(Ua||(Ua={})),function(e){e[e.IIIEGAL_APPID=1]="IIIEGAL_APPID",e[e.IIIEGAL_UID=2]="IIIEGAL_UID",e[e.INTERNAL_ERROR=3]="INTERNAL_ERROR"}(Qc||(Qc={})),function(e){e[e.INVALID_VENDOR_KEY=5]="INVALID_VENDOR_KEY",e[e.INVALID_CHANNEL_NAME=7]="INVALID_CHANNEL_NAME",e[e.INTERNAL_ERROR=8]="INTERNAL_ERROR",e[e.NO_AUTHORIZED=9]="NO_AUTHORIZED",e[e.DYNAMIC_KEY_TIMEOUT=10]="DYNAMIC_KEY_TIMEOUT",e[e.NO_ACTIVE_STATUS=11]="NO_ACTIVE_STATUS",e[e.DYNAMIC_KEY_EXPIRED=13]="DYNAMIC_KEY_EXPIRED",e[e.STATIC_USE_DYNAMIC_KEY=14]="STATIC_USE_DYNAMIC_KEY",e[e.DYNAMIC_USE_STATIC_KEY=15]="DYNAMIC_USE_STATIC_KEY",e[e.USER_OVERLOAD=16]="USER_OVERLOAD",e[e.FORBIDDEN_REGION=18]="FORBIDDEN_REGION",e[e.CANNOT_MEET_AREA_DEMAND=19]="CANNOT_MEET_AREA_DEMAND"}(Ir||(Ir={})),function(e){e[e.NO_FLAG_SET=100]="NO_FLAG_SET",e[e.FLAG_SET_BUT_EMPTY=101]="FLAG_SET_BUT_EMPTY",e[e.INVALID_FALG_SET=102]="INVALID_FALG_SET",e[e.FLAG_SET_BUT_NO_RE=103]="FLAG_SET_BUT_NO_RE",e[e.INVALID_SERVICE_ID=104]="INVALID_SERVICE_ID",e[e.NO_SERVICE_AVAILABLE=200]="NO_SERVICE_AVAILABLE",e[e.NO_SERVICE_AVAILABLE_P2P=201]="NO_SERVICE_AVAILABLE_P2P",e[e.NO_SERVICE_AVAILABLE_VOICE=202]="NO_SERVICE_AVAILABLE_VOICE",e[e.NO_SERVICE_AVAILABLE_WEBRTC=203]="NO_SERVICE_AVAILABLE_WEBRTC",e[e.NO_SERVICE_AVAILABLE_CDS=204]="NO_SERVICE_AVAILABLE_CDS",e[e.NO_SERVICE_AVAILABLE_CDN=205]="NO_SERVICE_AVAILABLE_CDN",e[e.NO_SERVICE_AVAILABLE_TDS=206]="NO_SERVICE_AVAILABLE_TDS",e[e.NO_SERVICE_AVAILABLE_REPORT=207]="NO_SERVICE_AVAILABLE_REPORT",e[e.NO_SERVICE_AVAILABLE_APP_CENTER=208]="NO_SERVICE_AVAILABLE_APP_CENTER",e[e.NO_SERVICE_AVAILABLE_ENV0=209]="NO_SERVICE_AVAILABLE_ENV0",e[e.NO_SERVICE_AVAILABLE_VOET=210]="NO_SERVICE_AVAILABLE_VOET",e[e.NO_SERVICE_AVAILABLE_STRING_UID=211]="NO_SERVICE_AVAILABLE_STRING_UID",e[e.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS=212]="NO_SERVICE_AVAILABLE_WEBRTC_UNILBS",e[e.NO_SERVICE_AVAILABLE_UNILBS_FLV=213]="NO_SERVICE_AVAILABLE_UNILBS_FLV"}(Sn||(Sn={})),function(e){e[e.K_TIMESTAMP_EXPIRED=2]="K_TIMESTAMP_EXPIRED",e[e.K_CHANNEL_PERMISSION_INVALID=3]="K_CHANNEL_PERMISSION_INVALID",e[e.K_CERTIFICATE_INVALID=4]="K_CERTIFICATE_INVALID",e[e.K_CHANNEL_NAME_EMPTY=5]="K_CHANNEL_NAME_EMPTY",e[e.K_CHANNEL_NOT_FOUND=6]="K_CHANNEL_NOT_FOUND",e[e.K_TICKET_INVALID=7]="K_TICKET_INVALID",e[e.K_CHANNEL_CONFLICTED=8]="K_CHANNEL_CONFLICTED",e[e.K_SERVICE_NOT_READY=9]="K_SERVICE_NOT_READY",e[e.K_SERVICE_TOO_HEAVY=10]="K_SERVICE_TOO_HEAVY",e[e.K_UID_BANNED=14]="K_UID_BANNED",e[e.K_IP_BANNED=15]="K_IP_BANNED",e[e.K_CHANNEL_BANNED=16]="K_CHANNEL_BANNED",e[e.WARN_NO_AVAILABLE_CHANNEL=103]="WARN_NO_AVAILABLE_CHANNEL",e[e.WARN_LOOKUP_CHANNEL_TIMEOUT=104]="WARN_LOOKUP_CHANNEL_TIMEOUT",e[e.WARN_LOOKUP_CHANNEL_REJECTED=105]="WARN_LOOKUP_CHANNEL_REJECTED",e[e.WARN_OPEN_CHANNEL_TIMEOUT=106]="WARN_OPEN_CHANNEL_TIMEOUT",e[e.WARN_OPEN_CHANNEL_REJECTED=107]="WARN_OPEN_CHANNEL_REJECTED",e[e.WARN_REQUEST_DEFERRED=108]="WARN_REQUEST_DEFERRED",e[e.ERR_DYNAMIC_KEY_TIMEOUT=109]="ERR_DYNAMIC_KEY_TIMEOUT",e[e.ERR_NO_AUTHORIZED=110]="ERR_NO_AUTHORIZED",e[e.ERR_VOM_SERVICE_UNAVAILABLE=111]="ERR_VOM_SERVICE_UNAVAILABLE",e[e.ERR_NO_CHANNEL_AVAILABLE_CODE=112]="ERR_NO_CHANNEL_AVAILABLE_CODE",e[e.ERR_MASTER_VOCS_UNAVAILABLE=114]="ERR_MASTER_VOCS_UNAVAILABLE",e[e.ERR_INTERNAL_ERROR=115]="ERR_INTERNAL_ERROR",e[e.ERR_NO_ACTIVE_STATUS=116]="ERR_NO_ACTIVE_STATUS",e[e.ERR_INVALID_UID=117]="ERR_INVALID_UID",e[e.ERR_DYNAMIC_KEY_EXPIRED=118]="ERR_DYNAMIC_KEY_EXPIRED",e[e.ERR_STATIC_USE_DYANMIC_KE=119]="ERR_STATIC_USE_DYANMIC_KE",e[e.ERR_DYNAMIC_USE_STATIC_KE=120]="ERR_DYNAMIC_USE_STATIC_KE",e[e.ERR_NO_VOCS_AVAILABLE=2e3]="ERR_NO_VOCS_AVAILABLE",e[e.ERR_NO_VOS_AVAILABLE=2001]="ERR_NO_VOS_AVAILABLE",e[e.ERR_JOIN_CHANNEL_TIMEOUT=2002]="ERR_JOIN_CHANNEL_TIMEOUT",e[e.ERR_REPEAT_JOIN_CHANNEL=2003]="ERR_REPEAT_JOIN_CHANNEL",e[e.ERR_JOIN_BY_MULTI_IP=2004]="ERR_JOIN_BY_MULTI_IP",e[e.ERR_NOT_JOINED=2011]="ERR_NOT_JOINED",e[e.ERR_REPEAT_JOIN_REQUEST=2012]="ERR_REPEAT_JOIN_REQUEST",e[e.ERR_INVALID_VENDOR_KEY=2013]="ERR_INVALID_VENDOR_KEY",e[e.ERR_INVALID_CHANNEL_NAME=2014]="ERR_INVALID_CHANNEL_NAME",e[e.ERR_INVALID_STRINGUID=2015]="ERR_INVALID_STRINGUID",e[e.ERR_TOO_MANY_USERS=2016]="ERR_TOO_MANY_USERS",e[e.ERR_SET_CLIENT_ROLE_TIMEOUT=2017]="ERR_SET_CLIENT_ROLE_TIMEOUT",e[e.ERR_SET_CLIENT_ROLE_NO_PERMISSION=2018]="ERR_SET_CLIENT_ROLE_NO_PERMISSION",e[e.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE=2019]="ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",e[e.ERR_PUBLISH_REQUEST_INVALID=2020]="ERR_PUBLISH_REQUEST_INVALID",e[e.ERR_SUBSCRIBE_REQUEST_INVALID=2021]="ERR_SUBSCRIBE_REQUEST_INVALID",e[e.ERR_NOT_SUPPORTED_MESSAGE=2022]="ERR_NOT_SUPPORTED_MESSAGE",e[e.ERR_ILLEAGAL_PLUGIN=2023]="ERR_ILLEAGAL_PLUGIN",e[e.ERR_REJOIN_TOKEN_INVALID=2024]="ERR_REJOIN_TOKEN_INVALID",e[e.ERR_REJOIN_USER_NOT_JOINED=2025]="ERR_REJOIN_USER_NOT_JOINED",e[e.ERR_INVALID_OPTIONAL_INFO=2027]="ERR_INVALID_OPTIONAL_INFO",e[e.ILLEGAL_AES_PASSWORD=2028]="ILLEGAL_AES_PASSWORD",e[e.ILLEGAL_CLIENT_ROLE_LEVEL=2029]="ILLEGAL_CLIENT_ROLE_LEVEL",e[e.ERR_TOO_MANY_BROADCASTERS=2031]="ERR_TOO_MANY_BROADCASTERS",e[e.ERR_TOO_MANY_SUBSCRIBERS=2032]="ERR_TOO_MANY_SUBSCRIBERS",e[e.ERR_LICENSE_MISSING=32769]="ERR_LICENSE_MISSING",e[e.ERR_LICENSE_EXPIRED=32771]="ERR_LICENSE_EXPIRED",e[e.ERR_LICENSE_MINUTES_EXCEEDED=32773]="ERR_LICENSE_MINUTES_EXCEEDED",e[e.ERR_LICENSE_PERIOD_INVALID=32774]="ERR_LICENSE_PERIOD_INVALID",e[e.ERR_LICENSE_MULTIPLE_SDK_SERVICE=32778]="ERR_LICENSE_MULTIPLE_SDK_SERVICE",e[e.ERR_LICENSE_ILLEGAL=32783]="ERR_LICENSE_ILLEGAL",e[e.ERR_TEST_RECOVER=9e3]="ERR_TEST_RECOVER",e[e.ERR_TEST_TRYNEXT=9001]="ERR_TEST_TRYNEXT",e[e.ERR_TEST_RETRY=9002]="ERR_TEST_RETRY"}(ve||(ve={})),function(e){e[e.AUDIENCE_LEVEL_LOW_LATENCY=1]="AUDIENCE_LEVEL_LOW_LATENCY",e[e.AUDIENCE_LEVEL_ULTRA_LOW_LATENCY=2]="AUDIENCE_LEVEL_ULTRA_LOW_LATENCY",e[e.AUDIENCE_LEVEL_SYNC_LATENCY=3]="AUDIENCE_LEVEL_SYNC_LATENCY"}(Mm||(Mm={})),function(e){e.LEAVE="LEAVE",e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.UID_BANNED="UID_BANNED",e.IP_BANNED="IP_BANNED",e.CHANNEL_BANNED="CHANNEL_BANNED",e.FALLBACK="FALLBACK",e.LICENSE_MISSING="LICENSE_MISSING",e.LICENSE_EXPIRED="LICENSE_EXPIRED",e.LICENSE_MINUTES_EXCEEDED="LICENSE_MINUTES_EXCEEDED",e.LICENSE_PERIOD_INVALID="LICENSE_PERIOD_INVALID",e.LICENSE_MULTIPLE_SDK_SERVICE="LICENSE_MULTIPLE_SDK_SERVICE",e.LICENSE_ILLEGAL="LICENSE_ILLEGAL"}(Je||(Je={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.MEDIA_RECONNECT_START="media-reconnect-start",e.MEDIA_RECONNECT_END="media-reconnect-end",e.IS_USING_CLOUD_PROXY="is-using-cloud-proxy",e.USER_JOINED="user-joined",e.USER_LEAVED="user-left",e.USER_PUBLISHED="user-published",e.USER_UNPUBLISHED="user-unpublished",e.USER_INFO_UPDATED="user-info-updated",e.CLIENT_BANNED="client-banned",e.CHANNEL_MEDIA_RELAY_STATE="channel-media-relay-state",e.CHANNEL_MEDIA_RELAY_EVENT="channel-media-relay-event",e.VOLUME_INDICATOR="volume-indicator",e.CRYPT_ERROR="crypt-error",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="token-privilege-will-expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="token-privilege-did-expire",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGED="stream-type-changed",e.STREAM_FALLBACK="stream-fallback",e.RECEIVE_METADATA="receive-metadata",e.STREAM_MESSAGE="stream-message",e.LIVE_STREAMING_ERROR="live-streaming-error",e.LIVE_STREAMING_WARNING="live-streaming-warning",e.INJECT_STREAM_STATUS="stream-inject-status",e.EXCEPTION="exception",e.ERROR="error",e.P2P_LOST="p2p_lost",e.JOIN_FALLBACK_TO_PROXY="join-fallback-to-proxy",e.CHANNEL_FALLBACK_TO_WEBSOCKET="channel-fallback-to-websocket",e.MEDIA_CONNECTION_TYPE_CHANGE="media-connection-type-change",e.PUBLISHED_USER_LIST="published-user-list",e.CONTENT_INSPECT_CONNECTION_STATE_CHANGE="content-inspect-connection-state-change",e.CONTENT_INSPECT_ERROR="content-inspect-error",e.CONTENT_INSPECT_RESULT="content-inspect-result",e.IMAGE_MODERATION_CONNECTION_STATE_CHANGE="image-moderation-connection-state-change"}(Me||(Me={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Kn||(Kn={})),function(e){e.CONNECTING="connecting",e.CONNECTED="connected",e.RECONNECTING="reconnecting",e.CLOSED="closed"}(et||(et={})),function(e){e.WS_CONNECTED="ws_connected",e.WS_RECONNECTING="ws_reconnecting",e.WS_CLOSED="ws_closed",e.WS_RECONNECT_WAITTING_FINISH="ws_reconnect_waitting_finish",e.WS_RECONNECT_CREATE_CONNECTION="ws_reconnect_create_connection",e.ON_BINARY_DATA="on_binary_data",e.REQUEST_RECOVER="request_recover",e.REQUEST_JOIN_INFO="request_join_info",e.REQUEST_REJOIN_INFO="req_rejoin_info",e.IS_P2P_DISCONNECTED="is_p2p_dis",e.DISCONNECT_P2P="dis_p2p",e.ABORT_P2P_EXECUTION="abort_p2p_execution",e.NEED_RENEW_SESSION="need-sid",e.REPORT_JOIN_GATEWAY="report_join_gateway",e.REQUEST_TIMEOUT="request_timeout",e.REQUEST_SUCCESS="request_success",e.JOIN_RESPONSE="join_response",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_CONNECTING="datachannel_connecting",e.DATACHANNEL_FAILBACK="datachannel_failback"}(Ee||(Ee={})),function(e){e.PING="ping",e.PING_BACK="ping_back",e.JOIN="join_v3",e.REJOIN="rejoin_v3",e.LEAVE="leave",e.SET_CLIENT_ROLE="set_client_role",e.PUBLISH="publish",e.UNPUBLISH="unpublish",e.SUBSCRIBE="subscribe",e.SUBSCRIBE_STREAMS="subscribe_streams",e.UNSUBSCRIBE="unsubscribe",e.UNSUBSCRIBE_STREAMS="unsubscribe_streams",e.SUBSCRIBE_CHANGE="subscribe_change",e.TRAFFIC_STATS="traffic_stats",e.RENEW_TOKEN="renew_token",e.SWITCH_VIDEO_STREAM="switch_video_stream",e.DEFAULT_VIDEO_STREAM="default_video_stream",e.SET_FALLBACK_OPTION="set_fallback_option",e.GATEWAY_INFO="gateway_info",e.CONTROL="control",e.SEND_METADATA="send_metadata",e.DATA_STREAM="data_stream",e.PICK_SVC_LAYER="pick_svc_layer",e.RESTART_ICE="restart_ice",e.CONNECT_PC="connect_pc",e.SET_VIDEO_PROFILE="set_video_profile",e.SET_PARAMETER="set_parameter"}(ye||(ye={})),function(e){e.PUBLISH_STATS="publish_stats",e.PUBLISH_RELATED_STATS="publish_related_stats",e.SUBSCRIBE_STATS="subscribe_stats",e.SUBSCRIBE_RELATED_STATS="subscribe_related_stats",e.WS_INFLATE_DATA_LENGTH="ws_inflate_data_length",e.DENOISER_STATS="denoiser_stats",e.TRANSPORT_STATS="transport_stats",e.EXTENSION_USAGE_STATS="extension_usage_stats"}(pr||(pr={})),function(e){e.ON_USER_ONLINE="on_user_online",e.ON_USER_OFFLINE="on_user_offline",e.ON_STREAM_FALLBACK_UPDATE="on_stream_fallback_update",e.ON_PUBLISH_STREAM="on_publish_stream",e.ON_UPLINK_STATS="on_uplink_stats",e.ON_P2P_LOST="on_p2p_lost",e.ON_REMOVE_STREAM="on_remove_stream",e.ON_ADD_AUDIO_STREAM="on_add_audio_stream",e.ON_ADD_VIDEO_STREAM="on_add_video_stream",e.ON_TOKEN_PRIVILEGE_WILL_EXPIRE="on_token_privilege_will_expire",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="on_token_privilege_did_expire",e.ON_USER_BANNED="on_user_banned",e.ON_USER_LICENSE_BANNED="on_user_license_banned",e.ON_NOTIFICATION="on_notification",e.ON_CRYPT_ERROR="on_crypt_error",e.MUTE_AUDIO="mute_audio",e.MUTE_VIDEO="mute_video",e.UNMUTE_AUDIO="unmute_audio",e.UNMUTE_VIDEO="unmute_video",e.ON_P2P_OK="on_p2p_ok",e.RECEIVE_METADATA="receive_metadata",e.ON_DATA_STREAM="on_data_stream",e.ENABLE_LOCAL_VIDEO="enable_local_video",e.DISABLE_LOCAL_VIDEO="disable_local_video",e.ENABLE_LOCAL_AUDIO="enable_local_audio",e.DISABLE_LOCAL_AUDIO="disable_local_audio",e.ON_PUBLISHED_USER_LIST="on_published_user_list"}(Pe||(Pe={})),function(e){e.CONNECTION_STATE_CHANGE="CONNECTION_STATE_CHANGE",e.NEED_ANSWER="NEED_ANSWER",e.NEED_RENEGOTIATE="NEED_RENEGOTIATE",e.P2P_LOST="P2P_LOST",e.GATEWAY_P2P_LOST="GATEWAY_P2P_LOST",e.NEED_UNPUB="NEED_UNPUB",e.NEED_UNSUB="NEED_UNSUB",e.NEED_UPLOAD="NEED_UPLOAD",e.NEED_CONTROL="NEED_CONTROL",e.START_RECONNECT="START_RECONNECT",e.END_RECONNECT="END_RECONNECT",e.NEED_SIGNAL_RTT="NEED_SIGNAL_RTT"}(kR||(kR={})),function(e){e.AUDIO_SOURCE_STATE_CHANGE="audio_source_state_change",e.RECEIVE_TRACK_BUFFER="receive_track_buffer",e.ON_AUDIO_BUFFER="on_audio_buffer",e.UPDATE_SOURCE="update_source"}(tr||(tr={}));const Um={sendVolumeLevel:0,sendBitrate:0,sendBytes:0,sendPackets:0,sendPacketsLost:0,currentPacketLossRate:0},xm={sendBytes:0,sendBitrate:0,sendPackets:0,sendPacketsLost:0,sendResolutionHeight:0,sendResolutionWidth:0,captureResolutionHeight:0,captureResolutionWidth:0,targetSendBitrate:0,totalDuration:0,totalFreezeTime:0,currentPacketLossRate:0},VR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveLevel:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1},BV={uplinkNetworkQuality:0,downlinkNetworkQuality:0},FR={transportDelay:0,end2EndDelay:0,receiveBitrate:0,receiveBytes:0,receiveDelay:0,receivePackets:0,receivePacketsLost:0,receiveResolutionHeight:0,receiveResolutionWidth:0,totalDuration:0,totalFreezeTime:0,freezeRate:0,packetLossRate:0,currentPacketLossRate:0,publishDuration:-1};let Ae,Gt,Ko;(function(e){e.CONNECTED="websocket:connected",e.RECONNECTING="websocket:reconnecting",e.WILL_RECONNECT="websocket:will_reconnect",e.CLOSED="websocket:closed",e.FAILED="websocket:failed",e.ON_MESSAGE="websocket:on_message",e.REQUEST_NEW_URLS="websocket:request_new_urls",e.RECONNECT_WAITTING_FINISH="websocket:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="websocket:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="websocket:on_token_privilege_did_expire"})(Ae||(Ae={})),function(e){e.TRANSCODE="mix_streaming",e.RAW="raw_streaming",e.INJECT="inject_streaming"}(Gt||(Gt={})),function(e){e[e.INJECT_STREAM_STATUS_START_SUCCESS=0]="INJECT_STREAM_STATUS_START_SUCCESS",e[e.INJECT_STREAM_STATUS_START_ALREADY_EXISTS=1]="INJECT_STREAM_STATUS_START_ALREADY_EXISTS",e[e.INJECT_STREAM_STATUS_START_UNAUTHORIZED=2]="INJECT_STREAM_STATUS_START_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_START_TIMEOUT=3]="INJECT_STREAM_STATUS_START_TIMEOUT",e[e.INJECT_STREAM_STATUS_START_FAILED=4]="INJECT_STREAM_STATUS_START_FAILED",e[e.INJECT_STREAM_STATUS_STOP_SUCCESS=5]="INJECT_STREAM_STATUS_STOP_SUCCESS",e[e.INJECT_STREAM_STATUS_STOP_NOT_FOUND=6]="INJECT_STREAM_STATUS_STOP_NOT_FOUND",e[e.INJECT_STREAM_STATUS_STOP_UNAUTHORIZED=7]="INJECT_STREAM_STATUS_STOP_UNAUTHORIZED",e[e.INJECT_STREAM_STATUS_STOP_TIMEOUT=8]="INJECT_STREAM_STATUS_STOP_TIMEOUT",e[e.INJECT_STREAM_STATUS_STOP_FAILED=9]="INJECT_STREAM_STATUS_STOP_FAILED",e[e.INJECT_STREAM_STATUS_BROKEN=10]="INJECT_STREAM_STATUS_BROKEN"}(Ko||(Ko={}));const GV={alpha:1,height:640,width:360,x:0,y:0,zOrder:0,audioChannel:0},Vm={x:0,y:0,width:160,height:160,zOrder:255,alpha:1};function Fm(e,t){_n(e.url,"".concat(t,".url"),1,1e3,!1),ht(e.x)||st(e.x,"".concat(t,".x"),0,1e4),ht(e.y)||st(e.y,"".concat(t,".y"),0,1e4),ht(e.width)||st(e.width,"".concat(t,".width"),0,1e4),ht(e.height)||st(e.height,"".concat(t,".height"),0,1e4),ht(e.zOrder)||st(e.zOrder,"".concat(t,".zOrder"),0,255),ht(e.alpha)||st(e.alpha,"".concat(t,".alpha"),0,1,!1)}const WV={audioBitrate:48,audioChannels:1,audioSampleRate:48e3,backgroundColor:0,height:360,lowLatency:!1,videoBitrate:400,videoCodecProfile:100,videoCodecType:1,videoFrameRate:15,videoGop:30,width:640,images:[],userConfigs:[],userConfigExtraInfo:""},HV={audioBitrate:48,audioChannels:2,audioVolume:100,audioSampleRate:48e3,height:0,width:0,videoBitrate:400,videoFramerate:15,videoGop:30};let ai,xa,At,jR,Tn,bi,xn,zo,Wt,_t,Ut,mu,Re,zt,Va,jm,Bm,Zc,Yo,Fa,je;function BR(e){if(!e.channelName)throw new b(I.INVALID_PARAMS,"invalid channelName in info");if(typeof e.uid!="number")throw new b(I.INVALID_PARAMS,"invalid uid in info, uid must be a number");return e.token&&_n(e.token,"info.token",1,2047),Pm(e.uid),Dm(e.channelName),!0}function GR(e){return tn(e,"mediaSource",["screen","window","application"]),!0}(function(e){e.WARNING="@live_uap-warning",e.ERROR="@line_uap-error",e.PUBLISH_STREAM_STATUS="@live_uap-publish-status",e.INJECT_STREAM_STATUS="@live_uap-inject-status",e.WORKER_STATUS="@live_uap-worker-status",e.REQUEST_NEW_ADDRESS="@live_uap-request-address"})(ai||(ai={})),function(e){e.REQUEST_WORKER_MANAGER_LIST="@live_req_worker_manager"}(xa||(xa={})),function(e){e[e.LIVE_STREAM_RESPONSE_SUCCEED=200]="LIVE_STREAM_RESPONSE_SUCCEED",e[e.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM=454]="LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM",e[e.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR=450]="LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_BAD_STREAM=451]="LIVE_STREAM_RESPONSE_BAD_STREAM",e[e.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR=400]="LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR",e[e.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST=404]="LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST",e[e.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED=456]="LIVE_STREAM_RESPONSE_NOT_AUTHORIZED",e[e.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE=457]="LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE",e[e.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN=429]="LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN",e[e.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH=452]="LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH",e[e.LIVE_STREAM_RESPONSE_NOT_SUPPORTED=453]="LIVE_STREAM_RESPONSE_NOT_SUPPORTED",e[e.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM=455]="LIVE_STREAM_RESPONSE_MAX_STREAM_NUM",e[e.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR=500]="LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR",e[e.LIVE_STREAM_RESPONSE_WORKER_LOST=501]="LIVE_STREAM_RESPONSE_WORKER_LOST",e[e.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT=502]="LIVE_STREAM_RESPONSE_RESOURCE_LIMIT",e[e.LIVE_STREAM_RESPONSE_WORKER_QUIT=503]="LIVE_STREAM_RESPONSE_WORKER_QUIT",e[e.ERROR_FAIL_SEND_MESSAGE=504]="ERROR_FAIL_SEND_MESSAGE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE=30]="PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT=31]="PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT",e[e.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH=32]="PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH",e[e.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN=33]="PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN"}(At||(At={})),function(e){e.CONNECT_FAILED="connect failed",e.CONNECT_TIMEOUT="connect timeout",e.WS_DISCONNECTED="websocket disconnected",e.REQUEST_TIMEOUT="request timeout",e.REQUEST_FAILED="request failed",e.WAIT_STATUS_TIMEOUT="wait status timeout",e.WAIT_STATUS_ERROR="wait status error",e.BAD_STATE="bad state",e.WS_ABORT="ws abort",e.AP_REQUEST_TIMEOUT="AP request timeout",e.AP_JSON_PARSE_ERROR="AP json parse error",e.AP_REQUEST_ERROR="AP request error",e.AP_REQUEST_ABORT="AP request abort"}(jR||(jR={})),function(e){e[e.SetSdkProfile=0]="SetSdkProfile",e[e.SetSourceChannel=1]="SetSourceChannel",e[e.SetSourceUserId=2]="SetSourceUserId",e[e.SetDestChannel=3]="SetDestChannel",e[e.StartPacketTransfer=4]="StartPacketTransfer",e[e.StopPacketTransfer=5]="StopPacketTransfer",e[e.UpdateDestChannel=6]="UpdateDestChannel",e[e.Reconnect=7]="Reconnect",e[e.SetVideoProfile=8]="SetVideoProfile"}(Tn||(Tn={})),function(e){e.NETWORK_DISCONNECTED="NETWORK_DISCONNECTED",e.NETWORK_CONNECTED="NETWORK_CONNECTED",e.PACKET_JOINED_SRC_CHANNEL="PACKET_JOINED_SRC_CHANNEL",e.PACKET_JOINED_DEST_CHANNEL="PACKET_JOINED_DEST_CHANNEL",e.PACKET_SENT_TO_DEST_CHANNEL="PACKET_SENT_TO_DEST_CHANNEL",e.PACKET_RECEIVED_VIDEO_FROM_SRC="PACKET_RECEIVED_VIDEO_FROM_SRC",e.PACKET_RECEIVED_AUDIO_FROM_SRC="PACKET_RECEIVED_AUDIO_FROM_SRC",e.PACKET_UPDATE_DEST_CHANNEL="PACKET_UPDATE_DEST_CHANNEL",e.PACKET_UPDATE_DEST_CHANNEL_REFUSED="PACKET_UPDATE_DEST_CHANNEL_REFUSED",e.PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE="PACKET_UPDATE_DEST_CHANNEL_NOT_CHANGE"}(bi||(bi={})),function(e){e.RELAY_STATE_IDLE="RELAY_STATE_IDLE",e.RELAY_STATE_CONNECTING="RELAY_STATE_CONNECTING",e.RELAY_STATE_RUNNING="RELAY_STATE_RUNNING",e.RELAY_STATE_FAILURE="RELAY_STATE_FAILURE"}(xn||(xn={})),function(e){e.RELAY_OK="RELAY_OK",e.SERVER_CONNECTION_LOST="SERVER_CONNECTION_LOST",e.SRC_TOKEN_EXPIRED="SRC_TOKEN_EXPIRED",e.DEST_TOKEN_EXPIRED="DEST_TOKEN_EXPIRED"}(zo||(zo={})),function(e){e.High="high",e.Low="low",e.Audio="audio",e.Screen="screen",e.ScreenLow="screen_low"}(Wt||(Wt={})),function(e){e.DISCONNECT="disconnect",e.CONNECTION_STATE_CHANGE="connection-state-change",e.NETWORK_QUALITY="network-quality",e.STREAM_TYPE_CHANGE="stream-type-change",e.IS_P2P_DISCONNECTED="is-p2p-dis",e.DISCONNECT_P2P="dis-p2p",e.REQUEST_NEW_GATEWAY_LIST="req-gate-url",e.NEED_RENEW_SESSION="need-sid",e.REQUEST_P2P_CONNECTION_PARAMS="request-p2p-connection-params",e.JOIN_RESPONSE="join-response",e.REQUEST_DC_CONNECTION_PARAMS="request-dc-connection-params",e.RESET_CONNECTION_EVENTS="reset-connection-events",e.DATACHANNEL_PRECONNECT="datachannel_preconnect",e.DATACHANNEL_FAILBACK="datachannel_failback",e.RESET_SIGNAL="reset-signal"}(_t||(_t={})),function(e){e[e.Nothing=0]="Nothing",e[e.Audio=1]="Audio",e[e.LwoVideo=2]="LwoVideo",e[e.Video=4]="Video",e[e.Data=8]="Data"}(Ut||(Ut={})),function(e){e[e.websocket=0]="websocket",e[e.datachannel=1]="datachannel"}(mu||(mu={})),function(e){e.NEED_RENEGOTIATE="@need_renegotiate",e.NEED_REPLACE_TRACK="@need_replace_track",e.NEED_CLOSE="@need_close",e.NEED_ENABLE_TRACK="@need_enable_track",e.NEED_DISABLE_TRACK="@need_disable_track",e.NEED_SESSION_ID="@need_sid",e.SET_OPTIMIZATION_MODE="@set_optimization_mode",e.GET_STATS="@get_stats",e.GET_LOW_VIDEO_TRACK="@get_low_video_track",e.NEED_RESET_REMOTE_SDP="@need_reset_remote_sdp",e.NEED_UPDATE_VIDEO_ENCODER="@need_update_video_encoder",e.NEED_MUTE_TRACK="@need_mute_track",e.NEED_UNMUTE_TRACK="@need_unmute_track"}(Re||(Re={})),function(e){e.SCREEN_TRACK="screen_track",e.CUSTOM_TRACK="custome_track",e.LOW_STREAM="low_stream"}(zt||(zt={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(Va||(Va={})),function(e){e[e.HIGH_STREAM=0]="HIGH_STREAM",e[e.LOW_STREAM=1]="LOW_STREAM"}(jm||(jm={})),function(e){e[e.DISABLE=0]="DISABLE",e[e.LOW_STREAM=1]="LOW_STREAM",e[e.AUDIO_ONLY=2]="AUDIO_ONLY"}(Bm||(Bm={})),function(e){e.TRANSCEIVER_UPDATED="transceiver-updated"}(Zc||(Zc={})),function(e){e.SOURCE_STATE_CHANGE="source-state-change",e.TRACK_ENDED="track-ended",e.BEAUTY_EFFECT_OVERLOAD="beauty-effect-overload",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status",e.CLOSED="closed"}(Yo||(Yo={})),function(e){e.FIRST_FRAME_DECODED="first-frame-decoded",e.VIDEO_ELEMENT_VISIBLE_STATUS="video-element-visible-status"}(Fa||(Fa={})),function(e){e.CHINA="CHINA",e.ASIA="ASIA",e.NORTH_AMERICA="NORTH_AMERICA",e.EUROPE="EUROPE",e.JAPAN="JAPAN",e.INDIA="INDIA",e.KOREA="KOREA",e.HKMC="HKMC",e.US="US",e.OCEANIA="OCEANIA",e.SOUTH_AMERICA="SOUTH_AMERICA",e.AFRICA="AFRICA",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="EXTENSIONS"}(je||(je={}));const KV=[je.AFRICA,je.ASIA,je.CHINA,je.EUROPE,je.GLOBAL,je.INDIA,je.JAPAN,je.NORTH_AMERICA,je.OCEANIA,je.OVERSEA,je.SOUTH_AMERICA];let nn;(function(e){e.CHINA="CN",e.ASIA="AS",e.NORTH_AMERICA="NA",e.EUROPE="EU",e.JAPAN="JP",e.INDIA="IN",e.KOREA="KR",e.HKMC="HK",e.US="US",e.OCEANIA="OC",e.SOUTH_AMERICA="SA",e.AFRICA="AF",e.OVERSEA="OVERSEA",e.GLOBAL="GLOBAL",e.EXTENSIONS="GLOBAL"})(nn||(nn={}));const Eu={CHINA:{},ASIA:{CODE:nn.ASIA,WEBCS_DOMAIN:["ap-web-1-asia.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-asia.agora.io"],PROXY_CS:["proxy-ap-web-asia.agora.io"],CDS_AP:["cds-ap-web-asia.agora.io","cds-ap-web-asia2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-asia.agora.io","sua-ap-web-asia2.agora.io"],UAP_AP:["uap-ap-web-asia.agora.io","uap-ap-web-asia2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-asia.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-asia.agora.io"],LOG_UPLOAD_SERVER:["logservice-asia.agora.io"],PROXY_SERVER_TYPE3:["southeast-asia.webrtc-cloud-proxy.sd-rtn.com"]},NORTH_AMERICA:{CODE:nn.NORTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-north-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-north-america.agora.io"],PROXY_CS:["proxy-ap-web-america.agora.io"],CDS_AP:["cds-ap-web-america.agora.io","cds-ap-web-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-america.agora.io","sua-ap-web-america2.agora.io"],UAP_AP:["uap-ap-web-america.agora.io","uap-ap-web-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-north-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-north-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-north-america.agora.io"],PROXY_SERVER_TYPE3:["east-usa.webrtc-cloud-proxy.sd-rtn.com"]},EUROPE:{CODE:nn.EUROPE,WEBCS_DOMAIN:["ap-web-1-europe.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-europe.agora.io"],PROXY_CS:["proxy-ap-web-europe.agora.io"],CDS_AP:["cds-ap-web-europe.agora.io","cds-ap-web-europe2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-europe.agora.io","sua-ap-web-europe.agora.io"],UAP_AP:["uap-ap-web-europe.agora.io","uap-ap-web-europe2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-europe.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-europe.agora.io"],LOG_UPLOAD_SERVER:["logservice-europe.agora.io"],PROXY_SERVER_TYPE3:["europe.webrtc-cloud-proxy.sd-rtn.com"]},JAPAN:{CODE:nn.JAPAN,WEBCS_DOMAIN:["ap-web-1-japan.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-japan.agora.io"],PROXY_CS:["proxy-ap-web-japan.agora.io"],CDS_AP:["cds-ap-web-japan.agora.io","cds-ap-web-japan2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-japan.agora.io","sua-ap-web-japan2.agora.io"],UAP_AP:["uap-ap-web-japan.agora.io","	uap-ap-web-japan2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-japan.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-japan.agora.io"],LOG_UPLOAD_SERVER:["logservice-japan.agora.io"],PROXY_SERVER_TYPE3:["japan.webrtc-cloud-proxy.sd-rtn.com"]},INDIA:{CODE:nn.INDIA,WEBCS_DOMAIN:["ap-web-1-india.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-india.agora.io"],PROXY_CS:["proxy-ap-web-india.agora.io"],CDS_AP:["cds-ap-web-india.agora.io","cds-ap-web-india2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-india.agora.io","sua-ap-web-india2.agora.io"],UAP_AP:["uap-ap-web-india.agora.io","uap-ap-web-india2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-india.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-india.agora.io"],LOG_UPLOAD_SERVER:["logservice-india.agora.io"],PROXY_SERVER_TYPE3:["india.webrtc-cloud-proxy.sd-rtn.com"]},KOREA:{CODE:nn.KOREA,WEBCS_DOMAIN:["ap-web-1-korea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-korea.agora.io"],PROXY_CS:["proxy-ap-web-korea.agora.io"],CDS_AP:["cds-ap-web-korea.agora.io","cds-ap-web-korea2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-korea.agora.io","sua-ap-web-korea2.agora.io"],UAP_AP:["uap-ap-web-korea.agora.io","uap-ap-web-korea2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-korea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-korea.agora.io"],LOG_UPLOAD_SERVER:["logservice-korea.agora.io"],PROXY_SERVER_TYPE3:["korea.webrtc-cloud-proxy.sd-rtn.com"]},HKMC:{CODE:nn.HKMC,WEBCS_DOMAIN:["ap-web-1-hkmc.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-hkmc.agora.io"],PROXY_CS:["proxy-ap-web-hkmc.agora.io"],CDS_AP:["cds-ap-web-hkmc.agora.io","cds-ap-web-hkmc2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-hkmc.agora.io","sua-ap-web-hkmc2.agora.io"],UAP_AP:["uap-ap-web-hkmc.agora.io","uap-ap-web-hkmc2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-hkmc.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-hkmc.agora.io"],LOG_UPLOAD_SERVER:["logservice-hkmc.agora.io"],PROXY_SERVER_TYPE3:["hkmc.webrtc-cloud-proxy.sd-rtn.com"]},US:{CODE:nn.US,WEBCS_DOMAIN:["ap-web-1-us.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-us.agora.io"],PROXY_CS:["proxy-ap-web-us.agora.io"],CDS_AP:["cds-ap-web-us.agora.io","cds-ap-web-us2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-us.agora.io","sua-ap-web-us2.agora.io"],UAP_AP:["uap-ap-web-us.agora.io","uap-ap-web-us2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-us.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-us.agora.io"],LOG_UPLOAD_SERVER:["logservice-us.agora.io"],PROXY_SERVER_TYPE3:["us.webrtc-cloud-proxy.sd-rtn.com"]},OVERSEA:{CODE:nn.OVERSEA,WEBCS_DOMAIN:["ap-web-1-oversea.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oversea.agora.io"],PROXY_CS:["proxy-ap-web-oversea.agora.io"],CDS_AP:["cds-ap-web-oversea.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oversea.agora.io"],UAP_AP:["uap-ap-web-oversea.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oversea.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oversea.agora.io"],LOG_UPLOAD_SERVER:["logservice-oversea.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.agora.io"]},GLOBAL:{CODE:nn.GLOBAL,WEBCS_DOMAIN:["webrtc2-ap-web-1.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-ap-web-3.agora.io"],PROXY_CS:["ap-proxy-1.agora.io","ap-proxy-2.agora.io"],CDS_AP:["cds-ap-web-1.agora.io","cds-ap-web-3.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-1.agora.io","sua-ap-web-3.agora.io"],UAP_AP:["uap-ap-web-1.agora.io","uap-ap-web-3.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2.agora.io"],LOG_UPLOAD_SERVER:["logservice.agora.io"],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy.sd-rtn.com"]},OCEANIA:{CODE:nn.OCEANIA,WEBCS_DOMAIN:["ap-web-1-oceania.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-oceania.agora.io"],PROXY_CS:["proxy-ap-web-oceania.agora.io"],CDS_AP:["cds-ap-web-oceania.agora.io","cds-ap-web-oceania2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-oceania.agora.io","sua-ap-web-oceania2.agora.io"],UAP_AP:["uap-ap-web-oceania.agora.io","uap-ap-web-oceania2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-oceania.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-oceania.agora.io"],LOG_UPLOAD_SERVER:["logservice-oceania.agora.io"],PROXY_SERVER_TYPE3:["oceania.webrtc-cloud-proxy.sd-rtn.com"]},SOUTH_AMERICA:{CODE:nn.SOUTH_AMERICA,WEBCS_DOMAIN:["ap-web-1-south-america.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-south-america.agora.io"],PROXY_CS:["proxy-ap-web-south-america.agora.io"],CDS_AP:["cds-ap-web-south-america.agora.io","cds-ap-web-south-america2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-south-america.agora.io","sua-ap-web-south-america2.agora.io"],UAP_AP:["uap-ap-web-south-america.agora.io","uap-ap-web-south-america2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-south-america.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-south-america.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-america.agora.io"],PROXY_SERVER_TYPE3:["south-america.webrtc-cloud-proxy.sd-rtn.com"]},AFRICA:{CODE:nn.AFRICA,WEBCS_DOMAIN:["ap-web-1-africa.agora.io"],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-africa.agora.io"],PROXY_CS:["proxy-ap-web-africa.agora.io"],CDS_AP:["cds-ap-web-africa.agora.io","cds-ap-web-africa2.agora.io"],ACCOUNT_REGISTER:["sua-ap-web-africa.agora.io","sua-ap-web-africa2.agora.io"],UAP_AP:["uap-ap-web-africa.agora.io","uap-ap-web-africa2.agora.io"],EVENT_REPORT_DOMAIN:["statscollector-1-africa.agora.io"],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-africa.agora.io"],LOG_UPLOAD_SERVER:["logservice-south-africa.agora.io"],PROXY_SERVER_TYPE3:["africa.webrtc-cloud-proxy.sd-rtn.com"]},EXTENSIONS:{}};let ed,WR,be,dn,Di,ue,Yt,Be,On,qo,vn,nr,Ar,Or,Ht,Yi,vt,Pi,HR,fr,Kr,Jo;ym&&(Eu.CHINA={CODE:nn.CHINA,WEBCS_DOMAIN:["webrtc2-2.ap.sd-rtn.com"],WEBCS_DOMAIN_BACKUP_LIST:["webrtc2-4.ap.sd-rtn.com"],PROXY_CS:["proxy-web.ap.sd-rtn.com"],CDS_AP:["cds-web-2.ap.sd-rtn.com","cds-web-4.ap.sd-rtn.com"],ACCOUNT_REGISTER:["sua-web-2.ap.sd-rtn.com","sua-web-4.ap.sd-rtn.com"],UAP_AP:["uap-web-2.ap.sd-rtn.com","uap-web-4.ap.sd-rtn.com"],EVENT_REPORT_DOMAIN:["web-3.statscollector.sd-rtn.com"],EVENT_REPORT_BACKUP_DOMAIN:["web-4.statscollector.sd-rtn.com"],LOG_UPLOAD_SERVER:["logservice-china.agora.io"],PROXY_SERVER_TYPE3:["east-cn.webrtc-cloud-proxy.sd-rtn.com"]}),function(e){e.UPDATE_BITRATE_LIMIT="update_bitrate_limit"}(ed||(ed={}));class _u extends gt{constructor(t,n){super(),g(this,"onICEConnectionStateChange",void 0),g(this,"onConnectionStateChange",void 0),g(this,"onDTLSTransportStateChange",void 0),g(this,"onDTLSTransportError",void 0),g(this,"onICETransportStateChange",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoReceived",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0),g(this,"establishPromise",void 0)}}(function(e){e.SEND="sendonly",e.RECV="recvonly",e.SENDRECV="sendrecv",e.INACTIVE="inactive"})(WR||(WR={})),function(e){e.VIDEO="video",e.AUDIO="audio"}(be||(be={})),function(e){e[e.UDP=0]="UDP",e[e.TCP=1]="TCP",e[e.RELAY=2]="RELAY"}(dn||(dn={})),function(e){e[e.FIRST_CONNECTION=0]="FIRST_CONNECTION",e[e.TCP_RESTART=1]="TCP_RESTART",e[e.RELAY_RESTART=2]="RELAY_RESTART",e[e.OLD_FIRST_CONNECTION=10]="OLD_FIRST_CONNECTION",e[e.OLD_RESTART=11]="OLD_RESTART",e[e.DISCONNECTED_OR_FAILED=20]="DISCONNECTED_OR_FAILED"}(Di||(Di={})),function(e){e.LocalVideoTrack="videoTrack",e.LocalAudioTrack="audioTrack",e.LocalVideoLowTrack="videoLowTrack"}(ue||(ue={})),function(e){e.New="new",e.Connected="connected",e.Reconnecting="reconnecting",e.Disconnected="disconnected"}(Yt||(Yt={})),function(e){e.StateChange="stateChange",e.IceConnectionStateChange="iceConnectionStateChange",e.RequestMuteLocal="requestMuteLocal",e.RequestUnmuteLocal="requestUnmuteLocal",e.RequestRePublish="requestRePublish",e.RequestReSubscribe="requestReSubscribe",e.RequestUploadStats="requestUploadStats",e.MediaReconnectStart="MediaReconnectStart",e.MediaReconnectEnd="MediaReconnectEnd",e.NeedSignalRTT="NeedSignalRTT",e.RequestRestartICE="RequestRestartIce",e.PeerConnectionStateChange="PeerConnectionStateChange",e.RequestReconnect="RequestReconnect",e.RequestReconnectPC="RequestReconnectPC",e.RequestUnpublishForReconnectPC="RequestUnpublishForReconnectPC",e.P2PLost="P2PLost",e.UpdateVideoEncoder="UpdateVideoEncoder",e.ConnectionTypeChange="ConnectionTypeChange",e.RequestLowStreamParameter="RequestLowStreamParameter",e.QueryClientConnectionState="QueryClientConnectionState"}(Be||(Be={})),function(e){e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(On||(On={})),function(e){e.NETWORK_STATE_CHANGE="NETWORK_STATE_CHANGE",e.ONLINE="ONLINE",e.OFFLINE="OFFLINE"}(qo||(qo={})),function(e){e.ON_TRACK="on_track",e.ON_NODE="on_node"}(vn||(vn={})),function(e){e.REQUEST_UPDATE_CONSTRAINTS="request_update_constraints",e.REQUEST_CONSTRAINTS="request_constraints"}(nr||(nr={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(Ar||(Ar={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Or||(Or={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Ht||(Ht={})),function(e){e.NETWORK_ERROR="NETWORK_ERROR",e.SERVER_ERROR="SERVER_ERROR",e.MULTI_IP="MULTI_IP",e.TIMEOUT="TIMEOUT",e.OFFLINE="OFFLINE",e.LEAVE="LEAVE",e.P2P_FAILED="P2P_FAILED",e.FALLBACK="FALLBACK"}(Yi||(Yi={})),function(e){e.CONNECTED="transmitter:connected",e.RECONNECTING="transmitter:reconnecting",e.WILL_RECONNECT="transmitter:will_reconnect",e.CLOSED="transmitter:closed",e.FAILED="transmitter:failed",e.ON_MESSAGE="transmitter:on_message",e.REQUEST_NEW_URLS="transmitter:request_new_urls",e.RECONNECT_WAITTING_FINISH="transmitter:reconnect_waitting_finish",e.RECONNECT_CREATE_CONNECTION="transmitter:reconnect_create_connection",e.ON_TOKEN_PRIVILEGE_DID_EXPIRE="transmitter:on_token_privilege_did_expire",e.TO_CONNECT_DATACHANNEL="transmitter:to_connect_datachannel",e.FAILBACK="transmitter:failback"}(vt||(vt={})),function(e){e.CAMERA_CHANGED="camera-changed",e.MICROPHONE_CHANGED="microphone-changed",e.PLAYBACK_DEVICE_CHANGED="playback-device-changed",e.AUDIO_AUTOPLAY_FAILED="audio-autoplay-failed",e.AUTOPLAY_FAILED="autoplay-failed",e.SECURITY_POLICY_VIOLATION="security-policy-violation"}(Pi||(Pi={})),function(e){e[e.APP_TYPE_INVALID_VALUE=-1]="APP_TYPE_INVALID_VALUE",e[e.APP_TYPE_NATIVE=0]="APP_TYPE_NATIVE",e[e.APP_TYPE_NATIVE_COCOS=1]="APP_TYPE_NATIVE_COCOS",e[e.APP_TYPE_NATIVE_UNITY=2]="APP_TYPE_NATIVE_UNITY",e[e.APP_TYPE_NATIVE_ELECTRON=3]="APP_TYPE_NATIVE_ELECTRON",e[e.APP_TYPE_NATIVE_FLUTTER=4]="APP_TYPE_NATIVE_FLUTTER",e[e.APP_TYPE_NATIVE_UNREAL=5]="APP_TYPE_NATIVE_UNREAL",e[e.APP_TYPE_NATIVE_XAMARIN=6]="APP_TYPE_NATIVE_XAMARIN",e[e.APP_TYPE_NATIVE_API_CLOUD=7]="APP_TYPE_NATIVE_API_CLOUD",e[e.APP_TYPE_NATIVE_REACT_NATIVE=8]="APP_TYPE_NATIVE_REACT_NATIVE",e[e.APP_TYPE_NATIVE_PYTHON=9]="APP_TYPE_NATIVE_PYTHON",e[e.APP_TYPE_NATIVE_COCOS_CREATOR=10]="APP_TYPE_NATIVE_COCOS_CREATOR",e[e.APP_TYPE_NATIVE_RUST=11]="APP_TYPE_NATIVE_RUST",e[e.APP_TYPE_NATIVE_C_SHARP=12]="APP_TYPE_NATIVE_C_SHARP",e[e.APP_TYPE_NATIVE_CEF=13]="APP_TYPE_NATIVE_CEF",e[e.APP_TYPE_NATIVE_UNI_APP=14]="APP_TYPE_NATIVE_UNI_APP",e[e.APP_TYPE_WEBRTC=1e3]="APP_TYPE_WEBRTC",e[e.APP_TYPE_WEBRTC_REACT=1001]="APP_TYPE_WEBRTC_REACT",e[e.APP_TYPE_WEBRTC_VUE=1002]="APP_TYPE_WEBRTC_VUE",e[e.APP_TYPE_WEBRTC_ANGULAR=1003]="APP_TYPE_WEBRTC_ANGULAR"}(HR||(HR={})),function(e){e.CONNECTING="CONNECTING",e.RECONNECTING="RECONNECTING",e.CONNECTED="CONNECTED",e.CLOSED="CLOSED"}(fr||(fr={})),function(e){e.CONNECTION_STATE_CHANGE="connection-state-change",e.STATE_CHANGE="state-change",e.INSPECT_RESULT="inspect-result",e.CLIENT_LOCAL_VIDEO_TRACK="client-local-video-track",e.REQUEST_NEW_WORKER_URL="request-new-worker-url"}(Kr||(Kr={})),function(e){e[e.CONNECT_AP=0]="CONNECT_AP",e[e.AP_CONNECTED=1]="AP_CONNECTED",e[e.CONNECT_WORKER_MANAGER=2]="CONNECT_WORKER_MANAGER",e[e.WORKER_MANAGER_CONNECTED=3]="WORKER_MANAGER_CONNECTED",e[e.GET_WORKER_MANAGER_RESPONSE=4]="GET_WORKER_MANAGER_RESPONSE",e[e.CONNECT_WORKER=5]="CONNECT_WORKER",e[e.WORKER_CONNECTED=6]="WORKER_CONNECTED",e[e.CLOSED=7]="CLOSED"}(Jo||(Jo={}));const wn={getDisplayMedia:!1,getStreamFromExtension:!1,supportUnifiedPlan:!1,supportMinBitrate:!1,supportSetRtpSenderParameters:!1,supportDualStream:!0,webAudioMediaStreamDest:!1,supportReplaceTrack:!1,supportWebGL:!1,webAudioWithAEC:!1,supportRequestFrame:!1,supportShareAudio:!1,supportDualStreamEncoding:!1,supportDataChannel:!1,supportPCSetConfiguration:!1,supportWebRTCEncodedTransform:!1};function bt(){return wn}let Qt;(function(e){e[e.CHOOSE_SERVER=11]="CHOOSE_SERVER",e[e.CLOUD_PROXY=18]="CLOUD_PROXY",e[e.CLOUD_PROXY_5=20]="CLOUD_PROXY_5",e[e.CLOUD_PROXY_FALLBACK=26]="CLOUD_PROXY_FALLBACK"})(Qt||(Qt={}));var zV=Ve,td=Array.isArray||function(e){return zV(e)=="Array"},YV=W,KR=td,qV=_f,JV=Zn,XV=mn("species"),zR=YV.Array,QV=function(e){var t;return KR(e)&&(t=e.constructor,(qV(t)&&(t===zR||KR(t.prototype))||JV(t)&&(t=t[XV])===null)&&(t=void 0)),t===void 0?zR:t},YR=function(e,t){return new(QV(e))(t===0?0:t)},$V=Vc,ZV=$n,eF=Uo,tF=xo,nF=YR,qR=F([].push),Xo=function(e){var t=e==1,n=e==2,r=e==3,o=e==4,a=e==6,d=e==7,u=e==5||a;return function(h,m,f,E){for(var T,R,A=eF(h),O=ZV(A),w=$V(m,f),x=tF(O),V=0,X=E||nF,le=t?X(h,x):n||d?X(h,0):void 0;x>V;V++)if((u||V in O)&&(R=w(T=O[V],V,A),e))if(t)le[V]=R;else if(R)switch(e){case 3:return!0;case 5:return T;case 6:return V;case 2:qR(le,T)}else switch(e){case 4:return!1;case 7:qR(le,T)}return a?-1:r||o?o:le}},JR={forEach:Xo(0),map:Xo(1),filter:Xo(2),some:Xo(3),every:Xo(4),find:Xo(5),findIndex:Xo(6),filterReject:Xo(7)},rF=JR.forEach,XR=Wp("forEach")?[].forEach:function(e){return rF(this,e,arguments.length>1?arguments[1]:void 0)};Wn({target:"Array",proto:!0,forced:[].forEach!=XR},{forEach:XR});var iF=Vo("Array").forEach,oF=jo,sF=hr,aF=H,cF=iF,Gm=Array.prototype,dF={DOMTokenList:!0,NodeList:!0},lF=function(e){var t=e.forEach;return e===Gm||aF(Gm,e)&&t===Gm.forEach||sF(dF,oF(e))?cF:t},uF=Uo,QR=Zp;Wn({target:"Object",stat:!0,forced:p(function(){QR(1)})},{keys:function(e){return QR(uF(e))}});var hF=Mo.Object.keys,pF=tT,fF=Wn,mF=td,EF=F([].reverse),$R=[1,2];fF({target:"Array",proto:!0,forced:String($R)===String($R.reverse())},{reverse:function(){return mF(this)&&(this.length=this.length),EF(this)}});var _F=Vo("Array").reverse,gF=H,SF=_F,Wm=Array.prototype,TF=function(e){var t=e.reverse;return e===Wm||gF(Wm,e)&&t===Wm.reverse?SF:t},vF=p,yF=fa,RF=mn("species"),ZR=function(e){return yF>=51||!vF(function(){var t=[];return(t.constructor={})[RF]=function(){return{foo:1}},t[e](Boolean).foo!==1})},CF=Wn,IF=W,eC=td,AF=_f,OF=Zn,tC=qp,wF=xo,NF=jr,bF=Im,DF=mn,PF=gf,LF=ZR("slice"),kF=DF("species"),Hm=IF.Array,MF=Math.max;CF({target:"Array",proto:!0,forced:!LF},{slice:function(e,t){var n,r,o,a=NF(this),d=wF(a),u=tC(e,d),h=tC(t===void 0?d:t,d);if(eC(a)&&(n=a.constructor,(AF(n)&&(n===Hm||eC(n.prototype))||OF(n)&&(n=n[kF])===null)&&(n=void 0),n===Hm||n===void 0))return PF(a,u,h);for(r=new(n===void 0?Hm:n)(MF(h-u,0)),o=0;u<h;u++,o++)u in a&&bF(r,o,a[u]);return r.length=o,r}});var UF=Vo("Array").slice,xF=H,VF=UF,Km=Array.prototype,FF=function(e){var t=e.slice;return e===Km||xF(Km,e)&&t===Km.slice?VF:t};function Y(e,t,n,r,o){var a,d,u,h={};return lF(a=hF(r)).call(a,function(m){h[m]=r[m]}),h.enumerable=!!h.enumerable,h.configurable=!!h.configurable,("value"in h||h.initializer)&&(h.writable=!0),h=pF(d=TF(u=FF(n).call(n)).call(u)).call(d,function(m,f){return f(e,t,m)||m},h),o&&h.initializer!==void 0&&(h.value=h.initializer?h.initializer.call(o):void 0,h.initializer=void 0),h.initializer===void 0&&(Gy(e,t,h),h=null),h}var jF=Vo("Array").keys,BF=jo,GF=hr,WF=H,HF=jF,zm=Array.prototype,KF={DOMTokenList:!0,NodeList:!0},Ws=function(e){var t=e.keys;return e===zm||WF(zm,e)&&t===zm.keys||GF(KF,BF(e))?HF:t};function nC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function rC(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nC(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let gu=0,Ym=0;function ci(e,t,n,r){return new de((o,a)=>{t.timeout=t.timeout||k("HTTP_CONNECT_TIMEOUT"),t.responseType=t.responseType||"json",t.data&&!n?(t.data=JSON.stringify(t.data),gu+=Ka(t.data)):n&&(t.data.size?gu+=t.data.size:t.data instanceof FormData?gu+=function(d){let u=0;return/DingTalk/i.test(navigator.userAgent)&&d.realFormData&&(d=d.realFormData),d.forEach(h=>{u+=typeof h=="string"?Ka(h):h.size}),u+138}(t.data):gu+=Ka(JSON.stringify(t.data))),t.headers=t.headers||{},t.headers["Content-Type"]=t.headers["Content-Type"]||"application/json",t.method="POST",t.url=e,Rr.request(t).then(d=>{typeof d.data=="string"?Ym+=Ka(d.data):d.data instanceof ArrayBuffer||d.data instanceof Uint8Array?Ym+=d.data.byteLength:Ym+=Ka(JSON.stringify(d.data)),r&&o({data:d.data,headers:d.headers}),o(d.data)}).catch(d=>{Rr.isCancel(d)?a(new b(I.OPERATION_ABORTED,"cancel token canceled")):d.code==="ECONNABORTED"?a(new b(I.NETWORK_TIMEOUT,d.message)):d.response?a(new b(I.NETWORK_RESPONSE_ERROR,d.response.status)):a(new b(I.NETWORK_ERROR,d.message))})})}async function zF(e,t){const n=new Blob([t.data],{type:"buffer"});return await ci(e,rC(rC({},t),{},{data:n,headers:{"Content-Type":"application/octet-stream"}}),!0)}const xt=new class extends gt{set networkState(e){v.info("[".concat(this._moduleName,"]")+"network state changed, "+this._networkState+" -> "+e),this.emit(qo.NETWORK_STATE_CHANGE,e,this._networkState),e===On.ONLINE?this.emit(qo.ONLINE):e===On.OFFLINE&&(this.onlineWaiter=new de(t=>{this.once(qo.ONLINE,()=>{this.onlineWaiter=void 0,t(On.ONLINE)})}),this.emit(qo.OFFLINE)),this._networkState=e}get networkState(){return this._networkState}constructor(){super(),g(this,"_moduleName","network-indicator"),g(this,"_networkState",On.ONLINE),g(this,"onlineWaiter",void 0),window.addEventListener("online",()=>{this.networkState=On.ONLINE}),window.addEventListener("offline",()=>{this.networkState=On.OFFLINE})}};let qm=!1;const wr=new class extends gt{constructor(){super(...arguments),g(this,"onAutoplayFailed",void 0),g(this,"onAudioAutoplayFailed",void 0)}};function iC(){if(qe(),!qm){const e=t=>{t.preventDefault(),qm=!1,Yc()?document.body.removeEventListener("click",e,!0):(document.body.removeEventListener("touchstart",e,!0),document.body.removeEventListener("mousedown",e,!0))};qm=!0,Yc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0)),v.info("detect media autoplay failed, document: https://docs.agora.io/cn/Voice/autoplay_policy_web_ng?platform=Web"),wr.onAutoplayFailed?wr.onAutoplayFailed():wr.onAudioAutoplayFailed?v.warning(`AgoraRTC.onAudioAutoplayFailed has been deprecated in favor of AgoraRTC.onAutoplayFailed.

  Please refer to the Agora document to migrate the newer API, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`):v.warning(`We have detected a media autoplay failed event, and found out that you haven't implemented AgoraRTC.onAutoplayFailed callback yet.

  It will cause audio/video element not playing automatically on some browsers without user interaction, possibly hurting user experiences.

  Please refer to the Agora document to properly handle autoplay failed event, https://docs.agora.io/en/Voice/autoplay_policy_web_ng?platform=Web .`),wr.emit("autoplay-failed")}}function Jm(e){return new TextEncoder().encode(e)}const oC=function(e,t){const n=new Uint8Array(e.byteLength+t.byteLength);return n.set(new Uint8Array(e),0),n.set(new Uint8Array(t),e.byteLength),n},YF=async e=>function(t,n){let r="";return new Uint8Array(t).forEach(o=>{r+=o.toString(n).padStart(2,"0")}),r}(await crypto.subtle.digest("SHA-256",Jm(e)),16);function sC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function De(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?sC(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):sC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Te(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};return function(t,n,r){const o=r.value;if(typeof o=="function"){const a=e.className||t.__className__||(t.constructor.name==="AgoraRTCClient"?"Client":t.constructor.name);r.value=function(){for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];let m=u;if(e.argsMap)try{m=e.argsMap(this,...u)}catch(E){v.warning(E),m=[]}try{JSON.stringify(m)}catch{v.warning("arguments for method ".concat(a,".").concat(String(n)," not serializable for apiInvoke.")),m=[]}const f=(e.report||he).reportApiInvoke(this._sessionId||null,{name:"".concat(a,".").concat(String(n)),options:m,tag:Et.TRACER,reportResult:e.reportResult},e.throttleTime);try{const E=o.apply(this,u);return E instanceof de?E.then(T=>(f.onSuccess(e.reportResult&&T),T)).catch(T=>{throw f.onError(T),T}):(f.onSuccess(e.reportResult&&E),E)}catch(E){throw f.onError(E),E}}}return r}}const he=new class{constructor(){g(this,"baseInfoMap",new Map),g(this,"proxyServer",void 0),g(this,"clientList",Bs),g(this,"eventUploadTimer",void 0),g(this,"setSessionIdTimer",void 0),g(this,"url",void 0),g(this,"backupUrl",void 0),g(this,"_appId",void 0),g(this,"keyEventUploadPendingItems",[]),g(this,"normalEventUploadPendingItems",[]),g(this,"apiInvokeUploadPendingItems",[]),g(this,"apiInvokeCount",0),g(this,"ltsList",[]),g(this,"lastSendNormalEventTime",Date.now()),g(this,"customReportCounterTimer",void 0),g(this,"customReportCount",0),g(this,"extApiInvoke",async e=>{for(const t of e){const n=De(De({},t),{},{sid:null,invokeId:++this.apiInvokeCount,tag:Et.TRACER});this.sendApiInvoke(n)}}),this.eventUploadTimer=window.setInterval(this.doSend.bind(this),k("EVENT_REPORT_SEND_INTERVAL")),this.setSessionIdTimer=window.setInterval(this.appendSessionId.bind(this),k("EVENT_REPORT_SEND_INTERVAL"))}adjustSessionStartTime(e){if(!this.baseInfoMap.has(e)&&!this.baseInfoMap.get(e))return void v.error("adjust session ".concat(e," start time, sid is not exist or info is undefined"));const t=this.baseInfoMap.get(e),n=Date.now(),r=t.startTime;t.startTime=n,v.debug("rewrite session ".concat(e," startTime: ").concat(n," , ").concat(n-r,"ms")),this.baseInfoMap.set(e,t)}setAppId(e){this._appId=e}reportApiInvoke(e,t,n){t.timeout=t.timeout||6e4,t.reportResult=t.reportResult===void 0||t.reportResult;const r=Date.now();this.apiInvokeCount+=1;const o=this.apiInvokeCount,a=()=>({tag:t.tag,invokeId:o,sid:e,name:t.name,apiInvokeTime:r,options:t.options,states:t.states||null}),d=!!k("SHOW_REPORT_INVOKER_LOG");d&&v.info("".concat(t.name," start"),t.options);let u=!1;Rn(t.timeout).then(()=>{u||(this.sendApiInvoke(De(De({},a()),{},{error:I.API_INVOKE_TIMEOUT,success:!1})),v.debug("".concat(t.name," timeout")))});const h=new b(I.UNEXPECTED_ERROR,"".concat(t.name,": this api invoke is end"));return{onSuccess:m=>{const f=()=>{if(u)throw h;return u=!0,this.sendApiInvoke(De(De({},a()),{},{success:!0},t.reportResult&&{result:m})),d&&v.info("".concat(t.name," onSuccess")),m};return n?RI(f,t.name+"Success",n,()=>u=!0):f()},onError:m=>{const f=()=>{if(u)throw m;u=!0,this.sendApiInvoke(De(De({},a()),{},{success:!1,error:m})),d&&v.info("".concat(t.name," onFailure"),m.toString())};return n?RI(f,t.name+"Error",n,()=>u=!0):f()}}}sessionInit(e,t){if(this.baseInfoMap.has(e))return;const n=Date.now(),r=this.createBaseInfo(e,n);r.cname=t.cname;const o=Object.assign({},{willUploadConsoleLog:k("UPLOAD_LOG"),maxTouchPoints:navigator.maxTouchPoints,areaVersion:ym?"global":"oversea",areas:k("AREAS")&&k("AREAS").join(",")},t.extend),a=Date.now(),d=De(De({},r),{},{eventType:cn.SESSION_INIT,appid:t.appid,browser:navigator.userAgent,build:vm,lts:a,elapse:a-n,extend:JSON.stringify(o),mode:t.mode,process:k("PROCESS_ID"),appType:k("APP_TYPE"),success:!0,version:Hr});this.send({type:St.SESSION,data:d},!0)}joinChooseServer(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.JOIN_CHOOSE_SERVER,lts:o,eventElapse:o-t.lts,chooseServerAddr:t.csAddr,errorCode:t.ec,elapse:o-n.startTime,success:t.succ,chooseServerAddrList:JSON.stringify(t.serverList),uid:t.uid?parseInt(t.uid):null,cid:t.cid?parseInt(t.cid):null,chooseServerIp:t.csIp||"",opid:t.opid,unilbsServerIds:t.unilbsServerIds,extend:t.extend||void 0,isHttp3:t.isHttp3});this.send({type:St.JOIN_CHOOSE_SERVER,data:a},!0)}reqUserAccount(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.REQ_USER_ACCOUNT,lts:o,success:t.success,serverAddress:t.serverAddr,stringUid:t.stringUid,uid:t.uid,errorCode:t.errorCode,elapse:o-n.startTime,eventElapse:o-t.lts,extend:JSON.stringify(t.extend)});this.send({type:St.REQ_USER_ACCOUNT,data:a},!0)}joinGateway(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info;t.vid&&(r.vid=t.vid),r.uid=t.uid,r.cid=t.cid;const o=Date.now(),{firstSuccess:a,avoidJoinStartTime:d,isProxy:u,addr:h}=t,m=o-(a&&d?d:n.startTime),f=De(De({},r),{},{eventType:cn.JOIN_GATEWAY,lts:o,gatewayAddr:t.addr,success:t.succ,errorCode:t.ec,elapse:m,eventElapse:o-t.lts,firstSuccess:a,signalChannel:t.signalChannel}),E=f.success?1:0;if(t.succ&&(n.lastJoinSuccessTime=o),a)this.send({type:St.JOIN_GATEWAY,data:f},!0);else{let T;if(h)if(u){const A=h.match(/h=(\d{1,3}-){3}\d{1,3}/g),O=h.match(/p=[0-9]{1,6}/g);T={isSuccess:E,gatewayIp:A&&A.length?A[0].split("=")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split("=")[1]:"",isProxy:u?1:0}}else{const A=h.match(/wss:\/\/(\d{1,3}-){3}\d{1,3}/g),O=h.match(/:[0-9]{1,6}/g);T={isSuccess:E,gatewayIp:A&&A.length?A[0].split("//")[1].replace(/-/g,"."):"",port:O&&O.length?O[0].split(":")[1]:"",isProxy:u?1:0}}else T={isSuccess:E,gatewayIp:"",port:"",isProxy:u?1:0};delete f.success,delete f.eventType,delete f.firstSuccess,f.vid=Number(f.vid);const R=Object.assign({},f,T,{eventType:cn.REJOIN_GATEWAY});this.send({type:St.RE_JOIN_GATEWAY,data:R},!0)}}joinChannelTimeout(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=Date.now(),o=De(De({},n.info),{},{lts:r,timeout:t,elapse:r-n.startTime});this.send({type:St.JOIN_CHANNEL_TIMEOUT,data:o},!0)}publish(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.PUBLISH,lts:o,eventElapse:t.eventElapse,elapse:o-n.startTime,success:t.succ,errorCode:t.ec,videoName:t.videoName,audioName:t.audioName,screenName:t.screenName,screenshare:t.screenshare,audio:t.audio,video:t.video,p2pid:t.p2pid,publishRequestid:t.publishRequestid});this.send({type:St.PUBLISH,data:a},!0)}subscribe(e,t,n){const r=this.baseInfoMap.get(e);if(!r)return;const o=r.info,a=Date.now(),d=De(De({},o),{},{eventType:cn.SUBSCRIBE,lts:a,eventElapse:t.eventElapse,elapse:a-r.startTime,success:t.succ,errorCode:t.ec,video:t.video,audio:t.audio,subscribeRequestid:t.subscribeRequestid,p2pid:t.p2pid},n&&{extend:JSON.stringify({isMassSubscribe:!0})});typeof t.peerid=="string"?d.peerSuid=t.peerid:d.peer=t.peerid,this.send({type:St.SUBSCRIBE,data:d},!0)}wsCompressorInit(e){var t;const n=[...Ws(t=this.baseInfoMap).call(t)],r=n.length?n[0]:"UnableToGetSid",o=this.baseInfoMap.get(r);if(!o)return;const a=o.info,d=Date.now(),u=De(De({},a),{},{eventType:cn.WS_COMPRESSOR_INIT,lts:d,eventElapse:e.eventElapse,elapse:d-o.startTime,status:e.status?1:2});this.send({type:St.WS_COMPRESSOR_INIT,data:u},!0)}firstRemoteVideoDecode(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),u=De(De(De({},a),r),{},{elapse:d-o.startTime,eventType:t,lts:d,firstDecodeFrame:Math.max(d-o.startTime,0),apEnd:Math.max(r.apEnd-o.startTime,0),apStart:Math.max(r.apStart-o.startTime,0),joinGwEnd:Math.max(r.joinGwEnd-o.startTime,0),joinGwStart:Math.max(r.joinGwStart-o.startTime,0),pcEnd:Math.max(r.pcEnd-o.startTime,0),pcStart:Math.max(r.pcStart-o.startTime,0),subscriberEnd:Math.max(r.subscriberEnd-o.startTime,0),subscriberStart:Math.max(r.subscriberStart-o.startTime,0),videoAddNotify:Math.max(r.videoAddNotify-o.startTime,0)});this.send({type:n,data:u},!0)}firstRemoteFrame(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),u=De(De(De({},a),r),{},{elapse:d-o.startTime,eventType:t,lts:d});this.send({type:n,data:u},!0)}pcStats(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De(De({},r),t),{},{vid:r.vid===void 0?0:Number(r.vid),elapse:o-n.startTime,eventType:cn.PC_STATS,lts:o});this.send({type:St.PC_STATS,data:a},!0)}onGatewayStream(e,t,n,r){const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),u=De(De(De({},a),r),{},{eventType:t,lts:d});this.send({type:n,data:u},!0)}streamSwitch(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.STREAM_SWITCH,lts:o,isDual:t.isdual,elapse:o-n.startTime,success:t.succ});this.send({type:St.STREAM_SWITCH,data:a},!0)}requestProxyAppCenter(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.REQUEST_PROXY_APPCENTER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,APAddr:t.APAddr,workerManagerList:t.workerManagerList,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:St.REQUEST_PROXY_APPCENTER,data:a},!0)}requestProxyWorkerManager(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{eventType:cn.REQUEST_PROXY_WORKER_MANAGER,lts:o,eventElapse:o-t.lts,elapse:o-n.startTime,workerManagerAddr:t.workerManagerAddr,response:t.response,errorCode:t.ec,success:t.succ});this.send({type:St.REQUEST_PROXY_WORKER_MANAGER,data:a},!0)}setProxyServer(e){this.proxyServer=e,e?v.debug("reportProxyServerurl: ".concat(e)):v.debug("disable reportProxyServerurl: ".concat(e))}peerPublishStatus(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De({},r),{},{subscribeElapse:t.subscribeElapse,peer:t.peer,peerPublishDuration:Math.max(t.audioPublishDuration,t.videoPublishDuration),audiotag:t.audioPublishDuration>0?1:-1,videotag:t.videoPublishDuration>0?1:-1,lts:o,elapse:o-n.startTime,joinChannelSuccessElapse:o-(n.lastJoinSuccessTime||o),peerPublishDurationVideo:t.videoPublishDuration,peerPublishDurationAudio:t.audioPublishDuration});this.send({type:St.PEER_PUBLISH_STATUS,data:a},!0)}workerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now();(function(a,d,u){const h=a[d];if(!h||typeof h!="string")return[a];a[d]="";const m=Ka(JSON.stringify(a));let f=0;const E=[];let T=0;for(let R=0;R<h.length;R++)T+=h.charCodeAt(R)<=127?1:3,T<=u-m||(E[E.length]=zs(zs({},a),{},{[d]:h.substring(f,R)}),f=R,T=h.charCodeAt(R)<=127?1:3);return f!==h.length-1&&(E[E.length]=zs(zs({},a),{},{[d]:h.substring(f)})),E})(De(De(De({},r),t),{},{elapse:o-n.startTime,lts:o,productType:"WebRTC"}),"payload",1300).forEach(a=>this.send({type:St.WORKER_EVENT,data:a},!0))}apworkerEvent(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De(De({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:St.AP_WORKER_EVENT,data:a},!0)}joinWebProxyAP(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De(De({},r),t),{},{elapse:o-n.startTime,lts:o,extend:t.extend||void 0});this.send({type:St.JOIN_WEB_PROXY_AP,data:a},!0)}WebSocketQuit(e,t){const n=this.baseInfoMap.get(e);if(!n)return;const r=n.info,o=Date.now(),a=De(De(De({},r),t),{},{elapse:o-n.startTime,lts:o});this.send({type:St.WEBSOCKET_QUIT,data:a},!0)}async sendCustomReportMessage(e,t){if(this.customReportCount+=t.length,this.customReportCount>k("CUSTOM_REPORT_LIMIT"))throw new b(I.CUSTOM_REPORT_FREQUENCY_TOO_HIGH);this.customReportCounterTimer||(this.customReportCounterTimer=window.setInterval(()=>{this.customReportCount=0},5e3));const n=Date.now(),r=t.map(o=>({type:St.USER_ANALYTICS,data:De(De({sid:e},o),{},{lts:n})}));try{k("NEW_REPORT_SERVER")?await this.postDataToStatsCollector2(r):await this.postDataToStatsCollector(r)}catch(o){throw v.error("send custom report message failed",o.toString()),new b(I.CUSTOM_REPORT_SEND_FAILED,o.message)}}autoplayFailed(e,t,n,r){if(!e)return;const o=this.baseInfoMap.get(e);if(!o)return;const a=o.info,d=Date.now(),u=De(De({},a),{},{vid:a.vid===void 0?0:Number(a.vid),lts:d,elapse:d-o.startTime,cbRegistered:wr.onAutoplayFailed||wr.onAudioAutoplayFailed?1:-1,errorMsg:n,mediaType:t,trackId:r,extend:void 0});this.send({type:St.AUTOPLAY_FAILED,data:u},!0)}sendApiInvoke(e){const t=k("NOT_REPORT_EVENT");if(e.tag&&t.includes&&t.includes(e.tag))return!1;if(e.sid===null)return this.apiInvokeUploadPendingItems.push(e),!1;const n=this.baseInfoMap.get(e.sid);if(!n)return this.apiInvokeUploadPendingItems.push(e),!1;const{cname:r,uid:o,cid:a}=n.info;e.lts=e.lts||Date.now();let d;if(e.error)if(e.error instanceof b){const{code:h,message:m}=e.error;d=h||m||e.error.toString()}else d=e.error.toString();const u={invokeId:e.invokeId,sid:e.sid,cname:r,cid:a,uid:o,lts:e.lts,success:e.success,elapse:e.lts-n.startTime,execElapse:e.lts-e.apiInvokeTime,apiName:e.name,options:e.options?JSON.stringify(e.options):void 0,execStates:e.states?JSON.stringify(e.states):void 0,execResult:e.result?JSON.stringify(e.result):void 0,errorCode:e.error?d:void 0,errorMsg:e.error?JSON.stringify(e.error):void 0};return this.send({type:St.API_INVOKE,data:u},!1),!0}appendSessionId(){this.clientList.forEach(e=>{if(e._sessionId){const t=this.apiInvokeUploadPendingItems.length;for(let n=0;n<t;n++){const r=this.apiInvokeUploadPendingItems.shift();r&&(r.sid=e._sessionId,this.sendApiInvoke(Object.assign({},r)))}}})}send(e,t){if(t)return this.keyEventUploadPendingItems.push(e),void this.sendItems(this.keyEventUploadPendingItems,!0);this.normalEventUploadPendingItems.push(e),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&this.normalEventUploadPendingItems.splice(0,1),this.normalEventUploadPendingItems.length>=10&&this.sendItems(this.normalEventUploadPendingItems,!1)}doSend(){this.keyEventUploadPendingItems.length>0&&this.sendItems(this.keyEventUploadPendingItems,!0),this.normalEventUploadPendingItems.length>0&&Date.now()-this.lastSendNormalEventTime>=5e3&&this.sendItems(this.normalEventUploadPendingItems,!1)}sendItems(e,t){const n=[],r=[];for(;e.length;){const a=e.shift();n.length<20?n.push(a):r.push(a)}e.push(...r);for(const a of[...n]){var o;this.ltsList.indexOf(a.data.lts)!==-1?(a.data.lts=this.ltsList[this.ltsList.length-1]+1,this.ltsList.push(a.data.lts)):(this.ltsList.push(a.data.lts),Nm(o=this.ltsList).call(o,(d,u)=>d-u))}return t||(this.lastSendNormalEventTime=Date.now()),k("ENABLE_EVENT_REPORT")&&n.length&&(k("NEW_REPORT_SERVER")?this.postDataToStatsCollector2(n):this.postDataToStatsCollector(n)).catch((a=>d=>{k("EVENT_REPORT_RETRY")&&(t?this.keyEventUploadPendingItems=this.keyEventUploadPendingItems.concat(a):(this.normalEventUploadPendingItems=this.normalEventUploadPendingItems.concat(a),this.normalEventUploadPendingItems.length>k("NORMAL_EVENT_QUEUE_CAPACITY")&&(this.normalEventUploadPendingItems.splice(0,this.normalEventUploadPendingItems.length-k("NORMAL_EVENT_QUEUE_CAPACITY")),v.warning("report: drop normal events"))))})(n)),e}async postDataToStatsCollector2(e){xt.networkState===On.OFFLINE&&await de.race([xt.onlineWaiter,Rn(2*kt.maxRetryTimeout)]);const t=o=>{let a=new Uint8Array;return o.forEach(d=>{const u=Jm(JSON.stringify(d.data)),h=new ArrayBuffer(5),m=(E=>{let T=0;return Object.entries(St).forEach(R=>{let[A,O]=R;O===E.type&&(T=km[A])}),T})(d),f=new DataView(h);f.setUint16(0,u.byteLength,!0),f.setUint8(2,255&m),f.setUint8(3,m>>>8&255),f.setUint8(4,m>>>16&255),a=oC(a,new Uint8Array(h)),a=oC(a,u)}),a},n="event";let r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[0],"/").concat(n);for(let o=0;o<2;o+=1){o===1&&(r=this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"&p=443&d=").concat(n):"https://".concat(k("NEW_REPORT_SERVER_DOMAINS")[1],"/").concat(n));try{await ci(r,{timeout:1e4,data:t(e),headers:De(De({biz:"webrtc",sendts:Math.round(Date.now()/1e3),debug:"false"},this._appId&&{appid:this._appId}),{},{"Content-Type":"application/octet-stream"})},!0)}catch(a){if(o===1)throw a;continue}return}}async postDataToStatsCollector(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n={msgType:"EventMessages",sentTs:Math.round(Date.now()/1e3),payloads:e.map(a=>JSON.stringify(a)),vid:(a=>{const d=a&&a.data.sid&&this.baseInfoMap.get(a.data.sid);return d&&d.info.vid&&+d.info.vid||0})(e[0])};xt.networkState===On.OFFLINE&&await de.race([xt.onlineWaiter,Rn(2*kt.maxRetryTimeout)]);const r=t?"/events/proto-raws":"/events/messages";let o=this.url||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(k("EVENT_REPORT_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(r));for(let a=0;a<2;a+=1){a===1&&(o=this.backupUrl||(this.proxyServer?"https://".concat(this.proxyServer,"/rs/?h=").concat(k("EVENT_REPORT_BACKUP_DOMAIN"),"&p=").concat(k("STATS_COLLECTOR_PORT"),"&d=").concat(r):"https://".concat(k("EVENT_REPORT_BACKUP_DOMAIN"),":").concat(k("STATS_COLLECTOR_PORT")).concat(r)));try{t?await zF(o,{timeout:1e4,data:n}):await ci(o,{timeout:1e4,data:n})}catch(d){if(a===1)throw d;continue}return}}createBaseInfo(e,t){const n=Object.assign({},FV);return n.sid=e,this.baseInfoMap.set(e,{info:n,startTime:t}),n}reportResourceTiming(e,t){const n=performance.getEntriesByName(e),r=n[n.length-1];r&&this.reportApiInvoke(t,{name:"Client.resourceTiming",options:r,tag:Et.TRACER}).onSuccess()}};uu.on("REPORT_LOG_UPLOAD",e=>{e.networkState=xt.networkState,he.reportApiInvoke(null,{name:"logUploadError",options:e,tag:Et.TRACER})});class aC extends gt{constructor(t,n){super(),g(this,"trackMediaType",void 0),g(this,"_ID",void 0),g(this,"_rtpTransceiver",void 0),g(this,"_lowRtpTransceiver",void 0),g(this,"_hints",[]),g(this,"_isClosed",!1),g(this,"_originMediaStreamTrack",void 0),g(this,"_mediaStreamTrack",void 0),g(this,"_external",{}),this._ID=n||ut(8,"track-"),this._originMediaStreamTrack=t,this._mediaStreamTrack=t,function(r){Xc.includes(r)||Xc.push(r)}(this)}toString(){return this._ID}getTrackId(){return this._ID}getMediaStreamTrack(t){if(!t){const n=he.reportApiInvoke(null,{name:Mt.GET_MEDIA_STREAM_TRACK,options:[],tag:Et.TRACER});this._mediaStreamTrack&&typeof this._mediaStreamTrack.label=="string"?n.onSuccess(this._mediaStreamTrack.label):n.onSuccess("")}return this._mediaStreamTrack}getRTCRtpTransceiver(t){return t===Va.LOW_STREAM?this._lowRtpTransceiver:this._rtpTransceiver}getMediaStreamTrackSettings(){return this.getMediaStreamTrack(!0).getSettings()}close(){this._isClosed=!0,this._lowRtpTransceiver=void 0,this._rtpTransceiver=void 0,function(t){const n=Xc.indexOf(t);n!==-1&&Xc.splice(n,1)}(this),this.emit(Yo.CLOSED)}_updateRtpTransceiver(t,n){if(n===Va.LOW_STREAM){if(this._lowRtpTransceiver===t)return;this._lowRtpTransceiver=t}else{if(this._rtpTransceiver===t)return;this._rtpTransceiver=t}this.emit(Zc.TRANSCEIVER_UPDATED,t,n)}}let $t,qF=1;class Vn{constructor(t){g(this,"lockingPromise",de.resolve()),g(this,"locks",0),g(this,"name",""),g(this,"lockId",void 0),this.lockId=qF++,t&&(this.name=t),v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is created."))}get isLocked(){return this.locks>0}lock(t){let n;this.locks+=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:""));const r=new de(a=>{n=()=>{this.locks-=1,v.debug("[lock-".concat(this.name,"-").concat(this.lockId,"] is not locked, current queue ").concat(this.locks,". ").concat(typeof t=="string"?t:"")),a()}}),o=this.lockingPromise.then(()=>n);return this.lockingPromise=this.lockingPromise.then(()=>r),o}}function ja(e,t){return function(n,r,o){const a=o.value;if(typeof a!="function")throw new Error("Cannot use mutex on object property.");return o.value=async function(){const d=this[t];if(!d)throw new Error("mutex property key ".concat(t," doesn't exist on ").concat(e));const u=await d.lock("From ".concat(e,".").concat(r));try{for(var h=arguments.length,m=new Array(h),f=0;f<h;f++)m[f]=arguments[f];return await a.apply(this,m)}finally{u()}},o}}class Xm extends aC{get isExternalTrack(){return this._isExternalTrack}get muted(){return this._muted}get enabled(){return this._enabled}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}constructor(t,n){super(t,n),g(this,"_enabled",!0),g(this,"_muted",!1),g(this,"_isExternalTrack",!1),g(this,"_isClosed",!1),g(this,"_enabledMutex",void 0),g(this,"processor",void 0),g(this,"_processorContext",void 0),g(this,"_handleTrackEnded",()=>{this.onTrackEnded()}),this._enabledMutex=new Vn("".concat(this.getTrackId())),t.addEventListener("ended",this._handleTrackEnded)}getTrackLabel(){var t,n;return(t=(n=this._originMediaStreamTrack)===null||n===void 0?void 0:n.label)!==null&&t!==void 0?t:""}close(){this._isClosed||(this.stop(),this._originMediaStreamTrack.stop(),this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack.stop(),this._mediaStreamTrack=null),this._originMediaStreamTrack=null,this._enabledMutex=null,v.debug("[".concat(this.getTrackId(),"] close")),this.emit(Re.NEED_CLOSE),super.close())}async _updateOriginMediaStreamTrack(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2];this._isExternalTrack=r,t!==this._originMediaStreamTrack&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),n&&this._originMediaStreamTrack.stop(),t.addEventListener("ended",this._handleTrackEnded),this._originMediaStreamTrack=t,this._muted&&(this._originMediaStreamTrack.enabled=!1),this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Rt(this,Re.NEED_REPLACE_TRACK,this),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}))}_getDefaultPlayerConfig(){return{}}onTrackEnded(){v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yo.TRACK_ENDED)}stateCheck(t,n){if(v.debug("check track state, [muted: ".concat(this._muted,", enabled: ").concat(this._enabled,"] to [").concat(t,": ").concat(n,"]")),Ma(n,t),this._enabled&&this._muted&&t==="enabled"&&n===!1)throw new b(I.TRACK_STATE_UNREACHABLE,"cannot set enabled while the track is muted").print();if(!this._enabled&&!this._muted&&t==="muted"&&n===!0)throw new b(I.TRACK_STATE_UNREACHABLE,"cannot set muted while the track is disabled").print()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}function cC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}(function(e){e.IOS_15_16_INTERRUPTION_START="ios15_16-interruption-start",e.IOS_15_16_INTERRUPTION_END="ios15_16-interruption-end",e.IOS_INTERRUPTION_START="ios-interruption-start",e.IOS_INTERRUPTION_END="ios-interruption-end",e.STATE_CHANGE="state-change"})($t||($t={}));const dC=window.AudioContext||window.webkitAudioContext;let Nr=null;const Xe=new class extends gt{constructor(){super(...arguments),g(this,"prevState",void 0),g(this,"curState",void 0),g(this,"currentTime",void 0),g(this,"currentTimeStuckAt",void 0),g(this,"interruptDetectorTrack",void 0),g(this,"onLocalAudioTrackMute",()=>{v.info("ios15-interruption-start"),this.emit($t.IOS_15_16_INTERRUPTION_START)}),g(this,"onLocalAudioTrackUnmute",async()=>{v.info("ios15-interruption-end"),this.curState!=="running"||this.duringInterruption?v.info("ios15-interruption-end-canceled"):(Nr&&await Nr.suspend(),this.emit($t.IOS_15_16_INTERRUPTION_END))})}get duringInterruption(){return this.prevState==="running"&&this.curState==="interrupted"}bindInterruptDetectorTrack(e){v.debug("webaudio bindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack||(this.interruptDetectorTrack=e,this.interruptDetectorTrack._mediaStreamTrack.onmute=this.onLocalAudioTrackMute,this.interruptDetectorTrack._mediaStreamTrack.onunmute=this.onLocalAudioTrackUnmute)}unbindInterruptDetectorTrack(e){v.debug("webaudio unbindInterruptDetectorTrack ".concat(e.getTrackId())),this.interruptDetectorTrack&&this.interruptDetectorTrack===e&&(this.interruptDetectorTrack._mediaStreamTrack&&(this.interruptDetectorTrack._mediaStreamTrack.onmute=null,this.interruptDetectorTrack._mediaStreamTrack.onunmute=null),this.interruptDetectorTrack=void 0)}};function JF(){if(!dC)return void v.error("your browser is not support web audio");v.info("create audio context");const e=function(t){for(var n=1;n<arguments.length;n++){var r=arguments[n]!=null?arguments[n]:{};n%2?cC(Object(r),!0).forEach(function(o){g(t,o,r[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(r)):cC(Object(r)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(r,o))})}return t}({},k("WEBAUDIO_INIT_OPTIONS"));v.debug("audio context init option:",JSON.stringify(e)),Nr=new dC(e),Xe.curState=Nr.state,Nr.onstatechange=()=>{Xe.prevState=Xe.curState,Xe.curState=Nr?Nr.state:void 0;const{prevState:t,curState:n}=Xe,r=n==="running",o=n==="interrupted",a=t==="running",d=t==="suspended",u=t==="interrupted",h=qe().osVersion;(Mn()||zi())&&a&&o&&(v.info("ios".concat(h,"-interruption-start")),Xe.emit($t.IOS_INTERRUPTION_START)),(Mn()||zi())&&(d||u)&&r&&(v.info("ios".concat(h,"-interruption-end")),Xe.emit($t.IOS_INTERRUPTION_END)),t!==n&&(v.debug("AudioContext State Change","".concat(t,"=>").concat(n)),Xe.emit($t.STATE_CHANGE))},setInterval(()=>{var t;const n=(t=Nr)===null||t===void 0?void 0:t.currentTime;Xe.currentTime!==n?(Xe.currentTimeStuckAt&&(v.debug("AudioContext current time resume at ".concat(n)),Xe.currentTimeStuckAt=void 0),Xe.currentTime=n):(n!==Xe.currentTimeStuckAt&&(he.reportApiInvoke(null,{name:"WEB_AUDIO_CURRENT_TIME_STUCK",options:{currentTime:n},tag:Et.TRACER}).onSuccess(),v.warning("AudioContext current time stuck at ".concat(n))),Xe.currentTimeStuckAt=n)},5e3),async function(t){const n=["click","contextmenu","auxclick","dblclick","mousedown","mouseup","touchend","keydown","keyup"];let r,o=!1,a=!1,d=!1;function u(w){t.state==="running"?h(!1):Mn()||zi()?t.state==="suspended"&&(h(!0),w&&t.resume().then(f,f)):t.state!=="closed"&&(h(!0),w&&t.resume().then(f,f))}function h(w){if(o!==w){o=w;for(let x=0,V=n;x<V.length;x+=1){const X=V[x];w?window.addEventListener(X,E,{capture:!0,passive:!0}):window.removeEventListener(X,E,{capture:!0,passive:!0})}}}function m(){u(!0)}function f(){u(!1)}function E(){u(!0)}function T(w){if(!d)if(r.paused)if(w){R(!1),d=!0;let x;try{x=r.play(),x?x.then(A,A):(r.addEventListener("playing",A),r.addEventListener("abort",A),r.addEventListener("error",A))}catch{A()}}else R(!0);else R(!1)}function R(w){if(a!==w){a=w;for(let x=0,V=n;x<V.length;x++){const X=V[x];w?window.addEventListener(X,O,{capture:!0,passive:!0}):window.removeEventListener(X,O,{capture:!0,passive:!0})}}}function A(){r.removeEventListener("playing",A),r.removeEventListener("abort",A),r.removeEventListener("error",A),d=!1,T(!1)}function O(){T(!0)}if(Mn()){const w=t.createMediaStreamDestination(),x=document.createElement("div");x.innerHTML="<audio x-webkit-airplay='deny'></audio>",r=x.children.item(0),r.controls=!1,r.disableRemotePlayback=!0,r.preload="auto",r.srcObject=w.stream,T(!0)}Xe.on($t.STATE_CHANGE,m),u(!1)}(Nr)}function Ba(){if(!Nr){if(JF(),!Nr)throw new b(I.NOT_SUPPORTED,"can not create audio context");return Nr}return Nr}function lC(){return!!Nr}function Hs(e){if(function(){if(Qm!==null)return Qm;const r=Ba(),o=r.createBufferSource(),a=r.createGain(),d=r.createGain();o.connect(a),o.connect(d),o.disconnect(a);let u=!1;try{o.disconnect(a)}catch{u=!0}return o.disconnect(),Qm=u,u}())return;const t=e.connect,n=e.disconnect;e.connect=(r,o,a)=>(e._inputNodes||(e._inputNodes=[]),e._inputNodes.includes(r)||(r instanceof AudioNode?(e._inputNodes.push(r),t.call(e,r,o,a)):t.call(e,r,o)),e),e.disconnect=(r,o,a)=>{n.call(e),r?sE(e._inputNodes,r):e._inputNodes=[];for(const d of e._inputNodes)t.call(e,d)}}let Qm=null;function uC(e,t){let n=!1;const r=1/t;if(k("DISABLE_WEBAUDIO")){const o=window.setInterval(()=>{n?window.clearInterval(o):e(performance.now()/1e3)},1e3*r)}else{const o=Ba();let a=o.createGain();a.gain.value=0,a.connect(o.destination);const d=()=>{if(n)return void(a=null);const u=o.createOscillator();u.onended=d,u.connect(a),u.start(0),u.stop(o.currentTime+r),e(o.currentTime)};d()}return()=>{n=!0}}class hC{constructor(){g(this,"context",void 0),g(this,"analyserNode",void 0),g(this,"sourceNode",void 0),this.context=Ba(),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4}updateSource(t){if(t!==this.sourceNode){if(this.sourceNode)try{this.sourceNode.disconnect(this.analyserNode)}catch{}this.sourceNode=t,t==null||t.connect(this.analyserNode)}}getVolumeLevel(){if(!this.sourceNode||(!this.context||Mn()||zi()||this.context.state!=="running"&&this.context.resume(),!this.analyserNode))return 0;const t=new Float32Array(this.analyserNode.fftSize);if(this.analyserNode.getFloatTimeDomainData)this.analyserNode.getFloatTimeDomainData(t);else{const r=new Uint8Array(this.analyserNode.fftSize);this.analyserNode.getByteTimeDomainData(r);for(let o=0;o<t.length;++o)t[o]=r[o]/128-1}const n=Fo(t).call(t,(r,o)=>r+o*o,0)/t.length;return Math.max(10*Math.log10(n)+100,0)/100}getAnalyserNode(){return this.analyserNode}rebuildAnalyser(){try{var t,n;(t=this.sourceNode)===null||t===void 0||t.disconnect(this.analyserNode),this.analyserNode=this.context.createAnalyser(),this.analyserNode.fftSize=2048,this.analyserNode.smoothingTimeConstant=.4,(n=this.sourceNode)===null||n===void 0||n.connect(this.analyserNode)}catch{v.warning("rebuild analyser node failed.")}}destroy(){this.updateSource(void 0)}}class pC extends gt{get processSourceNode(){return this.sourceNode}set processedNode(t){var n;if(!this.isDestroyed&&this._processedNode!==t){try{var r;(r=this.sourceNode)===null||r===void 0||r.disconnect(this.outputNode)}catch{}(n=this._processedNode)===null||n===void 0||n.disconnect(),this._processedNode=t,this.connect()}}get processedNode(){return this._processedNode}constructor(){super(),g(this,"outputNode",void 0),g(this,"outputTrack",void 0),g(this,"isPlayed",!1),g(this,"sourceNode",void 0),g(this,"context",void 0),g(this,"audioBufferNode",void 0),g(this,"destNode",void 0),g(this,"audioOutputLevel",0),g(this,"volumeLevelAnalyser",void 0),g(this,"_processedNode",void 0),g(this,"playNode",void 0),g(this,"isDestroyed",!1),g(this,"onNoAudioInput",void 0),g(this,"isNoAudioInput",!1),g(this,"_noAudioInputCount",0),this.context=Ba(),this.playNode=this.context.destination,this.outputNode=this.context.createGain(),Hs(this.outputNode),this.volumeLevelAnalyser=new hC}startGetAudioBuffer(t){this.audioBufferNode||(this.audioBufferNode=this.context.createScriptProcessor(t),this.outputNode.connect(this.audioBufferNode),this.audioBufferNode.connect(this.context.destination),this.audioBufferNode.onaudioprocess=n=>{this.emit(tr.ON_AUDIO_BUFFER,function(r){for(let o=0;o<r.outputBuffer.numberOfChannels;o+=1){const a=r.outputBuffer.getChannelData(o);for(let d=0;d<a.length;d+=1)a[d]=0}return r.inputBuffer}(n))})}stopGetAudioBuffer(){this.audioBufferNode&&(this.audioBufferNode.onaudioprocess=null,this.outputNode.disconnect(this.audioBufferNode),this.audioBufferNode=void 0)}createOutputTrack(){if(!bt().webAudioMediaStreamDest)throw new b(I.NOT_SUPPORTED,"your browser is not support audio processor");return this.destNode&&this.outputTrack||(this.destNode=this.context.createMediaStreamDestination(),this.outputNode.connect(this.destNode),this.outputTrack=this.destNode.stream.getAudioTracks()[0]),this.outputTrack}play(t){this.context.state!=="running"&&Li(()=>{Xe.emit("autoplay-failed")}),this.isPlayed=!0,this.playNode=t||this.context.destination,this.outputNode.connect(this.playNode)}stop(){if(this.isPlayed)try{this.outputNode.disconnect(this.playNode)}catch{}this.isPlayed=!1}getAccurateVolumeLevel(){return this.volumeLevelAnalyser.getVolumeLevel()}async checkHasAudioInput(){let t=arguments.length>0&&arguments[0]!==void 0?arguments[0]:0;if(t>5)return this.isNoAudioInput=!0,this.onNoAudioInput&&this.onNoAudioInput(),!1;Mn()||zi()?this.context.state==="suspended"&&this.context.resume():this.context.state!=="running"&&this.context.resume();const n=this.volumeLevelAnalyser.getAnalyserNode();let r;n.getFloatTimeDomainData?(r=new Float32Array(n.fftSize),n.getFloatTimeDomainData(r)):(r=new Uint8Array(n.fftSize),n.getByteTimeDomainData(r));let o=!1;for(let a=0;a<r.length;a++)r[a]!==0&&(o=!0);return o?(this.isNoAudioInput=!1,!0):(await Rn(200),await this.checkHasAudioInput(t?t+1:1)&&o)}getAudioVolume(){return this.outputNode.gain.value}setVolume(t){this.outputNode.gain.setValueAtTime(t,this.context.currentTime)}destroy(){this.disconnect(),this.stop(),this.isDestroyed=!0,this.onNoAudioInput=void 0}disconnect(){var t,n;(t=this.processedNode)===null||t===void 0||t.disconnect(),(n=this.sourceNode)===null||n===void 0||n.disconnect(),this.outputNode&&this.outputNode.disconnect()}connect(){var t;this.processedNode?(t=this.processedNode)===null||t===void 0||t.connect(this.outputNode):this.sourceNode&&this.sourceNode.connect(this.outputNode),this.volumeLevelAnalyser.updateSource(this.outputNode)}}class $m extends pC{get isFreeze(){return!1}constructor(t,n,r){var o;if(super(),g(this,"sourceNode",void 0),g(this,"track",void 0),g(this,"clonedTrack",void 0),g(this,"audioElement",void 0),g(this,"isCurrentTrackCloned",!1),g(this,"isRemoteTrack",!1),g(this,"originVolumeLevelAnalyser",void 0),g(this,"rebuildWebAudio",async()=>{if(v.debug("ready to rebuild web audio, state:",this.context.state),this.isNoAudioInput&&await this.checkHasAudioInput(),!this.isNoAudioInput||this.isDestroyed)return document.body.removeEventListener("click",this.rebuildWebAudio,!0),void v.debug("rebuild web audio success, current volume status",this.getAccurateVolumeLevel());this.context.resume().then(()=>v.info("resume success")),v.debug("rebuild web audio because of ios 12 bugs"),this.disconnect();const u=this.track;this.track=this.track.clone(),this.isCurrentTrackCloned?u.stop():this.isCurrentTrackCloned=!0;const h=new MediaStream([this.track]);this.sourceNode=this.context.createMediaStreamSource(h),Hs(this.sourceNode),this.volumeLevelAnalyser.rebuildAnalyser();const m=this.outputNode.gain.value;this.outputNode=this.context.createGain(),this.outputNode.gain.setValueAtTime(m,this.context.currentTime),Hs(this.outputNode),this.emit(tr.UPDATE_SOURCE),this.connect(),this.audioElement.srcObject=h,this.isPlayed&&this.play(this.playNode),this.checkHasAudioInput()}),t.kind!=="audio")throw new b(I.UNEXPECTED_ERROR);this.track=t;const a=new MediaStream([this.track]);if(this.isRemoteTrack=!!n,this.sourceNode=this.context.createMediaStreamSource(a),Hs(this.sourceNode),r){const u=r.clone();u.enabled=!0,this.clonedTrack=u,v.debug("create an unmuted track ".concat(u.id," from the original track ").concat(r.id," to get the volume"));const h=this.context.createMediaStreamSource(new MediaStream([u]));Hs(h),this.originVolumeLevelAnalyser=new hC,this.originVolumeLevelAnalyser.updateSource(h)}this.connect(),this.audioElement=document.createElement("audio"),this.audioElement.srcObject=a;const d=qe();n&&d.os===En.IOS&&Number((o=d.osVersion)===null||o===void 0?void 0:o.split(".")[0])<15&&(Xe.on($t.STATE_CHANGE,()=>{this.context.state==="suspended"?document.body.addEventListener("click",this.rebuildWebAudio,!0):this.context.state==="running"&&this.rebuildWebAudio()}),this.checkHasAudioInput().then(u=>{u||document.body.addEventListener("click",this.rebuildWebAudio,!0)}))}updateTrack(t){this.sourceNode.disconnect(),this.track=t,this.isCurrentTrackCloned=!1;const n=new MediaStream([t]);this.sourceNode=this.context.createMediaStreamSource(n),Hs(this.sourceNode),this.processedNode||this.sourceNode.connect(this.outputNode),this.emit(tr.UPDATE_SOURCE),this.audioElement.srcObject=n}destroy(){var t;this.audioElement.srcObject=null,this.audioElement.remove(),Xe.off("state-change",this.rebuildWebAudio),(t=this.originVolumeLevelAnalyser)===null||t===void 0||t.destroy(),this.clonedTrack=void 0,super.destroy()}createMediaStreamSourceNode(t){return this.context.createMediaStreamSource(new MediaStream([t]))}updateOriginTrack(t){const n=t.clone();n.enabled=!0,this.clonedTrack&&(this.clonedTrack.stop(),this.clonedTrack=n),v.debug("create an unmuted track ".concat(n.id," from the original track ").concat(t.id," to get the volume"));const r=this.context.createMediaStreamSource(new MediaStream([n]));Hs(r),this.originVolumeLevelAnalyser&&this.originVolumeLevelAnalyser.updateSource(r)}getOriginVolumeLevel(){return this.originVolumeLevelAnalyser?this.originVolumeLevelAnalyser.getVolumeLevel():this.getAccurateVolumeLevel()}}async function fC(e,t){const n=(o,a)=>o?typeof o!="number"?o.max||o.exact||o.ideal||o.min||a:o:a,r={audio:!1,video:{mandatory:{chromeMediaSource:"desktop",chromeMediaSourceId:e,maxHeight:n(t.height,1080),maxWidth:n(t.width,1920)}}};return t.frameRate&&typeof t.frameRate!="number"?(r.video.mandatory.maxFrameRate=t.frameRate.max,r.video.mandatory.minFrameRate=t.frameRate.min):typeof t.frameRate=="number"&&(r.video.mandatory.maxFrameRate=t.frameRate),await navigator.mediaDevices.getUserMedia(r)}async function XF(e){const t=await mC(e.mediaSource),n=await function(r){return new de((o,a)=>{const d=document.createElement("div");d.innerText="share screen",d.setAttribute("style","text-align: center; height: 25px; line-height: 25px; border-radius: 4px 4px 0 0; background: #D4D2D4; border-bottom:  solid 1px #B9B8B9;");const u=document.createElement("div");u.setAttribute("style","width: 100%; height: 500px; padding: 15px 25px ; box-sizing: border-box;");const h=document.createElement("div");h.innerText="Agora Web Screensharing wants to share the contents of your screen with webdemo.agorabeckon.com. Choose what you'd like to share.",h.setAttribute("style","height: 12%;");const m=document.createElement("div");m.setAttribute("style","width: 100%; height: 80%; background: #FFF; border:  solid 1px #CBCBCB; display: flex; flex-wrap: wrap; justify-content: space-around; overflow-y: scroll; padding: 0 15px; box-sizing: border-box;");const f=document.createElement("div");f.setAttribute("style","text-align: right; padding: 16px 0;");const E=document.createElement("button");E.innerHTML="cancel",E.setAttribute("style","width: 85px;"),E.onclick=()=>{document.body.removeChild(T);const R=new Error("NotAllowedError");R.name="NotAllowedError",a(R)},f.appendChild(E),u.appendChild(h),u.appendChild(m),u.appendChild(f);const T=document.createElement("div");T.setAttribute("style","position: fixed; z-index: 99999999; top: 50%; left: 50%; width: 620px; height: 525px; background: #ECECEC; border-radius: 4px; -webkit-transform: translate(-50%,-50%); transform: translate(-50%,-50%);"),T.appendChild(d),T.appendChild(u),document.body.appendChild(T),r.map(R=>{if(R.id){const A=document.createElement("div");A.setAttribute("style","width: 30%; height: 160px; padding: 20px 0; text-align: center;box-sizing: content-box;");let O=R.thumbnail;const{width:w}=O.getSize();w>1920&&(O=O.resize({width:1920})),A.innerHTML='<div style="height: 120px; display: table-cell; vertical-align: middle;"><img style="width: 100%; background: #333333; box-shadow: 1px 1px 1px 1px rgba(0, 0, 0, 0.2);" src='+O.toDataURL()+' /></div><span style="	height: 40px; line-height: 40px; display: inline-block; width: 70%; word-break: keep-all; white-space: nowrap; overflow: hidden; text-overflow: ellipsis;">'+(R.name.replace(/[\u00A0-\u9999<>\&]/g,function(x){return"&#"+x.charCodeAt(0)+";"})+"</span>"),A.onclick=()=>{document.body.removeChild(T),o(R.id)},m.appendChild(A)}})})}(t);return await fC(n,e)}async function mC(e){let t=["window","screen"];e!=="application"&&e!=="window"||(t=["window"]),e==="screen"&&(t=["screen"]);const n=EC();if(!n)throw new b(I.ELECTRON_IS_NULL);let r=null;try{var o;r=((o=n.desktopCapturer)===null||o===void 0?void 0:o.getSources({types:t}))||n.ipcRenderer.invoke("DESKTOP_CAPTURER_GET_SOURCES",{types:t})}catch{r=null}r&&r.then||(r=new de((a,d)=>{n.desktopCapturer.getSources({types:t},(u,h)=>{u?d(u):a(h)})}));try{return await r}catch(a){throw new b(I.ELECTRON_DESKTOP_CAPTURER_GET_SOURCES_ERROR,a.toString())}}let Su=null;function EC(){if(Su)return Su;try{return Su=window.require("electron"),Su}catch{return null}}function _C(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const Zm=new Vn("safari");let gC=!1,SC=!1;async function di(e,t){let n=0,r=null;for(;n<2;)try{r=await QF(e,t,n>0);break}catch(o){if(o instanceof b)throw v.error("[".concat(t,"] ").concat(o.toString())),o;const a=TC(o.name||o.code||o,o.message);if(a.code===I.MEDIA_OPTION_INVALID){v.debug("[".concat(t,"] detect media option invalid, retry")),n+=1,await Rn(500);continue}throw v.error("[".concat(t,"] ").concat(a.toString())),a}if(!r)throw new b(I.UNEXPECTED_ERROR,"can not find stream after getUserMedia");return r}async function QF(e,t,n){if(!navigator.mediaDevices||!navigator.mediaDevices.getUserMedia)throw new b(I.NOT_SUPPORTED,"can not find getUserMedia");n&&(e.video&&(delete e.video.width,delete e.video.height),e.screen&&(delete e.screen.width,delete e.screen.height));const r=bt(),o=new MediaStream;if(e.audioSource&&o.addTrack(e.audioSource),e.videoSource&&o.addTrack(e.videoSource),!e.audio&&!e.video&&!e.screen)return v.debug("Using Video Source/ Audio Source"),o;if(e.screen)if(EC())e.screen.sourceId?Ga(o,await fC(e.screen.sourceId,e.screen)):Ga(o,await XF(e.screen));else if(tm()&&e.screen.extensionId&&e.screen.mandatory){if(!r.getStreamFromExtension)throw new b(I.NOT_SUPPORTED,"This browser does not support screen sharing");v.debug("[".concat(t,'] Screen access on chrome stable, looking for extension"'));const T=await(d=e.screen.extensionId,u=t,new de((R,A)=>{try{chrome.runtime.sendMessage(d,{getStream:!0},O=>{if(!O||!O.streamId)return v.error("[".concat(u,"] No response from Chrome Plugin. Plugin not installed properly"),O),void A(new b(I.CHROME_PLUGIN_NO_RESPONSE,"No response from Chrome Plugin. Plugin not installed properly"));R(O.streamId)})}catch(O){v.error("[".concat(u,"] AgoraRTC screensharing plugin is not accessible(").concat(d,")"),O.toString()),A(new b(I.CHROME_PLUGIN_NOT_INSTALL))}}));e.screen.mandatory.chromeMediaSourceId=T,Ga(o,await navigator.mediaDevices.getUserMedia({video:{mandatory:e.screen.mandatory}}))}else if(r.getDisplayMedia){var a;e.screen.mediaSource&&GR(e.screen.mediaSource);const T={width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate,displaySurface:(a=e.screen.displaySurface)!==null&&a!==void 0?a:e.screen.mediaSource==="screen"?"monitor":e.screen.mediaSource},{selfBrowserSurface:R,surfaceSwitching:A,systemAudio:O}=e.screen,w={selfBrowserSurface:R,surfaceSwitching:A,systemAudio:O};!R&&delete w.selfBrowserSurface,!A&&delete w.surfaceSwitching,!O&&delete w.systemAudio,v.debug("[".concat(t,"] getDisplayMedia:"),JSON.stringify({video:T,audio:!!e.screenAudio,controls:w})),Ga(o,await navigator.mediaDevices.getDisplayMedia(function(x){for(var V=1;V<arguments.length;V++){var X=arguments[V]!=null?arguments[V]:{};V%2?_C(Object(X),!0).forEach(function(le){g(x,le,X[le])}):Object.getOwnPropertyDescriptors?Object.defineProperties(x,Object.getOwnPropertyDescriptors(X)):_C(Object(X)).forEach(function(le){Object.defineProperty(x,le,Object.getOwnPropertyDescriptor(X,le))})}return x}({video:T,audio:!!e.screenAudio},w)))}else{if(!Tt())throw v.error("[".concat(t,"] This browser does not support screenSharing")),new b(I.NOT_SUPPORTED,"This browser does not support screen sharing");{e.screen.mediaSource&&GR(e.screen.mediaSource);const T={video:{mediaSource:e.screen.mediaSource,width:e.screen.width,height:e.screen.height,frameRate:e.screen.frameRate}};v.debug("[".concat(t,"] getUserMedia: ").concat(JSON.stringify(T))),Ga(o,await navigator.mediaDevices.getUserMedia(T))}}var d,u;if(!e.video&&!e.audio)return o;let h={video:e.video,audio:e.audio},m=k("MEDIA_DEVICE_CONSTRAINTS");if(m)try{typeof m=="string"&&(m=JSON.parse(m)),h=function T(R,A){if(!CI(R)||!CI(A)||Array.isArray(R)&&!Array.isArray(A)||!Array.isArray(R)&&Array.isArray(A))return A;if(Array.isArray(A)&&Array.isArray(R)){const O=[...R];for(let w=0;w<A.length;w++)O[w]=T(R[w],A[w]);return O}{const O=zs({},R);for(const w in A)Object.prototype.hasOwnProperty.call(A,w)&&(Object.prototype.hasOwnProperty.call(R,w)?O[w]=T(R[w],A[w]):O[w]=A[w]);return O}}(h,m)}catch{}v.debug("[".concat(t,"] GetUserMedia"),JSON.stringify(h)),qe();let f,E=null;(kn()||Mn()||tu())&&(E=await Zm.lock());try{f=await navigator.mediaDevices.getUserMedia(h)}catch(T){throw E&&E(),T}return h.audio&&(gC=!0),h.video&&(SC=!0),Ga(o,f),E&&E(),o}function TC(e,t){switch(e){case"Starting video failed":case"OverconstrainedError":case"TrackStartError":return new b(I.MEDIA_OPTION_INVALID,"".concat(e,": ").concat(t));case"NotFoundError":case"DevicesNotFoundError":return new b(I.DEVICE_NOT_FOUND,"".concat(e,": ").concat(t));case"NotSupportedError":return new b(I.NOT_SUPPORTED,"".concat(e,": ").concat(t));case"NotReadableError":return new b(I.NOT_READABLE,"".concat(e,": ").concat(t));case"InvalidStateError":case"NotAllowedError":case"PERMISSION_DENIED":case"PermissionDeniedError":return new b(I.PERMISSION_DENIED,"".concat(e,": ").concat(t));case"ConstraintNotSatisfiedError":return new b(I.CONSTRAINT_NOT_SATISFIED,"".concat(e,": ").concat(t));default:return v.error("getUserMedia unexpected error",e),new b(I.UNEXPECTED_ERROR,"".concat(e,": ").concat(t))}}function Ga(e,t){const n=e.getVideoTracks()[0],r=e.getAudioTracks()[0],o=t.getVideoTracks()[0],a=t.getAudioTracks()[0];a&&(r&&e.removeTrack(r),e.addTrack(a)),o&&(n&&e.removeTrack(n),e.addTrack(o))}const br=new class extends gt{get state(){return this._state}set state(e){e!==this._state&&(this.emit(mo.STATE_CHANGE,e),this._state=e)}constructor(){super(),g(this,"_state",Ho.IDLE),g(this,"isAudioPermitted",!1),g(this,"isVideoPermitted",!1),g(this,"lastDeviceStatus",{audioPermitted:!1,videoPermitted:!1,hasVideoDevice:!1,hasAudioInputDevice:!1,hasAudioOutputDevice:!1}),g(this,"checkDeviceMatched",!1),g(this,"deviceInfoMap",new Map),this.init().then(()=>{var e,t;(e=navigator.mediaDevices)===null||e===void 0||(t=e.addEventListener)===null||t===void 0||t.call(e,"devicechange",this.updateDevicesInfo.bind(this)),window.setInterval(()=>{(k("ENUMERATE_DEVICES_INTERVAL")||(nu()||by()===En.HARMONY_OS)&&xs())&&this.updateDevicesInfo()},k("ENUMERATE_DEVICES_INTERVAL_TIME"))}).catch(e=>v.error(e.toString()))}async enumerateDevices(e,t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!navigator.mediaDevices||!navigator.mediaDevices.enumerateDevices)return new b(I.NOT_SUPPORTED,"enumerateDevices() not supported.").throw();const r=await navigator.mediaDevices.enumerateDevices(),o=await this.checkMediaDeviceStatus(r);o.audioPermitted&&(this.isAudioPermitted=!0),o.videoPermitted&&(this.isVideoPermitted=!0);let a=e,d=t;(this.isAudioPermitted||!o.hasAudioInputDevice||this.lastDeviceStatus.hasAudioInputDevice)&&(a=!1),(this.isVideoPermitted||!o.hasVideoDevice||this.lastDeviceStatus.hasVideoDevice)&&(d=!1);let u=null;if(!n&&(a||d)){if(Zm.isLocked&&(v.debug("[device manager] wait GUM lock"),(await Zm.lock())(),v.debug("[device manager] GUM unlock")),gC&&(a=!1,this.isAudioPermitted=!0),SC&&(d=!1,this.isVideoPermitted=!0),v.debug("[device manager] check media device permissions",e,t,a,d),a||d){try{u=await navigator.mediaDevices.getUserMedia({audio:a,video:d})}catch(h){const m=TC(h.name||h.code||h,h.message);if(m.code===I.PERMISSION_DENIED)throw m;v.warning("getUserMedia failed in getDevices",m)}a&&(this.isAudioPermitted=!0),d&&(this.isVideoPermitted=!0)}v.debug("[device manager] mic permission",e,"cam permission",t)}u&&u.getTracks().forEach(h=>h.stop()),u=null;try{return navigator.mediaDevices.enumerateDevices()}catch(h){return new b(I.ENUMERATE_DEVICES_FAILED,h.toString()).throw()}}async getRecordingDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audioinput")}async getCamerasDevices(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!1,!0,e)).filter(t=>t.kind==="videoinput")}async getSpeakers(){let e=arguments.length>0&&arguments[0]!==void 0&&arguments[0];return(await this.enumerateDevices(!0,!1,e)).filter(t=>t.kind==="audiooutput")}searchDeviceIdByName(e){let t=null;return this.deviceInfoMap.forEach(n=>{n.device.label===e&&(t=n.device.deviceId)}),t}async getDeviceById(e){const t=(await this.enumerateDevices(!0,!0,!0)).find(n=>n.deviceId===e);if(!t)throw new b(I.DEVICE_NOT_FOUND,"deviceId: ".concat(e));return t}async init(){this.state=Ho.INITING;try{await this.updateDevicesInfo(),this.state=Ho.INITEND}catch(e){if(e instanceof b&&[I.DEVICE_NOT_FOUND,I.PERMISSION_DENIED].includes(e.code))return void(this.state=Ho.INITEND);throw v.warning("Device Detection functionality cannot start properly.",e.toString()),this.state=Ho.IDLE,!function(){return typeof isSecureContext=="boolean"?isSecureContext:location.protocol==="https:"||location.protocol==="file:"||location.hostname==="localhost"||location.hostname==="127.0.0.1"||location.hostname==="::1"}()&&new b(I.WEB_SECURITY_RESTRICT,"Your context is limited by web security, please try using https protocol or localhost.").throw(),e}}async updateDevicesInfo(){let e=[];try{e=await this.enumerateDevices(!0,!0,this.lastDeviceStatus.audioPermitted&&this.lastDeviceStatus.videoPermitted)}catch(o){if(o instanceof b&&o.code===I.PERMISSION_DENIED){const a=await this.checkMediaDeviceStatus();this.lastDeviceStatus.hasAudioInputDevice=a.hasAudioInputDevice,this.lastDeviceStatus.hasAudioOutputDevice=a.hasAudioOutputDevice,this.lastDeviceStatus.hasVideoDevice=a.hasVideoDevice}throw o}const t=Date.now(),n=[];if(e[0]&&e[0].label&&this.checkDeviceMatched===!1){this.checkDeviceMatched=!0;const o=e.find(d=>d.kind==="audioinput"&&d.deviceId==="default"),a=e.find(d=>d.kind==="audiooutput"&&d.deviceId==="default");o&&a?a.groupId===o.groupId?v.debug("[device-check] default input ".concat(o.label," and output ").concat(a.label," is the same group")):v.warning("[device-check] default input ".concat(o.label," and output ").concat(a.label," is not the same group")):v.debug("[device-check] default input or output not found")}const r=await this.checkMediaDeviceStatus(e);e.forEach(o=>{if(!o.deviceId)return;const a=this.deviceInfoMap.get("".concat(o.kind,"_").concat(o.deviceId));if((a?a.state:"INACTIVE")!=="ACTIVE"){const d={initAt:t,updateAt:t,device:o,state:"ACTIVE"};this.deviceInfoMap.set("".concat(o.kind,"_").concat(o.deviceId),d),n.push(d)}a&&(a.updateAt=t)}),this.deviceInfoMap.forEach((o,a)=>{o.state==="ACTIVE"&&o.updateAt!==t&&(o.state="INACTIVE",n.push(o))}),this.state===Ho.INITEND&&n.forEach(o=>{switch(o.device.kind){case"audioinput":(this.lastDeviceStatus.audioPermitted||!this.lastDeviceStatus.hasAudioInputDevice)&&this.isAudioPermitted&&this.emit(mo.RECORDING_DEVICE_CHANGED,o);break;case"videoinput":(this.lastDeviceStatus.videoPermitted||!this.lastDeviceStatus.hasVideoDevice)&&this.isVideoPermitted&&this.emit(mo.CAMERA_DEVICE_CHANGED,o);break;case"audiooutput":(this.lastDeviceStatus.audioPermitted||!this.lastDeviceStatus.hasAudioOutputDevice)&&this.isAudioPermitted&&this.emit(mo.PLAYOUT_DEVICE_CHANGED,o)}}),r.audioPermitted&&(this.lastDeviceStatus.audioPermitted=!0,this.isAudioPermitted=!0),r.videoPermitted&&(this.lastDeviceStatus.videoPermitted=!0,this.isVideoPermitted=!0),this.lastDeviceStatus.hasAudioInputDevice=r.hasAudioInputDevice,this.lastDeviceStatus.hasAudioOutputDevice=r.hasAudioOutputDevice,this.lastDeviceStatus.hasVideoDevice=r.hasVideoDevice}async checkMediaDeviceStatus(e){if(!e)try{e=await navigator.mediaDevices.enumerateDevices()}catch(a){return new b(I.ENUMERATE_DEVICES_FAILED,a.toString()).throw()}const t=e.filter(a=>a.kind==="audioinput"),n=e.filter(a=>a.kind==="audiooutput"),r=e.filter(a=>a.kind==="audioinput"||a.kind==="audiooutput"),o=e.filter(a=>a.kind==="videoinput");return{audioPermitted:r.some(a=>a.label&&a.deviceId),videoPermitted:o.some(a=>a.label&&a.deviceId),hasAudioDevice:r.length>0,hasVideoDevice:o.length>0,hasAudioInputDevice:t.length>0,hasAudioOutputDevice:n.length>0}}},$F=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","error"],mr=new class{constructor(){g(this,"onAutoplayFailed",void 0),g(this,"elementMap",new Map),g(this,"elementStateMap",new Map),g(this,"elementsNeedToResume",[]),g(this,"sinkIdMap",new Map),g(this,"autoResumeAfterInterruption",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=this.elementStateMap.get(t),o=n.srcObject.getAudioTracks()[0];Oa()?o&&o.readyState==="live"&&Xe.curState==="running"&&(v.debug("auto resume after interruption for iOS 15"),n.pause(),n.play()):r&&r==="paused"&&o&&o.readyState==="live"&&Xe.curState==="running"&&(v.debug("auto resume after interruption for iOS"),n.play())})}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{Array.from(this.elementMap.entries()).forEach(e=>{let[t,n]=e;const r=n.srcObject.getAudioTracks()[0];r&&r.readyState==="live"&&(v.debug("auto resume after interruption inside autoResumeAfterInterruptionOnIOS15"),n.pause(),n.play())})}),this.autoResumeAudioElement(),Xe.on($t.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xe.on($t.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),Xe.on($t.STATE_CHANGE,()=>{Mn()&&Xe.prevState==="suspended"&&Xe.curState==="running"&&this.autoResumeAfterInterruption()})}async setSinkID(e,t){const n=this.elementMap.get(e);if(this.sinkIdMap.set(e,t),n)try{await n.setSinkId(t)}catch(r){throw new b(I.PERMISSION_DENIED,"can not set sink id: "+r.toString())}}play(e,t,n,r){if(this.elementMap.has(t))return;const o=document.createElement("audio");o.autoplay=!0,o.srcObject=new MediaStream([e]),this.bindAudioElementEvents(t,o),this.elementMap.set(t,o),this.elementStateMap.set(t,gn.INIT),this.setVolume(t,n);const a=this.sinkIdMap.get(t);if(a)try{o.setSinkId(a).catch(u=>{v.warning("[".concat(t,"] set sink id failed"),u.toString())})}catch(u){v.warning("[".concat(t,"] set sink id failed"),u.toString())}const d=o.play();d&&d.then&&d.catch(u=>{r&&he.autoplayFailed(r,"audio",u.message,t),v.warning("audio element play warning",u.toString()),this.elementMap.has(t)&&u.name==="NotAllowedError"&&(v.warning("detected audio element autoplay failed"),this.elementsNeedToResume.push(o),Li(()=>{this.onAutoplayFailed&&this.onAutoplayFailed(),iC()}))})}updateTrack(e,t){const n=this.elementMap.get(e);n&&(n.srcObject=new MediaStream([t]))}isPlaying(e){return this.elementMap.has(e)&&this.elementStateMap.get(e)==="playing"}setVolume(e,t){const n=this.elementMap.get(e);n&&(t=Math.max(0,Math.min(100,t)),n.volume=t/100)}stop(e){const t=this.elementMap.get(e);if(this.sinkIdMap.delete(e),!t)return;const n=this.elementsNeedToResume.indexOf(t);this.elementsNeedToResume.splice(n,1),t.srcObject=null,t.remove(),this.elementMap.delete(e),this.elementStateMap.delete(e)}bindAudioElementEvents(e,t){$F.forEach(n=>{t.addEventListener(n,r=>{const o=this.elementStateMap.get(e),a=r.type==="pause"?"paused":r.type;if(v.debug("[".concat(e,"] audio-element-status change ").concat(o," => ").concat(a)),r.type==="error"){const d=t==null?void 0:t.error;d&&v.error("[".concat(e,"] media error, code: ").concat(d.code,", message: ").concat(d.message))}this.elementStateMap.set(e,a)})})}getPlayerState(e){return this.elementStateMap.get(e)||"uninit"}autoResumeAudioElement(){const e=()=>{this.elementsNeedToResume.forEach(t=>{t.play().then(n=>{v.debug("Auto resume audio element success")}).catch(n=>{v.warning("Auto resume audio element failed!",n)})}),this.elementsNeedToResume=[]};new de(t=>{document.body?t():window.addEventListener("load",()=>t())}).then(()=>{Yc()?document.body.addEventListener("click",e,!0):(document.body.addEventListener("touchstart",e,!0),document.body.addEventListener("mousedown",e,!0))})}};function yt(){return function(e,t,n){const r=n.value;return typeof r=="function"&&(n.value=function(){this._isClosed&&new b(I.INVALID_OPERATION,"[".concat(this.getTrackId(),"] cannot operate a closed track")).print("warning");for(var o=arguments.length,a=new Array(o),d=0;d<o;d++)a[d]=arguments[d];const u=r.apply(this,a);return u instanceof de?new de((h,m)=>{u.then(h).catch(m)}):u}),n}}var ZF=Vo("Array").values,ej=jo,tj=hr,nj=H,rj=ZF,eE=Array.prototype,ij={DOMTokenList:!0,NodeList:!0},qi=function(e){var t=e.values;return e===eE||nj(eE,e)&&t===eE.values||tj(ij,ej(e))?rj:t};function vC(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Tu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?vC(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):vC(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class yC extends gt{constructor(t){super(),g(this,"name","VideoProcessorDestination"),g(this,"ID","0"),g(this,"_source",void 0),g(this,"videoContext",void 0),g(this,"inputTrack",void 0),this.videoContext=t}get kind(){return"video"}get enabled(){return!0}pipe(){throw new b(I.NOT_SUPPORTED,"VideoProcessor cannot pipe to any other Processor")}unpipe(){throw new b(I.NOT_SUPPORTED,"VideoProcessor cannot unpipe to any other Processor")}enable(){}disable(){}updateInput(t){if(t.context!==this.videoContext)throw new Error(`ProcessorContext passed to VideoTrack.processorDestination doesn't match it's belonging VideoTrack's context.
Probably you are making pipeline like this:
videoTrack1.pipe(processor).pipe(videoTrack2.processorDestination).`);t.track&&t.track!==this.inputTrack&&(this.videoContext.chained=!0,this.inputTrack=t.track,this.emit(vn.ON_TRACK,t.track))}reset(){this.inputTrack=void 0,this.videoContext.chained=!1,this.emit(vn.ON_TRACK,void 0)}}class RC extends gt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"usageRegistry",[]),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"_chained",!1),this.trackId=t,this.direction=n}async getConstraints(){return await Cn(this,nr.REQUEST_CONSTRAINTS)}async requestApplyConstraints(t,n){var r;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Rt(this,nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qi(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return v.info("processor ".concat(t.name," requestRevertConstraints for ").concat(this.trackId)),this.constraintsMap.delete(t),Rt(this,nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qi(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:a}of this.statsRegistry)try{const d=a();t.push({processorID:n,processorName:r,type:o,stats:d})}catch(d){v.error(new b(I.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof de&&(r=await r),t.push(Tu(Tu({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class CC extends gt{constructor(t){super(),g(this,"name","AudioProcessorDestination"),g(this,"ID","0"),g(this,"inputTrack",void 0),g(this,"inputNode",void 0),g(this,"audioProcessorContext",void 0),g(this,"_source",void 0),this.audioProcessorContext=t}get kind(){return"audio"}get enabled(){return!0}pipe(){throw new b(I.NOT_SUPPORTED,"AudioProcessorDestination cannot pipe to any other Processor")}unpipe(){throw new b(I.NOT_SUPPORTED,"AudioProcessor cannot unpipe to any other Processor")}enable(){}disable(){}reset(){this.inputTrack=void 0,this.inputNode=void 0,this.audioProcessorContext.chained=!1,this.emit(vn.ON_TRACK,void 0),this.emit(vn.ON_NODE,void 0)}updateInput(t){if(t.context!==this.audioProcessorContext)throw new Error(`ProcessorContext passed to AudioTrack.processorDestination doesn't match it's belonging AudioTrack's context.
        Probably you are making pipeline like this: audioTrack1.pipe(processor).pipe(audioTrack2.processorDestination).`);t.track&&this.inputTrack!==t.track&&(this.audioProcessorContext.chained=!0,this.inputTrack=t.track,this.emit(vn.ON_TRACK,this.inputTrack)),t.node&&this.inputNode!==t.node&&(this.audioProcessorContext.chained=!0,this.inputNode=t.node,this.emit(vn.ON_NODE,this.inputNode))}}class IC extends gt{set chained(t){this._chained=t}get chained(){return this._chained}constructor(t,n,r){super(),g(this,"constraintsMap",new Map),g(this,"statsRegistry",[]),g(this,"audioContext",void 0),g(this,"trackId",void 0),g(this,"direction",void 0),g(this,"usageRegistry",[]),g(this,"_chained",!1),this.audioContext=t,this.trackId=n,this.direction=r}async getConstraints(){return Cn(this,nr.REQUEST_CONSTRAINTS)}getAudioContext(){return this.audioContext}async requestApplyConstraints(t,n){var r;return v.info("processor ".concat(n.name," requestApplyConstraints for ").concat(this.trackId)),t&&this.constraintsMap.set(n,t),Rt(this,nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qi(r=this.constraintsMap).call(r)))}async requestRevertConstraints(t){var n;if(this.constraintsMap.has(t))return this.constraintsMap.delete(t),Rt(this,nr.REQUEST_UPDATE_CONSTRAINTS,Array.from(qi(n=this.constraintsMap).call(n)))}registerStats(t,n,r){this.statsRegistry.find(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n)||this.statsRegistry.push({processorName:t.name,processorID:t.ID,type:n,cb:r})}unregisterStats(t,n){const r=this.statsRegistry.findIndex(o=>o.processorID===t.ID&&o.processorName===t.name&&o.type===n);r!==-1&&this.statsRegistry.splice(r,1)}gatherStats(){const t=[];for(const{processorID:n,processorName:r,type:o,cb:a}of this.statsRegistry)try{const d=a();t.push({processorID:n,processorName:r,type:o,stats:d})}catch(d){v.error(new b(I.UNEXPECTED_ERROR,d.message))}return t}registerUsage(t,n){this.usageRegistry.find(r=>r.processorID===t.ID&&r.processorName===t.name)||this.usageRegistry.push({processorID:t.ID,processorName:t.name,cb:n})}unregisterUsage(t){const n=this.usageRegistry.findIndex(r=>r.processorID===t.ID&&r.processorName===t.name);n!==-1&&this.usageRegistry.splice(n,1)}async gatherUsage(){const t=[];if(!this.chained)return[];for(const{cb:n}of this.usageRegistry)try{let r=n();r instanceof de&&(r=await r),t.push(Tu(Tu({},r),{},{direction:this.direction}))}catch(r){v.error("gather extension usage error",r)}return t}getDirection(){return this.direction}}class tE extends gt{get isPlayed(){return!0}get isFreeze(){return!1}constructor(){super(),g(this,"context",void 0),g(this,"processSourceNode",void 0),g(this,"outputTrack",void 0),g(this,"processedNode",void 0),g(this,"clonedTrack",void 0),g(this,"outputNode",void 0),this.outputNode=new oj}setVolume(){}createOutputTrack(){throw new b(I.NOT_SUPPORTED,"can not create output MediaStreamTrack when WebAudio disabled")}getOriginVolumeLevel(){return 0}getAccurateVolumeLevel(){return 0}stopGetAudioBuffer(){}startGetAudioBuffer(){}play(){}stop(){}destroy(){}updateTrack(){}updateOriginTrack(){}createMediaStreamSourceNode(){}}class oj{disconnect(){}connect(){}}let vu,Wa=null;class sj{constructor(){g(this,"state","open"),g(this,"trigger",void 0),g(this,"tasks",[]),v.debug("[macro-task-queue] is created."),this.trigger=setTimeout(()=>{this.state="closed",v.debug("[macro-task-queue] will be closed, all remaining tasks will execute. [".concat(this.tasks.map(t=>t.key),"]")),this.trigger=void 0,this.tasks.forEach(t=>{let{func:n}=t;return n()}),this.tasks.length=0,v.debug("[macro-task-queue] is closed.")})}enqueue(t,n){this.state!=="closed"&&(this.tasks.push({key:t,func:n}),v.debug("[macro-task-queue] is queued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")))}runTask(t){if(this.state==="closed")return;const n=this.tasks.findIndex(r=>r.key===t);if(n!==-1){const r=this.tasks.splice(n,1);v.debug("[macro-task-queue] is unqueued, current queue ".concat(this.tasks.length,". ").concat(typeof t=="string"?t:"")),r[0].func()}}release(){this.trigger&&(this.state="closed",clearTimeout(this.trigger),this.trigger=void 0,this.tasks.length=0,v.debug("[macro-task-queue] is closed."))}}function nE(e){return function(t,n,r){var o;const a=(o=r.value)!==null&&o!==void 0?o:r.get,d=function(){Wa&&Wa.state==="open"&&Wa.runTask(e);for(var u=arguments.length,h=new Array(u),m=0;m<u;m++)h[m]=arguments[m];return a==null?void 0:a.apply(this,...h)};return r.value?r.value=d:r.get=d,r}}var AC,OC,wC,NC,bC,DC,PC,LC,kC,MC,UC,xC,VC,FC,jC,BC,GC,WC,HC,KC,zC,Qe,YC,qC,JC,XC,QC,$C,Ji,ZC,eI,tI,nI,rI,iI,oI,sI,aI,cI,dI,lI,Nn;function uI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function rE(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}(function(e){e.UPDATE_TRACK_SOURCE="update-track-source"})(vu||(vu={}));let yn=(AC=nE("INIT_WEBAUDIO"),OC=nE("INIT_WEBAUDIO"),wC=nE("INIT_WEBAUDIO"),NC=Te({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),bC=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),DC=yt(),PC=ja("LocalAudioTrack","_enabledMutex"),LC=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),kC=yt(),MC=ja("LocalAudioTrack","_enabledMutex"),UC=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),xC=yt(),VC=yt(),FC=yt(),jC=Te({argsMap:e=>[e.getTrackId()]}),BC=yt(),GC=Te({argsMap:e=>[e.getTrackId()]}),WC=yt(),HC=Te({argsMap:e=>[e.getTrackId()]}),KC=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),zC=Te({argsMap:e=>[e.getTrackId()]}),Y((Qe=class extends Xm{get _source(){return this._trackSource}set _source(e){this._trackSource=e}get processorContext(){return this._processorContext}set processorContext(e){this._processorContext=e}get processorDestination(){return this._processorDestination}set processorDestination(e){this._processorDestination=e}get isPlaying(){return this._useAudioElement?mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"LocalAudioTrack"}constructor(e,t,n,r,o){super(e,n),g(this,"trackMediaType","audio"),g(this,"_encoderConfig",void 0),g(this,"_trackSource",void 0),g(this,"_enabled",!0),g(this,"_volume",100),g(this,"_useAudioElement",!1),g(this,"_bypassWebAudio",!1),g(this,"processor",void 0),g(this,"_processorContext",void 0),g(this,"_processorDestination",void 0),g(this,"_getOriginVolumeLevel",void 0),this._encoderConfig=t,this._getOriginVolumeLevel=!!r;const a=()=>{this.processorContext=new IC(this._source.context,this.getTrackId(),"local"),this.processorDestination=new CC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(tr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})},d=o&&kn()&&!lC();k("DISABLE_WEBAUDIO")?(this._source=new tE,this._useAudioElement=!0,this._bypassWebAudio=!0):d?this._source=new tE:(this._source=new $m(e,!1,this._getOriginVolumeLevel?e:void 0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0)),a(),!k("DISABLE_WEBAUDIO")&&d&&(Wa||(Wa=new sj),Wa).enqueue("INIT_WEBAUDIO",()=>{this._source=new $m(e,!1,this._getOriginVolumeLevel?e:void 0),k("LOCAL_AUDIO_TRACK_USES_WEB_AUDIO")||(this._useAudioElement=!0),a(),this.emit(vu.UPDATE_TRACK_SOURCE)})}setVolume(e){st(e,"volume",0,1e3),this._volume=e,this._source.setVolume(e/100),this._useAudioElement&&mr.setVolume(this.getTrackId(),e);try{if(this._bypassWebAudio)return void v.debug("[".concat(this.getTrackId(),"] setVolume returned because no pass through WebAudio."));const t=this._source.createOutputTrack();this._mediaStreamTrack!==t&&(this._mediaStreamTrack=t,Rt(this,Re.NEED_REPLACE_TRACK,this).then(()=>{v.debug("[".concat(this.getTrackId(),"] replace web audio track success"))}).catch(n=>{v.warning("[".concat(this.getTrackId(),"] replace web audio track failed"),n)}))}catch{}}getVolumeLevel(){return this._muted&&this.enabled&&this._getOriginVolumeLevel?this._source.getOriginVolumeLevel():this._source.getAccurateVolumeLevel()}async setPlaybackDevice(e){if(!this._useAudioElement)throw new b(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mr.setSinkID(this.getTrackId(),e)}async setEnabled(e,t,n){return this._setEnabled(e,t,n)}async _setEnabled(e,t,n){if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){this._originMediaStreamTrack.enabled=!0;try{n||(this._enabled=!0),await Rt(this,Re.NEED_ENABLE_TRACK,this),v.info("[".concat(this.getTrackId(),"] setEnabled to ").concat(e," success"))}catch(r){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}}else{this._originMediaStreamTrack.enabled=!1,n||(this._enabled=!1);try{await Rt(this,Re.NEED_DISABLE_TRACK,this)}catch(r){throw n||(this._enabled=!0),v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}}}async setMuted(e){e!==this._muted&&(this.stateCheck("muted",e),this._muted=e,this._originMediaStreamTrack.enabled=!e,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(e)),e?await Rt(this,Re.NEED_MUTE_TRACK,this):await Rt(this,Re.NEED_UNMUTE_TRACK,this))}getStats(){return nd(()=>{v.warning("[deprecated] LocalAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalAudioStats instead")},"localAudioTrackGetStatsWarning"),li(this,Re.GET_STATS)||rE({},Um)}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tr.ON_AUDIO_BUFFER),this._source.on(tr.ON_AUDIO_BUFFER,n=>e(n))}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] start audio playback in element")),mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._useAudioElement?mr.stop(this.getTrackId()):this._source.stop()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe(),this._source.destroy()}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}async _updateOriginMediaStreamTrack(e,t){this._originMediaStreamTrack!==e&&(this._originMediaStreamTrack.removeEventListener("ended",this._handleTrackEnded),e.addEventListener("ended",this._handleTrackEnded),t&&this._originMediaStreamTrack.stop(),this._originMediaStreamTrack=e,this._muted&&(this._originMediaStreamTrack.enabled=!1),this.processor&&this.processor.updateInput({track:e,context:this.processorContext}),this._mediaStreamTrack!==this._source.outputTrack?(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Rt(this,Re.NEED_REPLACE_TRACK,this)):this._source.updateTrack(this._originMediaStreamTrack),this._getOriginVolumeLevel&&this._source.updateOriginTrack(e))}renewMediaStreamTrack(e){return de.resolve(void 0)}pipe(e){if(this._bypassWebAudio)throw new b(I.INVALID_OPERATION,"Can not process AudioTrack when bypassWebAudio set to true.");if(this.processor===e)return e;if(e._source)throw new b(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e),await Rt(this,Re.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Rt(this,Re.NEED_REPLACE_TRACK,this))}),this.processorDestination.on(vn.ON_NODE,e=>{this._source.processedNode=e})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vn.ON_TRACK),this.processorDestination.removeAllListeners(vn.ON_NODE)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(nr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(nr.REQUEST_CONSTRAINTS)}}).prototype,"_source",[AC],Object.getOwnPropertyDescriptor(Qe.prototype,"_source"),Qe.prototype),Y(Qe.prototype,"processorContext",[OC],Object.getOwnPropertyDescriptor(Qe.prototype,"processorContext"),Qe.prototype),Y(Qe.prototype,"processorDestination",[wC],Object.getOwnPropertyDescriptor(Qe.prototype,"processorDestination"),Qe.prototype),Y(Qe.prototype,"setVolume",[NC],Object.getOwnPropertyDescriptor(Qe.prototype,"setVolume"),Qe.prototype),Y(Qe.prototype,"setPlaybackDevice",[bC,DC],Object.getOwnPropertyDescriptor(Qe.prototype,"setPlaybackDevice"),Qe.prototype),Y(Qe.prototype,"setEnabled",[PC,LC,kC],Object.getOwnPropertyDescriptor(Qe.prototype,"setEnabled"),Qe.prototype),Y(Qe.prototype,"setMuted",[MC,UC,xC],Object.getOwnPropertyDescriptor(Qe.prototype,"setMuted"),Qe.prototype),Y(Qe.prototype,"getStats",[VC],Object.getOwnPropertyDescriptor(Qe.prototype,"getStats"),Qe.prototype),Y(Qe.prototype,"setAudioFrameCallback",[FC],Object.getOwnPropertyDescriptor(Qe.prototype,"setAudioFrameCallback"),Qe.prototype),Y(Qe.prototype,"play",[jC,BC],Object.getOwnPropertyDescriptor(Qe.prototype,"play"),Qe.prototype),Y(Qe.prototype,"stop",[GC,WC],Object.getOwnPropertyDescriptor(Qe.prototype,"stop"),Qe.prototype),Y(Qe.prototype,"close",[HC],Object.getOwnPropertyDescriptor(Qe.prototype,"close"),Qe.prototype),Y(Qe.prototype,"pipe",[KC],Object.getOwnPropertyDescriptor(Qe.prototype,"pipe"),Qe.prototype),Y(Qe.prototype,"unpipe",[zC],Object.getOwnPropertyDescriptor(Qe.prototype,"unpipe"),Qe.prototype),Qe),yu=(YC=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),qC=yt(),JC=ja("MicrophoneAudioTrack","_enabledMutex"),XC=Te({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),QC=yt(),$C=Te({argsMap:e=>[e.getTrackId()]}),Y((Ji=class extends yn{get __className__(){return"MicrophoneAudioTrack"}constructor(e,t,n,r){super(e,t.encoderConfig?fu(t.encoderConfig):{},r,k("GET_VOLUME_OF_MUTED_AUDIO_TRACK"),!0),g(this,"_config",void 0),g(this,"_deviceName","default"),g(this,"_constraints",void 0),g(this,"_originalConstraints",void 0),g(this,"_enabled",!0),this._config=t,this._constraints=n,this._originalConstraints=n,this._deviceName=e.label,typeof t.bypassWebAudio=="boolean"&&(this._bypassWebAudio=t.bypassWebAudio),(Oa()||rm())&&Xe.bindInterruptDetectorTrack(this),this.on(vu.UPDATE_TRACK_SOURCE,()=>{this.bindProcessorContextEvents()}),lC()&&this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] start set device to ").concat(e)),this._enabled)try{const t=await br.getDeviceById(e),n={};n.audio=rE({},this._constraints),n.audio.deviceId={exact:e},this._originMediaStreamTrack.stop();let r=null;try{r=await di(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await di({audio:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!1),this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await br.getDeviceById(e);this._deviceName=t.label,this._config.microphoneId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] set device to ").concat(e," success"))}async setEnabled(e,t,n){if(t)return v.debug("[".concat(this.getTrackId(),"] setEnabled false (do not close microphone)")),await super._setEnabled(e);if(!n){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),!e){var r;this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop(),(r=this._source.clonedTrack)===null||r===void 0||r.stop(),n||(this._enabled=!1);try{await Rt(this,Re.NEED_DISABLE_TRACK,this)}catch(d){throw v.error("[".concat(this.getTrackId(),"] setEnabled false failed"),d.toString()),d}return}const o=rE({},this._constraints),a=br.searchDeviceIdByName(this._deviceName);a&&!o.deviceId&&(o.deviceId=a);try{n||(this._enabled=!0);const d=await di({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(d.getAudioTracks()[0],!1),await Rt(this,Re.NEED_ENABLE_TRACK,this)}catch(d){throw n||(this._enabled=!1),v.error("[".concat(this.getTrackId(),"] setEnabled true failed"),d.toString()),d}v.info("[".concat(this.getTrackId(),"] setEnabled success"))}close(){super.close(),(Oa()||rm())&&Xe.unbindInterruptDetectorTrack(this)}onTrackEnded(){if((Mn()||zi())&&this._enabled&&!this._isClosed&&Xe.duringInterruption){const e=async()=>{Xe.off($t.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture microphone media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xe.on($t.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yo.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=br.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId=n),this._constraints=t,this._enabled){this._originMediaStreamTrack.stop();const r=await di({audio:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(r.getAudioTracks()[0],!0)}}bindProcessorContextEvents(){this.processorContext.on(nr.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){n(r)}}),this.processorContext.on(nr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[YC,qC],Object.getOwnPropertyDescriptor(Ji.prototype,"setDevice"),Ji.prototype),Y(Ji.prototype,"setEnabled",[JC,XC,QC],Object.getOwnPropertyDescriptor(Ji.prototype,"setEnabled"),Ji.prototype),Y(Ji.prototype,"close",[$C],Object.getOwnPropertyDescriptor(Ji.prototype,"close"),Ji.prototype),Ji),aj=(ZC=Te({argsMap:(e,t)=>[e.getTrackId(),t,e.duration]}),eI=yt(),tI=Te({argsMap:e=>[e.getTrackId()]}),nI=yt(),rI=Te({argsMap:e=>[e.getTrackId()]}),iI=yt(),oI=Te({argsMap:e=>[e.getTrackId()]}),sI=yt(),aI=Te({argsMap:e=>[e.getTrackId()]}),cI=yt(),dI=Te({argsMap:e=>[e.getTrackId()]}),lI=yt(),Y((Nn=class extends yn{get __className__(){return"BufferSourceAudioTrack"}constructor(e,t,n,r){super(t.createOutputTrack(),n,r),g(this,"source",void 0),g(this,"_bufferSource",void 0),this.source=e,this._bufferSource=t,this._bufferSource.on(tr.AUDIO_SOURCE_STATE_CHANGE,o=>{this.safeEmit(Yo.SOURCE_STATE_CHANGE,o)});try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}}get currentState(){return this._bufferSource.currentState}get duration(){return this._bufferSource.duration}get playbackSpeed(){return this._bufferSource.playbackSpeed}getCurrentTime(){return this._bufferSource.currentTime}startProcessAudioBuffer(e){e&&this._bufferSource.updateOptions(e),this._bufferSource.startProcessAudioBuffer()}pauseProcessAudioBuffer(){this._bufferSource.pauseProcessAudioBuffer()}seekAudioBuffer(e){this._bufferSource.seekAudioBuffer(e)}resumeProcessAudioBuffer(){this._bufferSource.resumeProcessAudioBuffer()}stopProcessAudioBuffer(){this._bufferSource.stopProcessAudioBuffer()}setAudioBufferPlaybackSpeed(e){st(e,"speed",0),this._bufferSource.setAudioBufferPlaybackSpeed(e)}}).prototype,"startProcessAudioBuffer",[ZC,eI],Object.getOwnPropertyDescriptor(Nn.prototype,"startProcessAudioBuffer"),Nn.prototype),Y(Nn.prototype,"pauseProcessAudioBuffer",[tI,nI],Object.getOwnPropertyDescriptor(Nn.prototype,"pauseProcessAudioBuffer"),Nn.prototype),Y(Nn.prototype,"seekAudioBuffer",[rI,iI],Object.getOwnPropertyDescriptor(Nn.prototype,"seekAudioBuffer"),Nn.prototype),Y(Nn.prototype,"resumeProcessAudioBuffer",[oI,sI],Object.getOwnPropertyDescriptor(Nn.prototype,"resumeProcessAudioBuffer"),Nn.prototype),Y(Nn.prototype,"stopProcessAudioBuffer",[aI,cI],Object.getOwnPropertyDescriptor(Nn.prototype,"stopProcessAudioBuffer"),Nn.prototype),Y(Nn.prototype,"setAudioBufferPlaybackSpeed",[dI,lI],Object.getOwnPropertyDescriptor(Nn.prototype,"setAudioBufferPlaybackSpeed"),Nn.prototype),Nn);class rr extends yn{get __className__(){return"MixingAudioTrack"}get isActive(){for(const t of this.trackList)if(t._enabled&&!t._isClosed&&!t.muted)return!0;return!1}constructor(){const t=Ba().createMediaStreamDestination();super(t.stream.getAudioTracks()[0],void 0,ut(8,"track-mix-")),g(this,"trackList",void 0),g(this,"destNode",void 0);try{this._mediaStreamTrack=this._source.createOutputTrack()}catch{}this.destNode=t,this.trackList=[]}hasAudioTrack(t){return this.trackList.indexOf(t)!==-1}addAudioTrack(t){this.trackList.indexOf(t)===-1?(v.debug("add ".concat(t.getTrackId()," to mixing track")),t._source.outputNode.connect(this.destNode),this.trackList.push(t),this.updateEncoderConfig()):v.debug("track ".concat(t.getTrackId()," is already added"))}removeAudioTrack(t){if(this.trackList.indexOf(t)!==-1){v.debug("remove ".concat(t.getTrackId()," from mixing track"));try{t._source.outputNode.disconnect(this.destNode)}catch{}sE(this.trackList,t),this.updateEncoderConfig()}}updateEncoderConfig(){const t={};this.trackList.forEach(n=>{n._encoderConfig&&((n._encoderConfig.bitrate||0)>(t.bitrate||0)&&(t.bitrate=n._encoderConfig.bitrate),(n._encoderConfig.sampleRate||0)>(t.sampleRate||0)&&(t.sampleRate=n._encoderConfig.sampleRate),(n._encoderConfig.sampleSize||0)>(t.sampleSize||0)&&(t.sampleSize=n._encoderConfig.sampleSize),n._encoderConfig.stereo&&(t.stereo=!0))}),this._encoderConfig=t}_updateRtpTransceiver(t){this._rtpTransceiver!==t&&(this._rtpTransceiver=t,this.trackList.forEach(n=>{n instanceof rr?n.emit(Zc.TRANSCEIVER_UPDATED,t):n._updateRtpTransceiver(t)}))}}class cj extends gt{constructor(){super(...arguments),g(this,"resultStorage",new Map)}setLocalAudioStats(t,n,r){this.record("AUDIO_INPUT_LEVEL_TOO_LOW",t,this.checkAudioInputLevel(r,n)),this.record("SEND_AUDIO_BITRATE_TOO_LOW",t,this.checkSendAudioBitrate(r,n))}setLocalVideoStats(t,n,r){this.record("SEND_VIDEO_BITRATE_TOO_LOW",t,this.checkSendVideoBitrate(r,n)),this.record("FRAMERATE_INPUT_TOO_LOW",t,this.checkFramerateInput(r,n)),this.record("FRAMERATE_SENT_TOO_LOW",t,this.checkFramerateSent(r))}setRemoteAudioStats(t,n){const r=t.getUserId();this.record("AUDIO_OUTPUT_LEVEL_TOO_LOW",r,this.checkAudioOutputLevel(n))}setRemoteVideoStats(t,n){const r=t.getUserId();this.record("RECV_VIDEO_DECODE_FAILED",r,this.checkVideoDecode(n))}record(t,n,r){if(k("STATS_UPDATE_INTERVAL")>500)return;this.resultStorage.has(t)||this.resultStorage.set(t,{result:[],isPrevNormal:!0});const o=this.resultStorage.get(t);if(o&&(o.result.push(r),o.result.length>=5)){const a=o.result.includes(!0);o.isPrevNormal&&!a&&this.emit("exception",hI[t],t,n),!o.isPrevNormal&&a&&this.emit("exception",hI[t]+2e3,t+"_RECOVER",n),o.isPrevNormal=a,o.result=[]}}checkAudioOutputLevel(t){return!(t.receiveBitrate>0&&t.receiveLevel===0)}checkAudioInputLevel(t,n){return n instanceof rr&&!n.isActive||!!n.muted||t.sendVolumeLevel!==0}checkFramerateInput(t,n){let r=null;n._encoderConfig&&n._encoderConfig.frameRate&&(r=_o(n._encoderConfig.frameRate));const o=t.captureFrameRate;return!r||!o||!(r>10&&o<5||r<10&&r>=5&&o<=1)}checkFramerateSent(t){return!(t.captureFrameRate&&t.sendFrameRate&&t.captureFrameRate>5&&t.sendFrameRate<=1)}checkSendVideoBitrate(t,n){return!!n.muted||t.sendBitrate!==0}checkSendAudioBitrate(t,n){return n instanceof rr&&!n.isActive||!!n.muted||t.sendBitrate!==0}checkVideoDecode(t){return t.receiveBitrate===0||t.decodeFrameRate!==0}}const hI={FRAMERATE_INPUT_TOO_LOW:1001,FRAMERATE_SENT_TOO_LOW:1002,SEND_VIDEO_BITRATE_TOO_LOW:1003,RECV_VIDEO_DECODE_FAILED:1005,AUDIO_INPUT_LEVEL_TOO_LOW:2001,AUDIO_OUTPUT_LEVEL_TOO_LOW:2002,SEND_AUDIO_BITRATE_TOO_LOW:2003},zr=new class{markSubscribeStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/subscribe-").concat(t))}markPublishStart(e,t){performance.mark("agora-web-sdk/".concat(e,"/publish-").concat(t))}measureFromSubscribeStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/subscribe-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}measureFromPublishStart(e,t){const n=performance.getEntriesByName("agora-web-sdk/".concat(e,"/publish-").concat(t));if(n.length>0){const r=n[n.length-1];return Math.round(performance.now()-r.startTime)}return 0}};function pI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ks(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?pI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):pI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Ha{constructor(t){g(this,"store",void 0),g(this,"onStatsException",void 0),g(this,"onUploadPublishDuration",void 0),g(this,"onStatsChanged",void 0),g(this,"localStats",new Map),g(this,"remoteStats",new Map),g(this,"updateStatsInterval",void 0),g(this,"trafficStats",void 0),g(this,"trafficStatsPeerList",[]),g(this,"uplinkStats",void 0),g(this,"exceptionMonitor",void 0),g(this,"p2pChannel",void 0),g(this,"scalabilityMode",Zf.L1T1),g(this,"updateStats",()=>{this.p2pChannel&&(this.updateRemoteStats(this.p2pChannel),this.updateLocalStats(this.p2pChannel))}),this.store=t,this.updateStatsInterval=window.setInterval(this.updateStats,1e3),this.exceptionMonitor=new cj,this.exceptionMonitor.on("exception",(n,r,o)=>{this.onStatsException&&this.onStatsException(n,r,o)})}reset(){this.localStats=new Map,this.remoteStats=new Map,this.trafficStats=void 0,this.trafficStatsPeerList=[],this.uplinkStats=void 0}getLocalAudioTrackStats(){return this.localStats.get(ue.LocalAudioTrack)||Ks({},Um)}getLocalVideoTrackStats(){return this.localStats.get(ue.LocalVideoTrack)||Ks({},xm)}getRemoteAudioTrackStats(t){const n=(a,d)=>{if(!this.trafficStats)return d;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(d.publishDuration=u.B_ppad+(Date.now()-this.trafficStats.timestamp)),d},r={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.audioStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[d,{audioStats:u}]=a;u&&(r[d]=n(d,u))});return r}getRemoteNetworkQualityStats(t){const n={};if(t){var r;const o=(r=this.remoteStats.get(t))===null||r===void 0?void 0:r.networkStats;o&&(n[t]=o)}else Array.from(this.remoteStats.entries()).forEach(o=>{let[a,{networkStats:d}]=o;d&&(n[a]=d)});return n}getRemoteVideoTrackStats(t){const n=(a,d)=>{if(!this.trafficStats)return d;const u=this.trafficStats.peer_delay.find(h=>h.peer_uid===a);return u&&(d.publishDuration=u.B_ppvd+(Date.now()-this.trafficStats.timestamp)),d},r={};if(t){var o;const a=(o=this.remoteStats.get(t))===null||o===void 0?void 0:o.videoStats;a&&(r[t]=n(t,a))}else Array.from(this.remoteStats.entries()).forEach(a=>{let[d,{videoStats:u}]=a;u&&(r[d]=n(d,u))});return r}getRTCStats(){let t=0,n=0,r=0,o=0;const a=this.localStats.get(ue.LocalAudioTrack);a&&(t+=a.sendBytes,n+=a.sendBitrate);const d=this.localStats.get(ue.LocalVideoTrack);d&&(t+=d.sendBytes,n+=d.sendBitrate);const u=this.localStats.get(ue.LocalVideoLowTrack);u&&(t+=u.sendBytes,n+=u.sendBitrate),this.remoteStats.forEach(m=>{let{audioStats:f,videoStats:E}=m;f&&(r+=f.receiveBytes,o+=f.receiveBitrate),E&&(r+=E.receiveBytes,o+=E.receiveBitrate)});let h=1;return this.trafficStats&&(h+=this.trafficStats.peer_delay.length),{Duration:0,UserCount:h,SendBitrate:n,SendBytes:t,RecvBytes:r,RecvBitrate:o,OutgoingAvailableBandwidth:this.uplinkStats?this.uplinkStats.B_uab/1e3:0,RTT:this.trafficStats?2*this.trafficStats.B_acd:0}}addLocalStats(t){this.localStats.set(t,void 0)}removeLocalStats(t){t?this.localStats.delete(t):this.localStats.clear()}addRemoteStats(t){this.remoteStats.set(t,{})}removeRemoteStats(t){t?this.remoteStats.delete(t):this.remoteStats.clear()}addP2PChannel(t){this.p2pChannel=t}updateTrafficStats(t){t.peer_delay=t.peer_delay.filter(n=>n.B_ppad!==void 0||n.B_ppvd!==void 0),t.peer_delay.filter(n=>this.trafficStatsPeerList.indexOf(n.peer_uid)===-1).forEach(n=>{var r;const o=(r=this.p2pChannel)===null||r===void 0?void 0:r.getRemoteMedia(n.peer_uid),a=o!=null&&o.videoSSRC?zr.measureFromSubscribeStart(this.store.clientId,o.videoSSRC):0,d=o!=null&&o.audioSSRC?zr.measureFromSubscribeStart(this.store.clientId,o.audioSSRC):0;n.B_ppad!==void 0&&n.B_ppvd!==void 0&&(this.onUploadPublishDuration&&this.onUploadPublishDuration(n.peer_uid,n.B_ppad,n.B_ppvd,a>d?a:d),this.trafficStatsPeerList.push(n.peer_uid))}),this.trafficStats=t}updateUplinkStats(t){this.uplinkStats&&this.uplinkStats.B_fir!==t.B_fir&&v.debug("[".concat(this.store.clientId,"]: Period fir changes to ").concat(t.B_fir)),this.uplinkStats=t}static isRemoteVideoFreeze(t,n,r){if(!t)return!1;const o=!!r&&n.framesDecodeFreezeTime>r.framesDecodeFreezeTime,a=!r||n.framesDecodeCount>r.framesDecodeCount;return o||!a}static isRemoteAudioFreeze(t){return!!t&&t._isFreeze()}isLocalVideoFreeze(t){return!(!t.inputFrame||!t.sentFrame)&&t.inputFrame.frameRate>5&&t.sentFrame.frameRate<3}updateLocalStats(t){Array.from(this.localStats.entries()).forEach(n=>{let[r,o]=n;switch(r){case ue.LocalVideoTrack:case ue.LocalVideoLowTrack:{const d=o,u=Ks({},xm),h=t.getStats(),m=t.getLocalMedia(r);if(h){const f=h.videoSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(f){const E=t.getLocalVideoSize(),T=t.getEncoderConfig(ue.LocalVideoTrack);f.codec!=="H264"&&f.codec!=="H265"&&f.codec!=="VP8"&&f.codec!=="VP9"&&f.codec!=="AV1X"&&f.codec!=="AV1"||(u.codecType=f.codec),u.sendBytes=f.bytes,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0,f.inputFrame?(u.captureFrameRate=f.inputFrame.frameRate,u.captureResolutionHeight=f.inputFrame.height,u.captureResolutionWidth=f.inputFrame.width):E&&(u.captureResolutionWidth=E.width,u.captureResolutionHeight=E.height),f.sentFrame?(u.sendFrameRate=f.sentFrame.frameRate,u.sendResolutionHeight=f.sentFrame.height,u.sendResolutionWidth=f.sentFrame.width):E&&(u.sendResolutionWidth=E.width,u.sendResolutionHeight=E.height),f.avgEncodeMs&&(u.encodeDelay=f.avgEncodeMs),T&&T.bitrateMax&&(u.targetSendBitrate=1e3*T.bitrateMax),u.sendPackets=f.packets,u.sendPacketsLost=f.packetsLost,u.totalDuration=d?d.totalDuration+1:1,u.totalFreezeTime=d?d.totalFreezeTime:0,this.isLocalVideoFreeze(f)&&(u.totalFreezeTime+=1),f.scalabilityMode&&this.scalabilityMode!==f.scalabilityMode&&(v.debug("[".concat(this.store.clientId,"]: The scalabilityMode of the video sending stream is ").concat(f.scalabilityMode)),this.scalabilityMode=f.scalabilityMode)}this.trafficStats&&(u.sendPacketsLost=this.trafficStats.B_pvlr4/100)}var a;this.localStats.set(r,u),((d==null?void 0:d.sendResolutionWidth)!==u.sendResolutionWidth||(d==null?void 0:d.sendResolutionHeight)!==u.sendResolutionHeight)&&((a=this.onStatsChanged)===null||a===void 0||a.call(this,"resolution",{width:u.sendResolutionWidth,height:u.sendResolutionHeight})),u&&m&&this.exceptionMonitor.setLocalVideoStats(this.store.uid,m.track,u);break}case ue.LocalAudioTrack:{const d=o,u=Ks({},Um),h=t.getStats(),m=t.getLocalMedia(r);if(h){const f=h.audioSend.find(E=>E.ssrc===(m==null?void 0:m.ssrcs[0].ssrcId));if(f){if(f.codec!=="opus"&&f.codec!=="aac"&&f.codec!=="PCMU"&&f.codec!=="PCMA"&&f.codec!=="G722"||(u.codecType=f.codec),f.inputLevel)u.sendVolumeLevel=Math.round(32767*f.inputLevel);else{const E=t.getLocalAudioVolume();E&&(u.sendVolumeLevel=Math.round(32767*E))}u.sendBytes=f.bytes,u.sendPackets=f.packets,u.sendPacketsLost=f.packetsLost,u.sendBitrate=d?8*Math.max(0,u.sendBytes-d.sendBytes):0}}this.trafficStats&&(u.sendPacketsLost=this.trafficStats.B_pvlr4/100),this.localStats.set(ue.LocalAudioTrack,u),u&&m&&this.exceptionMonitor.setLocalAudioStats(this.store.uid,m.track,u);break}}})}updateRemoteStats(t){Array.from(this.remoteStats.entries()).forEach(n=>{let[r,{videoStats:o,audioStats:a,videoPcStats:d}]=n;const u=a,h=o,m=d,f=Ks({},VR),E=Ks({},FR),T=Ks({},BV),{audioTrack:R,videoTrack:A,audioSSRC:O,videoSSRC:w}=t.getRemoteMedia(r),x=t.getStats(),V=x==null?void 0:x.audioRecv.find($=>$.ssrc===O),X=x==null?void 0:x.videoRecv.find($=>$.ssrc===w),le=this.trafficStats&&this.trafficStats.peer_delay.find($=>$.peer_uid===r);if(V&&(V.codec!=="opus"&&V.codec!=="aac"&&V.codec!=="PCMU"&&V.codec!=="PCMA"&&V.codec!=="G722"||(f.codecType=V.codec),V.outputLevel?f.receiveLevel=Math.round(32767*V.outputLevel):R&&(f.receiveLevel=Math.round(32767*R.getVolumeLevel())),f.receiveBytes=V.bytes,f.receivePackets=V.packets,f.receivePacketsLost=V.packetsLost,f.packetLossRate=f.receivePacketsLost/(f.receivePackets+f.receivePacketsLost),f.receiveBitrate=u?8*Math.max(0,f.receiveBytes-u.receiveBytes):0,f.totalDuration=u?u.totalDuration+1:1,f.totalFreezeTime=u?u.totalFreezeTime:0,f.freezeRate=f.totalFreezeTime/f.totalDuration,f.receiveDelay=V.jitterBufferMs,f.totalDuration>10&&Ha.isRemoteAudioFreeze(R)&&(f.totalFreezeTime+=1)),X){X.codec!=="H264"&&X.codec!=="H265"&&X.codec!=="VP8"&&X.codec!=="VP9"&&X.codec!=="AV1X"&&X.codec!=="AV1"||(E.codecType=X.codec),E.receiveBytes=X.bytes,E.receiveBitrate=h?8*Math.max(0,E.receiveBytes-h.receiveBytes):0,E.decodeFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,E.renderFrameRate=X.decodeFrameRate<0?0:X.decodeFrameRate,X.outputFrame&&(E.renderFrameRate=X.outputFrame.frameRate),X.receivedFrame?(E.receiveFrameRate=X.receivedFrame.frameRate,E.receiveResolutionHeight=X.receivedFrame.height,E.receiveResolutionWidth=X.receivedFrame.width):A&&(E.receiveResolutionHeight=A._videoHeight||0,E.receiveResolutionWidth=A._videoWidth||0),X.framesRateFirefox!==void 0&&(E.receiveFrameRate=Math.round(X.framesRateFirefox)),E.receivePackets=X.packets,E.receivePacketsLost=X.packetsLost,E.packetLossRate=E.receivePacketsLost/(E.receivePackets+E.receivePacketsLost),E.totalDuration=h?h.totalDuration+1:1,E.totalFreezeTime=h?h.totalFreezeTime:0,E.receiveDelay=X.jitterBufferMs||0;const $=!!w&&t.getRemoteVideoIsReady(w);A&&$&&Ha.isRemoteVideoFreeze(A,X,m)&&(E.totalFreezeTime+=1),E.freezeRate=E.totalFreezeTime/E.totalDuration}le&&(f.end2EndDelay=le.B_ad,E.end2EndDelay=le.B_vd,f.transportDelay=le.B_ed,E.transportDelay=le.B_ed,f.currentPacketLossRate=le.B_ealr4/100,E.currentPacketLossRate=le.B_evlr4/100,T.uplinkNetworkQuality=le.B_punq?le.B_punq:0,T.downlinkNetworkQuality=le.B_pdnq?le.B_pdnq:0),this.remoteStats.set(r,{audioStats:f,videoStats:E,videoPcStats:X,networkStats:T}),R&&this.exceptionMonitor.setRemoteAudioStats(R,f),A&&this.exceptionMonitor.setRemoteVideoStats(A,E)})}}const Eo=new class extends gt{get visibility(){return document.visibilityState}get lastHiddenTime(){return this._lastHiddenTime}get lastVisibleTime(){return this._lastVisibleTime}constructor(){super(),g(this,"_lastHiddenTime",0),g(this,"_lastVisibleTime",0),document.addEventListener("visibilitychange",()=>{document.visibilityState==="hidden"?this._lastHiddenTime=performance.now():this._lastVisibleTime=performance.now(),v.debug("document visibility went ".concat(document.visibilityState)),this.emit("VISIBILITY_CHANGE",document.visibilityState)})}};function fI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ru(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?fI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):fI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Cu(e){return e.match(/^[\.\:\d]+$/)?"".concat(e.replace(/[^\d]/g,"-"),".").concat(k("TURN_DOMAIN")):(v.info("Cannot recognized as IP address ".concat(e,". Used As Host instead")),e)}function mI(e,t){var n,r;const o=k("GATEWAY_DOMAINS");let a=o[1]&&t.indexOf(o[1])!==-1?1:0;e.addresses=e.addresses||[];const d=e.addresses.map(h=>h.domain_prefix?{address:"".concat(h.domain_prefix,".").concat(o[a++%o.length],":").concat(h.port)}:h.ip.match(/^[\.\:\d]+$/)?{ip:h.ip,port:h.port,address:"".concat(h.ip.replace(/[^\d]/g,"-"),".").concat(o[a++%o.length],":").concat(h.port)}:(v.info("Cannot recognized as IP address ".concat(h.ip,". Used As Host instead")),{ip:h.ip,port:h.port,address:"".concat(h.ip,":").concat(h.port)}));if((n=e.detail)!==null&&n!==void 0&&n[18]&&typeof((r=e.detail)===null||r===void 0?void 0:r[18])=="string"){const h=e.detail[18],m=h==null?void 0:h.split(";");for(let f=0;f<m.length;f++){var u;const E=uo(u=m[f]).call(u);d[f]&&E&&(d[f].ip6=E)}}return{gatewayAddrs:d,uid:e.uid,cid:e.cid,cert:e.cert,vid:e.detail&&e.detail[8],uni_lbs_ip:e.detail&&e.detail[1],res:e,csIp:e.detail&&e.detail[502]}}function _o(e){return typeof e=="number"?e:e.exact||e.ideal||e.max||e.min||0}function EI(e){const t=e._encoderConfig;if(!t)return{};const n={resolution:t.width&&t.height?"".concat(_o(t.width),"x").concat(_o(t.height)):void 0,maxVideoBW:t.bitrateMax,minVideoBW:t.bitrateMin};return typeof t.frameRate=="number"?(n.maxFrameRate=t.frameRate,n.minFrameRate=t.frameRate):t.frameRate&&(n.maxFrameRate=t.frameRate.max||t.frameRate.ideal||t.frameRate.exact||t.frameRate.min,n.minFrameRate=t.frameRate.min||t.frameRate.ideal||t.frameRate.exact||t.frameRate.max),n}function _I(e){return e>=0&&e<.17?1:e>=.17&&e<.36?2:e>=.36&&e<.59?3:e>=.59&&e<=1?4:e>1?5:0}function iE(e,t){let n,r,o;switch(t){case Qt.CHOOSE_SERVER:n=4096,r="choose server";break;case Qt.CLOUD_PROXY:n=1048576,r="proxy";break;case Qt.CLOUD_PROXY_5:n=4194304,r="proxy5";break;case Qt.CLOUD_PROXY_FALLBACK:n=4194310,r="proxy fallback";break;default:throw new b(I.UNEXPECTED_ERROR,"multi unlibs response transformer get unknown service id",{csIp:e.detail&&e.detail[502],retry:!1})}if(e.response_body.forEach(a=>{a.buffer&&a.buffer.flag===n&&(o={code:a.buffer.code,addresses:(a.buffer.edges_services||[]).map(d=>Ru(Ru({},d),{},{ticket:a.buffer.cert})),server_ts:e.enter_ts,uid:a.buffer.uid,cid:a.buffer.cid,cname:a.buffer.cname,detail:Ru(Ru({},a.buffer.detail),e.detail),flag:a.buffer.flag,opid:e.opid,cert:a.buffer.cert})}),!o)throw new b(I.MULTI_UNILBS_RESPONSE_ERROR,"cannot parse response ".concat(r," from multi unilbs response"),{csIp:e.detail&&e.detail[502]});return o}async function dj(e,t){return await de.all(e.addresses.map(async n=>({address:Cu(n.ip),tcpport:n.port,udpport:n.port,username:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?t.toString():Cr.username,password:t&&k("ENCRYPT_PROXY_USERNAME_AND_PSW")&&window.isSecureContext?await YF(t.toString()):Cr.password})))}function lj(e,t){const n=t._videoWidth||t.getMediaStreamTrack(!0).getSettings().width;return n||v.warning("cannot get original video track's width, default scale down 4 times for low stream"),n?n/_o(e.width):4}function Iu(e){let{candidateType:t,relayProtocol:n,type:r,address:o,port:a,protocol:d}=e;return r==="local-candidate"?{candidateType:t,relayProtocol:n,protocol:d}:{candidateType:t,relayProtocol:n,address:o,port:a,protocol:d}}function gI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function zs(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function Ka(e){return window.TextEncoder?new TextEncoder().encode(e).length:e.length}function Rn(e){return new de(t=>{window.setTimeout(t,e)})}function uj(e){const t=new b(I.TIMEOUT,"timeout");return new de((n,r)=>{window.setTimeout(()=>r(t),e)})}function ut(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:7,t=arguments.length>1?arguments[1]:void 0;const n=Math.random().toString(16).substr(2,e).toLowerCase();return n.length===e?"".concat(t).concat(n):"".concat(t).concat(n)+ut(e-n.length,"")}function oE(){return ut(32,"").toUpperCase()}const Au=()=>{};function SI(e){return new de((t,n)=>{let r=!1;const o=document.createElement("video");o.setAttribute("autoplay",""),o.setAttribute("muted",""),o.muted=!0,o.autoplay=!0,o.setAttribute("playsinline",""),o.setAttribute("style","position: fixed; top: 0; left: 0; width: 1px; height: 1px"),document.body.appendChild(o);const a=Mn()?"canplay":"playing";o.addEventListener(a,()=>{const d=o.videoWidth,u=o.videoHeight;!d&&Tt()||(r=!0,o.srcObject=null,o.remove(),t([d,u]))}),o.srcObject=new MediaStream([e]),o.play().catch(Au),setTimeout(()=>{r||(o.srcObject=null,o.remove(),t([o.videoWidth,o.videoHeight]))},4e3)})}function za(e){return de.all(e.map(t=>t.then(n=>{throw n},n=>n))).then(t=>{throw t},t=>t)}function Cn(e,t){for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return e.getListeners(t).length===0?de.reject(new b(I.UNEXPECTED_ERROR,"can not emit promise")):new de((a,d)=>{e.emit(t,...r,a,d)})}function Rt(e,t){if(e.getListeners(t).length===0)return de.resolve();for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return Cn(e,t,...r)}function li(e,t){if(e.getListeners(t).length===0)return null;for(var n=arguments.length,r=new Array(n>2?n-2:0),o=2;o<n;o++)r[o-2]=arguments[o];return Ys(e,t,...r)}function Ys(e,t){let n=null,r=null;for(var o=arguments.length,a=new Array(o>2?o-2:0),d=2;d<o;d++)a[d-2]=arguments[d];if(e.emit(t,...a,u=>{n=u},u=>{r=u}),r!==null)throw r;if(n===null)throw new b(I.UNEXPECTED_ERROR,"handler is not sync");return n}function sE(e,t){const n=e.indexOf(t);n!==-1&&e.splice(n,1)}function TI(e){const t=[];return e.forEach(n=>{t.indexOf(n)===-1&&t.push(n)}),t}function Li(e){de.resolve().then(e)}function Vt(e){return JSON.parse(JSON.stringify(e))}const vI={};function nd(e,t){vI[t]||(vI[t]=!0,e())}function aE(e){const t=window.atob(e),n=new Uint8Array(new ArrayBuffer(t.length));for(let r=0;r<t.length;r+=1)n[r]=t.charCodeAt(r);return n}function Ou(e){let t="";for(let n=0;n<e.length;n+=1)t+=String.fromCharCode(e[n]);return window.btoa(t)}const yI=new class{constructor(){g(this,"fnMap",new Map)}throttleByKey(e,t,n,r){for(var o=arguments.length,a=new Array(o>4?o-4:0),d=4;d<o;d++)a[d-4]=arguments[d];if(this.fnMap.has(t)){const u=this.fnMap.get(t);if(u.threshold!==n){u.fn(...u.args),clearTimeout(u.timer);const h=window.setTimeout(()=>{const m=this.fnMap.get(t);m&&m.fn(...m.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:h,args:a,skipFn:r})}else u.skipFn&&u.skipFn(...u.args),this.fnMap.set(t,zs(zs({},u),{},{fn:e,args:a,skipFn:r}))}else{const u=window.setTimeout(()=>{const h=this.fnMap.get(t);h&&h.fn(...h.args),this.fnMap.delete(t)},n);this.fnMap.set(t,{fn:e,threshold:n,timer:u,args:a,skipFn:r})}}},RI=yI.throttleByKey.bind(yI),rd=async e=>{let{fragementLength:t,referenceList:n,asyncMapHandler:r,allFailedhandler:o,promisesCollector:a}=e,d=0;const u=t;let h,m=0;const f=async()=>{const E=(()=>{const T=d*u,R=T+u;return n.slice(T,R).map(r)})();a&&a.push(...E);try{h=await za(E)}catch(T){if(m+=u,d++,!(m>=n.length))return void await f();o(T)}E.forEach(T=>T.cancel())};return await f(),h};function CI(e){return typeof e=="object"&&e!==null&&!(e instanceof RegExp)}const hj={[Ua.ACCESS_POINT]:{[Sn.NO_FLAG_SET]:{desc:"flag is zero",retry:!1},[Sn.FLAG_SET_BUT_EMPTY]:{desc:"flag is empty",retry:!1},[Sn.INVALID_FALG_SET]:{desc:"invalid flag",retry:!1},[Sn.FLAG_SET_BUT_NO_RE]:{desc:"flag set unilbs but no request",retry:!1},[Sn.INVALID_SERVICE_ID]:{desc:"invalid service id",retry:!1},[Sn.NO_SERVICE_AVAILABLE]:{desc:"no service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_P2P]:{desc:"no unilbs p2p service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voice service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_WEBRTC]:{desc:"no unilbs webrtc service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_CDS]:{desc:"no cds service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_CDN]:{desc:"no cdn dispatcher service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_TDS]:{desc:"no tds service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_REPORT]:{desc:"no unilbs report service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_APP_CENTER]:{desc:"no app center service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_ENV0]:{desc:"no unilbs sig env0 service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_VOET]:{desc:"no unilbs voet service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_STRING_UID]:{desc:"no string uid service available",retry:!0},[Sn.NO_SERVICE_AVAILABLE_WEBRTC_UNILBS]:{desc:"no webrtc unilbs service available",retry:!0}},[Ua.UNILBS]:{[Ir.INVALID_VENDOR_KEY]:{desc:"invalid vendor key, can not find appid",retry:!1},[Ir.INVALID_CHANNEL_NAME]:{desc:"invalid channel name",retry:!1},[Ir.INTERNAL_ERROR]:{desc:"unilbs internal error",retry:!1},[Ir.NO_AUTHORIZED]:{desc:"invalid token, authorized failed",retry:!1},[Ir.DYNAMIC_KEY_TIMEOUT]:{desc:"dynamic key or token timeout",retry:!1},[Ir.NO_ACTIVE_STATUS]:{desc:"no active status",retry:!1},[Ir.DYNAMIC_KEY_EXPIRED]:{desc:"dynamic key expired",retry:!1},[Ir.STATIC_USE_DYNAMIC_KEY]:{desc:"static use dynamic key",retry:!1},[Ir.DYNAMIC_USE_STATIC_KEY]:{desc:"dynamic use static key",retry:!1},[Ir.USER_OVERLOAD]:{desc:"amount of users over load",retry:!1},[Ir.FORBIDDEN_REGION]:{desc:"the request is forbidden in this area",retry:!1},[Ir.CANNOT_MEET_AREA_DEMAND]:{desc:"unable to allocate services in this area",retry:!1}},[Ua.STRING_UID_ALLOCATOR]:{[Qc.IIIEGAL_APPID]:{desc:"invalid appid",retry:!1},[Qc.IIIEGAL_UID]:{desc:"invalid string uid",retry:!1},[Qc.INTERNAL_ERROR]:{desc:"string uid allocator internal error",retry:!0}}};function wu(e){const t=hj[Math.floor(e/1e4)];if(!t)return{desc:"unkonw error",retry:!1};const n=t[e%1e4];if(!n){if(Math.floor(e/1e4)===Ua.ACCESS_POINT){const r=e%1e4;if(r.toString()[0]==="1")return{desc:e.toString(),retry:!1};if(r.toString()[0]==="2")return{desc:e.toString(),retry:!0}}return{desc:"unkonw error",retry:!1}}return n}const pj={[ve.K_TIMESTAMP_EXPIRED]:{desc:"K_TIMESTAMP_EXPIRED",action:"failed"},[ve.K_CHANNEL_PERMISSION_INVALID]:{desc:"K_CHANNEL_PERMISSION_INVALID",action:"failed"},[ve.K_CERTIFICATE_INVALID]:{desc:"K_CERTIFICATE_INVALID",action:"failed"},[ve.K_CHANNEL_NAME_EMPTY]:{desc:"K_CHANNEL_NAME_EMPTY",action:"failed"},[ve.K_CHANNEL_NOT_FOUND]:{desc:"K_CHANNEL_NOT_FOUND",action:"failed"},[ve.K_TICKET_INVALID]:{desc:"K_TICKET_INVALID",action:"failed"},[ve.K_CHANNEL_CONFLICTED]:{desc:"K_CHANNEL_CONFLICTED",action:"failed"},[ve.K_SERVICE_NOT_READY]:{desc:"K_SERVICE_NOT_READY",action:"tryNext"},[ve.K_SERVICE_TOO_HEAVY]:{desc:"K_SERVICE_TOO_HEAVY",action:"tryNext"},[ve.K_UID_BANNED]:{desc:"K_UID_BANNED",action:"failed"},[ve.K_IP_BANNED]:{desc:"K_IP_BANNED",action:"failed"},[ve.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ve.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ve.WARN_NO_AVAILABLE_CHANNEL]:{desc:"WARN_NO_AVAILABLE_CHANNEL",action:"failed"},[ve.WARN_LOOKUP_CHANNEL_TIMEOUT]:{desc:"WARN_LOOKUP_CHANNEL_TIMEOUT",action:"tryNext"},[ve.WARN_LOOKUP_CHANNEL_REJECTED]:{desc:"WARN_LOOKUP_CHANNEL_REJECTED",action:"failed"},[ve.WARN_OPEN_CHANNEL_TIMEOUT]:{desc:"WARN_OPEN_CHANNEL_TIMEOUT",action:"tryNext"},[ve.WARN_OPEN_CHANNEL_REJECTED]:{desc:"WARN_OPEN_CHANNEL_REJECTED",action:"failed"},[ve.WARN_REQUEST_DEFERRED]:{desc:"WARN_REQUEST_DEFERRED",action:"failed"},[ve.ERR_DYNAMIC_KEY_TIMEOUT]:{desc:"ERR_DYNAMIC_KEY_TIMEOUT",action:"failed"},[ve.ERR_NO_AUTHORIZED]:{desc:"ERR_NO_AUTHORIZED",action:"failed"},[ve.ERR_VOM_SERVICE_UNAVAILABLE]:{desc:"ERR_VOM_SERVICE_UNAVAILABLE",action:"tryNext"},[ve.ERR_NO_CHANNEL_AVAILABLE_CODE]:{desc:"ERR_NO_CHANNEL_AVAILABLE_CODE",action:"failed"},[ve.ERR_MASTER_VOCS_UNAVAILABLE]:{desc:"ERR_MASTER_VOCS_UNAVAILABLE",action:"tryNext"},[ve.ERR_INTERNAL_ERROR]:{desc:"ERR_INTERNAL_ERROR",action:"tryNext"},[ve.ERR_NO_ACTIVE_STATUS]:{desc:"ERR_NO_ACTIVE_STATUS",action:"failed"},[ve.ERR_INVALID_UID]:{desc:"ERR_INVALID_UID",action:"failed"},[ve.ERR_DYNAMIC_KEY_EXPIRED]:{desc:"ERR_DYNAMIC_KEY_EXPIRED",action:"failed"},[ve.ERR_STATIC_USE_DYANMIC_KE]:{desc:"ERR_STATIC_USE_DYANMIC_KE",action:"failed"},[ve.ERR_DYNAMIC_USE_STATIC_KE]:{desc:"ERR_DYNAMIC_USE_STATIC_KE",action:"failed"},[ve.ERR_NO_VOCS_AVAILABLE]:{desc:"ERR_NO_VOCS_AVAILABLE",action:"tryNext"},[ve.ERR_NO_VOS_AVAILABLE]:{desc:"ERR_NO_VOS_AVAILABLE",action:"tryNext"},[ve.ERR_JOIN_CHANNEL_TIMEOUT]:{desc:"ERR_JOIN_CHANNEL_TIMEOUT",action:"tryNext"},[ve.ERR_JOIN_BY_MULTI_IP]:{desc:"ERR_JOIN_BY_MULTI_IP",action:"recover"},[ve.ERR_NOT_JOINED]:{desc:"ERR_NOT_JOINED",action:"failed"},[ve.ERR_REPEAT_JOIN_REQUEST]:{desc:"ERR_REPEAT_JOIN_REQUEST",action:"quit"},[ve.ERR_REPEAT_JOIN_CHANNEL]:{desc:"ERR_REPEAT_JOIN_CHANNEL",action:"quit"},[ve.ERR_INVALID_VENDOR_KEY]:{desc:"ERR_INVALID_VENDOR_KEY",action:"failed"},[ve.ERR_INVALID_CHANNEL_NAME]:{desc:"ERR_INVALID_CHANNEL_NAME",action:"failed"},[ve.ERR_INVALID_STRINGUID]:{desc:"ERR_INVALID_STRINGUID",action:"failed"},[ve.ERR_TOO_MANY_USERS]:{desc:"ERR_TOO_MANY_USERS",action:"tryNext"},[ve.ERR_SET_CLIENT_ROLE_TIMEOUT]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ve.ERR_SET_CLIENT_ROLE_NO_PERMISSION]:{desc:"ERR_SET_CLIENT_ROLE_TIMEOUT",action:"failed"},[ve.ERR_SET_CLIENT_ROLE_ALREADY_IN_USE]:{desc:"ERR_SET_CLIENT_ROLE_ALREADY_IN_USE",action:"success"},[ve.ERR_PUBLISH_REQUEST_INVALID]:{desc:"ERR_PUBLISH_REQUEST_INVALID",action:"failed"},[ve.ERR_SUBSCRIBE_REQUEST_INVALID]:{desc:"ERR_SUBSCRIBE_REQUEST_INVALID",action:"failed"},[ve.ERR_NOT_SUPPORTED_MESSAGE]:{desc:"ERR_NOT_SUPPORTED_MESSAGE",action:"failed"},[ve.ERR_ILLEAGAL_PLUGIN]:{desc:"ERR_ILLEAGAL_PLUGIN",action:"failed"},[ve.ILLEGAL_CLIENT_ROLE_LEVEL]:{desc:"ILLEGAL_CLIENT_ROLE_LEVEL",action:"failed"},[ve.ERR_REJOIN_TOKEN_INVALID]:{desc:"ERR_REJOIN_TOKEN_INVALID",action:"failed"},[ve.ERR_REJOIN_USER_NOT_JOINED]:{desc:"ERR_REJOIN_NOT_JOINED",action:"failed"},[ve.ERR_INVALID_OPTIONAL_INFO]:{desc:"ERR_INVALID_OPTIONAL_INFO",action:"quit"},[ve.ERR_TEST_RECOVER]:{desc:"ERR_TEST_RECOVER",action:"recover"},[ve.ERR_TEST_TRYNEXT]:{desc:"ERR_TEST_TRYNEXT",action:"recover"},[ve.ERR_TEST_RETRY]:{desc:"ERR_TEST_RETRY",action:"recover"},[ve.ILLEGAL_AES_PASSWORD]:{desc:"ERR_TEST_RETRY",action:"failed"},[ve.ERR_TOO_MANY_BROADCASTERS]:{desc:"ERR_TOO_MANY_BROADCASTERS",action:"failed"},[ve.ERR_TOO_MANY_SUBSCRIBERS]:{desc:"ERR_TOO_MANY_SUBSCRIBERS",action:"failed"},[ve.ERR_LICENSE_ILLEGAL]:{desc:"ERR_LICENSE_ILLEGAL",action:"quit"},[ve.ERR_LICENSE_MISSING]:{desc:"ERR_LICENSE_MISSING",action:"quit"},[ve.ERR_LICENSE_EXPIRED]:{desc:"ERR_LICENSE_EXPIRED",action:"quit"},[ve.ERR_LICENSE_MINUTES_EXCEEDED]:{desc:"ERR_LICENSE_MINUTES_EXCEEDED",action:"quit"},[ve.ERR_LICENSE_PERIOD_INVALID]:{desc:"ERR_LICENSE_PERIOD_INVALID",action:"quit"},[ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE]:{desc:"ERR_LICENSE_MULTIPLE_SDK_SERVICE",action:"quit"}};function id(e){return pj[e]||{desc:"UNKNOW_ERROR_".concat(e),action:"failed"}}function II(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class qs extends gt{get url(){return this.websocket?this.websocket.url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(Ae.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(Ae.CONNECTED):this._state==="closed"?this.emit(Ae.CLOSED):this._state==="failed"&&this.emit(Ae.FAILED))}resetReconnectCount(t){v.debug("websocket reset reconnect count, reason: "+t),this.reconnectCount=0}constructor(t,n){let r=arguments.length>2&&arguments[2]!==void 0&&arguments[2],o=arguments.length>3&&arguments[3]!==void 0&&arguments[3],a=arguments.length>4?arguments[4]:void 0;super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"urls",void 0),g(this,"_reconnectMode","tryNext"),g(this,"reconnectReason",void 0),g(this,"_initMutex",new Vn("websocket")),g(this,"name",void 0),g(this,"_state","closed"),g(this,"reconnectInterrupter",void 0),g(this,"websocket",void 0),g(this,"retryConfig",void 0),g(this,"reconnectCount",0),g(this,"forceCloseTimeout",5e3),g(this,"onlineReconnectListener",void 0),g(this,"useCompress",void 0),g(this,"tryDoubleDomain",!1),g(this,"wsInflateLength",0),g(this,"wsDeflateLength",0),g(this,"closeEstablishingWs",()=>{}),g(this,"store",void 0),g(this,"joinChannelServiceRecordIndex",void 0),this.store=a,this.name=t,this.retryConfig=function(f){for(var E=1;E<arguments.length;E++){var T=arguments[E]!=null?arguments[E]:{};E%2?II(Object(T),!0).forEach(function(R){g(f,R,T[R])}):Object.getOwnPropertyDescriptors?Object.defineProperties(f,Object.getOwnPropertyDescriptors(T)):II(Object(T)).forEach(function(R){Object.defineProperty(f,R,Object.getOwnPropertyDescriptor(T,R))})}return f}({},n),this.useCompress=r,this.tryDoubleDomain=o;const{timeout:d,timeoutFactor:u}=n,h=Math.max(300,Math.floor(3*d/5)),m=Math.max(1.2,Math.floor(8*u)/10);On.ONLINE&&(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m),xt.on(qo.NETWORK_STATE_CHANGE,(f,E)=>{f!==E&&(this.resetReconnectCount("network state change: ".concat(E," -> ").concat(f)),f===On.ONLINE?(this.retryConfig.timeout=h,this.retryConfig.timeoutFactor=m):(this.retryConfig.timeout=d,this.retryConfig.timeoutFactor=u))})}getConnection(){return this.websocket||void 0}init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this.forceCloseTimeout=n;const r=(o,a)=>{this.urls=t;const d=this.urls[this.currentURLIndex];this.state="connecting",this.createWebSocketConnection(d).then(o).catch(a),this.once(Ae.CLOSED,()=>a(new b(I.WS_DISCONNECT))),this.once(Ae.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new de((a,d)=>{r(a,d)}).then(()=>{o()}).catch(()=>{o()}))}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this.reconnectInterrupter&&this.reconnectInterrupter(),this.websocket){this.websocket.onclose=null,this.websocket.onopen=null,this.websocket.onmessage=null;const r=this.websocket;n?setTimeout(()=>r.close(),500):r.close(),this.websocket=void 0}this.state=t?"failed":"closed",this.closeEstablishingWs&&this.closeEstablishingWs()}reconnect(t,n){if(!this.websocket)return void v.warning("[".concat(this.name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this.name,"] reconnect is triggered initiative")),typeof this.joinChannelServiceRecordIndex=="number"&&((r=this.store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this.joinChannelServiceRecordIndex));const o=this.websocket.onclose;this.websocket.onclose=null,this.websocket.close(),o&&o.bind(this.websocket)({code:9999,reason:n})}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this.websocket||this.websocket.readyState!==WebSocket.OPEN)throw new b(I.WS_ABORT,"websocket is not ready");try{n||(t=JSON.stringify(t)),this.websocket.send(t)}catch(r){throw new b(I.WS_ERR,"send websocket message error"+r.toString())}}setWsInflateData(t){this.wsDeflateLength=this.wsDeflateLength+t.originLength,this.wsInflateLength=this.wsInflateLength+t.compressedLength}getWsInflateData(){const t=this.wsInflateLength,n=this.wsDeflateLength;return this.clearWsInflateData(),{wsInflateLength:t,wsDeflateLength:n}}clearWsInflateData(){this.wsInflateLength=0,this.wsDeflateLength=0}async createWebSocketConnection(t,n){return this.connectionID+=1,this.connectionID,this.joinChannelServiceRecordIndex=void 0,new de((r,o)=>{var a;const d=f=>{var E;(E=this.store)===null||E===void 0||E.signalChannelOpen(),v.debug("[".concat(this.name,"] websocket opened:"),f),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),r()},u=async f=>{if(v.debug("[".concat(this.name,"] websocket close ").concat(this.websocket&&this.websocket.url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this.reconnectCount<this.retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const E=li(this,Ae.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,T=await this.reconnectWithAction(E);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] ws is closed, no need to reconnect"));if(!T)return o(new b(I.WS_DISCONNECT,"websocket reconnect failed: ".concat(f.code))),void this.close(!0);r()}else o(new b(I.WS_DISCONNECT,"websocket close: ".concat(f.code))),this.close()},h=f=>{this.emit(Ae.ON_MESSAGE,f)};this.websocket&&(this.websocket.onclose=null,this.websocket.close()),k("GATEWAY_WSS_ADDRESS")&&this.name.startsWith("gateway")&&(t=k("GATEWAY_WSS_ADDRESS")),v.debug("[".concat(this.name,"] start connect, url: ").concat(t));const m=(a=this.store)===null||a===void 0?void 0:a.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"});this.chooseBestWebsocketConnection(t,!!n,m).then(f=>{var E;this.websocket=f,d&&d(f.url),f.onclose=u,f.onmessage=h,(E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:"success"},m),this.joinChannelServiceRecordIndex=m}).catch(f=>{var E;if((E=this.store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:f instanceof b&&f.code===I.WS_ABORT?"aborted":"error",errors:[f]},m),this.state!=="closed"){if(f instanceof b&&f.code===I.WS_ERR){const T=new b(I.WS_ERR,"init websocket failed! Error: ".concat(f.toString()));return v.error("[".concat(this.name,"]").concat(T)),void o(T)}u&&u(f)}else o(new b(I.WS_DISCONNECT,"websocket is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this.reconnectCount>=this.retryConfig.maxRetryCount||!this.urls||this.state==="closed")return!1;this.onlineReconnectListener||xt.networkState!==On.OFFLINE||(this.onlineReconnectListener=xt.onlineWaiter&&xt.onlineWaiter.then(()=>{this.onlineReconnectListener=void 0}));let r=!0;if(this.reconnectInterrupter=()=>{r=!1},n){const d=Sm(this.reconnectCount,this.retryConfig);v.debug("[".concat(this.name,"] wait ").concat(d,"ms to reconnect websocket, mode: ").concat(t)),await de.race([Rn(d),this.onlineReconnectListener||new de(()=>{})])}if(this.state==="closed"||!r)return!1;this.reconnectCount+=1;const o=async(d,u)=>{this.emit(Ae.RECONNECT_CREATE_CONNECTION,u),await this.createWebSocketConnection(d)};try{if(t==="retry"){const d=this.urls[this.currentURLIndex];this.emit(Ae.RECONNECT_WAITTING_FINISH,t),await o(d,t)}else if(t==="tryNext"){if(this.currentURLIndex+=1,this.currentURLIndex>=this.urls.length)return await this.reconnectWithAction("recover",!1);v.debug("[".concat(this.name,"] websocket url length: ").concat(this.urls.length," current index: ").concat(this.currentURLIndex));const d=this.urls[this.currentURLIndex];this.emit(Ae.RECONNECT_WAITTING_FINISH,t),await o(d,t)}else if(t==="recover"){v.debug("[".concat(this.name,"] request new urls")),this.resetReconnectCount("recover mode"),this.emit(Ae.RECONNECT_WAITTING_FINISH,t),this.urls=await Cn(this,Ae.REQUEST_NEW_URLS),this.currentURLIndex=0;const d=this.urls[this.currentURLIndex];await o(d,t)}return!0}catch(d){var a;return v.error("[".concat(this.name,"] reconnect failed"),d.toString()),d!=null&&(a=d.data)!==null&&a!==void 0&&a.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&d.data.desc.includes("dynamic key expired")?(this.emit(Ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}async chooseBestWebsocketConnection(t,n,r){return new de((o,a)=>{let d=!1;const u=[];this.closeEstablishingWs=()=>{v.debug("[choose-best-ws] close establishing websockets"),u.forEach(O=>{O.onclose=null,O.onopen=null,O.onmessage=null,O.close()}),a(new b(I.WS_ABORT,"choose best websocket aborted"))};const h=k("GATEWAY_DOMAINS");let m;const f=t.indexOf("?h="),E=h.find(O=>f!==-1?t.includes(O,f):t.includes(O));v.debug("[choose-best-ws] currentDomain: ",E,", domains: ",h);let T=!this.tryDoubleDomain||n||!E;if(!T&&E){var R;const O=Date.now();try{h.forEach(w=>{const x=f===-1?t.replace(E,w):t.substr(0,f)+t.substr(f).replace(E,w),V=new WebSocket(x);V.binaryType="arraybuffer",u.push(V),v.debug("[choose-best-ws] ws is connecting:",V.url)})}catch{for(v.debug("[choose-best-ws] ws create failed, fallback to single url"),u.forEach(x=>x.close());u.length;)u.pop();T=!0}(R=this.store)===null||R===void 0||R.recordJoinChannelService({urls:u.map(w=>w.url),service:"gateway"},r),u.forEach(w=>{w.onopen=()=>{if(d)return;const x=Date.now()-O;v.debug("[choose-best-ws] ws open cost ".concat(x,"ms")),u.filter(V=>V!==w).forEach(V=>{v.debug("[choose-best-ws]close backup websocket: ".concat(V.url)),V.close()}),d=!0,o(w)},w.onclose=x=>{m=x,!d&&(u.find(V=>!(V.readyState===WebSocket.CLOSED||V.readyState===WebSocket.CLOSING))||(v.debug("[choose-best-ws] all websocket is closed"),d=!0,a(m)))},w.onmessage=x=>{v.debug("[choose-best-ws]".concat(w.url," onmessage: ").concat(x.data))}}),Rn(this.forceCloseTimeout).then(()=>{u.forEach(w=>{w.readyState!==WebSocket.OPEN&&w.close()})})}if(T){var A;let O;v.debug("[choose-best-ws] use single url: ",t),(A=this.store)===null||A===void 0||A.recordJoinChannelService({urls:[t],service:"gateway"},r);try{O=new WebSocket(t),u.push(O),O.binaryType="arraybuffer"}catch(w){const x=new b(I.WS_ERR,"init websocket failed! Error: ".concat(w.toString()));return v.error("[".concat(this.name,"]").concat(x)),void a(x)}O.onopen=()=>{o(O)},O.onclose=w=>{a(w)},O.onmessage=w=>{v.debug("[choose-best-ws]".concat(O.url," onmessage: ").concat(w.data))},Rn(this.forceCloseTimeout).then(()=>{O&&O.readyState!==WebSocket.OPEN&&O.close()})}}).then(o=>(this.closeEstablishingWs=void 0,o)).catch(o=>{throw this.closeEstablishingWs=void 0,o})}}class AI{constructor(t){g(this,"input",[]),g(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}mean(){var t;return this.input.length===0?0:Fo(t=this.input).call(t,(n,r)=>n+r)/this.input.length}}class OI extends gt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===et.CONNECTED?this.emit(Ee.WS_CONNECTED):t===et.RECONNECTING?this.emit(Ee.WS_RECONNECTING,this._websocketReconnectReason):t===et.CLOSED&&this.emit(Ee.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",et.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new AI(5)),g(this,"pingpongTimer",void 0),g(this,"wsInflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",r=>{if(r.data instanceof ArrayBuffer)return void this.emit(Ee.ON_BINARY_DATA,r.data);const o=JSON.parse(r.data);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")){if(this.emit(o._type,o._message),o._type===Pe.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Pe.ON_USER_BANNED)switch(o._message.error_code){case 14:this.close(Je.UID_BANNED);break;case 15:this.close(Je.IP_BANNED);break;case 16:this.close(Je.CHANNEL_BANNED)}if(o._type===Pe.ON_USER_LICENSE_BANNED)switch(o._message.error_code){case ve.ERR_LICENSE_MISSING:this.close(Je.LICENSE_MISSING);break;case ve.ERR_LICENSE_EXPIRED:this.close(Je.LICENSE_EXPIRED);break;case ve.ERR_LICENSE_MINUTES_EXCEEDED:this.close(Je.LICENSE_MINUTES_EXCEEDED);break;case ve.ERR_LICENSE_PERIOD_INVALID:this.close(Je.LICENSE_PERIOD_INVALID);break;case ve.ERR_LICENSE_MULTIPLE_SDK_SERVICE:this.close(Je.LICENSE_MULTIPLE_SDK_SERVICE);break;case ve.ERR_LICENSE_ILLEGAL:this.close(Je.LICENSE_ILLEGAL);break;default:this.close()}}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new qs("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===et.CONNECTED&&this.reconnect("retry",Kn.OFFLINE)})}async request(t,n,r,o){const a=ut(6,""),d={_id:a,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new de((A,O)=>{if(this.connectionState===et.CONNECTED)return A();const w=()=>{this.off(Ee.WS_CLOSED,x),A()},x=()=>{this.off(Ee.WS_CONNECTED,w),O(new b(I.WS_ABORT))};this.once(Ee.WS_CONNECTED,w),this.once(Ee.WS_CLOSED,x),t!==ye.PUBLISH&&t!==ye.SUBSCRIBE&&t!==ye.UNSUBSCRIBE&&t!==ye.UNPUBLISH&&t!==ye.CONTROL&&t!==ye.RESTART_ICE||this.once(Ee.DISCONNECT_P2P,()=>{O(new b(I.DISCONNECT_P2P))}),t!==ye.PUBLISH&&t!==ye.RESTART_ICE||this.once(Ee.ABORT_P2P_EXECUTION,()=>{O(new b(I.DISCONNECT_P2P))})});if(this.connectionState!==et.CONNECTING&&this.connectionState!==et.RECONNECTING||t===ye.JOIN||t===ye.REJOIN||await h(),this.websocket.sendMessage(d,!0),o)return;const m=new de((A,O)=>{let w=!1;const x=(X,le)=>{w=!0,A({isSuccess:X==="success",message:le||{}}),this.off(Ee.WS_CLOSED,V),this.off(Ee.WS_RECONNECTING,V),this.emit(Ee.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),x);const V=()=>{O(new b(I.WS_ABORT,"type: ".concat(t))),this.off(Ee.WS_CLOSED,V),this.off(Ee.WS_RECONNECTING,V),this.off("res-@".concat(a),x)};this.once(Ee.WS_CLOSED,V),this.once(Ee.WS_RECONNECTING,V),Rn(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(v.warning("[".concat(this.clientId,"] ws request timeout, type: ").concat(t)),this.emit(Ee.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await m}catch(A){if(this.connectionState===et.CLOSED||t===ye.LEAVE)throw new b(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===ye.JOIN||t===ye.REJOIN?null:(await h(),await this.request(t,n))}if(f.isSuccess)return f.message;const E=Number(f.message.error_code||f.message.code),T=id(E),R=new b(I.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(f.message.error_str),{code:E,data:f.message});return T.action==="success"?f.message:(v.warning("[".concat(this.clientId,"] [").concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(T.desc,", action: ").concat(T.action)),E===ve.ERR_TOO_MANY_BROADCASTERS?((t===ye.JOIN||t===ye.REJOIN)&&(this.initError=R,this.close()),R.throw()):T.action==="failed"?R.throw():T.action==="quit"?(this.initError=R,this.close(),R.throw()):(E===ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Kn.MULTI_IP)):this.reconnect(T.action,Kn.SERVER_ERROR),t===ye.JOIN||t===ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new de(r=>{const o=a=>{(!n||n(a))&&(this.off(t,o),r(a))};this.on(t,o)})}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==et.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new de((r,o)=>{this.once(Ee.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Ee.WS_CLOSED,()=>o(this.initError||new b(I.WS_ABORT))),this.connectionState=et.CONNECTING,this.websocket.init(t).catch(o),this.wsInflateDataTimer&&window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=window.setInterval(()=>{this.handleWsInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init websocket timeout while join with fallback to proxy")),o(new b(I.INIT_WEBSOCKET_TIMEOUT)))},k("JOIN_WITH_FALLBACK_PROXY_PENDING_DURATION"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.wsInflateDataTimer&&(this.handleWsInflateData(),window.clearInterval(this.wsInflateDataTimer),this.wsInflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Je.LEAVE,this.connectionState=et.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close websocket in signal"),this.websocket.close(),t===Je.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new qs("gateway-".concat(this.clientId),this.spec.retryConfig,!0,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ee.ABORT_P2P_EXECUTION);const t=await Cn(this,Ee.REQUEST_JOIN_INFO),n=await this.request(ye.JOIN,t);if(!n)return this.emit(Ee.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ee.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new b(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ys(this,Ee.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ye.REJOIN,t);return!!n&&(this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pe.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pe.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pe.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pe.MUTE_AUDIO,{uid:r.uid}):this.emit(Pe.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pe.MUTE_VIDEO,{uid:r.uid}):this.emit(Pe.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pe.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pe.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pe.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=id(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Je.UID_BANNED),void this.close()):void this.reconnect(n.action,Kn.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("[".concat(this.clientId,"] PINGPONG Timeout. Last Socket Message: ").concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Kn.TIMEOUT):this.request(ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),k("REPORT_STATS")&&this.send(ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleWsInflateData(){const{wsInflateLength:t,wsDeflateLength:n}=this.websocket.getWsInflateData();t!==0&&n!==0&&this.upload(pr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(Ae.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ee.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(Ae.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ee.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(Ae.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(Ae.CLOSED,()=>{this.connectionState=et.CLOSED}),this.websocket.on(Ae.FAILED,()=>{this._disconnectedReason=Je.NETWORK_ERROR,this.connectionState=et.CLOSED}),this.websocket.on(Ae.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===et.CONNECTED?this.connectionState=et.RECONNECTING:this.connectionState=et.CONNECTING}),this.websocket.on(Ae.WILL_RECONNECT,(t,n)=>{if(Ys(this,Ee.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P)),n(t)}),this.websocket.on(Ae.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Kn.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ee.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof b&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===ve.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Kn.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Kn.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(Ae.REQUEST_NEW_URLS,(t,n)=>{Cn(this,Ee.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(Ae.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)})}}function wI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class fj extends gt{get url(){return this._url?this._url:null}get reconnectMode(){return this._reconnectMode}set reconnectMode(t){["tryNext","recover"].includes(t)&&this.resetReconnectCount(t),this._reconnectMode=t}get state(){return this._state}set state(t){t!==this._state&&(this._state=t,this._state==="reconnecting"?this.emit(vt.RECONNECTING,this.reconnectReason):this._state==="connected"?this.emit(vt.CONNECTED):this._state==="closed"?this.emit(vt.CLOSED):this._state==="failed"&&this.emit(vt.FAILED))}constructor(t,n,r,o){super(),g(this,"connectionID",0),g(this,"currentURLIndex",0),g(this,"reconnectReason",void 0),g(this,"_reconnectMode","tryNext"),g(this,"_initMutex",void 0),g(this,"_name",void 0),g(this,"_state","closed"),g(this,"_reconnectInterrupter",void 0),g(this,"_url",void 0),g(this,"_retryConfig",void 0),g(this,"_reconnectCount",0),g(this,"_forceCloseTimeout",5e3),g(this,"_onlineReconnectListener",void 0),g(this,"_closeEstablishingTransmitter",()=>{}),g(this,"_store",void 0),g(this,"_joinChannelServiceRecordIndex",void 0),g(this,"_transmitter",void 0),g(this,"_useCompress",void 0),g(this,"_inflateLength",0),g(this,"_deflateLength",0),this._store=o,this._name=t,this._retryConfig=function(a){for(var d=1;d<arguments.length;d++){var u=arguments[d]!=null?arguments[d]:{};d%2?wI(Object(u),!0).forEach(function(h){g(a,h,u[h])}):Object.getOwnPropertyDescriptors?Object.defineProperties(a,Object.getOwnPropertyDescriptors(u)):wI(Object(u)).forEach(function(h){Object.defineProperty(a,h,Object.getOwnPropertyDescriptor(u,h))})}return a}({},n),this._useCompress=r}resetReconnectCount(t){v.debug("".concat(this._name," reset reconnect count, reason: ").concat(t)),this._reconnectCount=0}close(t,n){if(this.currentURLIndex=0,this.resetReconnectCount("close"),this._reconnectInterrupter&&this._reconnectInterrupter(),this._transmitter){this._transmitter.onclose=null,this._transmitter.onopen=null,this._transmitter.onmessage=null;const r=this._transmitter;n?setTimeout(()=>r.close(),500):r.close(),this._transmitter=void 0}this.state=t?"failed":"closed",this._closeEstablishingTransmitter&&this._closeEstablishingTransmitter()}reconnect(t,n){if(!this._transmitter)return void v.warning("[".concat(this._name,"] can not reconnect, no websocket"));var r;t!==void 0&&(this.reconnectMode=t),v.debug("[".concat(this._name,"] reconnect is triggered initiative")),typeof this._joinChannelServiceRecordIndex=="number"&&((r=this._store)===null||r===void 0||r.recordJoinChannelService({status:"error",errors:[new Error(n)]},this._joinChannelServiceRecordIndex));const o=this._transmitter.onclose;this._transmitter.onclose=null,this._transmitter.close(),o&&o.bind(this._transmitter)({code:9999,reason:n})}getInflateData(){const t=this._inflateLength,n=this._deflateLength;return this.clearInflateData(),{inflateLength:t,deflateLength:n}}setInflateData(t){this._deflateLength=this._deflateLength+t.originLength,this._inflateLength=this._inflateLength+t.compressedLength}clearInflateData(){this._inflateLength=0,this._deflateLength=0}}function NI(e,t,n){if("getBigUint64"in DataView.prototype)return e.getBigUint64(t,n);const r=e.getUint32(t,n),o=e.getUint32(t+4,n),a=+!!n,d=+!n;return BigInt(r*d+o*a)<<BigInt(32)|BigInt(r*a+o*d)}function bI(e,t,n,r){if("setBigUint64"in DataView.prototype)return e.setBigUint64(t,n,r);const o=Number(n>>BigInt(32)),a=Number(n&BigInt(4294967295));r?(e.setUint32(t+4,o,r),e.setUint32(t,a,r)):(e.setUint32(t,o,r),e.setUint32(t+4,a,r))}let Yr;(function(e){e[e.Default=0]="Default",e[e.Ack=1]="Ack"})(Yr||(Yr={}));class mj{constructor(t,n,r){g(this,"version",1),g(this,"initialRTO",void 0),g(this,"maxBatchAckCount",void 0),g(this,"maxRTO",void 0),g(this,"initialRTT",void 0),g(this,"ID",void 0),g(this,"rtt",void 0),g(this,"packetNumber",1),g(this,"rtoRatioMap",new Map),g(this,"timeoutMap",new Map),g(this,"unorderedPacketQueue",[]),g(this,"batchAckPacketQueue",[]),g(this,"lastOrderedPacketNumber",0),g(this,"batchAckTimer",void 0),g(this,"sendImpl",void 0),g(this,"receiveImpl",void 0),this.sendImpl=t,this.receiveImpl=n,this.ID=ut(7,"transmitter-"),this.initialRTO=(r==null?void 0:r.initialRTO)!==void 0?r.initialRTO:k("TRANSMITTER_INITIAL_RTO"),this.initialRTT=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:k("TRANSMITTER_INITIAL_RTT"),this.rtt=(r==null?void 0:r.initialRTT)!==void 0?r.initialRTT:k("TRANSMITTER_INITIAL_RTT"),this.maxBatchAckCount=(r==null?void 0:r.maxBatchAckCount)!==void 0?r.maxBatchAckCount:k("TRANSMITTER_MAX_BATCH_ACK_COUNT"),this.maxRTO=(r==null?void 0:r.maxRTO)!==void 0?r.maxRTO:k("TRANSMITTER_MAX_RTO")}packetize(t,n){return{type:Yr.Default,version:this.version,packetNumber:n,payload:t}}serialize(t){switch(t.type){case Yr.Default:{let n;typeof t.payload=="string"?n=new TextEncoder().encode(t.payload):n=t.payload;const r=new ArrayBuffer(n.length+15),o=new DataView(r);return o.setUint16(0,t.version),o.setUint8(2,t.type),o.setUint32(3,t.packetNumber),bI(o,7,BigInt(t.sendTs)),new Uint8Array(o.buffer).set(n,15),r}case Yr.Ack:{const n=new ArrayBuffer(16),r=new DataView(n);return r.setUint16(0,t.version),r.setUint8(2,t.type),r.setUint32(3,t.maxAckPacketNumber),r.setUint8(7,t.shift),bI(r,8,BigInt(t.ackSendTs)),n}}}deserialize(t){const n=new DataView(t),r=n.getUint16(0),o=n.getUint8(2);switch(o){case Yr.Default:{const a=n.getUint32(3),d=NI(n,7),u=t.slice(15),h=new TextDecoder().decode(u);return{version:r,type:o,packetNumber:a,sendTs:Number(d),payload:h}}case Yr.Ack:{const a=n.getUint32(3),d=n.getUint8(7),u=NI(n,8);return{version:r,type:o,maxAckPacketNumber:a,shift:d,ackSendTs:Number(u)}}default:throw v.error("[".concat(this.ID,"] Unrecognized packet type ").concat(o)),new Error("Unrecognized packet type ".concat(o))}}sendMessage(t){const n=this.packetize(t,this.packetNumber);this.packetNumber=this.packetNumber===4294967295?1:this.packetNumber+1;const r=this.calculateRTO(n),o=window.setTimeout(()=>{this.resendMessage(n)},r);this.timeoutMap.set(n.packetNumber,o),this.sendPacket(n)}onData(t){const n=this.deserialize(t);n.type===Yr.Default?this.ack(n):n.type===Yr.Ack&&(this.updateRTT(n,Math.round(performance.now())),this.clearRTO(n))}close(){this.rtt=this.initialRTT,this.packetNumber=1,Array.from(this.timeoutMap.entries()).forEach(t=>{let[n,r]=t;window.clearTimeout(r)}),this.timeoutMap=new Map,this.rtoRatioMap=new Map,this.unorderedPacketQueue=[],this.batchAckPacketQueue=[],this.lastOrderedPacketNumber=0,this.batchAckTimer!==void 0&&window.clearTimeout(this.batchAckTimer)}resendMessage(t){const n=this.calculateRTO(t),r=window.setTimeout(()=>{this.resendMessage(t)},n);this.timeoutMap.set(t.packetNumber,r),this.sendPacket(t)}calculateRTO(t){const n=this.rtoRatioMap.get(t.packetNumber);if(n===void 0)return this.rtoRatioMap.set(t.packetNumber,1),this.initialRTO;{const r=9*this.rtt/8*n;return this.rtoRatioMap.set(t.packetNumber,n+1),r>this.maxRTO?this.maxRTO:r}}updateRTT(t,n){const r=t.ackSendTs;this.rtt=this.rtt*(7/8)+(n-r-this.rtt)/8}ack(t){if(t.packetNumber===this.lastOrderedPacketNumber+1)for(this.batchAckPacketQueue.length>=this.maxBatchAckCount&&this.batchAck(),this.batchAckTimer?this.batchAckPacketQueue.push(t):(this.batchAckPacketQueue.push(t),this.batchAckTimer=window.setTimeout(()=>{this.batchAck()},this.rtt/8)),this.lastOrderedPacketNumber+=1,this.receiveImpl(t.payload);;){const n=this.unorderedPacketQueue[0];if(!n){this.unorderedPacketQueue.shift();break}this.batchAckTimer&&this.batchAck(),this.receiveImpl(n.payload),this.unorderedPacketQueue.shift(),this.lastOrderedPacketNumber+=1}else if(t.packetNumber<=this.lastOrderedPacketNumber){const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Yr.Ack,version:this.version};this.sendPacket(n)}else if(t.packetNumber>this.lastOrderedPacketNumber){this.unorderedPacketQueue[t.packetNumber-this.lastOrderedPacketNumber-2]=t;const n={ackSendTs:t.sendTs,maxAckPacketNumber:t.packetNumber,shift:0,type:Yr.Ack,version:this.version};this.sendPacket(n)}}batchAck(){window.clearTimeout(this.batchAckTimer),this.batchAckTimer=void 0;const t={ackSendTs:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].sendTs,maxAckPacketNumber:this.batchAckPacketQueue[this.batchAckPacketQueue.length-1].packetNumber,shift:this.batchAckPacketQueue.length-1,type:Yr.Ack,version:this.version};this.sendPacket(t),this.batchAckPacketQueue=[]}sendPacket(t){t.type===Yr.Default&&(t.sendTs=Math.round(performance.now()));const n=this.serialize(t);this.sendImpl(n)}clearRTO(t){for(let n=t.maxAckPacketNumber-t.shift;n<=t.maxAckPacketNumber;n++){const r=this.timeoutMap.get(n);r!==void 0&&window.clearTimeout(r),this.timeoutMap.delete(n),this.rtoRatioMap.delete(n)}}}class DI extends fj{constructor(t,n){super(t,n,arguments.length>2&&arguments[2]!==void 0&&arguments[2],arguments.length>3?arguments[3]:void 0),g(this,"_initMutex",void 0),g(this,"_reconnectInterrupter",void 0),g(this,"_url",void 0),g(this,"_transmitter",void 0),g(this,"_addresses",void 0),g(this,"_reliableTransmission",void 0),this._initMutex=new Vn("datachannel");const{timeout:r,timeoutFactor:o}=n,a=Math.max(300,Math.floor(3*r/5)),d=Math.max(1.2,Math.floor(8*o)/10);On.ONLINE&&(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d),xt.on(qo.NETWORK_STATE_CHANGE,(u,h)=>{u!==h&&(this.resetReconnectCount("network state change: ".concat(h," -> ").concat(u)),u===On.ONLINE?(this._retryConfig.timeout=a,this._retryConfig.timeoutFactor=d):(this._retryConfig.timeout=r,this._retryConfig.timeoutFactor=o))})}getConnection(){if(this._reliableTransmission)return this._reliableTransmission}async init(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;this._forceCloseTimeout=n;const r=(o,a)=>{this._addresses=t,this.currentURLIndex=this._addresses.findIndex(u=>u.fingerprint||k("FINGERPRINT"));const d=this._addresses[this.currentURLIndex];this.state="connecting",this.createTransmitterConnection(d).then(o).catch(a),this.once(vt.CLOSED,()=>a(new b(I.WS_DISCONNECT))),this.once(vt.CONNECTED,()=>o())};return this._initMutex.lock().then(o=>new de((a,d)=>{r(a,d)}).then(()=>{o()}).catch(()=>{o()}))}sendMessage(t){let n=arguments.length>2&&arguments[2]!==void 0&&arguments[2];if(!this._transmitter||!this._reliableTransmission)throw new b(I.WS_ABORT,"datachannel is not ready");try{n||(t=JSON.stringify(t)),this._reliableTransmission.sendMessage(t)}catch(r){throw new b(I.WS_ERR,"send datachannel signal message error"+r.toString())}}unbindDcCloseEventListener(){this._transmitter&&(this._transmitter.onclose=null)}sendMessageWithJSON(t){const n=JSON.stringify(t);return{compressed:n,compressedLength:n.length,origin:t}}sendMessageWithUint8Array(t){return{compressed:t,compressedLength:t.byteLength,origin:t}}createTransmitterConnection(t){return this.connectionID+=1,this._joinChannelServiceRecordIndex=void 0,this._url="dc://".concat(t.ip,":").concat(t.port),new de((n,r)=>{var o;const a=()=>{v.debug("[".concat(this._name,"] datachannel opened:"),this._url),this.reconnectMode="retry",this.state="connected",this.resetReconnectCount("opened"),n()},d=async f=>{var E;if((E=this._closeEstablishingTransmitter)===null||E===void 0||E.call(this),v.debug("[".concat(this._name,"] datachannel close ").concat(this._url,", code: ").concat(f.code,", reason: ").concat(f.reason,", current mode: ").concat(this.reconnectMode)),this._reconnectCount<this._retryConfig.maxRetryCount){this.state==="connected"&&(this.reconnectReason=f.reason,this.state="reconnecting");const T=li(this,vt.WILL_RECONNECT,this.reconnectMode)||this.reconnectMode,R=await this.reconnectWithAction(T);if(this.state==="closed")return void v.debug("[".concat(this.connectionID,"] dc is closed, no need to reconnect"));if(!R)return r(new b(I.WS_DISCONNECT,"datachannel reconnect failed: ".concat(f.code))),void this.close(!0);n()}else r(new b(I.WS_DISCONNECT,"datachannel close: ".concat(f.code))),this.close()},u=f=>{var E;(E=this._reliableTransmission)===null||E===void 0||E.onData(f.data)};this._transmitter&&(this._transmitter.onclose=null,this._transmitter.close()),this._reliableTransmission&&(this._reliableTransmission.close(),this._reliableTransmission=void 0),v.debug("[".concat(this._name,"] start connect, address: ").concat(JSON.stringify(t)));const h=(o=this._store)===null||o===void 0?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"gateway"}),m=Date.now();Cn(this,vt.TO_CONNECT_DATACHANNEL,t).then(f=>{var E,T;if(!f)throw new Error("transmissonInfo not exist yet");const{transmitter:R,close:A}=f;this._transmitter=R,(E=this._store)===null||E===void 0||E.signalChannelOpen();const O=Date.now()-m;v.debug("[choose dc] dc open cost ".concat(O,"ms")),this._reliableTransmission=new mj(w=>{var x;this._transmitter&&this._transmitter.readyState==="open"&&((x=this._transmitter)===null||x===void 0||x.send(w))},w=>{typeof w=="string"&&this.emit(vt.ON_MESSAGE,w)}),this._closeEstablishingTransmitter=()=>{var w;(w=this._reliableTransmission)===null||w===void 0||w.close(),this._reliableTransmission=void 0,A()},a&&a(),R.onclose=d,R.onmessage=u,(T=this._store)===null||T===void 0||T.recordJoinChannelService({endTs:Date.now(),status:"success"},h),this._joinChannelServiceRecordIndex=h}).catch(f=>{var E;if((E=this._store)===null||E===void 0||E.recordJoinChannelService({endTs:Date.now(),status:f instanceof b&&f.code===I.WS_ABORT?"aborted":"error",errors:[f]},h),this.state!=="closed"){if(f instanceof b&&f.code===I.WS_ERR){const T=new b(I.WS_ERR,"init datachannel failed! Error: ".concat(f.toString()));return v.error("[".concat(this._name,"]").concat(T)),void r(T)}d&&d(f)}else r(new b(I.WS_DISCONNECT,"datachannel is closed: ".concat(f.toString())))})})}async reconnectWithAction(t){let n=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(this._reconnectCount>=this._retryConfig.maxRetryCount||!this._addresses||this.state==="closed")return!1;this._onlineReconnectListener||xt.networkState!==On.OFFLINE||(this._onlineReconnectListener=xt.onlineWaiter&&xt.onlineWaiter.then(()=>{this._onlineReconnectListener=void 0}));let r=!0;if(this._reconnectInterrupter=()=>{r=!1},n){const d=Sm(this._reconnectCount,this._retryConfig);v.debug("[".concat(this._name,"] wait ").concat(d,"ms to reconnect datachannel, mode: ").concat(t)),await de.race([Rn(d),this._onlineReconnectListener||new de(()=>{})])}if(this.state==="closed"||!r)return!1;this._reconnectCount+=1;const o=async(d,u)=>{this.emit(vt.RECONNECT_CREATE_CONNECTION,u),await this.createTransmitterConnection(d)};try{if(t==="retry"){const d=this._addresses[this.currentURLIndex];this.emit(vt.RECONNECT_WAITTING_FINISH,t),await o(d,t)}else if(t==="tryNext"){this.currentURLIndex+=1;for(let u=this.currentURLIndex;u<this._addresses.length;u++){if(this._addresses[u].fingerprint||k("FINGERPRINT")){this.currentURLIndex=u;break}this.currentURLIndex+=1}if(this.currentURLIndex>=this._addresses.length)return v.debug("[".concat(this._name,"] the available addresses are exhausted, change to recover")),await this.reconnectWithAction("recover",!1);v.debug("[".concat(this._name,"] datachannel url length: ").concat(this._addresses.length," current index: ").concat(this.currentURLIndex));const d=this._addresses[this.currentURLIndex];this.emit(vt.RECONNECT_WAITTING_FINISH,t),await o(d,t)}else t==="recover"&&(v.debug("[".concat(this._name,"] start to failback to websocket")),this.resetReconnectCount("recover mode"),this.emit(vt.RECONNECT_WAITTING_FINISH,t),this.emit(vt.FAILBACK));return!0}catch(d){var a;return v.error("[".concat(this._name,"] reconnect failed"),d.toString()),d!=null&&(a=d.data)!==null&&a!==void 0&&a.desc&&Array.isArray(d.data.desc)&&d.data.desc.length&&d.data.desc.includes("dynamic key expired")?(this.emit(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE),!1):await this.reconnectWithAction(t,n)}}}class go extends gt{get connectionState(){return this._connectionState}set connectionState(t){t!==this._connectionState&&(this._connectionState=t,t===et.CONNECTED?this.emit(Ee.WS_CONNECTED):t===et.RECONNECTING?this.emit(Ee.WS_RECONNECTING,this._websocketReconnectReason):t===et.CLOSED&&this.emit(Ee.WS_CLOSED,this._disconnectedReason))}get currentURLIndex(){return this.websocket.currentURLIndex}get url(){return this.websocket?this.websocket.url:null}get rtt(){return this.rttRolling.mean()}constructor(t,n){super(),g(this,"_disconnectedReason",void 0),g(this,"_websocketReconnectReason",void 0),g(this,"_connectionState",et.CLOSED),g(this,"reconnectToken",void 0),g(this,"websocket",void 0),g(this,"openConnectionTime",void 0),g(this,"clientId",void 0),g(this,"lastMsgTime",Date.now()),g(this,"uploadCache",[]),g(this,"uploadCacheInterval",void 0),g(this,"rttRolling",new AI(5)),g(this,"pingpongTimer",void 0),g(this,"inflateDataTimer",void 0),g(this,"pingpongTimeoutCount",0),g(this,"joinResponse",void 0),g(this,"multiIpOption",void 0),g(this,"initError",void 0),g(this,"spec",void 0),g(this,"store",void 0),g(this,"onWebsocketMessage",r=>{if(r instanceof ArrayBuffer)return void this.emit(Ee.ON_BINARY_DATA,r);const o=JSON.parse(r);if(this.lastMsgTime=Date.now(),Object.prototype.hasOwnProperty.call(o,"_id")){const a="res-@".concat(o._id);this.emit(a,o._result,o._message)}else if(Object.prototype.hasOwnProperty.call(o,"_type")&&(this.emit(o._type,o._message),o._type===Pe.ON_NOTIFICATION&&this.handleNotification(o._message),o._type===Pe.ON_USER_BANNED))switch(o._message.error_code){case 14:this.close(Je.UID_BANNED);break;case 15:this.close(Je.IP_BANNED);break;case 16:this.close(Je.CHANNEL_BANNED)}}),this.clientId=t.clientId,this.spec=t,this.store=n,this.websocket=new DI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,n),this.handleWebsocketEvents(),window.addEventListener("offline",()=>{this.connectionState===et.CONNECTED&&this.reconnect("retry",Yi.OFFLINE)})}async request(t,n,r,o){const a=ut(6,""),d={_id:a,_type:t,_message:n},u=this.websocket.connectionID,h=()=>new de((A,O)=>{if(this.connectionState===et.CONNECTED)return A();const w=()=>{this.off(Ee.WS_CLOSED,x),A()},x=()=>{this.off(Ee.WS_CONNECTED,w),O(new b(I.WS_ABORT))};this.once(Ee.WS_CONNECTED,w),this.once(Ee.WS_CLOSED,x),t!==ye.PUBLISH&&t!==ye.SUBSCRIBE&&t!==ye.UNSUBSCRIBE&&t!==ye.UNPUBLISH&&t!==ye.CONTROL&&t!==ye.RESTART_ICE||this.once(Ee.DISCONNECT_P2P,()=>{O(new b(I.DISCONNECT_P2P))}),t!==ye.PUBLISH&&t!==ye.RESTART_ICE||this.once(Ee.ABORT_P2P_EXECUTION,()=>{O(new b(I.DISCONNECT_P2P))})});if(this.connectionState!==et.CONNECTING&&this.connectionState!==et.RECONNECTING||t===ye.JOIN||t===ye.REJOIN||await h(),t===ye.LEAVE&&(this.websocket.unbindDcCloseEventListener(),o=!0),this.websocket.sendMessage(d,!0,!1),o)return;const m=new de((A,O)=>{let w=!1;const x=(X,le)=>{w=!0,A({isSuccess:X==="success",message:le||{}}),this.off(Ee.WS_CLOSED,V),this.off(Ee.WS_RECONNECTING,V),this.emit(Ee.REQUEST_SUCCESS,t,n)};this.once("res-@".concat(a),x);const V=()=>{O(new b(I.WS_ABORT,"type: ".concat(t))),this.off(Ee.WS_CLOSED,V),this.off(Ee.WS_RECONNECTING,V),this.off("res-@".concat(a),x)};this.once(Ee.WS_CLOSED,V),this.once(Ee.WS_RECONNECTING,V),Rn(k("SIGNAL_REQUEST_TIMEOUT")).then(()=>{this.websocket.connectionID!==u||w||(v.warning("dc request timeout, type: ".concat(t)),this.emit(Ee.REQUEST_TIMEOUT,t,n))})});let f=null;try{f=await m}catch(A){if(this.connectionState===et.CLOSED||t===ye.LEAVE)throw new b(I.WS_ABORT);return!this.spec.forceWaitGatewayResponse||r?A.throw():t===ye.JOIN||t===ye.REJOIN?null:(await h(),await this.request(t,n))}if(f.isSuccess)return f.message;const E=Number(f.message.error_code||f.message.code),T=id(E),R=new b(I.UNEXPECTED_RESPONSE,"".concat(T.desc,": ").concat(f.message.error_str),{code:E,data:f.message});return T.action==="success"?f.message:(v.warning("[".concat(this.websocket.connectionID,"] unexpected response from type ").concat(t,", error_code: ").concat(E,", message: ").concat(T.desc,", action: ").concat(T.action)),E===ve.ERR_TOO_MANY_BROADCASTERS?((t===ye.JOIN||t===ye.REJOIN)&&(this.initError=R,this.close()),R.throw()):T.action==="failed"?R.throw():T.action==="quit"?(this.initError=R,this.close(),R.throw()):(E===ve.ERR_JOIN_BY_MULTI_IP?(this.multiIpOption=f.message.option,v.warning("[".concat(this.clientId,"] detect multi ip, recover")),this.reconnect("recover",Yi.MULTI_IP)):this.reconnect(T.action,Yi.SERVER_ERROR),t===ye.JOIN||t===ye.REJOIN?null:await this.request(t,n)))}waitMessage(t,n){return new de(r=>{const o=a=>{(!n||n(a))&&(this.off(t,o),r(a))};this.on(t,o)})}upload(t,n){const r={_type:t,_message:n};try{this.websocket.sendMessage(r)}catch{const a=k("MAX_UPLOAD_CACHE")||50;this.uploadCache.push(r),this.uploadCache.length>a&&this.uploadCache.splice(0,1),this.uploadCache.length>0&&!this.uploadCacheInterval&&(this.uploadCacheInterval=window.setInterval(()=>{if(this.connectionState!==et.CONNECTED)return;const d=this.uploadCache.splice(0,1)[0];this.uploadCache.length===0&&(window.clearInterval(this.uploadCacheInterval),this.uploadCacheInterval=void 0),this.upload(d._type,d._message)},k("UPLOAD_CACHE_INTERVAL")||2e3))}}send(t,n){const r={_type:t,_message:n};this.websocket.sendMessage(r)}init(t,n){return this.initError=void 0,this.multiIpOption=void 0,this.joinResponse=void 0,this.reconnectToken=void 0,this.openConnectionTime=void 0,new de((r,o)=>{this.once(Ee.WS_CONNECTED,()=>r(this.joinResponse)),this.once(Ee.WS_CLOSED,()=>o(this.initError||new b(I.WS_ABORT))),this.connectionState=et.CONNECTING,this.websocket.init(t).catch(o),this.websocket.once(vt.FAILBACK,()=>{this.openConnectionTime===void 0&&o(new b(I.INIT_DATACHANNEL_TIMEOUT))}),this.inflateDataTimer&&window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=window.setInterval(()=>{this.handleInflateData()},2e4),setTimeout(()=>{n&&this.openConnectionTime===void 0&&(v.debug("[".concat(this.clientId,"] init datachannel timeout while join with failback to websocket")),o(new b(I.INIT_DATACHANNEL_TIMEOUT)))},k("DC_JOIN_WITH_FAILBACK"))})}close(t){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.inflateDataTimer&&(this.handleInflateData(),window.clearInterval(this.inflateDataTimer),this.inflateDataTimer=void 0),this.reconnectToken=void 0,this.joinResponse=void 0,this._disconnectedReason=t||Je.LEAVE,this.connectionState=et.CLOSED,v.debug("[".concat(this.clientId,"] ")+"will close datachannel in signal"),this.websocket.close(),t===Je.FALLBACK&&(this.websocket.removeAllListeners(),this.websocket=new DI("gateway-".concat(this.clientId),this.spec.retryConfig,!0,this.store),this.handleWebsocketEvents())}async join(){if(!this.joinResponse){this.emit(Ee.ABORT_P2P_EXECUTION);const t=await Cn(this,Ee.DATACHANNEL_CONNECTING),n=await this.request(ye.JOIN,t);if(!n)return this.emit(Ee.REPORT_JOIN_GATEWAY,I.TIMEOUT,this.url||""),!1;this.joinResponse=n,this.emit(Ee.JOIN_RESPONSE,this.joinResponse),this.reconnectToken=this.joinResponse.rejoin_token}return this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),!0}async rejoin(){if(!this.reconnectToken)throw new b(I.UNEXPECTED_ERROR,"can not rejoin, no rejoin token");const t=Ys(this,Ee.REQUEST_REJOIN_INFO);t.token=this.reconnectToken;const n=await this.request(ye.REJOIN,t);return!!n&&(this.connectionState=et.CONNECTED,this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(this.handlePingPong.bind(this),3e3),n.peers&&n.peers.forEach(r=>{this.emit(Pe.ON_USER_ONLINE,{uid:r.uid}),r.audio&&this.emit(Pe.ON_ADD_AUDIO_STREAM,{uid:r.uid,uint_id:r.uint_id,audio:!0,ssrcId:r.audio_ssrc}),r.video&&this.emit(Pe.ON_ADD_VIDEO_STREAM,{uid:r.uid,uint_id:r.uint_id,video:!0,ssrcId:r.video_ssrc}),r.audio_mute?this.emit(Pe.MUTE_AUDIO,{uid:r.uid}):this.emit(Pe.UNMUTE_AUDIO,{uid:r.uid}),r.video_mute?this.emit(Pe.MUTE_VIDEO,{uid:r.uid}):this.emit(Pe.UNMUTE_VIDEO,{uid:r.uid}),r.audio_enable_local?this.emit(Pe.ENABLE_LOCAL_AUDIO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_AUDIO,{uid:r.uid}),r.video_enable_local?this.emit(Pe.ENABLE_LOCAL_VIDEO,{uid:r.uid}):this.emit(Pe.DISABLE_LOCAL_VIDEO,{uid:r.uid}),r.audio||r.video||this.emit(Pe.ON_REMOVE_STREAM,{uid:r.uid,uint_id:r.uint_id})}),!0)}reconnect(t,n){this.pingpongTimer&&(this.pingpongTimeoutCount=0,window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0),this.websocket.reconnect(t,n)}handleNotification(t){v.debug("[".concat(this.clientId,"] receive notification: "),t);const n=id(t.code);if(n.action!=="success"){if(n.action!=="failed")return n.action==="quit"?(n.desc==="ERR_REPEAT_JOIN_CHANNEL"&&this.close(Je.UID_BANNED),void this.close()):void this.reconnect(n.action,Yi.SERVER_ERROR);v.error("[".concat(this.clientId,"] ignore error: "),n.desc)}}handlePingPong(){if(!this.websocket||this.websocket.state!=="connected")return;this.pingpongTimeoutCount>0&&this.rttRolling.add(3e3),this.pingpongTimeoutCount+=1;const t=k("PING_PONG_TIME_OUT"),n=Date.now();this.pingpongTimeoutCount>=t&&(v.warning("PINGPONG Timeout. Last Socket Message: ".concat(n-this.lastMsgTime,"ms")),n-this.lastMsgTime>k("WEBSOCKET_TIMEOUT_MIN"))?this.reconnect("retry",Yi.TIMEOUT):this.request(ye.PING,void 0,!0).then(()=>{this.pingpongTimeoutCount=0;const r=Date.now()-n;this.rttRolling.add(r),k("REPORT_STATS")&&this.send(ye.PING_BACK,{pingpongElapse:r})}).catch(r=>{})}handleInflateData(){const{inflateLength:t,deflateLength:n}=this.websocket.getInflateData();t!==0&&n!==0&&this.upload(pr.WS_INFLATE_DATA_LENGTH,{ws_deflate_length:n,ws_inflate_length:t})}handleWebsocketEvents(){this.websocket.on(vt.RECONNECT_WAITTING_FINISH,t=>{this.emit(Ee.WS_RECONNECT_WAITTING_FINISH,t)}),this.websocket.on(vt.RECONNECT_CREATE_CONNECTION,t=>{this.emit(Ee.WS_RECONNECT_CREATE_CONNECTION,t)}),this.websocket.on(vt.ON_MESSAGE,this.onWebsocketMessage),this.websocket.on(vt.CLOSED,()=>{this.connectionState=et.CLOSED}),this.websocket.on(vt.FAILED,()=>{this._disconnectedReason=Je.NETWORK_ERROR,this.connectionState=et.CLOSED}),this.websocket.on(vt.RECONNECTING,t=>{this._websocketReconnectReason=t,this.joinResponse=void 0,this.connectionState===et.CONNECTED?this.connectionState=et.RECONNECTING:this.connectionState=et.CONNECTING}),this.websocket.on(vt.WILL_RECONNECT,(t,n)=>{if(Ys(this,Ee.IS_P2P_DISCONNECTED)&&t==="retry")return v.debug("".concat(this.clientId," reconnect mode is retry, but p2p lost, change to tryNext")),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P),n("tryNext");t!=="retry"&&(v.debug("".concat(this.clientId," websockt will_connect event, renewSession reconnectMode is ").concat(t)),this.reconnectToken=void 0,this.emit(Ee.NEED_RENEW_SESSION),this.emit(Ee.DISCONNECT_P2P)),n(t)}),this.websocket.on(vt.CONNECTED,()=>{this.openConnectionTime=Date.now(),this.reconnectToken?this.rejoin().catch(t=>{v.warning("[".concat(this.clientId,"] rejoin failed ").concat(t)),this.reconnect("tryNext",Yi.SERVER_ERROR)}):this.join().catch(t=>{if(this.emit(Ee.REPORT_JOIN_GATEWAY,t.message||t.code,this.url||""),t instanceof b&&t.code===I.UNEXPECTED_RESPONSE&&t.data.code===ve.ERR_NO_AUTHORIZED)return v.warning("[".concat(this.clientId,"] reconnect no authorized, recover")),void this.reconnect("recover",Yi.SERVER_ERROR);v.error("[".concat(this.clientId,"] join gateway request failed"),t.toString()),this.spec.forceWaitGatewayResponse?this.reconnect("tryNext",Yi.SERVER_ERROR):(this.initError=t,this.close())})}),this.websocket.on(vt.REQUEST_NEW_URLS,(t,n)=>{Cn(this,Ee.REQUEST_RECOVER,this.multiIpOption).then(t).catch(n)}),this.websocket.on(vt.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{this.emit(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE)}),this.websocket.on(vt.TO_CONNECT_DATACHANNEL,async(t,n,r)=>Cn(this,Ee.DATACHANNEL_PRECONNECT,t).then(n).catch(r)),this.websocket.on(vt.FAILBACK,()=>{this.openConnectionTime!==void 0&&this.emit(Ee.DATACHANNEL_FAILBACK)})}}function PI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Xi(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const cE=new Map;class Ej extends gt{get state(){return this._state}set state(t){if(t===this._state)return;const n=this._state;this._state=t,t==="DISCONNECTED"&&this._disconnectedReason?this.emit(_t.CONNECTION_STATE_CHANGE,t,n,this._disconnectedReason):this.emit(_t.CONNECTION_STATE_CHANGE,t,n)}get joinGatewayStartTime(){return this._joinGatewayStartTime}set joinGatewayStartTime(t){v.debug("[".concat(this.store.clientId,"] set joinGatewayStartTime at ").concat(t)),this._joinGatewayStartTime=t}constructor(t,n){super(),g(this,"store",void 0),g(this,"joinInfo",void 0),g(this,"key",void 0),g(this,"signal",void 0),g(this,"role",void 0),g(this,"inChannelInfo",{joinAt:null,duration:0}),g(this,"spec",void 0),g(this,"_state","DISCONNECTED"),g(this,"_statsCollector",void 0),g(this,"_disconnectedReason",void 0),g(this,"isSignalRecover",!1),g(this,"hasChangeBGPAddress",!1),g(this,"trafficStatsInterval",void 0),g(this,"networkQualityInterval",void 0),g(this,"_joinGatewayStartTime",0),g(this,"_signalTimeout",!1),g(this,"_clientRoleOptions",void 0),g(this,"_isProactiveJoin",!1),this.store=t,this.spec=n,this.signal=this.store.useDataChannel?new go(Xi(Xi({},n),{},{retryConfig:n.websocketRetryConfig}),t):new OI(Xi(Xi({},n),{},{retryConfig:n.websocketRetryConfig}),t),this._statsCollector=n.statsCollector,this.role=n.role||"audience",this._clientRoleOptions=n.clientRoleOptions,this.handleSignalEvents()}async join(t,n,r){if(this.signal instanceof go){let h=!1;t.cloudProxyServer!=="disabled"?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because cloudProxyServer are not supported (").concat(t.cloudProxyServer,")")),h=!0):"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length>255||"".concat(t.apResponse.cid,"_").concat(t.apResponse.cert).length<22?(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because ticket length is incorrect, it has to be between 22 and 255")),h=!0):t.apResponse.addresses.some(m=>m.fingerprint)||k("FINGERPRINT")||(v.debug("[".concat(this.store.clientId,"] Dc is not supported, because fingerprint does not exist")),h=!0),h&&this.resetSignal()}this.store.joinGatewayStart(),t.cloudProxyServer!=="disabled"&&(this.hasChangeBGPAddress=!0);const o=Date.now();let a=cE.get(t.cname);if(a||(a=new Map,cE.set(t.cname,a)),this._isProactiveJoin=!0,a.has(t.uid)){const h=new b(I.UID_CONFLICT);throw he.joinGateway(t.sid,{lts:o,succ:!1,ec:h.message,addr:null,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!t.proxyServer,signalChannel:this.signal instanceof go?"1":"0"}),this._isProactiveJoin=!1,h}a.set(t.uid,!0),this.joinInfo=t,this.key=n;let d=0;this.joinGatewayStartTime=o;const u=t.proxyServer;try{let h;if(v.debug("[".concat(this.store.clientId,"] use ").concat(this.signal instanceof go?"datachannel":"websocket"," join uid ").concat(d)),this.signal instanceof go)h=await this.signal.init(t.apResponse.addresses,r);else{const m=t.proxyServer,f=m?t.gatewayAddrs.map(E=>{const T=E.address.split(":");return"wss://".concat(m,"/ws/?h=").concat(T[0],"&p=").concat(T[1])}):t.gatewayAddrs.map(E=>"wss://".concat(E.address));h=await this.signal.init(f,r)}d=h.uid,v.debug("[".concat(this.store.clientId,"] ").concat(this.signal instanceof go?"datachannel":"websocket"," join uid ").concat(d," cost ").concat(Date.now()-this.joinGatewayStartTime))}catch(h){throw h&&h.code===I.INIT_WEBSOCKET_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join failed"),h.toString()),h):h&&h.code===I.INIT_DATACHANNEL_TIMEOUT?(v.warning("[".concat(this.store.clientId,"] User join datachannel failed"),h.toString()),this.resetSignal(),h):(v.error("[".concat(this.store.clientId,"] User join failed"),h.toString()),he.joinGateway(t.sid,{lts:o,succ:!1,ec:h.message,addr:this.signal.url,uid:t.uid,cid:t.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!u,signalChannel:this.signal instanceof go?"1":"0"}),this._isProactiveJoin=!1,a.delete(t.uid),this.signal.close(),h)}return this.state="CONNECTED",this.inChannelInfo.joinAt=Date.now(),v.debug("[".concat(this.store.clientId,"] Connected to gateway server")),this.trafficStatsInterval=window.setInterval(()=>{this.updateTrafficStats().catch(h=>{v.warning("[".concat(this.store.clientId,"] get traffic stats error"),h.toString())})},3e3),this.networkQualityInterval=window.setInterval(()=>{navigator&&navigator.onLine!==void 0&&!navigator.onLine?this.emit(_t.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6}):this._signalTimeout?this.emit(_t.NETWORK_QUALITY,{downlinkNetworkQuality:5,uplinkNetworkQuality:5}):this.state==="CONNECTED"&&this._statsCollector.trafficStats?this.emit(_t.NETWORK_QUALITY,{uplinkNetworkQuality:_I(this._statsCollector.trafficStats.B_unq),downlinkNetworkQuality:_I(this._statsCollector.trafficStats.B_dnq)}):this.emit(_t.NETWORK_QUALITY,{uplinkNetworkQuality:0,downlinkNetworkQuality:0})},2e3),this.store.joinGatewayEnd(),d}async leave(){let t=arguments.length>0&&arguments[0]!==void 0&&arguments[0],n=arguments.length>1?arguments[1]:void 0;if(this.state!=="DISCONNECTED"){n!==Je.FALLBACK&&(this.state="DISCONNECTING");try{t||this.signal.connectionState!==et.CONNECTED||await function(r,o){return o===1/0?r:de.race([r,uj(o)])}(this.signal.request(ye.LEAVE,void 0,!0),3e3)}catch(r){v.warning("[".concat(this.store.clientId,"] leave request failed, ignore"),r)}this.signal.close(n),n!==Je.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}}async publish(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));const o={state:"offer",p2p_id:this.store.p2pId,ortc:n,mode:this.spec.mode,extend:k("PUB_EXTEND"),twcc:!!k("PUBLISH_TWCC"),rtx:!!k("USE_PUB_RTX")};try{return(await this.signal.request(ye.PUBLISH,o,!0))._message}catch(a){if(r&&a.data&&a.data.code===ve.ERR_PUBLISH_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receive publish error code, retry"),a.toString()),await this.tryUnpubBeforeRepub(t,n),this.publish(t,n,!1);throw a}}async unpublish(t,n){try{if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not publish when connection state is ".concat(this.state));await this.signal.request(ye.UNPUBLISH,{stream_id:n,ortc:t},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unpublish warning: "),r)}}async subscribe(t,n,r){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not subscribe when connection state is ".concat(this.state));const o={stream_id:t,stream_type:n.stream_type,mode:this.spec.mode,codec:this.spec.codec,p2p_id:this.store.p2pId,twcc:!!k("SUBSCRIBE_TWCC"),rtx:!!k("USE_SUB_RTX"),extend:k("SUB_EXTEND"),ssrcId:n.ssrcId,svc:Array.isArray(k("SVC"))&&k("SVC").length!==0?k("SVC"):void 0};try{return(await this.signal.request(ye.SUBSCRIBE,o,!0))._message}catch(a){if(r&&a.data&&a.data.code===ve.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver subscribe error code, retry"),a.toString()),await this.tryUnsubBeforeResub(t,n),await this.subscribe(t,n,!1);throw a}}async subscribeAll(t,n){if(this.state!=="CONNECTED"&&this.state!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not massSubscribe when connection state is ".concat(this.state));const r={p2p_id:this.store.p2pId,users:t,dtx:!1,rtx:!!k("USE_SUB_RTX")};try{return await this.signal.request(ye.SUBSCRIBE_STREAMS,r,!0)}catch(o){if(n&&o.data&&o.data.code===ve.ERR_SUBSCRIBE_REQUEST_INVALID)return v.warning("[".concat(this.store.clientId,"] receiver massSubscribe error code, retry"),o.toString()),await this.tryMassUnsubBeforeResub(t),await this.subscribeAll(t,!1);throw o}}async setVideoProfile(t){const n=function(r){if(!(r.bitrateMax&&r.bitrateMin&&r.frameRate&&r.height&&r.width))return;let o=r.frameRate,a=r.width,d=r.height,u=!0;return typeof o!="number"&&(o=o.exact||o.ideal||o.max||o.min||0,o||(u=!1)),typeof a!="number"&&(a=a.exact||a.ideal||a.max||a.min||0,a||(u=!1)),typeof d!="number"&&(d=d.exact||d.ideal||d.max||d.min||0,o||(u=!1)),u?{stream_type:0,width:a,height:d,fps:o,start_bps:1e3*r.bitrateMax,min_bps:1e3*r.bitrateMin,target_bps:1e3*r.bitrateMax}:void 0}(t);if(n)return this.signal.request(ye.SET_VIDEO_PROFILE,n);v.debug("[".concat(this.store.clientId,"] encoder config is not complete, do not report to gateway"))}async unsubscribe(t,n){try{await this.signal.request(ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,ortc:t,stream_id:n},!0)}catch(r){v.warning("[".concat(this.store.clientId,"] unsubscribe warning: "),r)}}async massUnsubscribe(t){try{await this.signal.request(ye.UNSUBSCRIBE_STREAMS,t,!0)}catch(n){v.warning("[".concat(this.store.clientId,"] massUnsubscribeAll warning: "),n)}}async reconnectPC(t){const{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=t;return{gatewayEstablishParams:await this.signal.request(ye.CONNECT_PC,{p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}},!0),gatewayAddress:this.getCurrentGatewayAddress()}}getGatewayInfo(){return this.signal.request(ye.GATEWAY_INFO)}async renewToken(t){await this.signal.request(ye.RENEW_TOKEN,t),this.key=t.token}async setClientRole(t,n){if(n&&(this._clientRoleOptions=Object.assign({},n)),this.state!=="CONNECTED")return void(this.role=t);let r;r=t==="audience"?this._clientRoleOptions&&this._clientRoleOptions.level?this._clientRoleOptions.level:2:0,await this.signal.request(ye.SET_CLIENT_ROLE,{role:t,level:r,client_ts:Date.now()}),this.role=t}async setRemoteVideoStreamType(t,n){await this.signal.request(ye.SWITCH_VIDEO_STREAM,{stream_id:t,stream_type:n})}async setDefaultRemoteVideoStreamType(t){await this.signal.request(ye.DEFAULT_VIDEO_STREAM,{stream_type:t})}async setStreamFallbackOption(t,n){await this.signal.request(ye.SET_FALLBACK_OPTION,{stream_id:t,fallback_type:n})}async pickSVCLayer(t,n){await this.signal.request(ye.PICK_SVC_LAYER,{stream_id:t,spatial_layer:n.spatialLayer,temporal_layer:n.temporalLayer})}getInChannelInfo(){return this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt),Xi({},this.inChannelInfo)}async getGatewayVersion(){return(await this.signal.request(ye.GATEWAY_INFO)).version}reset(){if(this.inChannelInfo.joinAt&&(this.inChannelInfo.duration=Date.now()-this.inChannelInfo.joinAt,this.inChannelInfo.joinAt=null),this.trafficStatsInterval&&(window.clearInterval(this.trafficStatsInterval),this.trafficStatsInterval=void 0),this.joinInfo){const t=cE.get(this.joinInfo.cname);t&&t.delete(this.joinInfo.uid)}this.joinInfo=void 0,this.key=void 0,this.networkQualityInterval&&(window.clearInterval(this.networkQualityInterval),this.networkQualityInterval=void 0)}updateTurnConfigFromSignal(){if(!this.joinInfo)return;const t=function(n){let r;return r=n.startsWith("dc")?n.match(/(dc\:\/\/)?([^:]+):(\d+)/):n.match(/(wss\:\/\/)?([^:]+):(\d+)/),r?{username:Cr.username,password:Cr.password,turnServerURL:r[2],tcpport:parseInt(r[3])+30,udpport:parseInt(r[3])+30,forceturn:!1}:null}((this.joinInfo.cloudProxyServer==="disabled"?this.signal.url:this.joinInfo.gatewayAddrs[this.signal.currentURLIndex].address)||"");this.joinInfo.turnServer.serversFromGateway=[],t&&this.joinInfo.turnServer.mode!=="off"&&this.joinInfo.cloudProxyServer==="disabled"&&this.joinInfo.turnServer.serversFromGateway.push(Xi(Xi({},Cr),{},{turnServerURL:t.turnServerURL,tcpport:t.tcpport,udpport:t.udpport,username:this.joinInfo.uid.toString(),password:this.joinInfo.token}))}async updateTrafficStats(){if(this.state!=="CONNECTED")return;const t=await this.signal.request(ye.TRAFFIC_STATS,void 0,!0);t.timestamp=Date.now(),t.peer_delay.forEach(n=>{const r=this._statsCollector.trafficStats&&this._statsCollector.trafficStats.peer_delay.find(o=>o.peer_uid===n.peer_uid);r&&r.B_st!==n.B_st&&Li(()=>{this.emit(_t.STREAM_TYPE_CHANGE,n.peer_uid,n.B_st)})}),this._statsCollector.updateTrafficStats(t)}getJoinMessage(t){if(!this.joinInfo||!this.key)throw new b(I.UNEXPECTED_ERROR,"can not generate join message, no join info");const n=Object.assign({},this.joinInfo.apResponse);let r=k("REPORT_APP_SCENARIO");if(typeof r!="string")try{r=JSON.stringify(r)}catch{r=void 0}r&&r.length>128&&(r=void 0);const o=Xi({license:this.joinInfo.license,p2p_id:this.store.p2pId,session_id:this.joinInfo.sid,app_id:this.joinInfo.appId,channel_key:this.key,channel_name:this.joinInfo.cname,sdk_version:Hr,browser:navigator.userAgent,process_id:k("PROCESS_ID"),mode:this.spec.mode,codec:this.spec.codec,role:this.role,has_changed_gateway:this.hasChangeBGPAddress,ap_response:n,extend:k("JOIN_EXTEND"),details:{6:this.joinInfo.stringUid,cservice_map:this.joinInfo.cloudProxyServer==="proxy3"?"1":this.joinInfo.cloudProxyServer==="proxy5"?"2":void 0},features:{rejoin:!0},optionalInfo:this.joinInfo.optionalInfo,appScenario:r,attributes:{userAttributes:{enablePublishedUserList:k("ENABLE_PUBLISHED_USER_LIST"),maxSubscription:k("MAX_SUBSCRIPTION"),subscribeAudioFilterTopN:typeof k("SUBSCRIBE_AUDIO_FILTER_TOPN")=="number"?k("SUBSCRIBE_AUDIO_FILTER_TOPN"):void 0,enablePublishAudioFilter:typeof k("ENABLE_PUBLISH_AUDIO_FILTER")=="boolean"?k("ENABLE_PUBLISH_AUDIO_FILTER"):void 0,enableUserLicenseCheck:typeof k("ENABLE_USER_LICENSE_CHECK")=="boolean"?k("ENABLE_USER_LICENSE_CHECK"):void 0,enableRTX:k("USE_PUB_RTX")===!0||k("USE_SUB_RTX")===!0||void 0}},join_ts:this.joinGatewayStartTime},t);return this.joinInfo.stringUid&&(o.string_uid=this.joinInfo.stringUid),this.joinInfo.aesmode&&this.joinInfo.aespassword&&(o.aes_mode=this.joinInfo.aesmode,k("ENCRYPT_AES")?(o.aes_secret=this.joinInfo.aespassword,o.aes_encrypt=!0):o.aes_secret=this.joinInfo.aespassword,this.joinInfo.aessalt&&(o.aes_salt=this.joinInfo.aessalt)),n.addresses[this.signal.websocket.currentURLIndex]&&(o.ap_response.ticket=n.addresses[this.signal.websocket.currentURLIndex].ticket,delete n.addresses),this.joinInfo.defaultVideoStream!==void 0&&(o.default_video_stream=this.joinInfo.defaultVideoStream),o}getRejoinMessage(){if(!this.joinInfo)throw new b(I.UNEXPECTED_ERROR,"can not generate rejoin message, no join info");return{session_id:this.joinInfo.sid,channel_name:this.joinInfo.cname,cid:this.joinInfo.cid,uid:this.joinInfo.uid,vid:Number(this.joinInfo.vid)}}handleSignalEvents(){this.signal.on(Ee.WS_RECONNECT_WAITTING_FINISH,t=>{["tryNext","recover"].includes(t)&&this.joinInfo&&he.adjustSessionStartTime(this.joinInfo.sid)}),this.signal.on(Ee.WS_RECONNECT_CREATE_CONNECTION,t=>{this.joinGatewayStartTime=Date.now()}),this.signal.on(Ee.WS_RECONNECTING,t=>{this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:t||Kn.NETWORK_ERROR}),this.joinInfo&&(this.state="RECONNECTING",he.sessionInit(this.joinInfo.sid,{lts:new Date().getTime(),extend:this.isSignalRecover?{recover:!0}:{rejoin:!0},cname:this.joinInfo.cname,appid:this.joinInfo.appId,mode:this.spec.mode}),this.isSignalRecover=!1,this.joinGatewayStartTime=Date.now())}),this.signal.on(Ee.WS_CLOSED,t=>{let n;switch(t){case Je.LEAVE:n=Kn.LEAVE;break;case Je.UID_BANNED:case Je.IP_BANNED:case Je.CHANNEL_BANNED:case Je.SERVER_ERROR:n=Kn.SERVER_ERROR;break;case Je.FALLBACK:n=Kn.FALLBACK;break;case Je.LICENSE_MISSING:case Je.LICENSE_EXPIRED:case Je.LICENSE_MINUTES_EXCEEDED:case Je.LICENSE_PERIOD_INVALID:case Je.LICENSE_MULTIPLE_SDK_SERVICE:case Je.LICENSE_ILLEGAL:n=t;break;default:n=Kn.NETWORK_ERROR}v.debug("[".concat(this.store.clientId,"] [signal] websocket closed, reason: ").concat(n||"undefined -> "+Kn.NETWORK_ERROR)),this.joinInfo&&he.WebSocketQuit(this.joinInfo.sid,{lts:Date.now(),succ:t===Je.LEAVE?1:-1,cname:this.joinInfo.cname,uid:this.joinInfo.uid,cid:this.joinInfo.cid,errorCode:n}),this._disconnectedReason=t,t!==Je.FALLBACK&&(this.state="DISCONNECTED"),this.reset()}),this.signal.on(Ee.WS_CONNECTED,()=>{if(this.updateTurnConfigFromSignal(),this.state="CONNECTED",this.joinInfo&&(this.role==="audience"&&this._clientRoleOptions&&this._clientRoleOptions.level&&(v.debug("[".concat(this.store.clientId,"] patch to send set client role, role: ").concat(this.role,", mode: ").concat(this.spec.mode,", level: ").concat(this._clientRoleOptions&&this._clientRoleOptions.level)),this.setClientRole(this.role,this._clientRoleOptions)),he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!0,ec:null,vid:this.joinInfo.vid,addr:this.signal.url,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof go?"1":"0"}),this._isProactiveJoin=!1,this.joinInfo.useLocalAccessPoint&&this.joinInfo.setLocalAPVersion===1)){const t=this.signal.url&&this.signal.url.match(/wss\:\/\/([^:]+):(\d+)/);if(!t)return void v.error("[".concat(this.store.clientId,"] set local access point after joined failed: ").concat(t));it("EVENT_REPORT_DOMAIN",t[1]),it("EVENT_REPORT_BACKUP_DOMAIN",t[1]),it("LOG_UPLOAD_SERVER","".concat(t[1],":6444"))}}),this.signal.on(Pe.ON_UPLINK_STATS,t=>{this._statsCollector.updateUplinkStats(t)}),this.signal.on(Ee.REQUEST_RECOVER,(t,n,r)=>{if(!this.joinInfo)return r(new b(I.UNEXPECTED_ERROR,"gateway: can not recover, no join info"));t&&(this.joinInfo.multiIP=t,this.hasChangeBGPAddress=!0),this.isSignalRecover=!0,Cn(this,_t.REQUEST_NEW_GATEWAY_LIST).then(n).catch(r)}),this.signal.on(Ee.REQUEST_JOIN_INFO,async t=>{var n;this.updateTurnConfigFromSignal();const{iceParameters:r,dtlsParameters:o,rtpCapabilities:a}=await Cn(this,_t.REQUEST_P2P_CONNECTION_PARAMS,{turnServer:(n=this.joinInfo)===null||n===void 0?void 0:n.turnServer});t(this.getJoinMessage({ortc:{iceParameters:r,dtlsParameters:o,rtpCapabilities:a,version:"2"}}))}),this.signal.on(Ee.REQUEST_REJOIN_INFO,t=>{t(this.getRejoinMessage())}),this.signal.on(Ee.REPORT_JOIN_GATEWAY,(t,n)=>{this.joinInfo&&(he.joinGateway(this.joinInfo.sid,{lts:this.joinGatewayStartTime,succ:!1,ec:t,addr:n,uid:this.joinInfo.uid,cid:this.joinInfo.cid,firstSuccess:this._isProactiveJoin,avoidJoinStartTime:this.store.avoidJoinStart,isProxy:!!this.joinInfo.proxyServer,signalChannel:this.signal instanceof go?"1":"0"}),this._isProactiveJoin=!1)}),this.signal.on(Ee.IS_P2P_DISCONNECTED,t=>{t(Ys(this,_t.IS_P2P_DISCONNECTED))}),this.signal.on(Ee.DISCONNECT_P2P,()=>{this.emit(_t.DISCONNECT_P2P)}),this.signal.on(Ee.NEED_RENEW_SESSION,()=>{this.emit(_t.NEED_RENEW_SESSION)}),this.signal.on(Ee.REQUEST_SUCCESS,()=>{this._signalTimeout=!1}),this.signal.on(Ee.REQUEST_TIMEOUT,()=>{this._signalTimeout=!0}),this.signal.on(Ee.JOIN_RESPONSE,t=>{const n=this.getCurrentGatewayAddress();this.emit(_t.JOIN_RESPONSE,t,n)}),this.signal.on(Ee.DATACHANNEL_PRECONNECT,async(t,n,r)=>{this.updateTurnConfigFromSignal();const o=this.getCurrentGatewayAddress();return Cn(this,_t.DATACHANNEL_PRECONNECT,t,o).then(n).catch(r)}),this.signal.on(Ee.DATACHANNEL_CONNECTING,async t=>{const{iceParameters:n,dtlsParameters:r,rtpCapabilities:o}=await Cn(this,_t.REQUEST_DC_CONNECTION_PARAMS);t(this.getJoinMessage({ortc:{iceParameters:n,dtlsParameters:r,rtpCapabilities:o,version:"2"}}))}),this.signal.on(Ee.DATACHANNEL_FAILBACK,()=>{v.warning("[".concat(this.store.clientId,"] User join datachannel failed")),this.reset(),this.resetSignal(),this.emit(_t.DATACHANNEL_FAILBACK)})}async tryUnsubBeforeResub(t,n){try{await this.signal.request(ye.UNSUBSCRIBE,{p2p_id:this.store.p2pId,stream_id:t,ortc:[n]},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnsubBeforeResub warning"),r),r}}async tryUnpubBeforeRepub(t,n){try{await this.signal.request(ye.UNPUBLISH,{stream_id:t,ortc:n},!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryUnpubBeforeRepub warning: "),r),r}}async tryMassUnsubBeforeResub(t){const n={users:t.map(r=>({stream_id:r.stream_id,stream_type:r.stream_type}))};try{await this.signal.request(ye.UNSUBSCRIBE_STREAMS,n,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] tryMassUnsubBeforeResub warning"),r),r}}async muteLocal(t,n){const r={action:t.find(o=>o.stream_type===Wt.Audio)?"mute_local_audio":"mute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway muteLocal warning: "),o),o}}async unmuteLocal(t,n){const r={action:t.find(o=>o.stream_type===Wt.Audio)?"unmute_local_audio":"unmute_local_video",p2p_id:this.store.p2pId,ortc:t,stream_id:n};try{await this.signal.request(ye.CONTROL,r,!0,!0)}catch(o){throw v.warning("[".concat(this.store.clientId,"] gateway unmuteLocal warning: "),o),o}}uploadStats(t,n){this.signal.upload(t,n)}getSignalRTT(){return this.signal.rtt}async restartICE(t){const n={p2p_id:this.store.p2pId,stream_id:this.store.uid,ortc:t};try{return await this.signal.request(ye.RESTART_ICE,n,!0)}catch(r){throw v.warning("[".concat(this.store.clientId,"] P2PChannel.restartICE warning: "),r),r}}reconnect(){this.state==="CONNECTED"&&this.signal.reconnect(void 0,Kn.P2P_FAILED)}getCurrentGatewayAddress(){var t;if(!k("GATEWAY_WSS_ADDRESS"))return(t=this.joinInfo)!==null&&t!==void 0&&t.gatewayAddrs?this.joinInfo.gatewayAddrs[this.signal.currentURLIndex]:void 0}async setPublishAudioFilterEnabled(t){await this.signal.request(ye.SET_PARAMETER,{enablePublishAudioFilter:t})}resetSignal(){this.signal&&(this.signal.removeAllListeners(),this.signal.close(Je.FALLBACK)),this.store.useDataChannel=!1,this.signal=new OI(Xi(Xi({},this.spec),{},{retryConfig:this.spec.websocketRetryConfig}),this.store),this.handleSignalEvents(),this.emit(_t.RESET_SIGNAL,mu.websocket)}}/*! formdata-polyfill. MIT License. Jimmy W?rting <https://jimmy.warting.se/opensource> */(function(){var e;function t(K){var Q=0;return function(){return Q<K.length?{done:!1,value:K[Q++]}:{done:!0}}}var n=typeof Object.defineProperties=="function"?Object.defineProperty:function(K,Q,ae){return K==Array.prototype||K==Object.prototype||(K[Q]=ae.value),K},r,o=function(K){K=[typeof globalThis=="object"&&globalThis,K,typeof window=="object"&&window,typeof self=="object"&&self,typeof l=="object"&&l];for(var Q=0;Q<K.length;++Q){var ae=K[Q];if(ae&&ae.Math==Math)return ae}throw Error("Cannot find global object")}(this);function a(K,Q){if(Q)e:{var ae=o;K=K.split(".");for(var Ce=0;Ce<K.length-1;Ce++){var We=K[Ce];if(!(We in ae))break e;ae=ae[We]}(Q=Q(Ce=ae[K=K[K.length-1]]))!=Ce&&Q!=null&&n(ae,K,{configurable:!0,writable:!0,value:Q})}}function d(K){return(K={next:K})[Symbol.iterator]=function(){return this},K}function u(K){var Q=typeof Symbol<"u"&&Symbol.iterator&&K[Symbol.iterator];return Q?Q.call(K):{next:t(K)}}if(a("Symbol",function(K){function Q(We,te){this.A=We,n(this,"description",{configurable:!0,writable:!0,value:te})}if(K)return K;Q.prototype.toString=function(){return this.A};var ae="jscomp_symbol_"+(1e9*Math.random()>>>0)+"_",Ce=0;return function We(te){if(this instanceof We)throw new TypeError("Symbol is not a constructor");return new Q(ae+(te||"")+"_"+Ce++,te)}}),a("Symbol.iterator",function(K){if(K)return K;K=Symbol("Symbol.iterator");for(var Q="Array Int8Array Uint8Array Uint8ClampedArray Int16Array Uint16Array Int32Array Uint32Array Float32Array Float64Array".split(" "),ae=0;ae<Q.length;ae++){var Ce=o[Q[ae]];typeof Ce=="function"&&typeof Ce.prototype[K]!="function"&&n(Ce.prototype,K,{configurable:!0,writable:!0,value:function(){return d(t(this))}})}return K}),typeof Object.setPrototypeOf=="function")r=Object.setPrototypeOf;else{var h;e:{var m={};try{m.__proto__={a:!0},h=m.a;break e}catch{}h=!1}r=h?function(K,Q){if(K.__proto__=Q,K.__proto__!==Q)throw new TypeError(K+" is not extensible");return K}:null}var f=r;function E(){this.m=!1,this.j=null,this.v=void 0,this.h=1,this.u=this.C=0,this.l=null}function T(K){if(K.m)throw new TypeError("Generator is already running");K.m=!0}function R(K,Q){return K.h=3,{value:Q}}function A(K){this.g=new E,this.G=K}function O(K,Q,ae,Ce){try{var We=Q.call(K.g.j,ae);if(!(We instanceof Object))throw new TypeError("Iterator result "+We+" is not an object");if(!We.done)return K.g.m=!1,We;var te=We.value}catch(S){return K.g.j=null,K.g.s(S),w(K)}return K.g.j=null,Ce.call(K.g,te),w(K)}function w(K){for(;K.g.h;)try{var Q=K.G(K.g);if(Q)return K.g.m=!1,{value:Q.value,done:!1}}catch(ae){K.g.v=void 0,K.g.s(ae)}if(K.g.m=!1,K.g.l){if(Q=K.g.l,K.g.l=null,Q.F)throw Q.D;return{value:Q.return,done:!0}}return{value:void 0,done:!0}}function x(K){this.next=function(Q){return K.o(Q)},this.throw=function(Q){return K.s(Q)},this.return=function(Q){return function(ae,Ce){T(ae.g);var We=ae.g.j;return We?O(ae,"return"in We?We.return:function(te){return{value:te,done:!0}},Ce,ae.g.return):(ae.g.return(Ce),w(ae))}(K,Q)},this[Symbol.iterator]=function(){return this}}function V(K,Q){return Q=new x(new A(Q)),f&&K.prototype&&f(Q,K.prototype),Q}if(E.prototype.o=function(K){this.v=K},E.prototype.s=function(K){this.l={D:K,F:!0},this.h=this.C||this.u},E.prototype.return=function(K){this.l={return:K},this.h=this.u},A.prototype.o=function(K){return T(this.g),this.g.j?O(this,this.g.j.next,K,this.g.o):(this.g.o(K),w(this))},A.prototype.s=function(K){return T(this.g),this.g.j?O(this,this.g.j.throw,K,this.g.o):(this.g.s(K),w(this))},a("Array.prototype.entries",function(K){return K||function(){return function(Q,ae){Q instanceof String&&(Q+="");var Ce=0,We=!1,te={next:function(){if(!We&&Ce<Q.length){var S=Ce++;return{value:ae(S,Q[S]),done:!1}}return We=!0,{done:!0,value:void 0}}};return te[Symbol.iterator]=function(){return te},te}(this,function(Q,ae){return[Q,ae]})}}),typeof Blob<"u"&&(typeof FormData>"u"||!FormData.prototype.keys)){var X=function(K,Q){for(var ae=0;ae<K.length;ae++)Q(K[ae])},le=function(K){return K.replace(/\r?\n|\r/g,`\r
`)},$=function(K,Q,ae){return Q instanceof Blob?(ae=ae!==void 0?ae+"":typeof Q.name=="string"?Q.name:"blob",Q.name===ae&&Object.prototype.toString.call(Q)!=="[object Blob]"||(Q=new File([Q],ae)),[String(K),Q]):[String(K),String(Q)]},ee=function(K,Q){if(K.length<Q)throw new TypeError(Q+" argument required, but only "+K.length+" present.")},q=typeof globalThis=="object"?globalThis:typeof window=="object"?window:typeof self=="object"?self:this,re=q.FormData,ze=q.XMLHttpRequest&&q.XMLHttpRequest.prototype.send,Se=q.Request&&q.fetch,ct=q.navigator&&q.navigator.sendBeacon,tt=q.Element&&q.Element.prototype,Pt=q.Symbol&&Symbol.toStringTag;Pt&&(Blob.prototype[Pt]||(Blob.prototype[Pt]="Blob"),"File"in q&&!File.prototype[Pt]&&(File.prototype[Pt]="File"));try{new File([],"")}catch{q.File=function(Q,ae,Ce){return Q=new Blob(Q,Ce||{}),Object.defineProperties(Q,{name:{value:ae},lastModified:{value:+(Ce&&Ce.lastModified!==void 0?new Date(Ce.lastModified):new Date)},toString:{value:function(){return"[object File]"}}}),Pt&&Object.defineProperty(Q,Pt,{value:"File"}),Q}}var un=function(K){return K.replace(/\n/g,"%0A").replace(/\r/g,"%0D").replace(/"/g,"%22")},Ot=function(K){this.i=[];var Q=this;K&&X(K.elements,function(ae){if(ae.name&&!ae.disabled&&ae.type!=="submit"&&ae.type!=="button"&&!ae.matches("form fieldset[disabled] *"))if(ae.type==="file"){var Ce=ae.files&&ae.files.length?ae.files:[new File([],"",{type:"application/octet-stream"})];X(Ce,function(We){Q.append(ae.name,We)})}else ae.type==="select-multiple"||ae.type==="select-one"?X(ae.options,function(We){!We.disabled&&We.selected&&Q.append(ae.name,We.value)}):ae.type==="checkbox"||ae.type==="radio"?ae.checked&&Q.append(ae.name,ae.value):(Ce=ae.type==="textarea"?le(ae.value):ae.value,Q.append(ae.name,Ce))})};if((e=Ot.prototype).append=function(K,Q,ae){ee(arguments,2),this.i.push($(K,Q,ae))},e.delete=function(K){ee(arguments,1);var Q=[];K=String(K),X(this.i,function(ae){ae[0]!==K&&Q.push(ae)}),this.i=Q},e.entries=function K(){var Q,ae=this;return V(K,function(Ce){if(Ce.h==1&&(Q=0),Ce.h!=3)return Q<ae.i.length?Ce=R(Ce,ae.i[Q]):(Ce.h=0,Ce=void 0),Ce;Q++,Ce.h=2})},e.forEach=function(K,Q){ee(arguments,1);for(var ae=u(this),Ce=ae.next();!Ce.done;Ce=ae.next()){var We=u(Ce.value);Ce=We.next().value,We=We.next().value,K.call(Q,We,Ce,this)}},e.get=function(K){ee(arguments,1);var Q=this.i;K=String(K);for(var ae=0;ae<Q.length;ae++)if(Q[ae][0]===K)return Q[ae][1];return null},e.getAll=function(K){ee(arguments,1);var Q=[];return K=String(K),X(this.i,function(ae){ae[0]===K&&Q.push(ae[1])}),Q},e.has=function(K){ee(arguments,1),K=String(K);for(var Q=0;Q<this.i.length;Q++)if(this.i[Q][0]===K)return!0;return!1},e.keys=function K(){var Q,ae,Ce,We,te=this;return V(K,function(S){if(S.h==1&&(Q=u(te),ae=Q.next()),S.h!=3)return ae.done?void(S.h=0):(Ce=ae.value,We=u(Ce),R(S,We.next().value));ae=Q.next(),S.h=2})},e.set=function(K,Q,ae){ee(arguments,2),K=String(K);var Ce=[],We=$(K,Q,ae),te=!0;X(this.i,function(S){S[0]===K?te&&(te=!Ce.push(We)):Ce.push(S)}),te&&Ce.push(We),this.i=Ce},e.values=function K(){var Q,ae,Ce,We,te=this;return V(K,function(S){if(S.h==1&&(Q=u(te),ae=Q.next()),S.h!=3)return ae.done?void(S.h=0):(Ce=ae.value,(We=u(Ce)).next(),R(S,We.next().value));ae=Q.next(),S.h=2})},Ot.prototype._asNative=function(){for(var K=new re,Q=u(this),ae=Q.next();!ae.done;ae=Q.next()){var Ce=u(ae.value);ae=Ce.next().value,Ce=Ce.next().value,K.append(ae,Ce)}return K},Ot.prototype._blob=function(){var K="----formdata-polyfill-"+Math.random(),Q=[],ae="--"+K+`\r
Content-Disposition: form-data; name="`;return this.forEach(function(Ce,We){return typeof Ce=="string"?Q.push(ae+un(le(We))+`"\r
\r
`+le(Ce)+`\r
`):Q.push(ae+un(le(We))+'"; filename="'+un(Ce.name)+`"\r
Content-Type: `+(Ce.type||"application/octet-stream")+`\r
\r
`,Ce,`\r
`)}),Q.push("--"+K+"--"),new Blob(Q,{type:"multipart/form-data; boundary="+K})},Ot.prototype[Symbol.iterator]=function(){return this.entries()},Ot.prototype.toString=function(){return"[object FormData]"},tt&&!tt.matches&&(tt.matches=tt.matchesSelector||tt.mozMatchesSelector||tt.msMatchesSelector||tt.oMatchesSelector||tt.webkitMatchesSelector||function(K){for(var Q=(K=(this.document||this.ownerDocument).querySelectorAll(K)).length;0<=--Q&&K.item(Q)!==this;);return-1<Q}),Pt&&(Ot.prototype[Pt]="FormData"),ze){var or=q.XMLHttpRequest.prototype.setRequestHeader;q.XMLHttpRequest.prototype.setRequestHeader=function(K,Q){or.call(this,K,Q),K.toLowerCase()==="content-type"&&(this.B=!0)},q.XMLHttpRequest.prototype.send=function(K){K instanceof Ot?(K=K._blob(),this.B||this.setRequestHeader("Content-Type",K.type),ze.call(this,K)):ze.call(this,K)}}Se&&(q.fetch=function(K,Q){return Q&&Q.body&&Q.body instanceof Ot&&(Q.body=Q.body._blob()),Se.call(this,K,Q)}),ct&&(q.navigator.sendBeacon=function(K,Q){return Q instanceof Ot&&(Q=Q._asNative()),ct.call(this,K,Q)}),q.FormData=Ot}})();const Nu=()=>{const e=k("AREAS");return e.length===0&&e.push(je.GLOBAL),Fo(e).call(e,(t,n,r)=>{const o=LI(n);return o?r===0?o:"".concat(t,",").concat(o):t},"")},LI=e=>e===je.OVERSEA?"".concat(nn.ASIA,",").concat(nn.EUROPE,",").concat(nn.AFRICA,",").concat(nn.NORTH_AMERICA,",").concat(nn.SOUTH_AMERICA,",").concat(nn.OCEANIA):nn[e],_j=e=>{const t={CODE:"",WEBCS_DOMAIN:[],WEBCS_DOMAIN_BACKUP_LIST:[],PROXY_CS:[],CDS_AP:[],ACCOUNT_REGISTER:[],UAP_AP:[],EVENT_REPORT_DOMAIN:[],EVENT_REPORT_BACKUP_DOMAIN:[],LOG_UPLOAD_SERVER:[],PROXY_SERVER_TYPE3:[]};return e.map(n=>{const r=Eu[n],o=Object.keys(r);o&&o.map(a=>{a!=="CODE"&&(t[a]=t[a].concat(r[a]))})}),t},bu={GLOBAL:{ASIA:[je.CHINA,je.JAPAN,je.INDIA,je.KOREA,je.HKMC],EUROPE:[],NORTH_AMERICA:[je.US],SOUTH_AMERICA:[],OCEANIA:[],AFRICA:[]}},dE=Object.keys(bu[je.GLOBAL]),kI=[je.CHINA,je.NORTH_AMERICA,je.EUROPE,je.ASIA,je.JAPAN,je.INDIA,je.OCEANIA,je.SOUTH_AMERICA,je.AFRICA,je.KOREA,je.HKMC,je.US],gj=function(e,t){let n=[];if(e.includes(je.GLOBAL)){const a=[je.GLOBAL,je.OVERSEA],d=Object.keys(Eu);if(t===je.GLOBAL)throw new b(I.INVALID_PARAMS,"GLOBAL is an invalid excludedArea value");if(t===je.CHINA)n=[je.OVERSEA];else if(o=t,dE.includes(o)){const u=(r=t,bu[je.GLOBAL][r]||[]),h=[...a,t,...u];n=d.filter(m=>!h.includes(m))}else if(function(u){let h=!1;return dE.forEach(m=>{bu[je.GLOBAL][m].includes(u)&&(h=!0)}),h}(t)){const u=function(m){let f;return dE.forEach(E=>{bu[je.GLOBAL][E].includes(m)&&(f=E)}),f}(t),h=[...a,u,t];n=d.filter(m=>!h.includes(m))}else n=e;n=function(u){const h=[];return kI.forEach(m=>{u.includes(m)&&h.push(m)}),h.concat(u.filter(m=>!kI.includes(m)))}(n)}else n=e;var r,o;return n};function MI(e){if(!e&&k("AREAS").includes(je.EXTENSIONS))return v.debug("update area from ap : reset"),void lE(_R,!0);if(!k("AREAS").includes(je.GLOBAL)||!e)return;let t=Eu.EXTENSIONS;t&&(t={CODE:LI(je.EXTENSIONS),WEBCS_DOMAIN:["ap-web-1-".concat(e,".agora.io")],WEBCS_DOMAIN_BACKUP_LIST:["ap-web-2-".concat(e,".ap.sd-rtn.com")],PROXY_CS:["proxy-ap-web-".concat(e,".agora.io")],CDS_AP:["cds-ap-web-1-".concat(e,".agora.io"),"cds-ap-web-2-".concat(e,".ap.sd-rtn.com")],ACCOUNT_REGISTER:["sua-ap-web-1-".concat(e,".agora.io"),"sua-ap-web-2-".concat(e,".ap.sd-rtn.com")],UAP_AP:["uap-ap-web-1-".concat(e,".agora.io"),"uap-ap-web-2-".concat(e,".ap.sd-rtn.com")],EVENT_REPORT_DOMAIN:["statscollector-1-".concat(e,".agora.io")],EVENT_REPORT_BACKUP_DOMAIN:["statscollector-2-".concat(e,".agora.io")],LOG_UPLOAD_SERVER:["logservice-".concat(e,".agora.io")],PROXY_SERVER_TYPE3:["webrtc-cloud-proxy-".concat(e,".agora.io")]},v.debug("update area from ap success: ".concat(e,",config is "),t),it("AREAS",[je.EXTENSIONS],!0),Object.keys(t).map(n=>{n==="LOG_UPLOAD_SERVER"||n==="EVENT_REPORT_DOMAIN"||n==="EVENT_REPORT_BACKUP_DOMAIN"||n==="PROXY_SERVER_TYPE3"?it(n,t[n][0]):it(n,t[n])}))}function lE(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];const n=he.reportApiInvoke(null,{name:Mt.SET_AREA,options:e,tag:Et.TRACER});try{let r=[];if(typeof e=="string"&&(r=[e]),Array.isArray(e)&&(e.forEach(a=>{if(!KV.includes(a))throw new b(I.INVALID_PARAMS,"invalid area code")}),r=e),Object.prototype.toString.call(e)==="[object Object]"){const{areaCode:a,excludedArea:d}=e;if(!a)throw new b(I.INVALID_PARAMS,"area code is needed");let u=a;typeof a=="string"&&(u=[a]),r=d?gj(u,d):u}if(!t){if(js.AREAS){const a=new b(I.PROHIBITED_OPERATION,"setArea is prohibited because of config-distribute");return n.onError(a),void v.warning("setArea is prohibited because of config-distribute")}if(r.includes(je.GLOBAL)&&k("AREAS")===je.EXTENSIONS){const a=new b(I.PROHIBITED_OPERATION,"setArea is prohibited because of ap extensions");return n.onError(a),void v.warning("setArea is prohibited because of ap extensions")}}it("AREAS",r,t);const o=_j(r);Object.keys(o).map(a=>{a==="LOG_UPLOAD_SERVER"||a==="EVENT_REPORT_DOMAIN"||a==="EVENT_REPORT_BACKUP_DOMAIN"||a==="PROXY_SERVER_TYPE3"?it(a,o[a][0]):it(a,o[a])}),v.debug("set area success:",r.join(","))}catch(r){throw n.onError(r),r}n.onSuccess()}function UI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function xI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?UI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):UI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let uE=1;function Sj(e,t,n,r,o){uE+=1;const a={sid:n.sid,command:"convergeAllocateEdge",uid:"666",appId:n.appId,ts:Math.floor(Date.now()/1e3),seq:uE,requestId:uE,version:Hr,cname:n.cname},d={service_name:t,json_body:JSON.stringify(a)};let u,h,m=e[0];return Ni(async()=>{u=Date.now();const f=await ci(m,{data:d,cancelToken:r,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"}});if(h=Date.now()-u,f.code!==0){const R=new b(I.UNEXPECTED_RESPONSE,"live streaming ap error, code"+f.code,{retry:!0,responseTime:h});throw v.error(R.toString()),R}const E=JSON.parse(f.json_body);if(E.code!==200){const R=new b(I.UNEXPECTED_RESPONSE,"live streaming app center error, code: ".concat(E.code,", reason: ").concat(E.reason),{code:E.code,responseTime:h});throw v.error(R.toString()),R}if(!E.servers||E.servers.length===0){const R=new b(I.UNEXPECTED_RESPONSE,"live streaming app center empty server",{code:E.code,responseTime:h});throw v.error(R.toString()),R}const T=function(R,A){return{addressList:R.servers.map(O=>"wss://".concat(O.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(O.wss,"?serviceName=").concat(encodeURIComponent(A))),workerToken:R.workerToken,vid:R.vid}}(E,t);return k("LIVE_STREAMING_ADDRESS")&&(T.addressList=k("LIVE_STREAMING_ADDRESS")instanceof Array?k("LIVE_STREAMING_ADDRESS"):[k("LIVE_STREAMING_ADDRESS")]),xI(xI({},T),{},{responseTime:h})},(f,E)=>(he.apworkerEvent(n.sid,{success:!0,sc:200,serviceName:t,responseDetail:JSON.stringify(f.addressList),firstSuccess:E===0,responseTime:h,serverIp:e[E%e.length]}),!1),(f,E)=>(he.apworkerEvent(n.sid,{success:!1,sc:f.data&&f.data.code||200,serviceName:t,responseTime:h,serverIp:e[E%e.length]}),!!(f.code!==I.OPERATION_ABORTED&&f.code!==I.UNEXPECTED_RESPONSE||f.data&&f.data.retry)&&(m=e[(E+1)%e.length],!0)),o)}let hE=1;function VI(e,t,n,r){let{url:o,areaCode:a}=e;const d=Date.now();let u;const[h,m]=GI(t,a,[Qt.CHOOSE_SERVER]);let f=xt.networkState;return Ni(async()=>{f&&xt.networkState===On.OFFLINE&&xt.onlineWaiter&&await de.race([xt.onlineWaiter,Rn(r&&r.maxRetryTimeout||kt.maxRetryTimeout)]),f=xt.networkState;const{data:E,headers:T}=await ci(o,{data:h,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);u=T.http3==="1"?1:-1,he.reportResourceTiming(o,t.sid),jI(E,o,t,d,[Qt.CHOOSE_SERVER],u);const R=iE(E,Qt.CHOOSE_SERVER);return BI(R),mI(R,o)},E=>(E&&he.joinChooseServer(t.sid,{lts:d,succ:!0,csAddr:o,opid:m,serverList:E.gatewayAddrs.map(T=>T.address),ec:null,cid:E.cid.toString(),uid:E.uid.toString(),csIp:E.csIp,unilbsServerIds:[Qt.CHOOSE_SERVER].toString(),isHttp3:u}),!1),E=>E.code!==I.OPERATION_ABORTED&&(E.code===I.CAN_NOT_GET_GATEWAY_SERVER?E.data.retry:(he.joinChooseServer(t.sid,{lts:d,succ:!1,csAddr:o,serverList:null,opid:m,ec:E.code,csIp:E.data&&E.data.csIp,unilbsServerIds:[Qt.CHOOSE_SERVER].toString(),extend:JSON.stringify({networkState:f}),isHttp3:u}),v.warning("[".concat(t.clientId,"] Choose server network error, retry"),E),!0)),r)}function FI(e,t,n,r){let o,{url:a,areaCode:d,serviceIds:u}=e;const h=Date.now(),[m,f]=GI(t,d,u);let E;return Ni(async()=>{E&&xt.networkState===On.OFFLINE&&xt.onlineWaiter&&await de.race([xt.onlineWaiter,Rn(r&&r.maxRetryTimeout||kt.maxRetryTimeout)]),E=xt.networkState;const{data:T,headers:R}=await ci(a,{data:m,cancelToken:n,headers:{"Content-Type":"multipart/form-data;"}},!0,!0);o=R.http3==="1"?1:-1,he.reportResourceTiming(a,t.sid),jI(T,a,t,h,u,o);const A=iE(T,Qt.CHOOSE_SERVER),O=iE(T,t.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:t.cloudProxyServer==="proxy3"||t.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK);return BI(A),{gatewayInfo:mI(A,a),proxyInfo:O,url:a}},T=>(T.gatewayInfo&&he.joinChooseServer(t.sid,{lts:h,succ:!0,csAddr:a,serverList:T.gatewayInfo.gatewayAddrs.map(R=>R.address),ec:null,opid:f,cid:T.gatewayInfo.cid.toString(),uid:T.gatewayInfo.uid.toString(),csIp:T.gatewayInfo.csIp,unilbsServerIds:u.toString(),isHttp3:o}),T.proxyInfo&&he.joinWebProxyAP(t.sid,{lts:h,sucess:1,apServerAddr:a,turnServerAddrList:T.proxyInfo.addresses.map(R=>R.ip).join(","),errorCode:null,eventType:t.cloudProxyServer,unilbsServerIds:u.toString()}),!1),T=>T.code!==I.OPERATION_ABORTED&&(T.code===I.CAN_NOT_GET_GATEWAY_SERVER?T.data.retry:(he.joinWebProxyAP(t.sid,{lts:h,sucess:0,apServerAddr:a,turnServerAddrList:null,errorCode:T.code,eventType:t.cloudProxyServer,unilbsServerIds:u.toString(),extend:JSON.stringify({networkState:E})}),v.warning("[".concat(t.clientId,"] multi unilbs network error, retry"),T),!0)),r)}const jI=(e,t,n,r,o,a)=>{const d=[],u=h=>{h.flag===4096?he.joinChooseServer(n.sid,{lts:r,succ:!1,csAddr:t,opid:e.opid,serverList:null,ec:h.error.message,csIp:h.error.data&&h.error.data.csIp,unilbsServerIds:o.toString(),isHttp3:a}):h.flag!==1048576&&h.flag!==4194304&&h.flag!==4194310||he.joinWebProxyAP(n.sid,{lts:r,sucess:0,apServerAddr:t,turnServerAddrList:null,errorCode:h.error.code,eventType:n.cloudProxyServer,unilbsServerIds:o.toString()})};if(e.response_body.forEach(h=>{const m=h.buffer.code;if(h.uri===23&&m===0&&!h.buffer.edges_services)if(h.buffer.flag===4194310)v.warning("no edge services in ap response of proxy fallback, will not set proxy in iceServers"),h.buffer.edges_services=[];else{const f={error:new b(I.CAN_NOT_GET_GATEWAY_SERVER,"no edge services in ap response",{retry:!0,csIp:e.detail[502]}),flag:h.buffer.flag};d.push(f),u(f)}if(m!==0){const f=wu(m),E={error:new b(I.CAN_NOT_GET_GATEWAY_SERVER,f.desc,{desc:f.desc,retry:f.retry,csIp:e.detail[502]}),flag:h.buffer.flag};h.buffer.flag===4194310?v.warning(E.error.toString()):d.push(E),u(E)}}),d.length)throw v.warning("[".concat(n.clientId,"] multi unilbs ").concat(t," failed, ").concat(d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message,", retry: ").concat(h.error.data.retry)).join(" | "))),new b(I.CAN_NOT_GET_GATEWAY_SERVER,d.map(h=>"flag: ".concat(h.flag,", message: ").concat(h.error.message)).join(" | "),{retry:!!d.find(h=>h.error.data.retry),csIp:e.detail[502],desc:[...new Set(d.map(h=>{var m,f;return h==null||(m=h.error)===null||m===void 0||(f=m.data)===null||f===void 0?void 0:f.desc}).filter(h=>!!h))]})},BI=e=>{var t,n,r,o;if(e.addresses&&e.addresses.length===0&&e.code===0)throw new b(I.CAN_NOT_GET_GATEWAY_SERVER,"void gateway address",{retry:!0,csIp:e.detail&&e.detail[502]});if(k("AP_AREA")&&((r=e.detail)!==null&&r!==void 0&&r[23]&&typeof((o=e.detail)===null||o===void 0?void 0:o[23])=="string"?MI(e.detail[23].toLowerCase()):MI()),(t=e.detail)!==null&&t!==void 0&&t[19]&&typeof((n=e.detail)===null||n===void 0?void 0:n[19])=="string"){const d=e.detail[19],u=d==null?void 0:d.split(";");for(let h=0;h<u.length;h++){var a;const m=uo(a=u[h]).call(a);e.addresses[h]&&u&&(e.addresses[h].fingerprint=m)}}if(k("GATEWAY_ADDRESS")&&k("GATEWAY_ADDRESS").length>0){v.debug("assign gateway address to",k("GATEWAY_ADDRESS"));const d=k("GATEWAY_ADDRESS").map(u=>{var h,m;const f=(h=(m=e.addresses.find(E=>E.ip===u.ip&&E.port===u.port))===null||m===void 0?void 0:m.fingerprint)!==null&&h!==void 0?h:"";return{ip:u.ip,port:u.port,ticket:e.addresses[0]&&e.addresses[0].ticket,fingerprint:f}});e.addresses=d}},Tj=(e,t)=>{if(e.response_body&&e.response_body.length){const n=e.response_body[0];if(n.buffer.code!==0){const r=wu(n.buffer.code);throw new b(I.UPDATE_TICKET_FAILED,"[".concat(n.buffer.code,"]: ").concat(r.desc),{retry:r.retry})}return n.buffer.ticket}throw v.debug("update ticket request received ap response without response body:",t),new b(I.UPDATE_TICKET_FAILED,"cannot find response body from ap response",{retry:!1})},GI=(e,t,n)=>{const r=Math.floor(Math.random()*1e12),o={appid:e.appId,client_ts:Date.now(),opid:r,sid:e.sid,request_bodies:[{uri:22,buffer:{cname:e.cname,detail:{6:e.stringUid,11:t,12:k("USE_NEW_TOKEN")?"1":void 0,22:t},key:e.token,service_ids:n,uid:e.uid||0}}]};o.request_bodies.forEach(d=>{e.multiIP&&e.multiIP.gateway_ip&&(d.buffer.detail[5]=JSON.stringify({vocs_ip:[e.multiIP.uni_lbs_ip],vos_ip:[e.multiIP.gateway_ip]}))});const a=new FormData;return a.append("request",JSON.stringify(o)),[a,r]},vj=(e,t)=>{const n=Math.floor(Math.random()*1e12),r={appid:e.appId,client_ts:Date.now(),opid:n,sid:e.sid,request_bodies:[{uri:28,buffer:{cname:e.cname,detail:{1:"",6:e.stringUid,12:"1"},token:e.token,service_ids:t,uid:e.uid||0,edges_services:e.apResponse.addresses.map(a=>({ip:a.ip,port:a.port}))}}]},o=new FormData;return o.append("request",JSON.stringify(r)),[o,n]};let Ya=0;async function pE(e,t,n,r){return{gatewayInfo:await async function(a,d,u,h){let m=null;const f=[],E=async()=>{const R=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(w=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Nu()})),A=h.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(w=>w.url)}),O=await rd({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(v.debug("[".concat(a.clientId,"] Connect to choose_server:"),w.url),VI(w,a,d,u)),allFailedhandler:w=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:f});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O},T=async()=>{if(await Rn(1e3),m!==null)return m;const R=k("WEBCS_DOMAIN_BACKUP_LIST").map(w=>({url:a.proxyServer?"https://".concat(a.proxyServer,"/ap/?url=").concat(w+"/api/v2/transpond/webrtc?v=2"):"https://".concat(w,"/api/v2/transpond/webrtc?v=2"),areaCode:Nu()})),A=h.recordJoinChannelService({endTs:void 0,startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(w=>w.url)}),O=await rd({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(v.debug("[".concat(a.clientId,"] Connect to backup choose_server:"),w.url),VI(w,a,d,u)),allFailedhandler:w=>{throw h.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:f});return h.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O};try{return m=await za([E(),T()]),f.length&&f.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),m}catch(R){throw R[0]}}(e,t,n,r)}}async function WI(e,t,n,r,o){const a=e.cloudProxyServer;if(a==="disabled"){if(!r)return;if(e.useLocalAccessPoint)return await pE(e,t,n,o);if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY")){const{gatewayInfo:m,proxyInfo:f}=await KI(e,t,n,o);return e.turnServer&&e.turnServer.mode!=="auto"||(e.turnServer={mode:"manual",servers:f.map(E=>({turnServerURL:E.address,tcpport:E.tcpport||Cr.tcpport,udpport:E.udpport||Cr.udpport,username:E.username||Cr.username,password:E.password||Cr.password,forceturn:!1,security:!0}))}),{gatewayInfo:m}}return await pE(e,t,n,o)}const{proxyInfo:d,gatewayInfo:u}=await KI(e,t,n,o),h={gatewayInfo:u};return e.turnServer={mode:"manual",servers:d.map(m=>({turnServerURL:m.address,tcpport:a==="proxy3"?void 0:m.tcpport?m.tcpport:Cr.tcpport,udpport:a==="proxy4"?void 0:m.udpport?m.udpport:Cr.udpport,username:m.username||Cr.username,password:m.password||Cr.password,forceturn:a!=="proxy4",security:a==="proxy5"}))},v.debug("[".concat(e.clientId,"] set proxy server: ").concat(e.proxyServer,", mode: ").concat(a)),h}async function HI(e,t,n,r,o){const a=k("ACCOUNT_REGISTER").slice(0,k("AJAX_REQUEST_CONCURRENT"));let d=[];d=t.proxyServer?a.map(h=>"https://".concat(t.proxyServer,"/ap/?url=").concat(h+"/api/v1")):a.map(h=>"https://".concat(h,"/api/v1"));const u=o==null?void 0:o.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"stringUID",urls:d});try{const h=await async function(m,f,E,T,R){const A=Date.now(),O={sid:E.sid,opid:10,appid:E.appId,string_uid:f};let w=m[0];const x=await Ni(()=>ci(w+"".concat(w.indexOf("?")===-1?"?":"&","action=stringuid"),{data:O,cancelToken:T,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":72}}),(V,X)=>{if(V.code===0){if(V.uid<=0||V.uid>=Math.pow(2,32))throw v.error("Invalid Uint Uid ".concat(f," => ").concat(V.uid),V),he.reqUserAccount(O.sid,{lts:A,success:!1,serverAddr:w,stringUid:O.string_uid,uid:V.uid,errorCode:I.INVALID_UINT_UID_FROM_STRING_UID,extend:O}),new b(I.INVALID_UINT_UID_FROM_STRING_UID);return he.reqUserAccount(O.sid,{lts:A,success:!0,serverAddr:w,stringUid:O.string_uid,uid:V.uid,errorCode:null,extend:O}),!1}const le=wu(V.code);return le.retry&&(w=m[(X+1)%m.length]),he.reqUserAccount(O.sid,{lts:A,success:!1,serverAddr:w,stringUid:O.string_uid,uid:V.uid,errorCode:le.desc,extend:O}),le.retry},(V,X)=>V.code!==I.OPERATION_ABORTED&&(he.reqUserAccount(O.sid,{lts:A,success:!1,serverAddr:w,stringUid:O.string_uid,uid:null,errorCode:V.code,extend:O}),w=m[(X+1)%m.length],!0),R);if(x.code!==0){const V=wu(x.code);throw new b(I.UNEXPECTED_RESPONSE,V.desc)}return x}(d,e,t,n,r);return o==null||o.recordJoinChannelService({status:"success",endTs:Date.now()},u),h.uid}catch(h){throw o==null||o.recordJoinChannelService({status:"error",endTs:Date.now(),errors:[h]},u),h}}async function yj(e,t,n){const r=k("CDS_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(u=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(u+"/api/v1"):"https://".concat(u,"/api/v1?action=config")).map(u=>function(h,m,f,E){const T=qe(),R={flag:64,cipher_method:0,features:{device:T.name,system:T.os,system_general:navigator.userAgent,vendor:m.appId,version:Hr,cname:m.cname,sid:m.sid,session_id:m.sid,detail:"",proxyServer:m.proxyServer}};return Ni(()=>ci(h,{data:R,timeout:1e3,cancelToken:f,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":54}}),void 0,A=>A.code!==I.OPERATION_ABORTED,E)}(u,e,t,n));let o=null,a=null,d={};try{o=await za(r)}catch(u){if(u.code===I.OPERATION_ABORTED)throw u;a=u}if(r.forEach(u=>u.cancel()),he.reportApiInvoke(e.sid,{name:Mt.REQUEST_CONFIG_DISTRIBUTE,options:{error:a,res:o}}).onSuccess(),o&&o.test_tags)try{d=function(u){if(!u.test_tags)return{};const h=u.test_tags,m=Object.keys(h),f={};return m.forEach(E=>{var T;const R=uo(T=E.slice(4)).call(T),A=JSON.parse(h[E])[1];f[R]=A}),f}(o)}catch{}return d}async function KI(e,t,n,r){const o=k("PROXY_SERVER_TYPE3"),a=(R,A,O)=>{let w=O||o;return Array.isArray(w)&&(w=A%2==0?o[1]:o[0]),"https://".concat(w,"/ap/?url=").concat(R)};let d=null;const u=[],h=async()=>{const R=k("WEBCS_DOMAIN").slice(0,k("AJAX_REQUEST_CONCURRENT")).map((w,x)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(w,"/api/v2/transpond/webrtc?v=2"),x,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):a("".concat(w,"/api/v2/transpond/webrtc?v=2"),x),{url:V,areaCode:Nu(),serviceIds:[Qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(w=>w.url)}),O=await rd({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(v.debug("[".concat(e.clientId,"] Connect to choose_server:"),w.url),FI(w,e,t,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O},m=async()=>{if(await Rn(1e3),d!==null)return d;const R=k("WEBCS_DOMAIN_BACKUP_LIST").map((w,x)=>{let V;return V=e.cloudProxyServer==="disabled"&&e.proxyServer?a("".concat(w,"/api/v2/transpond/webrtc?v=2"),x,e.proxyServer):e.cloudProxyServer==="disabled"||e.cloudProxyServer==="fallback"?"https://".concat(w,"/api/v2/transpond/webrtc?v=2"):a("".concat(w,"/api/v2/transpond/webrtc?v=2"),x),{url:V,areaCode:Nu(),serviceIds:[Qt.CHOOSE_SERVER,e.cloudProxyServer==="proxy5"?Qt.CLOUD_PROXY_5:e.cloudProxyServer==="proxy3"||e.cloudProxyServer==="proxy4"?Qt.CLOUD_PROXY:Qt.CLOUD_PROXY_FALLBACK]}}),A=r.recordJoinChannelService({startTs:Date.now(),status:"pending",service:"chooseServer",urls:R.map(w=>w.url)}),O=await rd({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:R,asyncMapHandler:w=>(v.debug("[".concat(e.clientId,"] Connect to backup choose_server:"),w.url),FI(w,e,t,n)),allFailedhandler:w=>{throw r.recordJoinChannelService({endTs:Date.now(),status:"error",errors:w},A),w[0]},promisesCollector:u});return r.recordJoinChannelService({endTs:Date.now(),status:"success"},A),O};let f,E,T;try{({gatewayInfo:f,proxyInfo:E,url:T}=await za([h(),m()]))}catch(R){throw R[0]}if(u.length&&u.forEach(R=>R.cancel&&typeof R.cancel=="function"&&R.cancel()),!f||!E)throw new b(I.UNEXPECTED_ERROR,"missing gateway or proxy response").print();if(e.apUrl=T,e.cloudProxyServer!=="disabled"&&Array.isArray(o)&&T){const R=/^https?:\/\/(.+?)(\/.*)?$/.exec(T)[1];o.includes(R)&&(e.proxyServer=R,v.setProxyServer(R),he.setProxyServer(R))}return d={gatewayInfo:f,proxyInfo:await dj(E,f.uid)},d}async function zI(e,t,n,r){const o=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(a=>t.proxyServer?"https://".concat(t.proxyServer,"/ap/?url=").concat(a+"/api/v1?action=uap"):"https://".concat(a,"/api/v1?action=uap"));return await Sj(o,e,t,n,r)}async function Rj(e,t,n){const r=k("UAP_AP").slice(0,k("AJAX_REQUEST_CONCURRENT")).map(o=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(o+"/api/v1?action=uap"):"https://".concat(o,"/api/v1?action=uap")).map(o=>function(a,d,u,h){const m={command:"convergeAllocateEdge",sid:d.sid,appId:d.appId,token:d.token,ts:Date.now(),version:Hr,cname:d.cname,uid:d.uid.toString(),requestId:hE,seq:hE};hE+=1;const f={service_name:"tele_channel",json_body:JSON.stringify(m)};return Ni(async()=>{const E=await ci(a,{data:f,cancelToken:u,headers:{"X-Packet-Service-Type":0,"X-Packet-URI":61}});if(E.code!==0){const R=new b(I.UNEXPECTED_RESPONSE,"cross channel ap error, code"+E.code,{retry:!0});throw v.error(R.toString()),R}const T=JSON.parse(E.json_body);if(T.code!==200){const R=new b(I.UNEXPECTED_RESPONSE,"cross channel app center error, code: ".concat(T.code,", reason: ").concat(T.reason));throw v.error(R.toString()),R}if(!T.servers||T.servers.length===0){const R=new b(I.UNEXPECTED_RESPONSE,"cross channel app center empty server");throw v.error(R.toString()),R}return{vid:T.vid,workerToken:T.workerToken,addressList:(k("CHANNEL_MEDIA_RELAY_SERVERS")||T.servers).map(R=>"wss://".concat(R.address.replace(/\./g,"-"),".").concat(k("WORKER_DOMAIN"),":").concat(R.wss))}},void 0,E=>!!(E.code!==I.OPERATION_ABORTED&&E.code!==I.UNEXPECTED_RESPONSE||E.data&&E.data.retry),h)}(o,e,t,n));try{const o=await za(r);return r.forEach(a=>a.cancel()),o}catch(o){throw o[0]}}async function Cj(e,t,n){let r=null;const o=[],a=async d=>{const u=k(d?"WEBCS_DOMAIN_BACKUP_LIST":"WEBCS_DOMAIN").map(h=>e.proxyServer?"https://".concat(e.proxyServer,"/ap/?url=").concat(h+"/api/v2/transpond/webrtc?v=2"):"https://".concat(h,"/api/v2/transpond/webrtc?v=2"));return d&&(await Rn(1e3),r!==null)?r:await rd({fragementLength:k("FRAGEMENT_LENGTH"),referenceList:u,asyncMapHandler:h=>(v.debug("[".concat(e.clientId,"] update ticket, Connect to ").concat(d?"backup":""," choose_server:"),h),function(m,f,E,T){const[R]=vj(f,[Qt.CHOOSE_SERVER]);let A=xt.networkState;return Ni(async()=>{A&&xt.networkState===On.OFFLINE&&xt.onlineWaiter&&await de.race([xt.onlineWaiter,Rn(T&&T.maxRetryTimeout||kt.maxRetryTimeout)]),A=xt.networkState;const O=await ci(m,{data:R,cancelToken:E,headers:{"Content-Type":"multipart/form-data;"}},!0);return Tj(O,m)},()=>!1,O=>O.code!==I.OPERATION_ABORTED&&(O.code===I.UPDATE_TICKET_FAILED?O.data.retry:(v.warning("[".concat(f.clientId,"] update ticket network error, retry"),O),!0)),T)}(h,e,t,n)),allFailedhandler:h=>{throw h[0]},promisesCollector:o})};try{return r=await za([a(!1),a(!0)]),o.length&&o.forEach(d=>d.cancel&&typeof d.cancel=="function"&&d.cancel()),r}catch(d){throw d[0]}}function YI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function qI(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?YI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):YI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Ij extends gt{constructor(){super(),g(this,"configs",void 0),g(this,"joinInfo",void 0),g(this,"cancelToken",void 0),g(this,"retryConfig",{timeout:3e3,timeoutFactor:1.5,maxRetryCount:1,maxRetryTimeout:1e4}),g(this,"interval",void 0),g(this,"mutex",new Vn("config-distribute")),g(this,"mutableParamsRead",!1)}startGetConfigDistribute(t,n){this.joinInfo=t,this.cancelToken=n,this.interval&&this.stopGetConfigDistribute(),k("ENABLE_CONFIG_DISTRIBUTE")&&(this.updateConfigDistribute(),this.interval=window.setInterval(()=>{this.updateConfigDistribute()},k("CONFIG_DISTRIBUTE_INTERVAL")))}stopGetConfigDistribute(){this.interval&&clearInterval(this.interval),this.interval=void 0,this.joinInfo=void 0,this.cancelToken=void 0}async awaitConfigDistributeComplete(){this.mutex.isLocked&&(await this.mutex.lock())()}async updateConfigDistribute(){if(this.mutableParamsRead||(this.mutableParamsRead=!0,he.reportApiInvoke(null,{options:void 0,name:Mt.LOAD_CONFIG_FROM_LOCALSTORAGE,tag:Et.TRACER}).onSuccess(JSON.stringify(js))),!this.joinInfo||!this.cancelToken||!this.retryConfig)return void v.debug("[config-distribute] get config distribute interrupted have no joininfo");let t;const n=await this.mutex.lock();try{t=await yj(this.joinInfo,this.cancelToken,this.retryConfig),v.debug("[config-distribute] get config distribute",JSON.stringify(t)),t.limit_bitrate&&this.handleBitrateLimit(t.limit_bitrate),this.cacheGlobalParameterConfig(t),this.configs=t}catch(r){const o=new b(I.NETWORK_RESPONSE_ERROR,r);v.warning("[config-distribute] ".concat(o.toString()))}finally{n()}}getBitrateLimit(){return this.configs?this.configs.limit_bitrate:void 0}handleBitrateLimit(t){var n;(n=t)&&n.uplink&&n.id&&n.uplink.max_bitrate!==void 0&&n.uplink.min_bitrate!==void 0&&(this.configs&&this.configs.limit_bitrate?this.configs&&this.configs.limit_bitrate&&this.configs.limit_bitrate.id!==t.id&&this.emit(ed.UPDATE_BITRATE_LIMIT,t):this.emit(ed.UPDATE_BITRATE_LIMIT,t))}getLowStreamConfigDistribute(){return this.configs&&this.configs.limit_bitrate&&qI({},this.configs.limit_bitrate.low_stream_uplink)}cacheGlobalParameterConfig(t){var n;const r=Nm(n=Object.keys(t).filter(a=>/^webrtc_ng_global_parameter/.test(a))).call(n);for(let a=0;a<r.length;a++)for(let d=r.length-1;d>a;d--){const u=r[d];if(typeof t[u].__priority=="number"){const h=t[u].__priority,m=r[d-1];if(typeof t[m].__priority=="number"){if(!(h>t[m].__priority))continue;{const f=u;r[d]=r[d-1],r[d-1]=f}}else{const f=u;r[d]=r[d-1],r[d-1]=f}}}const o={};r.forEach(a=>{const d=t[a],u=d.__expires;Object.keys(d).forEach(h=>{h==="__priority"||h==="__expires"||Object.prototype.hasOwnProperty.call(o,h)||(o[h]=qI({value:d[h]},u&&{expires:u}))})});try{const a=JSON.stringify(o),d=window.btoa(a);window.localStorage.setItem("websdk_ng_global_parameter",d),v.debug("Caching global parameters ".concat(a))}catch(a){v.error("Error caching global parameters:",a.message)}}}function JI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function od(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?JI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):JI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Aj extends gt{constructor(t,n,r,o){super(),g(this,"spec",void 0),g(this,"token",void 0),g(this,"websocket",void 0),g(this,"pingpongTimer",void 0),g(this,"reconnectMode","retry"),g(this,"serviceMode",void 0),g(this,"reqId",0),g(this,"commandReqId",0),g(this,"handleWebSocketOpen",()=>{this.reconnectMode="retry",this.startPingPong()}),g(this,"handleWebSocketMessage",a=>{if(!a.data)return;const d=JSON.parse(a.data);d.requestId?this.emit("@".concat(d.requestId,"-").concat(d.sid),d):this.serviceMode===Gt.INJECT?this.emit(ai.INJECT_STREAM_STATUS,d):(he.workerEvent(this.spec.sid,{actionType:"status",serverCode:d.code,workerType:this.serviceMode===Gt.TRANSCODE?1:2}),this.emit(ai.PUBLISH_STREAM_STATUS,d))}),this.spec=n,this.token=t,this.serviceMode=o,this.websocket=new qs("live-streaming",r),this.websocket.on(Ae.CONNECTED,this.handleWebSocketOpen),this.websocket.on(Ae.ON_MESSAGE,this.handleWebSocketMessage),this.websocket.on(Ae.REQUEST_NEW_URLS,(a,d)=>{Cn(this,ai.REQUEST_NEW_ADDRESS).then(a).catch(d)}),this.websocket.on(Ae.RECONNECTING,()=>{this.websocket.reconnectMode=this.reconnectMode})}init(t){return this.websocket.init(t)}async request(t,n,r,o){this.reqId+=1,t==="request"&&(this.commandReqId+=1);const a=this.commandReqId,d=this.reqId;if(!d||!this.websocket)throw new b(I.UNEXPECTED_ERROR);const u=od({command:t,sdkVersion:Hr==="4.18.1"?"0.0.1":Hr,seq:d,requestId:d,allocate:r,cname:this.spec.cname,appId:this.spec.appId,sid:this.spec.sid,uid:this.spec.uid.toString(),ts:Math.floor(Date.now()/1e3)},n);if(this.websocket.state==="closed")throw new b(I.WS_DISCONNECT);const h=()=>new de((T,R)=>{this.websocket.once(Ae.CLOSED,()=>R(new b(I.WS_ABORT))),this.websocket.once(Ae.CONNECTED,T)});this.websocket.state!=="connected"&&await h(),u.clientRequest&&(u.clientRequest.workerToken=this.token);const m=new de((T,R)=>{const A=()=>{R(new b(I.WS_ABORT))};this.websocket.once(Ae.RECONNECTING,A),this.websocket.once(Ae.CLOSED,A),this.once("@".concat(d,"-").concat(this.spec.sid),O=>{T(O)})});o&&he.workerEvent(this.spec.sid,od(od({},o),{},{requestId:a,actionType:"request",payload:JSON.stringify(n.clientRequest),serverCode:0,code:0}));const f=Date.now();this.websocket.sendMessage(u);let E=null;try{E=await m}catch(T){if(this.websocket.state==="closed")throw T;return await h(),await this.request(t,n,r)}return o&&he.workerEvent(this.spec.sid,od(od({},o),{},{requestId:a,actionType:"response",payload:JSON.stringify(E.serverResponse),serverCode:E.code,success:E.code===200,responseTime:Date.now()-f})),E.code!==200&&this.handleResponseError(E),E}tryNextAddress(){this.reconnectMode="tryNext",this.websocket.reconnect("tryNext")}close(){const t=Hr==="4.18.1"?"0.0.1":Hr;this.reqId+=1,this.websocket.state==="connected"?(this.websocket.sendMessage({command:"request",appId:this.spec.appId,cname:this.spec.cname,uid:this.spec.uid.toString(),sdkVersion:t,sid:this.spec.sid,seq:this.reqId,ts:Math.floor(Date.now()/1e3),requestId:this.reqId,clientRequest:{command:"DestroyWorker"}}),this.websocket.close(!1,!0)):this.websocket.close(!1),this.pingpongTimer&&(window.clearInterval(this.pingpongTimer),this.pingpongTimer=void 0)}handleResponseError(t){switch(t.code){case At.LIVE_STREAM_RESPONSE_ALREADY_EXISTS_STREAM:return void v.warning("live stream response already exists stream");case At.LIVE_STREAM_RESPONSE_TRANSCODING_PARAMETER_ERROR:case At.LIVE_STREAM_RESPONSE_BAD_STREAM:case At.LIVE_STREAM_RESPONSE_WM_PARAMETER_ERROR:return new b(I.LIVE_STREAMING_INVALID_ARGUMENT,"",{code:t.code}).throw();case At.LIVE_STREAM_RESPONSE_WM_WORKER_NOT_EXIST:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case At.LIVE_STREAM_RESPONSE_NOT_AUTHORIZED:return new b(I.LIVE_STREAMING_PUBLISH_STREAM_NOT_AUTHORIZED,"",{code:t.code}).throw();case At.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const n=new b(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE);return this.emit(ai.WARNING,n,t.serverResponse.url)}case At.LIVE_STREAM_RESPONSE_REQUEST_TOO_OFTEN:{const n=new b(I.LIVE_STREAMING_WARN_FREQUENT_REQUEST);return this.emit(ai.WARNING,n,t.serverResponse.url)}case At.LIVE_STREAM_RESPONSE_NOT_FOUND_PUBLISH:throw new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream response wm worker not exist",{retry:!0});case At.LIVE_STREAM_RESPONSE_NOT_SUPPORTED:return new b(I.LIVE_STREAMING_TRANSCODING_NOT_SUPPORTED,"",{code:t.code}).throw();case At.LIVE_STREAM_RESPONSE_MAX_STREAM_NUM:{const n=new b(I.LIVE_STREAMING_WARN_STREAM_NUM_REACH_LIMIT);return this.emit(ai.WARNING,n,t.serverResponse.url)}case At.LIVE_STREAM_RESPONSE_INTERNAL_SERVER_ERROR:return new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code}).throw();case At.LIVE_STREAM_RESPONSE_RESOURCE_LIMIT:throw new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"live stream resource limit",{retry:!0,changeAddress:!0});case At.LIVE_STREAM_RESPONSE_WORKER_LOST:case At.LIVE_STREAM_RESPONSE_WORKER_QUIT:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;throw new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case At.ERROR_FAIL_SEND_MESSAGE:if(t.serverResponse.command==="UnpublishStream"||t.serverResponse.command==="UninjectStream")return;if(t.serverResponse.command==="UpdateTranscoding"||t.serverResponse.command==="ControlStream")return new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{code:t.code}).throw();throw new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"error fail send message",{retry:!0,changeAddress:!0});case At.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:return new b(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code}).throw()}}startPingPong(){this.pingpongTimer&&window.clearInterval(this.pingpongTimer),this.pingpongTimer=window.setInterval(()=>{this.websocket.state==="connected"&&this.request("ping",{}).catch(Au)},6e3)}}function XI(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function zn(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?XI(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):XI(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class Oj extends gt{constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:kt,r=arguments.length>2&&arguments[2]!==void 0?arguments[2]:kt;super(),g(this,"onLiveStreamWarning",void 0),g(this,"onLiveStreamError",void 0),g(this,"onInjectStatusChange",void 0),g(this,"spec",void 0),g(this,"retryTimeout",1e4),g(this,"connection",void 0),g(this,"httpRetryConfig",void 0),g(this,"wsRetryConfig",void 0),g(this,"streamingTasks",new Map),g(this,"isStartingStreamingTask",!1),g(this,"taskMutex",new Vn("live-streaming")),g(this,"cancelToken",Rr.CancelToken.source()),g(this,"transcodingConfig",void 0),g(this,"injectConfig",zn({},HV)),g(this,"injectLoopTimes",0),g(this,"uapResponse",void 0),g(this,"lastTaskId",1),g(this,"statusError",new Map),this.spec=t,this.httpRetryConfig=r,this.wsRetryConfig=n}async setTranscodingConfig(t){const n=zn(zn({},WV),t);n.videoCodecProfile!==66&&n.videoCodecProfile!==77&&n.videoCodecProfile!==100&&(v.debug("[".concat(this.spec.clientId,"] set transcoding config, fix video codec profile: ").concat(n.videoCodecProfile," -> 100")),n.videoCodecProfile=100),n.transcodingUsers||(n.transcodingUsers=n.userConfigs),n.transcodingUsers&&(n.transcodingUsers=n.transcodingUsers.map(d=>zn(zn(zn({},GV),d),{},{zOrder:d.zOrder?d.zOrder+1:1}))),function(d){ht(d.width)||st(d.width,"config.width",0,1e4),ht(d.height)||st(d.height,"config.height",0,1e4),ht(d.videoBitrate)||st(d.videoBitrate,"config.videoBitrate",1,1e6),ht(d.videoFrameRate)||st(d.videoFrameRate,"config.videoFrameRate"),ht(d.lowLatency)||Ma(d.lowLatency,"config.lowLatency"),ht(d.audioSampleRate)||tn(d.audioSampleRate,"config.audioSampleRate",[32e3,44100,48e3]),ht(d.audioBitrate)||st(d.audioBitrate,"config.audioBitrate",1,128),ht(d.audioChannels)||tn(d.audioChannels,"config.audioChannels",[1,2,3,4,5]),ht(d.videoGop)||st(d.videoGop,"config.videoGop"),ht(d.videoCodecProfile)||tn(d.videoCodecProfile,"config.videoCodecProfile",[66,77,100]),ht(d.userCount)||st(d.userCount,"config.userCount",0,17),ht(d.backgroundColor)||st(d.backgroundColor,"config.backgroundColor",0,16777215),ht(d.userConfigExtraInfo)||_n(d.userConfigExtraInfo,"config.userConfigExtraInfo",0,4096,!1),d.transcodingUsers&&!ht(d.transcodingUsers)&&(fo(d.transcodingUsers,"config.transcodingUsers"),d.transcodingUsers.forEach((u,h)=>{Pm(u.uid),ht(u.x)||st(u.x,"transcodingUser[".concat(h,"].x"),0,1e4),ht(u.y)||st(u.y,"transcodingUser[".concat(h,"].y"),0,1e4),ht(u.width)||st(u.width,"transcodingUser[".concat(h,"].width"),0,1e4),ht(u.height)||st(u.height,"transcodingUser[".concat(h,"].height"),0,1e4),ht(u.zOrder)||st(u.zOrder-1,"transcodingUser[".concat(h,"].zOrder"),0,100),ht(u.alpha)||st(u.alpha,"transcodingUser[".concat(h,"].alpha"),0,1,!1)})),ht(d.watermark)||Fm(d.watermark,"watermark"),ht(d.backgroundImage)||Fm(d.backgroundImage,"backgroundImage"),d.images&&!ht(d.images)&&(fo(d.images,"config.images"),d.images.forEach((u,h)=>{Fm(u,"images[".concat(h,"]"))}))}(n);const r=[];n.images&&r.push(...n.images.map(d=>zn(zn(zn({},Vm),d),{},{zOrder:255}))),n.backgroundImage&&(r.push(zn(zn(zn({},Vm),n.backgroundImage),{},{zOrder:0})),delete n.backgroundImage),n.watermark&&(r.push(zn(zn(zn({},Vm),n.watermark),{},{zOrder:255})),delete n.watermark),n.images=r,n.transcodingUsers&&(n.userConfigs=n.transcodingUsers.map(d=>zn({},d)),n.userCount=n.transcodingUsers.length,delete n.transcodingUsers);const o=(n.userConfigs||[]).map(d=>typeof d.uid=="number"?de.resolve(d.uid):HI(d.uid,this.spec,this.cancelToken.token,this.httpRetryConfig));if((await de.all(o)).forEach((d,u)=>{n.userConfigs&&n.userConfigs[u]&&(n.userConfigs[u].uid=d)}),this.transcodingConfig=n,this.connection)try{var a;const d=await this.connection.request("request",{clientRequest:{command:"UpdateTranscoding",transcodingConfig:this.transcodingConfig}},!1,{command:"UpdateTranscoding",workerType:1,requestByUser:!0,tid:Array.from(qi(a=this.streamingTasks).call(a)).map(u=>u.taskId).join("#")});v.debug("[".concat(this.spec.clientId,"] update live transcoding config success, code: ").concat(d.code,", config:"),JSON.stringify(this.transcodingConfig))}catch(d){if(!d.data||!d.data.retry)throw d;d.data.changeAddress&&this.connection.tryNextAddress(),this.streamingTasks.forEach(u=>{v.warning("[".concat(this.spec.clientId,"] live streaming receive error"),d.toString(),"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,d).then(()=>{v.debug("[".concat(this.spec.clientId,"] live streaming republish ").concat(u.url," success"))}).catch(h=>{v.error("[".concat(this.spec.clientId,"] live streaming republish failed"),u.url,h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)})})}}setInjectStreamConfig(t,n){this.injectConfig=Object.assign({},this.injectConfig,t),this.injectLoopTimes=n}async startLiveStreamingTask(t,n,r){var o;if(Array.from(qi(o=this.streamingTasks).call(o)).find(h=>h.mode===Gt.INJECT)&&n===Gt.INJECT)return new b(I.LIVE_STREAMING_TASK_CONFLICT,"inject stream over limit").throw();if(!this.transcodingConfig&&n===Gt.TRANSCODE)throw new b(I.INVALID_OPERATION,"[LiveStreaming] no transcoding config found, can not start transcoding streaming task");let a={command:"PublishStream",ts:Date.now(),url:t,uid:this.spec.uid.toString(),autoDestroyTime:100,acceptImageTimeout:!0};v.debug("[".concat(this.spec.clientId,"] start live streaming ").concat(t,", mode: ").concat(n));const d=await this.taskMutex.lock();if(!this.connection&&r)return void d();if(this.streamingTasks.get(t)&&!r)return d(),new b(I.LIVE_STREAMING_TASK_CONFLICT).throw();try{this.connection||(this.connection=await this.connect(n))}catch(h){throw d(),h}switch(n){case Gt.TRANSCODE:a.transcodingConfig=zn({},this.transcodingConfig);break;case Gt.RAW:break;case Gt.INJECT:a={cname:this.spec.cname,command:"InjectStream",sid:this.spec.sid,transcodingConfig:this.injectConfig,ts:Date.now(),url:t,loopTimes:this.injectLoopTimes}}this.uapResponse&&this.uapResponse.vid&&(a.vid=this.uapResponse.vid),this.isStartingStreamingTask=!0;const u=this.lastTaskId++;try{const h=new de((f,E)=>{Rn(this.retryTimeout).then(()=>{if(r)return E(r);const T=this.statusError.get(t);return T?(this.statusError.delete(t),E(T)):void 0})}),m=await de.race([this.connection.request("request",{clientRequest:a},!0,{url:t,command:"PublishStream",workerType:n===Gt.TRANSCODE?1:2,requestByUser:!r,tid:u.toString()}),h]);this.isStartingStreamingTask=!1,v.debug("[".concat(this.spec.clientId,"] live streaming started, code: ").concat(m.code)),this.streamingTasks.set(t,{clientRequest:a,mode:n,url:t,taskId:u}),d()}catch(h){if(d(),this.isStartingStreamingTask=!1,!h.data||!h.data.retry||r)throw h;return h.data.changeAddress?(this.connection.tryNextAddress(),await this.startLiveStreamingTask(t,n,h)):await this.startLiveStreamingTask(t,n,h)}}stopLiveStreamingTask(t){return new de((n,r)=>{const o=this.streamingTasks.get(t);if(!o||!this.connection)return new b(I.UNEXPECTED_ERROR,"can not find streaming task to stop").throw();const a=o.mode;o.abortTask=()=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success(worker exception)")),this.streamingTasks.delete(t),n()},this.connection.request("request",{clientRequest:{command:a===Gt.INJECT?"UninjectStream":"UnpublishStream",url:o.url}},!1,{url:t,command:"UnPublishStream",workerType:a===Gt.TRANSCODE?1:2,requestByUser:!0,tid:(this.lastTaskId++).toString()}).then(d=>{v.debug("[".concat(this.spec.clientId,"] stop live streaming success, code: ").concat(d.code)),this.streamingTasks.delete(t),this.streamingTasks.size===0&&a!==Gt.INJECT&&(this.connection&&this.connection.close(),this.connection=void 0),n(),a===Gt.INJECT&&this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_STOP_SUCCESS,this.spec.uid,t)}).catch(r)})}async controlInjectStream(t,n,r,o){const a=this.streamingTasks.get(t);if(!a||!this.connection||a.mode!==Gt.INJECT)throw new b(I.INVALID_OPERATION,"can not find inject stream task to control");return(await this.connection.request("request",{clientRequest:{command:"ControlStream",url:t,control:n,audioVolume:r,position:o}})).serverResponse}resetAllTask(){var t;const n=Array.from(qi(t=this.streamingTasks).call(t));this.terminate();for(const r of n)this.startLiveStreamingTask(r.url,r.mode).catch(o=>{this.onLiveStreamError&&this.onLiveStreamError(r.url,o)})}terminate(){this.cancelToken&&this.cancelToken.cancel(),this.streamingTasks=new Map,this.isStartingStreamingTask=!1,this.statusError=new Map,this.cancelToken=Rr.CancelToken.source(),this.uapResponse=void 0,this.connection&&this.connection.close(),this.connection=void 0}async connect(t){if(this.connection)throw new b(I.UNEXPECTED_ERROR,"live streaming connection has already connected");const n=await Cn(this,xa.REQUEST_WORKER_MANAGER_LIST,t);return this.uapResponse=n,this.connection=new Aj(n.workerToken,this.spec,this.wsRetryConfig,t),this.connection.on(ai.WARNING,(r,o)=>this.onLiveStreamWarning&&this.onLiveStreamWarning(o,r)),this.connection.on(ai.PUBLISH_STREAM_STATUS,r=>this.handlePublishStreamServer(r)),this.connection.on(ai.INJECT_STREAM_STATUS,r=>this.handleInjectStreamServerStatus(r)),this.connection.on(ai.REQUEST_NEW_ADDRESS,(r,o)=>{if(!this.connection)return o(new b(I.UNEXPECTED_ERROR,"can not get new live streaming address list"));Cn(this,xa.REQUEST_WORKER_MANAGER_LIST,t).then(a=>{this.uapResponse=a,r(a.addressList)}).catch(o)}),await this.connection.init(n.addressList),this.connection}handlePublishStreamServer(t){const n=t.serverStatus&&t.serverStatus.url||"empty_url",r=this.streamingTasks.get(n),o=t.reason;switch(t.code){case At.PUBLISH_STREAM_STATUS_ERROR_PUBLISH_BROKEN:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_CONNECT:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_HANDSHAKE:case At.PUBLISH_STREAM_STATUS_ERROR_RTMP_PUBLISH:{const d=new b(I.LIVE_STREAMING_CDN_ERROR,"",{code:t.code});if(r)return v.error(d.toString()),this.onLiveStreamError&&this.onLiveStreamError(n,d);if(!this.isStartingStreamingTask)return;this.statusError.set(n,d)}case At.LIVE_STREAM_RESPONSE_FAILED_LOAD_IMAGE:{const d=new b(I.LIVE_STREAMING_WARN_FAILED_LOAD_IMAGE,o);return this.onLiveStreamWarning&&this.onLiveStreamWarning(n,d)}case At.LIVE_STREAM_RESPONSE_WORKER_LOST:case At.LIVE_STREAM_RESPONSE_WORKER_QUIT:{var a;if(!this.connection)return;this.connection.tryNextAddress();const d=Array.from(qi(a=this.streamingTasks).call(a));for(const u of d)u.abortTask?u.abortTask():(v.warning("[".concat(this.spec.clientId,"] publish stream status code"),t.code,"try to republish",u.url),this.startLiveStreamingTask(u.url,u.mode,new b(I.LIVE_STREAMING_INTERNAL_SERVER_ERROR,"",{code:t.code})).then(()=>{v.debug("[".concat(this.spec.clientId,"] republish live stream success"),u.url)}).catch(h=>{v.error(h.toString()),this.onLiveStreamError&&this.onLiveStreamError(u.url,h)}));return}}}handleInjectStreamServerStatus(t){const n=Number(t.uid),r=t.serverStatus&&t.serverStatus.url;switch(t.code){case 200:return void(this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_START_SUCCESS,n,r));case 451:return this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_START_ALREADY_EXISTS,n,r),void this.streamingTasks.delete(r);case 453:return this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_START_UNAUTHORIZED,n,r),void this.streamingTasks.delete(r);case 470:return this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_BROKEN,n,r),void this.streamingTasks.delete(r);case 499:return this.onInjectStatusChange&&this.onInjectStatusChange(Ko.INJECT_STREAM_STATUS_START_TIMEOUT,n,r),void this.streamingTasks.delete(r);default:return void v.debug("inject stream server status",t)}}hasUrl(t){return this.streamingTasks.has(t)}}class QI{constructor(){g(this,"destChannelMediaInfos",new Map),g(this,"srcChannelMediaInfo",void 0)}setSrcChannelInfo(t){BR(t),this.srcChannelMediaInfo=t}addDestChannelInfo(t){BR(t),this.destChannelMediaInfos.set(t.channelName,t)}removeDestChannelInfo(t){Dm(t),this.destChannelMediaInfos.delete(t)}getSrcChannelMediaInfo(){return this.srcChannelMediaInfo}getDestChannelMediaInfo(){return this.destChannelMediaInfos}}function $I(e){if(!(e instanceof QI))return new b(I.INVALID_PARAMS,"Config should be instance of [ChannelMediaRelayConfiguration]").throw();const t=e.getSrcChannelMediaInfo(),n=e.getDestChannelMediaInfo();if(!t)return new b(I.INVALID_PARAMS,"srcChannelMediaInfo should not be empty").throw();if(n.size===0)return new b(I.INVALID_PARAMS,"destChannelMediaInfo should not be empty").throw()}class wj extends gt{constructor(t,n,r){super(),g(this,"ws",void 0),g(this,"requestId",1),g(this,"heartBeatTimer",void 0),g(this,"joinInfo",void 0),g(this,"clientId",void 0),g(this,"onOpen",()=>{this.emit("open"),this.startHeartBeatCheck()}),g(this,"onClose",o=>{this.emit("close"),this.dispose()}),g(this,"onMessage",o=>{const a=JSON.parse(o.data);if(!a||a.command!=="serverResponse"||!a.requestId)return a&&a.command==="serverStatus"&&a.serverStatus&&a.serverStatus.command?(this.emit("status",a.serverStatus),void this.emit(a.serverStatus.command,a.serverStatus)):void 0;this.emit("req_".concat(a.requestId),a)}),this.joinInfo=t,this.clientId=n,this.ws=new qs("cross-channel-".concat(this.clientId),r),this.ws.on(Ae.RECONNECTING,()=>{this.ws.reconnectMode="retry",this.emit("reconnecting")}),this.ws.on(Ae.CONNECTED,this.onOpen),this.ws.on(Ae.ON_MESSAGE,this.onMessage),this.ws.on(Ae.CLOSED,this.onClose)}isConnect(){return this.ws.state==="connected"}sendMessage(t){const n=this.requestId++;return t.requestId=n,t.seq=n,this.ws.sendMessage(t),n}waitStatus(t){return new de((n,r)=>{const o=window.setTimeout(()=>{r(new b(I.TIMEOUT,"wait status timeout, status: ".concat(t)))},5e3);this.once(t,a=>{window.clearTimeout(o),a.state&&a.state!==0?r(new b(I.CROSS_CHANNEL_WAIT_STATUS_ERROR,"wait status error, status: ".concat(t))):n(void 0)}),this.once("dispose",()=>{window.clearTimeout(o),r(new b(I.WS_ABORT))})})}async request(t){if(this.ws.state==="closed")throw new b(I.WS_DISCONNECT);const n=()=>new de((d,u)=>{this.ws.once(Ae.CLOSED,()=>u(new b(I.WS_ABORT))),this.ws.once(Ae.CONNECTED,d)});this.ws.state!=="connected"&&await n();const r=this.sendMessage(t),o=new de((d,u)=>{const h=()=>{u(new b(I.WS_ABORT))};this.ws.once(Ae.RECONNECTING,h),this.ws.once(Ae.CLOSED,h),this.once("req_".concat(r),d),Rn(3e3).then(()=>{this.removeAllListeners("req_".concat(r)),this.ws.off(Ae.RECONNECTING,h),this.ws.off(Ae.CLOSED,h),u(new b(I.TIMEOUT,"cross channel ws request timeout"))})}),a=await o;if(!a||a.code!==200)throw new b(I.CROSS_CHANNEL_SERVER_ERROR_RESPONSE,"response: ".concat(JSON.stringify(a)));return a}async connect(t){this.ws.removeAllListeners(Ae.REQUEST_NEW_URLS),this.ws.on(Ae.REQUEST_NEW_URLS,n=>{n(t)}),await this.ws.init(t)}dispose(){this.clearHeartBeatCheck(),this.emit("dispose"),this.removeAllListeners(),this.ws.close()}sendPing(t){const n=this.requestId++;return t.requestId=n,this.ws.sendMessage(t),n}startHeartBeatCheck(){this.heartBeatTimer&&window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=window.setInterval(()=>{this.sendPing({command:"ping",appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sid:this.joinInfo.sid,ts:+new Date,requestId:0})},3e3)}clearHeartBeatCheck(){window.clearInterval(this.heartBeatTimer),this.heartBeatTimer=void 0}}class Nj extends gt{set state(t){t!==this._state&&(t!==xn.RELAY_STATE_FAILURE&&(this.errorCode=zo.RELAY_OK),this.emit("state",t,this.errorCode),this._state=t)}get state(){return this._state}constructor(t,n,r,o,a){super(),g(this,"joinInfo",void 0),g(this,"sid",void 0),g(this,"clientId",void 0),g(this,"cancelToken",Rr.CancelToken.source()),g(this,"workerToken",void 0),g(this,"requestId",0),g(this,"signal",void 0),g(this,"prevChannelMediaConfig",void 0),g(this,"httpRetryConfig",void 0),g(this,"_resolution",void 0),g(this,"_state",xn.RELAY_STATE_IDLE),g(this,"errorCode",zo.RELAY_OK),g(this,"onStatus",d=>{v.debug("[".concat(this.clientId,"] ChannelMediaStatus: ").concat(JSON.stringify(d))),d&&d.command&&(d.command==="onAudioPacketReceived"&&this.emit("event",bi.PACKET_RECEIVED_AUDIO_FROM_SRC),d.command==="onVideoPacketReceived"&&this.emit("event",bi.PACKET_RECEIVED_VIDEO_FROM_SRC),d.command==="onSrcTokenPrivilegeDidExpire"&&(this.errorCode=zo.SRC_TOKEN_EXPIRED,this.state=xn.RELAY_STATE_FAILURE),d.command==="onDestTokenPrivilegeDidExpire"&&(this.errorCode=zo.DEST_TOKEN_EXPIRED,this.state=xn.RELAY_STATE_FAILURE))}),g(this,"onReconnect",async()=>{v.debug("[".concat(this.clientId,"] ChannelMediaSocket disconnect, reconnecting")),this.emit("event",bi.NETWORK_DISCONNECTED),this.state=xn.RELAY_STATE_IDLE,this.prevChannelMediaConfig&&this.sendStartRelayMessage(this.prevChannelMediaConfig).catch(d=>{this.state!==xn.RELAY_STATE_IDLE&&(v.error("auto restart channel media relay failed",d.toString()),this.errorCode=zo.SERVER_CONNECTION_LOST,this.state=xn.RELAY_STATE_FAILURE)})}),this.joinInfo=t,this.clientId=n,this.sid=oE(),this.signal=new wj(this.joinInfo,this.clientId,r),this.httpRetryConfig=o,this._resolution=a}async startChannelMediaRelay(t){if(this.state!==xn.RELAY_STATE_IDLE)throw new b(I.INVALID_OPERATION);this.state=xn.RELAY_STATE_CONNECTING,await this.connect(),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: connect success"));try{await this.sendStartRelayMessage(t)}catch(n){throw n.data&&n.data.serverResponse&&n.data.serverResponse.command==="SetSourceChannel"?new b(I.CROSS_CHANNEL_FAILED_JOIN_SRC):n.data&&n.data.serverResponse&&n.serverResponse.command==="SetDestChannelStatus"?new b(I.CROSS_CHANNEL_FAILED_JOIN_DEST):n.data&&n.data.serverResponse&&n.serverResponse.command==="StartPacketTransfer"?new b(I.CROSS_CHANNEL_FAILED_PACKET_SENT_TO_DEST):n}this.prevChannelMediaConfig=t}async updateChannelMediaRelay(t){if(this.state!==xn.RELAY_STATE_RUNNING)throw new b(I.INVALID_OPERATION);await this.sendUpdateMessage(t),this.prevChannelMediaConfig=t}async setVideoProfile(t){if(this._resolution=t,this.state!==xn.RELAY_STATE_RUNNING)throw new b(I.INVALID_OPERATION);const n=this.genMessage(Tn.SetVideoProfile);await this.signal.request(n),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: setVideoProfile success"))}async stopChannelMediaRelay(){await this.sendStopRelayMessage(),v.debug("[".concat(this.clientId,"] stopChannelMediaRelay: send stop message success")),this.state=xn.RELAY_STATE_IDLE,this.dispose()}dispose(){v.debug("[".concat(this.clientId,"] disposeChannelMediaRelay")),this.cancelToken.cancel(),this.cancelToken=Rr.CancelToken.source(),this.state=xn.RELAY_STATE_IDLE,this.emit("dispose"),this.signal.dispose(),this.prevChannelMediaConfig=void 0}async connect(){const t=await Rj(this.joinInfo,this.cancelToken.token,this.httpRetryConfig);this.workerToken=t.workerToken,await this.signal.connect(t.addressList),this.emit("event",bi.NETWORK_CONNECTED),this.signal.on("status",this.onStatus),this.signal.on("reconnecting",this.onReconnect)}async sendStartRelayMessage(t){const n=this.genMessage(Tn.StopPacketTransfer);await this.signal.request(n),await this.signal.waitStatus("Normal Quit"),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StopPacketTransfer success"));const r=this.genMessage(Tn.SetSdkProfile,t);await this.signal.request(r),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSdkProfile success"));const o=this.genMessage(Tn.SetSourceChannel,t);await this.signal.request(o),await this.signal.waitStatus("SetSourceChannelStatus"),this.emit("event",bi.PACKET_JOINED_SRC_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceChannel success"));const a=this.genMessage(Tn.SetSourceUserId,t);await this.signal.request(a),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetSourceUserId success"));const d=this.genMessage(Tn.SetDestChannel,t);await this.signal.request(d),await this.signal.waitStatus("SetDestChannelStatus"),this.emit("event",bi.PACKET_JOINED_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] startChannelMediaRelay: SetDestChannel success"));const u=this.genMessage(Tn.StartPacketTransfer,t);await this.signal.request(u),this.emit("event",bi.PACKET_SENT_TO_DEST_CHANNEL),this.state=xn.RELAY_STATE_RUNNING,v.debug("[".concat(this.clientId,"] startChannelMediaRelay: StartPacketTransfer success")),this.setVideoProfile(this._resolution)}async sendUpdateMessage(t){const n=this.genMessage(Tn.UpdateDestChannel,t);await this.signal.request(n),this.emit("event",bi.PACKET_UPDATE_DEST_CHANNEL),v.debug("[".concat(this.clientId,"] sendUpdateMessage: UpdateDestChannel success"))}async sendStopRelayMessage(){const t=this.genMessage(Tn.StopPacketTransfer);await this.signal.request(t),v.debug("[".concat(this.clientId,"] sendStopRelayMessage: StopPacketTransfer success"))}genMessage(t,n){const r=[],o=[],a=[];this.requestId+=1;const d={appId:this.joinInfo.appId,cname:this.joinInfo.cname,uid:this.joinInfo.uid.toString(),sdkVersion:Hr,sid:this.sid,ts:Date.now(),requestId:this.requestId,seq:this.requestId,allocate:!0,clientRequest:{}};d.sdkVersion==="4.18.1"&&(d.sdkVersion="0.0.1");let u=null,h=null;switch(t){case Tn.SetSdkProfile:return d.clientRequest={command:"SetSdkProfile",type:"multi_channel"},d;case Tn.SetSourceChannel:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new b(I.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceChannel",uid:"0",channelName:h.channelName,token:h.token||this.joinInfo.appId},d;case Tn.SetSourceUserId:if(h=n&&n.getSrcChannelMediaInfo(),!h)throw new b(I.UNEXPECTED_ERROR,"can not find source config");return d.clientRequest={command:"SetSourceUserId",uid:h.uid+""},d;case Tn.SetDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new b(I.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{r.push(m.channelName),o.push(m.uid+""),a.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"SetDestChannel",channelName:r,uid:o,token:a},d;case Tn.StartPacketTransfer:return d.clientRequest={command:"StartPacketTransfer"},d;case Tn.Reconnect:return d.clientRequest={command:"Reconnect"},d;case Tn.StopPacketTransfer:return d.clientRequest={command:"StopPacketTransfer"},d;case Tn.UpdateDestChannel:if(u=n&&n.getDestChannelMediaInfo(),!u)throw new b(I.UNEXPECTED_ERROR,"can not find dest config");return u.forEach(m=>{r.push(m.channelName),o.push(m.uid+""),a.push(m.token||this.joinInfo.appId)}),d.clientRequest={command:"UpdateDestChannel",channelName:r,uid:o,token:a},d;case Tn.SetVideoProfile:d.clientRequest={command:"SetVideoProfile",width:this._resolution.width,height:this._resolution.height}}return d}}const fE=e=>{const t=document.createElement("canvas");return t.width=2,t.height=2,new de((n,r)=>{t.toBlob(async o=>{if(t.remove(),o){const a=await ZI(o);n({buffer:a,width:t.width,height:t.height})}else r(new b(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},e,1)})},ZI=async e=>{const t=await e.arrayBuffer();return new Uint8Array(t)};function eA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function tA(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?eA(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):eA(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class mE{get videoElementStatus(){return this._videoElementStatus}set videoElementStatus(t){t!==this._videoElementStatus&&(v.debug("[".concat(this.trackId,"] video-element-status change ").concat(this._videoElementStatus," => ").concat(t)),this._videoElementStatus=t)}constructor(t){g(this,"trackId",void 0),g(this,"config",void 0),g(this,"onFirstVideoFrameDecoded",void 0),g(this,"freezeTimeCounterList",[]),g(this,"renderFreezeAccTime",0),g(this,"isKeepLastFrame",!1),g(this,"timeUpdatedCount",0),g(this,"freezeTime",0),g(this,"playbackTime",0),g(this,"lastTimeUpdatedTime",0),g(this,"autoplayFailed",!1),g(this,"videoTrack",void 0),g(this,"videoElement",void 0),g(this,"cacheVideoElement",void 0),g(this,"videoElementCheckInterval",void 0),g(this,"_videoElementStatus",gn.NONE),g(this,"isGettingVideoDimensions",!1),g(this,"startGetVideoDimensions",()=>{const n=()=>{if(this.isGettingVideoDimensions=!0,this.videoElement.videoWidth*this.videoElement.videoHeight>4)return v.debug("[".concat(this.trackId,"] current video dimensions:"),this.videoElement.videoWidth,this.videoElement.videoHeight),void(this.isGettingVideoDimensions=!1);setTimeout(n,500)};!this.isGettingVideoDimensions&&n()}),g(this,"autoResumeAfterInterruption",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&Xe.curState==="running"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Dy())),Uy()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),g(this,"handleVideoEvents",n=>{switch(n.type){case"play":case"playing":this.startGetVideoDimensions(),this.videoElementStatus=gn.PLAYING;break;case"loadeddata":if(this.onFirstVideoFrameDecoded&&this.onFirstVideoFrameDecoded(),this.cacheVideoElement){try{this.cacheVideoElement.srcObject=null,this.cacheVideoElement.remove()}catch{}this.cacheVideoElement=void 0}break;case"canplay":this.videoElementStatus=gn.CANPLAY;break;case"stalled":this.videoElementStatus=gn.STALLED;break;case"suspend":this.videoElementStatus=gn.SUSPEND;break;case"pause":this.videoElementStatus=gn.PAUSED,Mn()||zi()||kn()&&this.autoplayFailed||!this.videoTrack||this.videoTrack.readyState!=="live"||(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume")),this.videoElement.play());break;case"waiting":this.videoElementStatus=gn.WAITING;break;case"abort":this.videoElementStatus=gn.ABORT;break;case"ended":this.videoElementStatus=gn.ENDED;break;case"emptied":this.videoElementStatus=gn.EMPTIED;break;case"error":{this.videoElementStatus=gn.ERROR;const r=this.videoElement.error;r&&v.error("[".concat(this.trackId,"] media error, code: ").concat(r.code,", message: ").concat(r.message));break}case"timeupdate":{const r=performance.now();if(this.timeUpdatedCount+=1,this.timeUpdatedCount<10)return void(this.lastTimeUpdatedTime=r);const o=r-this.lastTimeUpdatedTime,a=this.lastTimeUpdatedTime;if(this.lastTimeUpdatedTime=r,Eo.lastVisibleTime<Eo.lastHiddenTime||a<Eo.lastHiddenTime||a<Eo.lastVisibleTime)return;for(o>k("VIDEO_FREEZE_DURATION")&&(this.freezeTime+=o),this.playbackTime+=o;this.playbackTime>=6e3;){this.playbackTime-=6e3;const d=Math.min(6e3,this.freezeTime);this.freezeTimeCounterList.push(d),this.freezeTime=Math.max(0,this.freezeTime-6e3)}break}}}),g(this,"autoResumeAfterInterruptionOnIOS15_16",()=>{this.videoTrack&&this.videoTrack.readyState==="live"&&(v.debug("[track-".concat(this.trackId,"] video element paused, auto resume for ").concat(Dy())),Uy()?(this.videoElement.srcObject=null,this.videoElement.srcObject=new MediaStream([this.videoTrack]),this.videoElement.play()):(this.videoElement.pause(),this.videoElement.play()))}),this.trackId=t.trackId,this.config=t,t.element instanceof HTMLVideoElement?this.videoElement=t.element:this.videoElement=document.createElement("video"),Xe.on($t.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xe.on($t.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16)}getVideoElement(){return this.videoElement}getContainerElement(){var t;return(t=this.videoElement.parentElement)!==null&&t!==void 0?t:void 0}updateConfig(t){this.config=t,this.trackId=t.trackId,t.element!==this.videoElement&&(this.destroy(),this.videoElement=t.element),this.videoTrack&&this.initVideoElement()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.initVideoElement())}play(t){const n=this.videoElement.play();n&&n.catch&&n.catch(o=>{t&&he.autoplayFailed(t,"video",o.message,this.trackId),o.name==="NotAllowedError"?(v.warning("detected video element autoplay failed",o),this.autoplayFailed=!0,this.handleAutoPlayFailed()):v.warning("[".concat(this.trackId,"] play warning: "),o)});const r=qe();if((r.name==="Safari"&&Number(r.version)===15||Oa())&&n&&n.then&&n.catch){const o=()=>{this.config.mirror&&(this.videoElement.style.transform="rotateY(180deg)")};n.then(o).catch(o)}}getCurrentFrame(){const t=document.createElement("canvas");t.width=this.videoElement.videoWidth,t.height=this.videoElement.videoHeight;const n=t.getContext("2d");if(!n)return v.error("create canvas context failed!"),new ImageData(2,2);n.drawImage(this.videoElement,0,0,t.width,t.height);const r=n.getImageData(0,0,t.width,t.height);return t.remove(),r}async getCurrentFrameToUint8Array(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;const r=document.createElement("canvas");r.width=this.videoElement.videoWidth,r.height=this.videoElement.videoHeight;const o=r.getContext("2d");return o?(o.drawImage(this.videoElement,0,0,r.width,r.height),new de((a,d)=>{r.toBlob(async u=>{if(r.remove(),u){const h=await ZI(u);a({buffer:h,width:r.width,height:r.height})}else d(new b(I.CONVERTING_VIDEO_FRAME_TO_BLOB_FAILED))},t,n<0?.1:n>1?1:n)})):await fE(t)}destroy(){Xe.off($t.IOS_INTERRUPTION_END,this.autoResumeAfterInterruption),Xe.off($t.IOS_15_16_INTERRUPTION_END,this.autoResumeAfterInterruptionOnIOS15_16),this.videoElement.srcObject=null,this.resetVideoElement(),this.freezeTimeCounterList=[]}initVideoElement(){if(this.videoElementStatus=gn.INIT,!this.videoElementCheckInterval&&(nA.forEach(a=>{this.videoElement.addEventListener(a,this.handleVideoEvents)}),this.videoElementCheckInterval=window.setInterval(()=>{(function(a){return a!==document.body&&document.body.contains(a)})(this.videoElement)||(this.videoElementStatus=gn.DESTROYED)},1e3),k("ENABLE_VIDEO_FRAME_CALLBACK"))){var t,n;let a;const d=(u,h)=>{if(this.videoElementStatus===gn.PLAYING){if(a){const E=h.presentationTime-a.presentationTime;E>k("VIDEO_FREEZE_DURATION")&&Eo.lastVisibleTime>=Eo.lastHiddenTime&&a.timestamp>Eo.lastVisibleTime&&a.timestamp>Eo.lastHiddenTime&&(this.renderFreezeAccTime+=E)}a=tA(tA({},h),{},{timestamp:u})}var m,f;k("ENABLE_VIDEO_FRAME_CALLBACK")&&((m=(f=this.videoElement).requestVideoFrameCallback)===null||m===void 0||m.call(f,d))};(t=(n=this.videoElement).requestVideoFrameCallback)===null||t===void 0||t.call(n,d)}this.videoElement.controls=!1,this.videoElement.setAttribute("playsinline",""),nu()&&(this.videoElement.poster="noposter");const r=qe();r.name==="Safari"&&Number(r.version)===15||Oa()||!this.config.mirror||(this.videoElement.style.transform="rotateY(180deg)"),this.config.fit?this.videoElement.style.objectFit=this.config.fit:this.videoElement.style.objectFit="cover",this.videoElement.setAttribute("muted",""),this.videoElement.muted=!0,this.videoElement.srcObject&&this.videoElement.srcObject instanceof MediaStream?this.videoElement.srcObject.getVideoTracks()[0]!==this.videoTrack&&(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tt()&&this.videoElement.load()):(this.videoElement.srcObject=this.videoTrack?new MediaStream([this.videoTrack]):null,Tt()&&this.videoElement.load());const o=this.videoElement.play();o!==void 0&&o.catch(a=>{v.debug("[".concat(this.trackId,"] playback interrupted"),a.toString())})}resetVideoElement(){nA.forEach(t=>{this.videoElement&&this.videoElement.removeEventListener(t,this.handleVideoEvents)}),this.videoElementCheckInterval&&(window.clearInterval(this.videoElementCheckInterval),this.videoElementCheckInterval=void 0),this.videoElementStatus=gn.NONE}handleAutoPlayFailed(){const t=n=>{n.preventDefault(),this.videoElement.play().then(()=>{v.debug("[".concat(this.trackId,"] Video element for trackId:").concat(this.trackId," autoplay resumed."))}).catch(r=>{v.error(r)}),this.autoplayFailed=!1,Yc()?document.body.removeEventListener("click",t,!0):(document.body.removeEventListener("touchstart",t,!0),document.body.removeEventListener("mousedown",t,!0))};Yc()?document.body.addEventListener("click",t,!0):(document.body.addEventListener("touchstart",t,!0),document.body.addEventListener("mousedown",t,!0)),iC()}}const nA=["play","playing","loadeddata","canplay","pause","stalled","suspend","waiting","abort","emptied","ended","timeupdate","error"];class rA extends mE{constructor(t){super(t),g(this,"container",void 0),g(this,"slot",void 0),this.slot=t.element,this.updateConfig(t)}updateConfig(t){this.config=t,this.trackId=t.trackId;const n=t.element;n!==this.slot&&(this.destroy(),this.slot=n),this.createElements()}updateVideoTrack(t){this.videoTrack!==t&&(this.videoTrack=t,this.createElements())}play(t){var n;(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)&&super.play(t)}getCurrentFrame(){var t;return(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)?super.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameToUint8Array(t){var n;let r=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return(n=this.container)!==null&&n!==void 0&&n.contains(this.videoElement)?await super.getCurrentFrameToUint8Array(t,r):await fE(t)}destroy(){if(super.destroy(),this.videoElement.remove(),this.videoElement=document.createElement("video"),this.container){try{this.container.remove(),this.slot.removeChild(this.container)}catch{}this.container=void 0}}createElements(){this.container||(this.container=document.createElement("div")),this.container.id="agora-video-player-".concat(this.trackId),this.container.style.width="100%",this.container.style.height="100%",this.container.style.position="relative",this.container.style.overflow="hidden",this.videoTrack?(this.container.style.backgroundColor="black",k("KEEP_LAST_FRAME")&&this.isKeepLastFrame&&this.videoElement.paused&&this.resetVideoElement(),this.mountedVideoElement()):this.unmountedVideoElement(),this.slot.appendChild(this.container)}mountedVideoElement(){var t;!this.container||(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)||this.container.appendChild(this.videoElement),super.initVideoElement(),this.videoElement.id="video_".concat(this.trackId),this.videoElement.className="agora_video_player",this.videoElement.style.width="100%",this.videoElement.style.height="100%",this.videoElement.style.position="absolute",this.videoElement.style.left="0",this.videoElement.style.top="0"}unmountedVideoElement(){var t;if((t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)){super.resetVideoElement();try{this.container&&this.container.removeChild(this.videoElement)}catch{}this.videoElement=document.createElement("video")}}resetVideoElement(){var t;(t=this.container)!==null&&t!==void 0&&t.contains(this.videoElement)&&(super.resetVideoElement(),this.cacheVideoElement=this.videoElement,this.videoElement=document.createElement("video"))}getContainerElement(){return this.container}}function Du(e){const t={};e.facingMode&&(t.facingMode=e.facingMode),e.cameraId&&(t.deviceId={exact:e.cameraId});const n=Fs(e.encoderConfig);return t.width=n.width,t.height=n.height,!Vy()&&n.frameRate&&(t.frameRate=n.frameRate),qe().name===Ze.EDGE&&typeof t.frameRate=="object"&&(t.frameRate.max=60),Tt()&&(t.frameRate={ideal:30,max:30}),t}function bj(e){const t={};e.screenSourceType&&(t.mediaSource=e.screenSourceType),e.extensionId&&tm()&&(t.extensionId=e.extensionId);const{displaySurface:n,selfBrowserSurface:r,surfaceSwitching:o,systemAudio:a}=e;(nm(107)||Py(107)||Ly(93))&&(n&&(tn(n,"displaySurface",["browser","window","monitor"]),t.displaySurface=n),r?(tn(r,"selfBrowserSurface",["exclude","include"]),t.selfBrowserSurface=r):t.selfBrowserSurface="include",o&&(tn(o,"surfaceSwitching",["exclude","include"]),t.surfaceSwitching=o)),(nm(105)||Py(105)||Ly(91))&&a&&(tn(a,"systemAudio",["exclude","include"]),t.systemAudio=a),e.electronScreenSourceId&&(t.sourceId=e.electronScreenSourceId);const d=e.encoderConfig?Rm(e.encoderConfig):null;return t.mandatory={chromeMediaSource:"desktop",maxWidth:d?d.width:void 0,maxHeight:d?d.height:void 0},d&&(d.frameRate&&(typeof d.frameRate=="number"?(t.mandatory.maxFrameRate=d.frameRate,t.mandatory.minFrameRate=d.frameRate):(t.mandatory.maxFrameRate=d.frameRate.max||d.frameRate.ideal||d.frameRate.exact||void 0,t.mandatory.minFrameRate=d.frameRate.min||d.frameRate.ideal||d.frameRate.exact||void 0),t.frameRate=d.frameRate),d.width&&(t.width=d.width),d.height&&(t.height=d.height)),t}function iA(e){const t={};if(Vy()||(e.AGC!==void 0&&(t.autoGainControl=e.AGC),e.AEC!==void 0&&(t.echoCancellation=e.AEC),e.ANS!==void 0&&(t.noiseSuppression=e.ANS,tm()&&e.ANS&&(t.googHighpassFilter=e.ANS))),e.encoderConfig){const n=fu(e.encoderConfig);t.channelCount=n.stereo?2:1,t.sampleRate=n.sampleRate,t.sampleSize=n.sampleSize}return e.microphoneId&&(t.deviceId={exact:e.microphoneId}),nu()&&(t.sampleRate=void 0),t}var qa,Pu;(function(e){e.COVERED="COVERED",e.POSITION="POSITION",e.SIZE="SIZE",e.STYLE="STYLE"})(qa||(qa={})),function(e){e.UNMOUNTED="UNMOUNTED",e.INVALID_HTML_ELEMENT="INVALID_HTML_ELEMENT"}(Pu||(Pu={}));var oA,sA,aA,cA,dA,lA,uA,hA,pA,fA,mA,EA,_A,gA,SA,TA,vA,yA,RA,CA,IA,AA,OA,wA,Ue,NA,bA,DA,PA,LA,kA,MA,UA,qr,xA=new class{constructor(){g(this,"_clientSize",null),g(this,"getClientWidth",()=>document.documentElement?document.documentElement.clientWidth:document.body.clientWidth),g(this,"getClientHeight",()=>document.documentElement?document.documentElement.clientHeight:document.body.clientHeight),g(this,"getStyle",e=>window.getComputedStyle(e,null)),g(this,"checkCssVisibleProperty",e=>{let t=!0;const n=this.getStyle(e),{display:r,visibility:o,opacity:a,filter:d}=n;return(r==="none"||["hidden","collapse"].includes(o)||Number(a)<.1)&&(t=!1),t?(d&&d.split(" ").filter(u=>{const h=u.split("(")[0];return["brightness","blur","opacity"].includes(h)}).map(u=>{const[h,m]=u.split(/\(|\)/);return[h,Number(m.match(/^[0-9\.]+/))]}).forEach(u=>{const[h,m]=u;switch(h){case"brightness":(m<.1||m>3)&&(t=!1);break;case"blur":m>3&&(t=!1);break;case"opacity":m<.1&&(t=!1)}}),t):!1}),g(this,"checkPropertyUpToAllParentNodes",(e,t)=>{let n=!0,r=!0;const o=d=>t(d);let a=e;for(;a&&r;)o(a)||(n=!1,r=!1),a=a.parentElement,a||(r=!1);return n}),g(this,"checkActualCssVisibleIncludeInherit",e=>this.checkPropertyUpToAllParentNodes(e,this.checkCssVisibleProperty)),g(this,"getSizeAboutClient",e=>{const{width:t,height:n,left:r,right:o,top:a,bottom:d}=e.getBoundingClientRect(),u=this.getClientWidth(),h=this.getClientHeight();return{width:t,height:n,left:r,right:o,top:a,bottom:d,clientWidth:u,clientHeight:h,clientMin:Math.min(u,h)}}),g(this,"checkActualSize",()=>{const{width:e,height:t,clientMin:n}=this._clientSize;return this.checkSizeIsVisible(e,t,n)}),g(this,"elementFromPoint",(e,t)=>document.elementFromPoint?document.elementFromPoint(e,t):null),g(this,"checkCoverForAPoint",(e,t,n)=>{const r=this.elementFromPoint(e,t);return r!==null&&r!==n}),g(this,"getPointPositionList",()=>{const{width:e,height:t,left:n,top:r}=this._clientSize,o=e/6,a=t/6,d=[],u=10**6;for(let h=0;h<5;h++)for(let m=0;m<5;m++){const f=(n*u+(h===0?.1:h===4?(o*h*u-1e5)/u:o*h)*u)/u,E=(r*u+(m===0?.1:m===4?(a*m*u-1e5)/u:a*m)*u)/u;d.push({x:f,y:E})}return[...d]}),g(this,"checkElementCover",e=>this.getPointPositionList().map(t=>this.checkCoverForAPoint(t.x,t.y,e)).filter(t=>!!t).length>6),g(this,"checkSizeIsVisible",(e,t,n)=>(e>50||n/e<=10)&&(t>50||n/t<=10)),g(this,"checkSizeOfPartInClient",()=>{const{left:e,right:t,top:n,bottom:r,clientHeight:o,clientWidth:a,clientMin:d}=this._clientSize;let u,h,m,f;if(e<0)u=0;else{if(!(e<a))return!1;u=e}if(t<0)return!1;if(h=t<a?t:a,n<0)m=0;else{if(!(n<o))return!1;m=n}if(r<0)return!1;f=r<o?r:o;const E=h-u,T=f-m;return this.checkSizeIsVisible(E,T,d)}),g(this,"returnHiddenResult",e=>(this._clientSize=null,{visible:!1,reason:e})),g(this,"checkOneElementVisible",e=>{if(e instanceof HTMLElement){if(this.checkElementIsMountedOnDom(e)){if(this.checkActualCssVisibleIncludeInherit(e)){if(this._clientSize=this.getSizeAboutClient(e),this.checkElementCover(e))return this.returnHiddenResult(qa.COVERED);{const t=this.checkActualSize(),n=this.checkSizeOfPartInClient();return t&&!n?this.returnHiddenResult(qa.POSITION):t?(this._clientSize=null,{visible:!0}):this.returnHiddenResult(qa.SIZE)}}return this.returnHiddenResult(qa.STYLE)}return this.returnHiddenResult(Pu.UNMOUNTED)}return this.returnHiddenResult(Pu.INVALID_HTML_ELEMENT)}),g(this,"checkElementIsMountedOnDom",e=>this.checkPropertyUpToAllParentNodes(e,t=>t.nodeName.toUpperCase()!=="HTML"?t.parentElement!==null:!!document.documentElement))}};function VA(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function sd(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?VA(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):VA(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let Ft=(oA=Te({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),sA=yt(),aA=Te({argsMap:e=>[e.getTrackId()]}),cA=ja("LocalVideoTrack","_enabledMutex"),dA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),lA=yt(),uA=ja("LocalVideoTrack","_enabledMutex"),hA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),pA=yt(),fA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),mA=yt(),EA=yt(),_A=Te({argsMap:(e,t,n)=>[e.getTrackId(),t,n]}),gA=yt(),SA=yt(),TA=yt(),vA=yt(),yA=yt(),RA=yt(),CA=yt(),IA=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),AA=Te({argsMap:e=>[e.getTrackId()]}),OA=Te({argsMap:e=>[e.getTrackId()]}),wA=Te({argsMap:(e,t,n)=>[e.getTrackId(),t.label,n]}),Y((Ue=class fP extends Xm{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gn.PLAYING)}get processorContext(){return this._processorContext}set processorContext(t){this._processorContext=t}get __className__(){return"LocalVideoTrack"}constructor(t,n,r,o,a,d){if(super(t,a),g(this,"trackMediaType","video"),g(this,"_player",void 0),g(this,"_videoVisibleTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"_encoderConfig",void 0),g(this,"_scalabiltyMode",{numSpatialLayers:1,numTemporalLayers:1}),g(this,"_optimizationMode",void 0),g(this,"_videoHeight",void 0),g(this,"_videoWidth",void 0),g(this,"_forceBitrateLimit",void 0),g(this,"_enabled",!0),g(this,"processorDestination",void 0),g(this,"_processorContext",void 0),kn()){const{width:u,height:h}=t.getSettings();this._videoWidth=u,this._videoHeight=h}else this.updateMediaStreamTrackResolution();this._encoderConfig=n,this._scalabiltyMode=r,this._optimizationMode=o,this._hints=d||[],this._hints.indexOf(zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile(),n&&this._hints.indexOf(zt.CUSTOM_TRACK)!==-1&&this.setEncoderConfiguration(n),this.processorContext=new RC(this.getTrackId(),"local"),this.processorDestination=new yC(this.processorContext),this.bindProcessorDestinationEvents()}play(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof t=="string"){const o=document.getElementById(t);o?t=o:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(t,'" element, use document.body')),t=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(n));const r=sd(sd(sd({},this._getDefaultPlayerConfig()),n),{},{trackId:this.getTrackId(),element:t});this._player?this._player.updateConfig(r):(t instanceof HTMLVideoElement?this._player=new mE(r):this._player=new rA(r),this._player.updateVideoTrack(this._mediaStreamTrack)),this._player.play(),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const o=this.getVideoElementVisibleStatus();this.safeEmit(Yo.VIDEO_ELEMENT_VISIBLE_STATUS,o)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}async setEnabled(t,n){if(!n){if(t===this._enabled)return;this.stateCheck("enabled",t)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),t),!t){this._originMediaStreamTrack.enabled=!1;try{await Rt(this,Re.NEED_DISABLE_TRACK,this)}catch(r){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),r.toString()),r}return n||(this._enabled=!1),void v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}this._originMediaStreamTrack.enabled=!0;try{await Rt(this,Re.NEED_ENABLE_TRACK,this)}catch(r){throw v.error("[".concat(this.getTrackId(),"] setEnabled to true error"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),n||(this._enabled=!0)}async setMuted(t){t!==this._muted&&(this.stateCheck("muted",t),this._muted=t,this._originMediaStreamTrack.enabled=!t,v.debug("[".concat(this.getTrackId(),"] start set muted: ").concat(t)),t?await Rt(this,Re.NEED_MUTE_TRACK,this):await Rt(this,Re.NEED_UNMUTE_TRACK,this))}async setEncoderConfiguration(t,n){if(!this._enabled)throw new b(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");if(t=Fs(t),this._forceBitrateLimit&&(t.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:t.bitrateMax,t.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:t.bitrateMin),t.width||t.height||t.frameRate){const r=Du({encoderConfig:t});(kn()||Mn()||zi())&&(r.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(t),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const a=new b(I.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}}this._encoderConfig=t,this._hints.indexOf(zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Rt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(r){return r.throw()}}getStats(){return nd(()=>{v.warning("[deprecated] LocalVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getLocalVideoStats instead")},"localVideoTrackGetStatsWarning"),li(this,Re.GET_STATS)||sd({},xm)}async setBeautyEffect(t){v.error("LocalVideoTrack.setBeautyEffect was deprecated, please migrate to agora-extension-beauty-effect")}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}async getCurrentFrameImage(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:1;return this._player?this._player.getCurrentFrameToUint8Array(t,n):await fE(t)}clone(t,n,r,o){const a=this._mediaStreamTrack.clone();return new fP(a,t,n,r,o)}async setBitrateLimit(t){if(v.debug("[".concat(this.getTrackId(),"] set bitrate limit, ").concat(JSON.stringify(t))),t){this._forceBitrateLimit=t,this._encoderConfig&&(this._encoderConfig.bitrateMax?this._encoderConfig.bitrateMax=this._encoderConfig.bitrateMax<t.max_bitrate?this._encoderConfig.bitrateMax:t.max_bitrate:this._encoderConfig.bitrateMax=t.max_bitrate,this._encoderConfig.bitrateMin,this._encoderConfig.bitrateMin=t.min_bitrate);try{await Rt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(n){return n.throw()}}}async setOptimizationMode(t){if(t!=="motion"&&t!=="detail"&&t!=="balanced")return void v.error(I.INVALID_PARAMS,"optimization mode must be motion, detail or balanced");const n=this._optimizationMode;try{this._optimizationMode=t,await Rt(this,Re.SET_OPTIMIZATION_MODE,this)}catch(r){throw this._optimizationMode=n,v.error("[".concat(this.getTrackId(),"] set optimization mode failed"),r.toString()),r}v.info("[".concat(this.getTrackId(),"] set optimization mode success (").concat(t,")"))}setScalabiltyMode(t){if(t.numSpatialLayers===1&&t.numTemporalLayers!==1)return v.error(I.INVALID_PARAMS,"scalability mode currently not supported, no SVC."),void(this._scalabiltyMode={numSpatialLayers:1,numTemporalLayers:1});this._scalabiltyMode=t,v.info("[".concat(this.getTrackId(),"] set scalability mode success (").concat(t,")"))}updateMediaStreamTrackResolution(){SI(this._originMediaStreamTrack).then(t=>{let[n,r]=t;this._videoHeight=r,this._videoWidth=n}).catch(Au)}_updatePlayerSource(){this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}_getDefaultPlayerConfig(){return{fit:"contain"}}updateBitrateFromProfile(){if(!this._encoderConfig)return;const{width:t,height:n,frameRate:r}=this.getMediaStreamTrackSettings();if(!t||!n||!r)return;const[o,a]=function(d,u,h){const m=k("BITRATE_ADAPTER_TYPE");let f;const E=200*Math.pow(h/15,.6)*Math.pow(d*u/640/360,.75),T=E;if(m==="STANDARD_BITRATE")f=4*E;else{if(m!=="COMPATIABLE_BITRATE")return;f=2*E}return[Math.floor(f),Math.floor(T)]}(t,n,r)||[void 0,void 0];this._encoderConfig.bitrateMin||this._encoderConfig.bitrateMax||(this._encoderConfig.bitrateMin=a,this._encoderConfig.bitrateMax=o,v.debug("[".concat(this.getTrackId(),"] update bitrate from profile, [w: ").concat(t,", h: ").concat(n,", fps: ").concat(r,"] => [brMax: ").concat(o,", brMin: ").concat(a,"]")))}getVideoElementVisibleStatus(){try{var t,n;const r=this==null||(t=this._player)===null||t===void 0?void 0:t.getContainerElement(),o={track:this,element:this==null||(n=this._player)===null||n===void 0?void 0:n.getVideoElement(),slot:r==null?void 0:r.parentElement},{element:a,slot:d}=o;if(this.isPlaying&&a instanceof HTMLVideoElement&&d instanceof HTMLElement){const u=xA.checkOneElementVisible(a),h=Object.assign({},u);if(h.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=h.visible;const m=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.LOCAL_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});h.visible?m.onSuccess("Video is visible"):m.onSuccess("Invisible because of ".concat(h.reason))}return h}return}catch(r){throw new b(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,r.message)}}async renewMediaStreamTrack(t){}pipe(t){if(this.processor===t)return t;if(t._source)throw new b(I.INVALID_OPERATION,"Processor ".concat(t.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=t,this.processor._source=this,t.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),t}unpipe(){if(!this.processor)return;const t=this.processor;this.processor._source=void 0,this.processor=void 0,t.reset()}close(){super.close(),this.unbindProcessorDestinationEvents(),this.unbindProcessorContextEvents(),this.unpipe(),this.processorDestination._source&&this.processorDestination._source.unpipe()}async replaceTrack(t,n){if(!(t instanceof MediaStreamTrack))throw new b(I.INVALID_PARAMS,"track should be an instance of MediaStreamTrack");if(t.kind!=="video")throw new b(I.INVALID_PARAMS,"track should be a video MediaStreamTrack");await this._updateOriginMediaStreamTrack(t,n,!0),this.updateMediaStreamTrackResolution()}bindProcessorDestinationEvents(){this.processorDestination.on(vn.ON_TRACK,async t=>{t?t!==this._mediaStreamTrack&&(this._mediaStreamTrack=t,this._updatePlayerSource(),await Rt(this,Re.NEED_REPLACE_TRACK,this)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource(),await Rt(this,Re.NEED_REPLACE_TRACK,this))})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vn.ON_TRACK)}unbindProcessorContextEvents(){this.processorContext.removeAllListeners(nr.REQUEST_UPDATE_CONSTRAINTS),this.processorContext.removeAllListeners(nr.REQUEST_CONSTRAINTS)}}).prototype,"play",[oA,sA],Object.getOwnPropertyDescriptor(Ue.prototype,"play"),Ue.prototype),Y(Ue.prototype,"stop",[aA],Object.getOwnPropertyDescriptor(Ue.prototype,"stop"),Ue.prototype),Y(Ue.prototype,"setEnabled",[cA,dA,lA],Object.getOwnPropertyDescriptor(Ue.prototype,"setEnabled"),Ue.prototype),Y(Ue.prototype,"setMuted",[uA,hA,pA],Object.getOwnPropertyDescriptor(Ue.prototype,"setMuted"),Ue.prototype),Y(Ue.prototype,"setEncoderConfiguration",[fA,mA],Object.getOwnPropertyDescriptor(Ue.prototype,"setEncoderConfiguration"),Ue.prototype),Y(Ue.prototype,"getStats",[EA],Object.getOwnPropertyDescriptor(Ue.prototype,"getStats"),Ue.prototype),Y(Ue.prototype,"setBeautyEffect",[_A,gA],Object.getOwnPropertyDescriptor(Ue.prototype,"setBeautyEffect"),Ue.prototype),Y(Ue.prototype,"getCurrentFrameData",[SA],Object.getOwnPropertyDescriptor(Ue.prototype,"getCurrentFrameData"),Ue.prototype),Y(Ue.prototype,"getCurrentFrameImage",[TA],Object.getOwnPropertyDescriptor(Ue.prototype,"getCurrentFrameImage"),Ue.prototype),Y(Ue.prototype,"setBitrateLimit",[vA],Object.getOwnPropertyDescriptor(Ue.prototype,"setBitrateLimit"),Ue.prototype),Y(Ue.prototype,"setOptimizationMode",[yA],Object.getOwnPropertyDescriptor(Ue.prototype,"setOptimizationMode"),Ue.prototype),Y(Ue.prototype,"setScalabiltyMode",[RA],Object.getOwnPropertyDescriptor(Ue.prototype,"setScalabiltyMode"),Ue.prototype),Y(Ue.prototype,"updateMediaStreamTrackResolution",[CA],Object.getOwnPropertyDescriptor(Ue.prototype,"updateMediaStreamTrackResolution"),Ue.prototype),Y(Ue.prototype,"pipe",[IA],Object.getOwnPropertyDescriptor(Ue.prototype,"pipe"),Ue.prototype),Y(Ue.prototype,"unpipe",[AA],Object.getOwnPropertyDescriptor(Ue.prototype,"unpipe"),Ue.prototype),Y(Ue.prototype,"close",[OA],Object.getOwnPropertyDescriptor(Ue.prototype,"close"),Ue.prototype),Y(Ue.prototype,"replaceTrack",[wA],Object.getOwnPropertyDescriptor(Ue.prototype,"replaceTrack"),Ue.prototype),Ue),FA=(NA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),bA=yt(),DA=ja("CameraVideoTrack","_enabledMutex"),PA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),LA=yt(),kA=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),MA=yt(),UA=Te({argsMap:e=>[e.getTrackId()]}),Y((qr=class extends Ft{get __className__(){return"CameraVideoTrack"}constructor(e,t,n,r,o,a){super(e,Fs(t.encoderConfig),r,o,a),g(this,"_config",void 0),g(this,"_originalConstraints",void 0),g(this,"_constraints",void 0),g(this,"_enabled",!0),g(this,"_deviceName","default"),g(this,"tryResumeVideoForIOS15_16WeChat",async()=>{(Oa()||rm())&&!function(){const d=qe();if(d.os!==En.IOS||!d.osVersion)return!1;const u=d.osVersion.split(".");return Number(u[0])===15&&Number(u[1])>=2}()&&xy()&&this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS 15 device on WeChat.")),await this.renewMediaStreamTrack())}),this._config=t,this._originalConstraints=n,this._constraints=n,this._deviceName=e.label,this._encoderConfig=Fs(this._config.encoderConfig),Xe.on($t.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xe.on($t.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),this.bindProcessorContextEvents()}async setDevice(e){if(v.info("[".concat(this.getTrackId(),"] set device to ").concat(e)),this._enabled)try{const t=await br.getDeviceById(e),n={};n.video=sd({},this._constraints),n.video.deviceId={exact:e},n.video.facingMode=void 0,this._originMediaStreamTrack.stop();let r=null;try{r=await di(n,this.getTrackId())}catch(o){throw v.error("[".concat(this.getTrackId(),"] setDevice failed"),o.toString()),r=await di({video:this._constraints},this.getTrackId()),await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),o}await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!1),this.updateMediaStreamTrackResolution(),this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}else try{const t=await br.getDeviceById(e);this._deviceName=t.label,this._config.cameraId=e,this._constraints.deviceId={exact:e}}catch(t){throw v.error("[".concat(this.getTrackId(),"] setDevice error"),t.toString()),t}v.info("[".concat(this.getTrackId(),"] setDevice success"))}async setEnabled(e,t){if(!t){if(e===this._enabled)return;this.stateCheck("enabled",e)}if(v.info("[".concat(this.getTrackId(),"] start setEnabled"),e),e){try{if(this.isExternalTrack)this._originMediaStreamTrack.enabled=!0;else{const n=await di({video:this._constraints},this.getTrackId());await this._updateOriginMediaStreamTrack(n.getVideoTracks()[0],!1)}await Rt(this,Re.NEED_ENABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled true error"),n.toString()),n}this.updateMediaStreamTrackResolution(),v.info("[".concat(this.getTrackId(),"] setEnabled to true success")),t||(this._enabled=!0)}else{this.isExternalTrack?this._originMediaStreamTrack.enabled=!1:(this._originMediaStreamTrack.onended=null,this._originMediaStreamTrack.stop()),t||(this._enabled=!1);try{await Rt(this,Re.NEED_DISABLE_TRACK,this)}catch(n){throw v.error("[".concat(this.getTrackId(),"] setEnabled to false error"),n.toString()),n}v.info("[".concat(this.getTrackId(),"] setEnabled to false success"))}}async setEncoderConfiguration(e,t){if(!this._enabled)throw new b(I.TRACK_IS_DISABLED,"can not set encoder configuration when track is disabled");e=Fs(e),this._forceBitrateLimit&&(e.bitrateMax=this._forceBitrateLimit.max_bitrate?this._forceBitrateLimit.max_bitrate:e.bitrateMax,e.bitrateMin=this._forceBitrateLimit.min_bitrate?this._forceBitrateLimit.min_bitrate:e.bitrateMin);const n=Vt(this._config);n.encoderConfig=e;const r=Du(n);(kn()||Mn()||zi())&&(r.deviceId=void 0),v.debug("[".concat(this.getTrackId(),"] setEncoderConfiguration applyConstraints"),JSON.stringify(e),JSON.stringify(r));try{await this._originMediaStreamTrack.applyConstraints(r),this.updateMediaStreamTrackResolution()}catch(o){const a=new b(I.UNEXPECTED_ERROR,o.toString());throw v.error("[".concat(this.getTrackId(),"] applyConstraints error"),a.toString()),a}this._config=n,this._constraints=r,this._originalConstraints=r,this._encoderConfig=e,this._hints.indexOf(zt.SCREEN_TRACK)===-1&&this.updateBitrateFromProfile();try{await Rt(this,Re.NEED_UPDATE_VIDEO_ENCODER,this)}catch(o){return o.throw()}}_getDefaultPlayerConfig(){return{mirror:!0,fit:"cover"}}onTrackEnded(){if((Mn()||zi())&&this._enabled&&!this._isClosed&&Xe.duringInterruption){const e=async()=>{Xe.off($t.IOS_INTERRUPTION_END,e),this._enabled&&!this._isClosed&&(v.debug("[".concat(this.getTrackId(),"] try capture camera media device for interrupted iOS device.")),await this.setEnabled(!1),await this.setEnabled(!0))};Xe.on($t.IOS_INTERRUPTION_END,e)}else v.debug("[".concat(this.getTrackId(),"] track ended")),this.safeEmit(Yo.TRACK_ENDED)}async renewMediaStreamTrack(e){const t=e||this._constraints,n=br.searchDeviceIdByName(this._deviceName);if(n&&!t.deviceId&&(t.deviceId={exact:n}),this._enabled){const r=await di({video:t},this.getTrackId());this._constraints=t,await this._updateOriginMediaStreamTrack(r.getVideoTracks()[0],!0),this.updateMediaStreamTrackResolution()}}close(){super.close(),Xe.off($t.IOS_15_16_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat),Xe.off($t.IOS_INTERRUPTION_END,this.tryResumeVideoForIOS15_16WeChat)}bindProcessorContextEvents(){this.processorContext.on(nr.REQUEST_UPDATE_CONSTRAINTS,async(e,t,n)=>{try{const r=Object.assign({},this._originalConstraints,...e);await this.renewMediaStreamTrack(r),t()}catch(r){n(r)}}),this.processorContext.on(nr.REQUEST_CONSTRAINTS,async e=>{e(this._originMediaStreamTrack.getSettings())})}}).prototype,"setDevice",[NA,bA],Object.getOwnPropertyDescriptor(qr.prototype,"setDevice"),qr.prototype),Y(qr.prototype,"setEnabled",[DA,PA,LA],Object.getOwnPropertyDescriptor(qr.prototype,"setEnabled"),qr.prototype),Y(qr.prototype,"setEncoderConfiguration",[kA,MA],Object.getOwnPropertyDescriptor(qr.prototype,"setEncoderConfiguration"),qr.prototype),Y(qr.prototype,"close",[UA],Object.getOwnPropertyDescriptor(qr.prototype,"close"),qr.prototype),qr);class EE{get hasVideo(){return this._video_enabled_&&!this._video_muted_&&this._video_added_}get hasAudio(){return this._audio_enabled_&&!this._audio_muted_&&this._audio_added_}get audioTrack(){if(this.hasAudio)return this._audioTrack}get videoTrack(){if(this.hasVideo)return this._videoTrack}constructor(t,n){g(this,"uid",void 0),g(this,"_uintid",void 0),g(this,"_trust_in_room_",!0),g(this,"_trust_audio_enabled_state_",!0),g(this,"_trust_video_enabled_state_",!0),g(this,"_trust_audio_mute_state_",!0),g(this,"_trust_video_mute_state_",!0),g(this,"_audio_muted_",!1),g(this,"_video_muted_",!1),g(this,"_audio_enabled_",!0),g(this,"_video_enabled_",!0),g(this,"_audio_added_",!1),g(this,"_video_added_",!1),g(this,"_trust_video_stream_added_state_",!0),g(this,"_trust_audio_stream_added_state_",!0),g(this,"_audioTrack",void 0),g(this,"_videoTrack",void 0),g(this,"_audioSSRC",void 0),g(this,"_videoSSRC",void 0),g(this,"_audioOrtc",void 0),g(this,"_videoOrtc",void 0),g(this,"_cname",void 0),g(this,"_rtxSsrcId",void 0),this.uid=t,this._uintid=n}}var Dj=Jv,Pj=ya,Lj=Wl;Wn({target:"Promise",stat:!0},{try:function(e){var t=Pj.f(this),n=Lj(e);return(n.error?t.reject:t.resolve)(n.value),t.promise}});var _E=Dj,kj=Wn,Mj=W,Uj=p,xj=td,Vj=Zn,Fj=Uo,jj=xo,jA=Im,Bj=YR,Gj=ZR,Wj=fa,BA=mn("isConcatSpreadable"),GA=9007199254740991,WA="Maximum allowed index exceeded",HA=Mj.TypeError,Hj=Wj>=51||!Uj(function(){var e=[];return e[BA]=!1,e.concat()[0]!==e}),Kj=Gj("concat"),zj=function(e){if(!Vj(e))return!1;var t=e[BA];return t!==void 0?!!t:xj(e)};kj({target:"Array",proto:!0,forced:!Hj||!Kj},{concat:function(e){var t,n,r,o,a,d=Fj(this),u=Bj(d,0),h=0;for(t=-1,r=arguments.length;t<r;t++)if(zj(a=t===-1?d:arguments[t])){if(h+(o=jj(a))>GA)throw HA(WA);for(n=0;n<o;n++,h++)n in a&&jA(u,h,a[n])}else{if(h>=GA)throw HA(WA);jA(u,h++,a)}return u.length=h,u}});var KA={},Yj=Ve,qj=jr,zA=Il.f,Jj=SR,YA=typeof window=="object"&&window&&Object.getOwnPropertyNames?Object.getOwnPropertyNames(window):[];KA.f=function(e){return YA&&Yj(e)=="Window"?function(t){try{return zA(t)}catch{return Jj(YA)}}(e):zA(qj(e))};var ad={},Xj=mn;ad.f=Xj;var qA=Mo,Qj=hr,$j=ad,Zj=Ai.f,ln=function(e){var t=qA.Symbol||(qA.Symbol={});Qj(t,e)||Zj(t,e,{value:$j.f(e)})},Ja=Wn,gE=W,eB=Wi,tB=M,cd=_e,nB=F,Xa=Z,Js=Dp,SE=p,In=hr,rB=td,iB=j,oB=Zn,sB=H,TE=Pp,vE=Oi,aB=Uo,Lu=jr,yE=Sl,JA=ga,RE=Fr,dd=Nl,XA=Zp,cB=Il,QA=KA,CE=Qp,$A=J,ZA=Ai,dB=$p,eO=Ne,lB=gf,IE=Fl,ld=gl.exports,tO=Al,nO=Vp,rO=mn,uB=ad,hB=ln,pB=Bc,iO=Vl,ku=JR.forEach,Dr=Cl("hidden"),Mu="Symbol",oO=rO("toPrimitive"),fB=iO.set,sO=iO.getterFor(Mu),ki=Object.prototype,Qo=gE.Symbol,Xs=Qo&&Qo.prototype,aO=gE.TypeError,AE=gE.QObject,ud=eB("JSON","stringify"),cO=$A.f,$o=ZA.f,dO=QA.f,mB=eO.f,lO=nB([].push),So=ld("symbols"),hd=ld("op-symbols"),OE=ld("string-to-symbol-registry"),wE=ld("symbol-to-string-registry"),EB=ld("wks"),NE=!AE||!AE.prototype||!AE.prototype.findChild,bE=Xa&&SE(function(){return dd($o({},"a",{get:function(){return $o(this,"a",{value:7}).a}})).a!=7})?function(e,t,n){var r=cO(ki,t);r&&delete ki[t],$o(e,t,n),r&&e!==ki&&$o(ki,t,r)}:$o,DE=function(e,t){var n=So[e]=dd(Xs);return fB(n,{type:Mu,tag:e,description:t}),Xa||(n.description=t),n},Uu=function(e,t,n){e===ki&&Uu(hd,t,n),vE(e);var r=yE(t);return vE(n),In(So,r)?(n.enumerable?(In(e,Dr)&&e[Dr][r]&&(e[Dr][r]=!1),n=dd(n,{enumerable:RE(0,!1)})):(In(e,Dr)||$o(e,Dr,RE(1,{})),e[Dr][r]=!0),bE(e,r,n)):$o(e,r,n)},PE=function(e,t){vE(e);var n=Lu(t),r=XA(n).concat(LE(n));return ku(r,function(o){Xa&&!cd(uO,n,o)||Uu(e,o,n[o])}),e},uO=function(e){var t=yE(e),n=cd(mB,this,t);return!(this===ki&&In(So,t)&&!In(hd,t))&&(!(n||!In(this,t)||!In(So,t)||In(this,Dr)&&this[Dr][t])||n)},hO=function(e,t){var n=Lu(e),r=yE(t);if(n!==ki||!In(So,r)||In(hd,r)){var o=cO(n,r);return!o||!In(So,r)||In(n,Dr)&&n[Dr][r]||(o.enumerable=!0),o}},pO=function(e){var t=dO(Lu(e)),n=[];return ku(t,function(r){In(So,r)||In(tO,r)||lO(n,r)}),n},LE=function(e){var t=e===ki,n=dO(t?hd:Lu(e)),r=[];return ku(n,function(o){!In(So,o)||t&&!In(ki,o)||lO(r,So[o])}),r};if(Js||(IE(Xs=(Qo=function(){if(sB(Xs,this))throw aO("Symbol is not a constructor");var e=arguments.length&&arguments[0]!==void 0?JA(arguments[0]):void 0,t=nO(e),n=function(r){this===ki&&cd(n,hd,r),In(this,Dr)&&In(this[Dr],t)&&(this[Dr][t]=!1),bE(this,t,RE(1,r))};return Xa&&NE&&bE(ki,t,{configurable:!0,set:n}),DE(t,e)}).prototype,"toString",function(){return sO(this).tag}),IE(Qo,"withoutSetter",function(e){return DE(nO(e),e)}),eO.f=uO,ZA.f=Uu,dB.f=PE,$A.f=hO,cB.f=QA.f=pO,CE.f=LE,uB.f=function(e){return DE(rO(e),e)},Xa&&$o(Xs,"description",{configurable:!0,get:function(){return sO(this).description}})),Ja({global:!0,wrap:!0,forced:!Js,sham:!Js},{Symbol:Qo}),ku(XA(EB),function(e){hB(e)}),Ja({target:Mu,stat:!0,forced:!Js},{for:function(e){var t=JA(e);if(In(OE,t))return OE[t];var n=Qo(t);return OE[t]=n,wE[n]=t,n},keyFor:function(e){if(!TE(e))throw aO(e+" is not a symbol");if(In(wE,e))return wE[e]},useSetter:function(){NE=!0},useSimple:function(){NE=!1}}),Ja({target:"Object",stat:!0,forced:!Js,sham:!Xa},{create:function(e,t){return t===void 0?dd(e):PE(dd(e),t)},defineProperty:Uu,defineProperties:PE,getOwnPropertyDescriptor:hO}),Ja({target:"Object",stat:!0,forced:!Js},{getOwnPropertyNames:pO,getOwnPropertySymbols:LE}),Ja({target:"Object",stat:!0,forced:SE(function(){CE.f(1)})},{getOwnPropertySymbols:function(e){return CE.f(aB(e))}}),ud&&Ja({target:"JSON",stat:!0,forced:!Js||SE(function(){var e=Qo();return ud([e])!="[null]"||ud({a:e})!="{}"||ud(Object(e))!="{}"})},{stringify:function(e,t,n){var r=lB(arguments),o=t;if((oB(t)||e!==void 0)&&!TE(e))return rB(t)||(t=function(a,d){if(iB(o)&&(d=cd(o,this,a,d)),!TE(d))return d}),r[1]=t,tB(ud,null,r)}}),!Xs[oO]){var _B=Xs.valueOf;IE(Xs,oO,function(e){return cd(_B,this)})}pB(Qo,Mu),tO[Dr]=!0,ln("asyncIterator"),ln("hasInstance"),ln("isConcatSpreadable"),ln("iterator"),ln("match"),ln("matchAll"),ln("replace"),ln("search"),ln("species"),ln("split"),ln("toPrimitive"),ln("toStringTag"),ln("unscopables"),Bc(W.JSON,"JSON",!0);var gB=Mo.Symbol;ln("asyncDispose"),ln("dispose"),ln("matcher"),ln("metadata"),ln("observable"),ln("patternMatch"),ln("replaceAll");var fO=gB,mO=ad.f("asyncIterator"),SB=mO;function EO(e){this.wrapped=e}function pd(e){var t,n;function r(a,d){try{var u=e[a](d),h=u.value,m=h instanceof EO;_E.resolve(m?h.wrapped:h).then(function(f){m?r(a==="return"?"return":"next",f):o(u.done?"return":"normal",f)},function(f){r("throw",f)})}catch(f){o("throw",f)}}function o(a,d){switch(a){case"return":t.resolve({value:d,done:!0});break;case"throw":t.reject(d);break;default:t.resolve({value:d,done:!1})}(t=t.next)?r(t.key,t.arg):n=null}this._invoke=function(a,d){return new _E(function(u,h){var m={key:a,arg:d,resolve:u,reject:h,next:null};n?n=n.next=m:(t=n=m,r(a,d))})},typeof e.return!="function"&&(this.return=void 0)}function ui(e){return function(){return new pd(e.apply(this,arguments))}}function xe(e){return new EO(e)}pd.prototype[typeof fO=="function"&&SB||"@@asyncIterator"]=function(){return this},pd.prototype.next=function(e){return this._invoke("next",e)},pd.prototype.throw=function(e){return this._invoke("throw",e)},pd.prototype.return=function(e){return this._invoke("return",e)};var TB=ad.f("iterator");function xu(e,t){var n={},r=!1;function o(a,d){return r=!0,d=new _E(function(u){u(e[a](d))}),{done:!1,value:t(d)}}return n[fO!==void 0&&TB||"@@iterator"]=function(){return this},n.next=function(a){return r?(r=!1,a):o("next",a)},typeof e.throw=="function"&&(n.throw=function(a){if(r)throw r=!1,a;return o("throw",a)}),typeof e.return=="function"&&(n.return=function(a){return r?(r=!1,a):o("return",a)}),n}var _O=mO,jt={exports:{}};function gO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function SO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?gO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):gO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function kE(e,t,n,r,o,a,d){let u=[],h=[],m=[],f=[],E=!1,T=!1;if(jt.exports.parse(e).mediaDescriptions.forEach(R=>{d&&d!==R.attributes.direction||(R.media.mediaType!=="video"||E||(h=R.attributes.payloads,f=R.attributes.extmaps,E=!0),R.media.mediaType!=="audio"||T||(u=R.attributes.payloads,m=R.attributes.extmaps,T=!0))}),!f||h.length===0)throw new Error("Cannot get video capabilities from SDP.");if(!m||u.length===0)throw new Error("Cannot get audio capabilities from SDP.");return h.forEach(R=>{var A;(A=R.rtpMap)!==null&&A!==void 0&&A.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),u.forEach(R=>{var A;(A=R.rtpMap)!==null&&A!==void 0&&A.clockRate&&(R.rtpMap.clockRate=parseInt(R.rtpMap.clockRate))}),t&&(u=u.filter(R=>{var A;return((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())!=="rtx"}),h=h.filter(R=>{var A;return((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())!=="rtx"})),n&&(h=h.filter(R=>{var A;return!/(red)|(ulpfec)|(flexfec)/i.test(((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName)||"")})),r&&(u=u.filter(R=>{var A;return!/(red)|(ulpfec)|(flexfec)/i.test(((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName)||"")})),o&&(o==null?void 0:o.length)>0&&(u=u.filter(R=>{var A;return o.includes(((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")})),a&&(a==null?void 0:a.length)>0&&(h=h.filter(R=>{var A;return a.includes(((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName.toLowerCase())||"")})),{audioCodecs:u,videoCodecs:h,audioExtensions:m,videoExtensions:f}}function Qs(e){const t=jt.exports.parse(e);let n,r;for(const o of t.mediaDescriptions){if(!n){const a=o.attributes.iceUfrag,d=o.attributes.icePwd;if(!a||!d)throw new Error("Cannot get iceUfrag or icePwd from SDP.");n={iceUfrag:a,icePwd:d}}if(!r){const a=o.attributes.fingerprints;a.length>0&&(r={fingerprints:a})}}if(!r&&t.attributes.fingerprints.length>0&&(r={fingerprints:t.attributes.fingerprints}),!r||!n)throw new Error("Cannot get iceParameters or dtlsParameters from SDP.");return{iceParameters:n,dtlsParameters:r}}function TO(e,t){const n=[],r=e.attributes.ssrcGroups.filter(d=>d.semantic==="FID"),o=e.attributes.ssrcGroups.find(d=>d.semantic==="SIM"),a=e.attributes.ssrcs;if(o)o.ssrcIds.forEach(d=>{var u;const h=(u=r.find(m=>m.ssrcIds[0]===d))===null||u===void 0?void 0:u.ssrcIds[1];n.push({ssrcId:d,rtx:t?h:void 0})});else if(r.length>0){const d=r[0].ssrcIds[0],u=r[0].ssrcIds[1];n.push({ssrcId:d,rtx:t?u:void 0})}else{if(a.length===0)throw new Error("No ssrcs found on local media description.");n.push({ssrcId:a[0].ssrcId})}return n}function vO(e,t){const{cname:n}=e;let r;t&&t.ip&&typeof t.port=="number"?(r=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip,port:t.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(t.ip,":").concat(t.port)),t.ip6&&(r.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:t.ip6,port:t.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(t.ip6,":").concat(t.port)))):r=e.iceParameters.candidates.map(u=>({foundation:u.foundation,componentId:"1",transport:u.protocol,priority:u.priority.toString(),connectionAddress:u.ip,port:u.port.toString(),type:u.type,extension:{}}));const o={fingerprints:e.dtlsParameters.fingerprints.map(u=>({hashFunction:u.algorithm,fingerprint:u.fingerprint}))},a={iceUfrag:e.iceParameters.iceUfrag,icePwd:e.iceParameters.icePwd};let d;switch(e.dtlsParameters.role){case"server":d="passive";break;case"client":d="active";break;case"auto":d="actpass"}return{dtlsParameters:o,iceParameters:a,candidates:r,rtpCapabilities:xE(e.rtpCapabilities),setup:d,cname:n}}function Jr(e,t,n){const r=[],o=[];return e.forEach(a=>{let{ssrcId:d,rtx:u}=a;const h=ut(8,"track-"),m={ssrcId:d,attributes:SO({label:h,mslabel:n=n||ut(10,""),msid:"".concat(n," ").concat(h)},t&&{cname:t})};if(r.push(m),u!==void 0){const f={ssrcId:u,attributes:SO({label:h,mslabel:n,msid:"".concat(n," ").concat(h)},t&&{cname:t})};r.push(f),o.push({semantic:"FID",ssrcIds:[d,u]})}}),e.length>1&&o.push({semantic:"SIM",ssrcIds:e.map(a=>{let{ssrcId:d}=a;return d})}),{ssrcs:r,ssrcGroups:o}}function Qa(e,t){t instanceof yn&&e.attributes.payloads.forEach(n=>{var r;const o=(r=n.rtpMap)===null||r===void 0?void 0:r.encodingName.toLowerCase();if(!o||["opus","pcmu","pcma","g722"].indexOf(o)===-1)return;n.fmtp||(n.fmtp={parameters:{}}),n.fmtp.parameters.minptime="10",n.fmtp.parameters.useinbandfec="1";const a=t._encoderConfig;a&&o!=="pcmu"&&o!=="pcma"&&o!=="g722"&&(a.bitrate&&!Tt()&&(n.fmtp.parameters.maxaveragebitrate="".concat(Math.floor(1e3*a.bitrate))),a.sampleRate&&(n.fmtp.parameters.maxplaybackrate="".concat(a.sampleRate),n.fmtp.parameters["sprop-maxcapturerate"]="".concat(a.sampleRate)),a.stereo&&(n.fmtp.parameters.stereo="1",n.fmtp.parameters["sprop-stereo"]="1"))})}function ME(e){const t=e.attributes.unrecognized.findIndex(n=>n.attField==="x-google-flag"&&n.attValue==="conference");t!==-1&&e.attributes.unrecognized.splice(t,1)}function UE(e,t){if(!(t instanceof Ft&&t._encoderConfig&&t._hints.indexOf(zt.SCREEN_TRACK)===-1))return;const n=t._encoderConfig;bt().supportMinBitrate&&n.bitrateMin&&e.attributes.payloads.forEach(r=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-min-bitrate"]="".concat(n.bitrateMin))}),bt().supportMinBitrate&&!t._hints.includes(zt.LOW_STREAM)&&n.bitrateMax&&e.attributes.payloads.forEach(r=>{var o;["h264","h265","vp8","vp9","av1"].includes(((o=r.rtpMap)===null||o===void 0?void 0:o.encodingName.toLowerCase())||"")&&(r.fmtp||(r.fmtp={parameters:{}}),r.fmtp.parameters["x-google-start-bitrate"]="".concat(k("X_GOOGLE_START_BITRATE")||Math.floor(n.bitrateMax)))})}function yO(e){if(e.media.mediaType!=="video")return;const t=qe();if(t.name!==Ze.SAFARI&&t.os!==En.IOS)return;const n=e.attributes.extmaps.findIndex(r=>/video-orientation/g.test(r.extensionName));n!==-1&&e.attributes.extmaps.splice(n,1)}function Vu(e,t,n){if(!t)return;let r,o;if(e.media.mediaType==="video"?(r=n.videoExtensions,o=n.videoCodecs):(r=n.audioExtensions,o=n.audioCodecs),t.twcc===!0){const a=r.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01"}),function(d,u){return u.filter(h=>!!d.find(m=>m.payloadType===h.payloadType&&!!m.rtcpFeedbacks.find(f=>f.type==="transport-cc")))}(o,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="transport-cc")||d.rtcpFeedbacks.push({type:"transport-cc"})}))}else if(t.twcc===!1){const a=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(d=>{const u=d.rtcpFeedbacks.findIndex(h=>h.type==="transport-cc");u!==-1&&d.rtcpFeedbacks.splice(u,1)})}if(t.remb===!0){const a=r.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a&&(e.attributes.extmaps.find(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time")||e.attributes.extmaps.push({entry:a.entry,extensionName:"http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time"}),function(d,u){return u.filter(h=>!!d.find(m=>m.payloadType===h.payloadType&&!!m.rtcpFeedbacks.find(f=>f.type==="goog-remb")))}(o,e.attributes.payloads).forEach(d=>{d.rtcpFeedbacks.find(u=>u.type==="goog-remb")||d.rtcpFeedbacks.push({type:"goog-remb"})}))}else if(t.remb===!1){const a=e.attributes.extmaps.findIndex(d=>d.extensionName==="http://www.webrtc.org/experiments/rtp-hdrext/abs-send-time");a!==-1&&e.attributes.extmaps.splice(a,1),e.attributes.payloads.forEach(d=>{const u=d.rtcpFeedbacks.findIndex(h=>h.type==="goog-remb");u!==-1&&d.rtcpFeedbacks.splice(u,1)})}}function RO(e,t,n){if(Tt()||e.media.mediaType!=="video"||!(t instanceof Ft)||n!=="vp9"&&n!=="vp8"||n==="vp8"&&!k("SIMULCAST")||t._scalabiltyMode===void 0||t._scalabiltyMode.numSpatialLayers<=1)return;const r=n==="vp8"?2:t._scalabiltyMode.numSpatialLayers,o=e.attributes.ssrcs[0],a=e.attributes.ssrcGroups.find(u=>u.semantic==="FID"&&u.ssrcIds[0]===o.ssrcId),d={semantic:"SIM",ssrcIds:[o.ssrcId]};for(let u=1;u<r;u++)e.attributes.ssrcs.push({ssrcId:o.ssrcId+u,attributes:Vt(o.attributes)}),d.ssrcIds.push(o.ssrcId+u),a&&(e.attributes.ssrcs.push({ssrcId:a.ssrcIds[1]+u,attributes:Vt(o.attributes)}),e.attributes.ssrcGroups.push({semantic:"FID",ssrcIds:[o.ssrcId+u,a.ssrcIds[1]+u]}));e.attributes.ssrcGroups.unshift(d)}async function CO(e,t,n,r,o){const a=new RTCPeerConnection;a.addTransceiver("video",{direction:"sendonly"}),a.addTransceiver("audio",{direction:"sendonly"}),a.addTransceiver("video",{direction:"recvonly"}),a.addTransceiver("audio",{direction:"recvonly"});const d=(await a.createOffer()).sdp,u=kE(d,e,t,n,r,o,"sendonly"),h=kE(d,e,t,n,r,o,"recvonly"),m={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},f={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},E={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]};if(Fu(u,h,"videoExtensions",m,f,E),Fu(u,h,"videoCodecs",m,f,E),Fu(u,h,"audioExtensions",m,f,E),Fu(u,h,"audioCodecs",m,f,E),k("RAISE_H264_BASELINE_PRIORITY")){const T=E.videoCodecs.findIndex(R=>{var A,O;return((A=R.rtpMap)===null||A===void 0?void 0:A.encodingName.toLocaleLowerCase())==="h264"&&((O=R.fmtp)===null||O===void 0?void 0:O.parameters["profile-level-id"])==="42001f"});if(T!==-1){const R=E.videoCodecs.findIndex(A=>{var O;return((O=A.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"});if(R<T){v.debug("raising H264 baseline profile priority");const A=E.videoCodecs[T];E.videoCodecs.splice(T,1),E.videoCodecs.splice(R,0,A)}R!==-1&&(f.videoCodecs=f.videoCodecs.filter(A=>{var O,w;return!(((O=A.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((w=A.fmtp)===null||w===void 0?void 0:w.parameters["profile-level-id"])!=="42001f")})),R!==-1&&k("FILTER_SEND_H264_BASELINE")&&(m.videoCodecs=m.videoCodecs.filter(A=>{var O,w;return!(((O=A.rtpMap)===null||O===void 0?void 0:O.encodingName.toLocaleLowerCase())==="h264"&&((w=A.fmtp)===null||w===void 0?void 0:w.parameters["profile-level-id"])!=="42001f")}))}}try{a.close()}catch{}return{send:m,recv:f,sendrecv:E}}function Fu(e,t,n,r,o,a){if(n==="videoExtensions"||n==="audioExtensions"){const d=[];return e[n].forEach(u=>{t[n].some((h,m)=>{if(u.entry===h.entry&&u.extensionName===h.extensionName)return d.push(m),!0})?a[n].push(u):r[n].push(u)}),void t[n].forEach((u,h)=>{d.indexOf(h)===-1&&o[n].push(u)})}if(n==="videoCodecs"||n==="audioCodecs"){const d=[];return e[n].forEach(u=>{t[n].some((h,m)=>{if(u.payloadType===h.payloadType&&JSON.stringify(u)===JSON.stringify(h))return d.push(m),!0})?a[n].push(u):r[n].push(u)}),void t[n].forEach((u,h)=>{d.indexOf(h)===-1&&o[n].push(u)})}}function xE(e){const{send:t,recv:n,sendrecv:r}=e;if(!r){if(!t||!n)throw new Error("cannot merge rtp capabilities because one of send or recv is empty!");return{send:t,recv:n}}let o,a;return t?(o={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},o.audioCodecs=[...t.audioCodecs,...r.audioCodecs],o.videoCodecs=[...t.videoCodecs,...r.videoCodecs],o.audioExtensions=[...t.audioExtensions,...r.audioExtensions],o.videoExtensions=[...t.videoExtensions,...r.videoExtensions]):o=r,n?(a={audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},a.audioCodecs=[...n.audioCodecs,...r.audioCodecs],a.videoCodecs=[...n.videoCodecs,...r.videoCodecs],a.audioExtensions=[...n.audioExtensions,...r.audioExtensions],a.videoExtensions=[...n.videoExtensions,...r.videoExtensions]):a=r,{send:o,recv:a}}function Zo(e){e.media.mediaType==="audio"&&e.attributes.payloads.filter(t=>{var n;return((n=t.rtpMap)===null||n===void 0?void 0:n.encodingName.toLowerCase())==="opus"}).forEach(t=>{t.fmtp||(t.fmtp={parameters:{}}),t.fmtp.parameters.stereo="1",t.fmtp.parameters["sprop-stereo"]="1"})}function IO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function AO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?IO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):IO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}(function(e,t){e.exports=(()=>{var n={8:(a,d,u)=>{u.r(d),u.d(d,{Parser:()=>ct,Printer:()=>or,parse:()=>Ce,print:()=>We});const h=`
`,m="".concat("\r").concat(h),f=" ";let E;function T(te){return te>="0"&&te<="9"}function R(te){return te>="!"&&te<="~"}function A(te){return R(te)||te>=""&&te<="ÿ"}function O(te){return te==="!"||te>="#"&&te<="'"||te>="*"&&te<="+"||te>="-"&&te<="."||te>="0"&&te<="9"||te>="A"&&te<="Z"||te>="^"&&te<="~"}function w(te){return te>="1"&&te<="9"}function x(te){return te>="A"&&te<="Z"||te>="a"&&te<="z"}function V(te){return te==="d"||te==="h"||te==="m"||te==="s"}function X(te){return te>""&&te<"	"||te>"\v"&&te<"\f"||te>""&&te<"ÿ"}function le(te){return x(te)||T(te)||te==="+"||te==="/"}function $(te){return T(te)||x(te)||te==="+"||te==="/"||te==="-"||te==="_"}function ee(te){return x(te)||T(te)||te==="+"||te==="/"}function q(te,S){var N=Object.keys(te);if(Object.getOwnPropertySymbols){var D=Object.getOwnPropertySymbols(te);S&&(D=D.filter(function(z){return Object.getOwnPropertyDescriptor(te,z).enumerable})),N.push.apply(N,D)}return N}function re(te){for(var S=1;S<arguments.length;S++){var N=arguments[S]!=null?arguments[S]:{};S%2?q(Object(N),!0).forEach(function(D){ze(te,D,N[D])}):Object.getOwnPropertyDescriptors?Object.defineProperties(te,Object.getOwnPropertyDescriptors(N)):q(Object(N)).forEach(function(D){Object.defineProperty(te,D,Object.getOwnPropertyDescriptor(N,D))})}return te}function ze(te,S,N){return S in te?Object.defineProperty(te,S,{value:N,enumerable:!0,configurable:!0,writable:!0}):te[S]=N,te}(function(te){te.VERSION="v",te.ORIGIN="o",te.SESSION_NAME="s",te.INFORMATION="i",te.URI="u",te.EMAIL="e",te.PHONE="p",te.CONNECTION="c",te.BANDWIDTH="b",te.TIME="t",te.REPEAT="r",te.ZONE_ADJUSTMENTS="z",te.KEY="k",te.ATTRIBUTE="a",te.MEDIA="m"})(E||(E={}));class Se{consumeText(S,N){let D=N;for(;D<S.length;){const z=S[D];if(z==="\0"||z==="\r"||z===h)break;D+=1}if(D-N==0)throw new Error("Invalid text, at ".concat(S));return D}consumeUnicastAddress(S,N,D){return this.consumeTill(S,N,f)}consumeOneOrMore(S,N,D){let z=N;for(;D(S[z]);)z++;if(z-N==0)throw new Error("Invalid rule at ".concat(N,"."));return z}consumeSpace(S,N){if(S[N]===f)return N+1;throw new Error("Invalid space at ".concat(N,"."))}consumeIP4Address(S,N){let D=N;for(let z=0;z<4;z++)if(D=this.consumeDecimalUChar(S,D),z!==3){if(S[D]!==".")throw new Error("Invalid IP4 address.");D++}return D}consumeDecimalUChar(S,N){let D=N;for(let Oe=0;Oe<3&&T(S[D]);Oe++,D++);if(D-N==0)throw new Error("Invalid decimal uchar.");const z=parseInt(S.slice(N,D));if(z>=0&&z<=255)return D;throw new Error("Invalid decimal uchar")}consumeIP6Address(S,N){let D=this.consumeHexpart(S,N);return S[D]===":"&&(D+=1,D=this.consumeIP4Address(S,D)),D}consumeHexpart(S,N){let D=N;if(S[D]===":"&&S[D+1]===":"){D+=2;try{D=this.consumeHexseq(S,D)}catch{}return D}if(D=this.consumeHexseq(S,D),S[D]===":"&&S[D+1]===":"){D+=2;try{D=this.consumeHexseq(S,D)}catch{}return D}return D}consumeHexseq(S,N){let D=N;for(;D=this.consumeHex4(S,D),S[D]===":"&&S[D+1]!==":";)D+=1;return D}consumeHex4(S,N){let D=0;for(;D<4;D++)if(!((z=S[N+D])>="0"&&z<="9"||z>="a"&&z<="f"||z>="A"&&z<="F")){if(D===0)throw new Error("Invalid hex 4");break}var z;return N+D}consumeFQDN(S,N){let D=N;for(;T(S[D])||x(S[D])||S[D]==="-"||S[D]===".";)D+=1;if(D-N<4)throw new Error("Invalid FQDN");return D}consumeExtnAddr(S,N){return this.consumeOneOrMore(S,N,A)}consumeMulticastAddress(S,N,D){switch(D){case"IP4":case"ip4":return this.consumeIP4MulticastAddress(S,N);case"IP6":case"ip6":return this.consumeIP6MulticastAddress(S,N);default:try{return this.consumeFQDN(S,N)}catch{return this.consumeExtnAddr(S,N)}}}consumeIP6MulticastAddress(S,N){const D=this.consumeHexpart(S,N);return S[D]==="/"?this.consumeInteger(S,D+1):D}consumeIP4MulticastAddress(S,N){let D=N+3;const z=S.slice(N,D),Oe=parseInt(z);if(Oe<224||Oe>239)throw new Error("Invalid IP4 multicast address, IPv4 multicast addresses may be in the range 224.0.0.0 to 239.255.255.255.");for(let dt=0;dt<3;dt++){if(S[D]!==".")throw new Error("Invalid IP4 multicast address.");D+=1,D=this.consumeDecimalUChar(S,D)}return S[D]==="/"&&(D+=1),D=this.consumeTTL(S,D),S[D]==="/"&&(D=this.consumeInteger(S,D)),D}consumeInteger(S,N){if(!w(S[N]))throw new Error("Invalid integer.");for(N+=1;T(S[N]);)N+=1;return N}consumeTTL(S,N){if(S[N]==="0")return N+1;if(!w(S[N]))throw new Error("Invalid TTL.");N+=1;for(let D=0;D<2&&T(S[N]);D++)N+=1;return N}consumeToken(S,N){return this.consumeOneOrMore(S,N,O)}consumeTime(S,N){let D=N;if(S[D]==="0")return D+1;for(w(S[D])&&(D+=1);T(S[D]);)D++;if(D-N<10)throw new Error("Invalid time");return D}consumeAddress(S,N){return this.consumeTill(S,N,f)}consumeTypedTime(S,N){let D=N;return D=this.consumeOneOrMore(S,D,T),V(S[D])?D+1:D}consumeRepeatInterval(S,N){if(!w(S[N]))throw new Error("Invalid repeat interval");for(N+=1;T(S[N]);)N+=1;return V(S[N])&&(N+=1),N}consumePort(S,N){return this.consumeOneOrMore(S,N,T)}consume(S,N,D){for(let z=0;z<D.length;z++){if(N+z>=S.length)throw new Error("consume exceeding value length");if(S[N+z]!==D[z])throw new Error("consume ".concat(D," failed at ").concat(z))}return N+D.length}consumeTill(S,N,D){let z=N;for(;z<S.length&&(typeof D!="string"||S[z]!==D)&&(typeof D!="function"||!D(S[z]));)z++;return z}}class ct extends Se{constructor(){super(),ze(this,"records",[]),ze(this,"currentLine",0)}parse(S){const N=this.probeEOL(S);this.records=S.split(N).filter(Yn=>!!Yn.trim()).map(this.parseLine),this.currentLine=0;const D=this.parseVersion(),z=this.parseOrigin(),Oe=this.parseSessionName(),dt=this.parseInformation(),hn=this.parseUri(),mi=this.parseEmail(),os=this.parsePhone(),Zr=this.parseConnection(),ss=this.parseBandWidth(),rc=this.parseTimeFields(),Ct=this.parseKey(),Bt=this.parseSessionAttribute(),ot=this.parseMediaDescription();if(this.currentLine!==this.records.length)throw new Error("parsing failed, non exhaustive sdp lines.");return{version:D,origin:z,sessionName:Oe,information:dt,uri:hn,emails:mi,phones:os,connection:Zr,bandwidths:ss,timeFields:rc,key:Ct,attributes:Bt,mediaDescriptions:ot}}getCurrentRecord(){const S=this.records[this.currentLine];if(!S)throw new Error("Record doesn't exit.");return S}probeEOL(S){for(let N=0;N<S.length;N++)if(S[N]===h)return S[N-1]==="\r"?m:h;throw new Error("Invalid newline character.")}parseLine(S,N){if(S.length<2)throw new Error("Invalid sdp line, sdp line should be of form <type>=<value>.");const D=S[0];if(S[1]!=="=")throw new Error('Invalid sdp line, <type> should be a single character followed by an "=" sign.');return{type:D,value:S.slice(2),line:N,cur:0}}parseSessionAttribute(){const S=new Pt;for(;this.currentLine<this.records.length;){const N=this.getCurrentRecord();if(N.type!==E.ATTRIBUTE)break;const D={attField:this.extractOneOrMore(N,z=>O(z)&&z!==":"),_cur:0};N.value[N.cur]===":"&&(N.cur+=1,D.attValue=this.extractOneOrMore(N,X)),S.parse(D),this.currentLine++}return S.digest()}parseMediaAttributes(S){const N=new un(S);for(;this.currentLine<this.records.length;){const D=this.getCurrentRecord();if(D.type!==E.ATTRIBUTE)break;const z={attField:this.extractOneOrMore(D,Oe=>O(Oe)&&Oe!==":"),_cur:0};D.value[D.cur]===":"&&(D.cur+=1,z.attValue=this.extractOneOrMore(D,X)),N.parse(z),this.currentLine++}return N.digest()}parseKey(){const S=this.getCurrentRecord();if(S.type===E.KEY){if(S.value==="prompt"||S.value==="clear:"||S.value==="base64:"||S.value==="uri:")return S.value;throw this.currentLine++,new Error("Invalid key.")}}parseZone(){const S=this.getCurrentRecord();if(S.type===E.ZONE_ADJUSTMENTS){const N=[];for(;;)try{const D=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);let z=!1;S.value[S.cur]==="-"&&(z=!0,S.cur+=1);const Oe=this.extract(S,this.consumeTypedTime);N.push({time:D,typedTime:Oe,back:z})}catch{break}if(N.length===0)throw new Error("Invalid zone adjustments");return this.currentLine++,N}return[]}parseRepeat(){const S=[];for(;;){const N=this.getCurrentRecord();if(N.type!==E.REPEAT)break;{const D=this.extract(N,this.consumeRepeatInterval),z=this.parseTypedTime(N);S.push({repeatInterval:D,typedTimes:z}),this.currentLine++}}return S}parseTypedTime(S){const N=[];for(;;)try{this.consumeSpaceForRecord(S),N.push(this.extract(S,this.consumeTypedTime))}catch{break}if(N.length===0)throw new Error("Invalid typed time.");return N}parseTime(){const S=this.getCurrentRecord(),N=this.extract(S,this.consumeTime);this.consumeSpaceForRecord(S);const D=this.extract(S,this.consumeTime);return this.currentLine++,{startTime:N,stopTime:D}}parseBandWidth(){const S=[];for(;this.currentLine<this.records.length;){const N=this.getCurrentRecord();if(N.type!==E.BANDWIDTH)break;{const D=this.extractOneOrMore(N,O);if(N.value[N.cur]!==":")throw new Error("Invalid bandwidth field.");N.cur++;const z=this.extractOneOrMore(N,T);S.push({bwtype:D,bandwidth:z}),this.currentLine++}}return S}parseVersion(){const S=this.getCurrentRecord();if(S.type!==E.VERSION)throw new Error("first sdp record must be version");const N=S.value.slice(0,this.consumeOneOrMore(S.value,0,T));if(N.length!==S.value.length)throw new Error('invalid proto version, "v='.concat(S.value,'"'));return this.currentLine++,N}parseOrigin(){const S=this.getCurrentRecord();if(S.type!==E.ORIGIN)throw new Error("second line of sdp must be origin");const N=this.extractOneOrMore(S,A);this.consumeSpaceForRecord(S);const D=this.extractOneOrMore(S,T);this.consumeSpaceForRecord(S);const z=this.extractOneOrMore(S,T);this.consumeSpaceForRecord(S);const Oe=this.extractOneOrMore(S,O);this.consumeSpaceForRecord(S);const dt=this.extractOneOrMore(S,O);this.consumeSpaceForRecord(S);const hn=this.extract(S,this.consumeUnicastAddress);return this.currentLine++,{username:N,sessId:D,sessVersion:z,nettype:Oe,addrtype:dt,unicastAddress:hn}}parseSessionName(){const S=this.getCurrentRecord();if(S.type===E.SESSION_NAME){const N=this.extract(S,this.consumeText);return this.currentLine++,N}}parseInformation(){const S=this.getCurrentRecord();if(S.type!==E.INFORMATION)return;const N=this.extract(S,this.consumeText);return this.currentLine++,N}parseUri(){const S=this.getCurrentRecord();if(S.type===E.URI)return this.currentLine++,S.value}parseEmail(){const S=[];for(;;){const N=this.getCurrentRecord();if(N.type!==E.EMAIL)break;S.push(N.value),this.currentLine++}return S}parsePhone(){const S=[];for(;;){const N=this.getCurrentRecord();if(N.type!==E.PHONE)break;S.push(N.value),this.currentLine++}return S}parseConnection(){const S=this.getCurrentRecord();if(S.type===E.CONNECTION){const N=this.extractOneOrMore(S,O);this.consumeSpaceForRecord(S);const D=this.extractOneOrMore(S,O);this.consumeSpaceForRecord(S);const z=this.extract(S,this.consumeAddress);return this.currentLine++,{nettype:N,addrtype:D,address:z}}}parseMedia(){const S=this.getCurrentRecord(),N=this.extract(S,this.consumeToken);this.consumeSpaceForRecord(S);let D=this.extract(S,this.consumePort);S.value[S.cur]==="/"&&(S.cur+=1,D+=this.extract(S,this.consumeInteger)),this.consumeSpaceForRecord(S);const z=[];for(z.push(this.extract(S,this.consumeToken));S.value[S.cur]==="/";)S.cur+=1,z.push(this.extract(S,this.consumeToken));if(z.length===0)throw new Error("Invalid proto");const Oe=this.parseFmt(S);return this.currentLine++,{mediaType:N,port:D,protos:z,fmts:Oe}}parseTimeFields(){const S=[];for(;this.getCurrentRecord().type===E.TIME;){const N=this.parseTime(),D=this.parseRepeat(),z=this.parseZone();S.push({time:N,repeats:D,zones:z})}return S}parseMediaDescription(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.MEDIA;){const N=this.parseMedia(),D=this.parseInformation(),z=this.parseConnections(),Oe=this.parseBandWidth(),dt=this.parseKey(),hn=this.parseMediaAttributes(N);S.push({media:N,information:D,connections:z,bandwidths:Oe,key:dt,attributes:hn})}return S}parseConnections(){const S=[];for(;this.currentLine<this.records.length&&this.getCurrentRecord().type===E.CONNECTION;)S.push(this.parseConnection());return S}parseFmt(S){const N=[];for(;;)try{this.consumeSpaceForRecord(S),N.push(this.extract(S,this.consumeToken))}catch{break}if(N.length===0)throw new Error("Invalid fmts");return N}extract(S,N,...D){const z=N.call(this,S.value,S.cur,...D),Oe=S.value.slice(S.cur,z);return S.cur=z,Oe}extractOneOrMore(S,N){const D=this.consumeOneOrMore(S.value,S.cur,N),z=S.value.slice(S.cur,D);return S.cur=D,z}consumeSpaceForRecord(S){if(S.value[S.cur]!==f)throw new Error("Invalid space at ".concat(S.cur,"."));S.cur+=1}}class tt extends Se{constructor(...S){super(...S),ze(this,"attributes",void 0),ze(this,"digested",!1)}extractOneOrMore(S,N,D){const z=this.consumeOneOrMore(S.attValue,S._cur,N),Oe=S.attValue.slice(S._cur,z),[dt,hn]=D||[];if(typeof dt=="number"&&Oe.length<dt)throw new Error("error in length, should be more or equal than ".concat(dt," characters."));if(typeof hn=="number"&&Oe.length>hn)throw new Error("error in length, should be less or equal than ".concat(hn," characters."));return S._cur=z,Oe}consumeAttributeSpace(S){if(S.attValue[S._cur]!==f)throw new Error("Invalid space at ".concat(S._cur,"."));S._cur+=1}extract(S,N,...D){if(!S.attValue)throw new Error("Nothing to extract from attValue.");const z=N.call(this,S.attValue,S._cur,...D),Oe=S.attValue.slice(S._cur,z);return S._cur=z,Oe}atEnd(S){if(!S.attValue)throw new Error;return S._cur>=S.attValue.length}peekChar(S){if(!S.attValue)throw new Error;return S.attValue[S._cur]}peek(S,N){if(!S.attValue)throw new Error;for(let D=0;D<N.length;D++)if(N[D]!==S.attValue[S._cur+D])return!1;return!0}parseIceUfrag(S){if(this.attributes.iceUfrag)throw new Error("Invalid ice-ufrag, should be only a single line if 'a=ice-ufrag'");this.attributes.iceUfrag=this.extractOneOrMore(S,le,[4,256])}parseIcePwd(S){if(this.attributes.icePwd)throw new Error("Invalid ice-pwd, should be only a single line if 'a=ice-pwd'");this.attributes.icePwd=this.extractOneOrMore(S,le,[22,256])}parseIceOptions(S){if(this.attributes.iceOptions)throw new Error("Invalid ice-options, should be only one 'ice-options' line");const N=[];for(;!this.atEnd(S);){N.push(this.extractOneOrMore(S,le));try{this.consumeAttributeSpace(S)}catch(D){if(this.atEnd(S))break;throw D}}this.attributes.iceOptions=N}parseFingerprint(S){const N=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill);this.attributes.fingerprints.push({hashFunction:N,fingerprint:D})}parseExtmap(S){const N=this.extractOneOrMore(S,T);let D;this.peekChar(S)==="/"&&(this.extract(S,this.consume,"/"),D=this.extract(S,this.consumeToken)),this.consumeAttributeSpace(S);const z=this.extract(S,this.consumeTill,f),Oe=re(re({entry:parseInt(N,10)},D&&{direction:D}),{},{extensionName:z});this.peekChar(S)===f&&(this.consumeAttributeSpace(S),Oe.extensionAttributes=this.extract(S,this.consumeTill)),this.attributes.extmaps.push(Oe)}parseSetup(S){if(this.attributes.setup)throw new Error("must only be one single 'a=setup' line.");const N=this.extract(S,this.consumeTill);if(N!=="active"&&N!=="passive"&&N!=="actpass"&&N!=="holdconn")throw new Error("role must be one of 'active', 'passive', 'actpass', 'holdconn'.");this.attributes.setup=N}}class Pt extends tt{constructor(...S){super(...S),ze(this,"attributes",{unrecognized:[],groups:[],extmaps:[],fingerprints:[],identities:[]})}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"group":this.parseGroup(S);break;case"ice-lite":this.parseIceLite();break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"fingerprint":this.parseFingerprint(S);break;case"setup":this.parseSetup(S);break;case"tls-id":this.parseTlsId(S);break;case"identity":this.parseIdentity(S);break;case"extmap":this.parseExtmap(S);break;case"msid-semantic":this.parseMsidSemantic(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(N){throw console.error("parsing session attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),N}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}digest(){return this.digested=!0,this.attributes}parseGroup(S){const N=this.extract(S,this.consumeToken),D=[];for(;!this.atEnd(S)&&this.peekChar(S)===f;)this.consumeAttributeSpace(S),D.push(this.extract(S,this.consumeToken));this.attributes.groups.push({semantic:N,identificationTag:D})}parseIceLite(){if(this.attributes.iceLite)throw new Error("Invalid ice-lite, should be only a single line of 'a=ice-lite'");this.attributes.iceLite=!0}parseTlsId(S){if(this.attributes.tlsId)throw new Error("must be only one tld-id line");this.attributes.tlsId=this.extractOneOrMore(S,$)}parseIdentity(S){const N=this.extractOneOrMore(S,ee),D=[];for(;!this.atEnd(S)&&this.peekChar(S)===f;){this.consumeAttributeSpace(S);const z=this.extract(S,this.consumeToken);this.extract(S,this.consume,"=");const Oe=this.extractOneOrMore(S,dt=>dt!==f&&X(dt));D.push({name:z,value:Oe})}this.attributes.identities.push({assertionValue:N,extensions:D})}parseMsidSemantic(S){this.peekChar(S)===f&&this.consumeAttributeSpace(S);const N={semantic:this.extract(S,this.consumeToken),identifierList:[]};for(;;){try{this.consumeAttributeSpace(S)}catch{break}if(this.peekChar(S)==="*"){this.extract(S,this.consume,"*"),N.applyForAll=!0;break}{const D=this.extract(S,this.consumeTill,f);N.identifierList.push(D)}}this.attributes.msidSemantic=N}}class un extends tt{constructor(S){super(),ze(this,"attributes",void 0),S.protos.indexOf("RTP")!==-1||S.protos.indexOf("rtp"),this.attributes={unrecognized:[],candidates:[],extmaps:[],fingerprints:[],imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:[],ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:[]}}parse(S){if(this.digested)throw new Error("already digested");try{switch(S.attField){case"extmap":this.parseExtmap(S);break;case"setup":this.parseSetup(S);break;case"ice-ufrag":this.parseIceUfrag(S);break;case"ice-pwd":this.parseIcePwd(S);break;case"ice-options":this.parseIceOptions(S);break;case"candidate":this.parseCandidate(S);break;case"remote-candidate":this.parseRemoteCandidate(S);break;case"end-of-candidates":this.parseEndOfCandidates();break;case"fingerprint":this.parseFingerprint(S);break;case"rtpmap":this.parseRtpmap(S);break;case"ptime":this.parsePtime(S);break;case"maxptime":this.parseMaxPtime(S);break;case"sendrecv":case"recvonly":case"sendonly":case"inactive":this.parseDirection(S);break;case"ssrc":this.parseSSRC(S);break;case"fmtp":this.parseFmtp(S);break;case"rtcp-fb":this.parseRtcpFb(S);break;case"rtcp-mux":this.parseRTCPMux();break;case"rtcp-mux-only":this.parseRTCPMuxOnly();break;case"rtcp-rsize":this.parseRTCPRsize();break;case"rtcp":this.parseRTCP(S);break;case"mid":this.parseMid(S);break;case"msid":this.parseMsid(S);break;case"imageattr":this.parseImageAttr(S);break;case"rid":this.parseRid(S);break;case"simulcast":this.parseSimulcast(S);break;case"sctp-port":this.parseSctpPort(S);break;case"max-message-size":this.parseMaxMessageSize(S);break;case"ssrc-group":this.parseSSRCGroup(S);break;default:S.ignored=!0,this.attributes.unrecognized.push(S)}}catch(N){throw console.error("parsing media attribute ".concat(S.attField,' error, "a=').concat(S.attField,":").concat(S.attValue,'"')),N}if(!S.ignored&&S.attValue&&!this.atEnd(S))throw new Error("attribute parsing error")}parseCandidate(S){const N=this.extractOneOrMore(S,le,[1,32]);this.consumeAttributeSpace(S);const D=this.extractOneOrMore(S,T,[1,5]);this.consumeAttributeSpace(S);const z=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const Oe=this.extractOneOrMore(S,T,[1,10]);this.consumeAttributeSpace(S);const dt=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const hn=this.extract(S,this.consumePort);this.consumeAttributeSpace(S),this.extract(S,this.consume,"typ"),this.consumeAttributeSpace(S);const mi={foundation:N,componentId:D,transport:z,priority:Oe,connectionAddress:dt,port:hn,type:this.extract(S,this.consumeToken),extension:{}};for(this.peek(S," raddr")&&(this.extract(S,this.consume," raddr"),this.consumeAttributeSpace(S),mi.relAddr=this.extract(S,this.consumeAddress)),this.peek(S," rport")&&(this.extract(S,this.consume," rport"),this.consumeAttributeSpace(S),mi.relPort=this.extract(S,this.consumePort));this.peekChar(S)===f;){this.consumeAttributeSpace(S);const os=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S),mi.extension[os]=this.extractOneOrMore(S,R)}this.attributes.candidates.push(mi)}parseRemoteCandidate(S){const N=[];for(;;){const D=this.extractOneOrMore(S,T,[1,5]);this.consumeAttributeSpace(S);const z=this.extract(S,this.consumeAddress);this.consumeAttributeSpace(S);const Oe=this.extract(S,this.consumePort);N.push({componentId:D,connectionAddress:z,port:Oe});try{this.consumeAttributeSpace(S)}catch{break}}this.attributes.remoteCandidatesList.push(N)}parseEndOfCandidates(){if(this.attributes.endOfCandidates)throw new Error("must be only one line of end-of-candidates");this.attributes.endOfCandidates=!0}parseRtpmap(S){const N=this.extract(S,this.consumeToken);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,"/");this.extract(S,this.consume,"/");const z={encodingName:D,clockRate:this.extractOneOrMore(S,T)};this.atEnd(S)||this.peekChar(S)!=="/"||(this.extract(S,this.consume,"/"),z.encodingParameters=parseInt(this.extract(S,this.consumeTill),10));const Oe=this.attributes.payloads.find(dt=>dt.payloadType===parseInt(N,10));Oe?Oe.rtpMap=z:this.attributes.payloads.push({payloadType:parseInt(N,10),rtpMap:z,rtcpFeedbacks:[]})}parsePtime(S){if(this.attributes.ptime)throw new Error("must be only one line of ptime");this.attributes.ptime=this.extract(S,this.consumeTill)}parseMaxPtime(S){if(this.attributes.maxPtime)throw new Error("must be only one line of ptime");this.attributes.maxPtime=this.extract(S,this.consumeTill)}parseDirection(S){if(this.attributes.direction)throw new Error("must be only one line of direction info");this.attributes.direction=S.attField}parseSSRC(S){const N=this.extractOneOrMore(S,T);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,":");let z;this.peekChar(S)===":"&&(this.extract(S,this.consume,":"),z=this.extract(S,this.consumeTill));const Oe=this.attributes.ssrcs.find(dt=>dt.ssrcId===parseInt(N,10));Oe?Oe.attributes[D]=z:this.attributes.ssrcs.push({ssrcId:parseInt(N,10),attributes:{[D]:z}})}parseFmtp(S){const N=this.extract(S,this.consumeTill,f);this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill),z={};D.split(";").forEach(dt=>{let[hn,mi]=dt.split("=");hn=hn.trim();const os=typeof mi=="string"?mi.trim():null;typeof hn=="string"&&hn.length>0&&(z[hn]=os)});const Oe=this.attributes.payloads.find(dt=>dt.payloadType===parseInt(N,10));Oe?Oe.fmtp={parameters:z}:this.attributes.payloads.push({payloadType:parseInt(N,10),rtcpFeedbacks:[],fmtp:{parameters:z}})}parseFmtParameters(S){const N={},D=this.extract(S,this.consumeTill,"=");S._cur++;const z=this.extract(S,this.consumeTill,";");for(N[D]=z;S.attValue[S._cur]===";";){const Oe=this.extract(S,this.consumeTill,"=");S._cur++;const dt=this.extract(S,this.consumeTill,";");N[Oe]=dt}return N}parseRtcpFb(S){let N="";N=this.peekChar(S)==="*"?this.extract(S,this.consume,"*"):this.extract(S,this.consumeTill,f),this.consumeAttributeSpace(S);const D=this.extract(S,this.consumeTill,f);let z;switch(D){case"trr-int":z={type:D,interval:this.extract(S,this.consumeTill)};break;case"ack":case"nack":default:{const Oe={type:D};this.peekChar(S)===f&&(this.consumeAttributeSpace(S),Oe.parameter=this.extract(S,this.consumeToken),this.peekChar(S)===f&&(Oe.additional=this.extract(S,this.consumeTill))),z=Oe}}if(N==="*")this.attributes.rtcpFeedbackWildcards.push(z);else{const Oe=this.attributes.payloads.find(dt=>dt.payloadType===parseInt(N,10));Oe?Oe.rtcpFeedbacks.push(z):this.attributes.payloads.push({payloadType:parseInt(N,10),rtcpFeedbacks:[z]})}}parseRTCPMux(){if(this.attributes.rtcpMux)throw new Error("must be single line of rtcp-mux");this.attributes.rtcpMux=!0}parseRTCPMuxOnly(){if(this.attributes.rtcpMuxOnly)throw new Error("must be single line of rtcp-only");this.attributes.rtcpMuxOnly=!0}parseRTCPRsize(){if(this.attributes.rtcpRsize)throw new Error("must be single line of rtcp-rsize");this.attributes.rtcpRsize=!0}parseRTCP(S){if(this.attributes.rtcp)throw new Error("must be single line of rtcp");const N={port:this.extract(S,this.consumePort)};this.peekChar(S)===f&&(this.consumeAttributeSpace(S),N.netType=this.extractOneOrMore(S,O),this.consumeAttributeSpace(S),N.addressType=this.extractOneOrMore(S,O),this.consumeAttributeSpace(S),N.address=this.extract(S,this.consumeAddress)),this.attributes.rtcp=N}parseMsid(S){const N={id:this.extractOneOrMore(S,O,[1,64])};this.peekChar(S)===f&&(this.consumeAttributeSpace(S),N.appdata=this.extractOneOrMore(S,O,[1,64])),this.attributes.msids.push(N)}parseImageAttr(S){this.attributes.imageattr.push(S.attValue)}parseRid(S){const N=this.extractOneOrMore(S,z=>x(z)||T(z)||z==="_"||z==="-");this.consumeAttributeSpace(S);const D={id:N,direction:this.extract(S,this.consumeToken),params:[]};if(this.peekChar(S)===f){if(this.consumeAttributeSpace(S),this.peek(S,"pt=")){this.extract(S,this.consume,"pt=");const z=[];for(;;){const Oe=this.extract(S,this.consumeToken);z.push(Oe);try{this.extract(S,this.consume,",")}catch{break}}D.payloads=z,this.peekChar(S)===f&&this.extract(S,this.consume,f)}for(;;){const z=this.extract(S,this.consumeToken);switch(z){case"depend":{const Oe={type:z,rids:this.extract(S,this.consume,"=").split(",")};D.params.push(Oe);break}case"max-width":case"height-width":case"max-fps":case"max-fs":case"max-br":case"max-pps":case"max-bpp":default:{const Oe={type:z};this.peekChar(S)==="="&&(this.extract(S,this.consume,"="),Oe.val=this.extract(S,this.consumeTill,";")),D.params.push(Oe)}}try{this.extract(S,this.consume,";")}catch{break}}}this.attributes.rids.push(D)}parseSimulcast(S){if(this.attributes.simulcast)throw new Error("must be single line of simulcast");this.attributes.simulcast=S.attValue,this.extract(S,this.consumeTill)}parseSctpPort(S){this.attributes.sctpPort=this.extractOneOrMore(S,T,[1,5])}parseMaxMessageSize(S){this.attributes.maxMessageSize=this.extractOneOrMore(S,T,[1,void 0])}digest(){return this.digested=!0,this.attributes}parseMid(S){this.attributes.mid=this.extract(S,this.consumeToken)}parseSSRCGroup(S){const N=this.extract(S,this.consumeToken),D=[];for(;;)try{this.consumeAttributeSpace(S);const z=this.extract(S,this.consumeInteger);D.push(parseInt(z,10))}catch{break}this.attributes.ssrcGroups.push({semantic:N,ssrcIds:D})}}function Ot(te,S,N){return S in te?Object.defineProperty(te,S,{value:N,enumerable:!0,configurable:!0,writable:!0}):te[S]=N,te}class or{constructor(){Ot(this,"eol",m)}print(S,N){let D="";return N&&(this.eol=N),D+=this.printVersion(S.version),D+=this.printOrigin(S.origin),D+=this.printSessionName(S.sessionName),D+=this.printInformation(S.information),D+=this.printUri(S.uri),D+=this.printEmail(S.emails),D+=this.printPhone(S.phones),D+=this.printConnection(S.connection),D+=this.printBandwidth(S.bandwidths),D+=this.printTimeFields(S.timeFields),D+=this.printKey(S.key),D+=this.printSessionAttributes(S.attributes),D+=this.printMediaDescription(S.mediaDescriptions),D}printVersion(S){return"v=".concat(S).concat(this.eol)}printOrigin(S){return"o=".concat(S.username," ").concat(S.sessId," ").concat(S.sessVersion," ").concat(S.nettype," ").concat(S.addrtype," ").concat(S.unicastAddress).concat(this.eol)}printSessionName(S){return S?"s=".concat(S).concat(this.eol):""}printInformation(S){return S?"i=".concat(S).concat(this.eol):""}printUri(S){return S?"u=".concat(S).concat(this.eol):""}printEmail(S){let N="";for(const D of S)N+="e=".concat(D).concat(this.eol);return N}printPhone(S){let N="";for(const D of S)N+="e=".concat(D).concat(this.eol);return N}printConnection(S){return S?"c=".concat(S.nettype," ").concat(S.addrtype," ").concat(S.address).concat(this.eol):""}printBandwidth(S){let N="";for(const D of S)N+="b=".concat(D.bwtype,":").concat(D.bandwidth).concat(this.eol);return N}printTimeFields(S){let N="";for(const D of S){N+="t=".concat(D.time.startTime," ").concat(D.time.startTime).concat(this.eol);for(const z of D.repeats)N+="r=".concat(z.repeatInterval," ").concat(z.typedTimes.join(" ")).concat(this.eol);D.zoneAdjustments&&(N+="z=",N+="z=".concat(D.zoneAdjustments.map(z=>"".concat(z.time," ").concat(z.back?"-":""," ").concat(z.typedTime)).join(" ")).concat(this.eol),N+=this.eol)}return N}printKey(S){return S?"k=".concat(S).concat(this.eol):""}printAttributes(S){let N="";for(const D of S)N+="a=".concat(D.attField).concat(D.attValue?":".concat(D.attValue):"").concat(this.eol);return N}printMediaDescription(S){let N="";for(const D of S)N+=this.printMedia(D.media),N+=this.printInformation(D.information),N+=this.printConnections(D.connections),N+=this.printBandwidth(D.bandwidths),N+=this.printKey(D.key),N+=this.printMediaAttributes(D);return N}printConnections(S){let N="";for(const D of S)N+=this.printConnection(D);return N}printMedia(S){return"m=".concat(S.mediaType," ").concat(S.port," ").concat(S.protos.join("/")," ").concat(S.fmts.join(" ")).concat(this.eol)}printSessionAttributes(S){return new Q(this.eol).print(S)}printMediaAttributes(S){return new ae(this.eol).print(S)}}class K{constructor(S){Ot(this,"eol",void 0),this.eol=S}printIceUfrag(S){return S===void 0?"":"a=ice-ufrag:".concat(S).concat(this.eol)}printIcePwd(S){return S===void 0?"":"a=ice-pwd:".concat(S).concat(this.eol)}printIceOptions(S){return S===void 0?"":"a=ice-options:".concat(S.join(f)).concat(this.eol)}printFingerprints(S){return S.length>0?S.map(N=>"a=fingerprint:".concat(N.hashFunction).concat(f).concat(N.fingerprint)).join(this.eol)+this.eol:""}printExtmap(S){return S.map(N=>"a=extmap:".concat(N.entry).concat(N.direction?"/".concat(N.direction):"").concat(f).concat(N.extensionName).concat(N.extensionAttributes?"".concat(f).concat(N.extensionAttributes):"").concat(this.eol)).join("")}printSetup(S){return S===void 0?"":"a=setup:".concat(S).concat(this.eol)}printUnrecognized(S){return S.map(N=>"a=".concat(N.attField).concat(N.attValue?":".concat(N.attValue):"").concat(this.eol)).join("")}}class Q extends K{print(S){let N="";return N+=this.printGroups(S.groups),N+=this.printMsidSemantic(S.msidSemantic),N+=this.printIceLite(S.iceLite),N+=this.printIceUfrag(S.iceUfrag),N+=this.printIcePwd(S.icePwd),N+=this.printIceOptions(S.iceOptions),N+=this.printFingerprints(S.fingerprints),N+=this.printSetup(S.setup),N+=this.printTlsId(S.tlsId),N+=this.printIdentity(S.identities),N+=this.printExtmap(S.extmaps),N+=this.printUnrecognized(S.unrecognized),N}printGroups(S){let N="";return S.length>0&&(N+=S.map(D=>"a=group:".concat(D.semantic).concat(D.identificationTag.map(z=>"".concat(f).concat(z)).join("")).concat(this.eol)).join("")),N}printIceLite(S){return S===void 0?"":"a=ice-lite"+this.eol}printTlsId(S){return S?"a=tls-id:".concat(S).concat(this.eol):""}printIdentity(S){return S.length===0?"":S.map(N=>"a=identity:".concat(N.assertionValue).concat(N.extensions.map(D=>"".concat(f).concat(D.name).concat(D.value?"=".concat(D.value):"")))).join(this.eol)+this.eol}printMsidSemantic(S){if(!S)return"";let N="a=msid-semantic:".concat(S.semantic);return S.applyForAll?N+="".concat(f,"*"):S.identifierList.length>0&&(N+=S.identifierList.map(D=>"".concat(f).concat(D))),N+this.eol}}class ae extends K{print(S){const N=S.attributes;let D="";return D+=this.printRTCP(N.rtcp),D+=this.printIceUfrag(N.iceUfrag),D+=this.printIcePwd(N.icePwd),D+=this.printIceOptions(N.iceOptions),D+=this.printCandidates(N.candidates),D+=this.printRemoteCandidatesList(N.remoteCandidatesList),D+=this.printEndOfCandidates(N.endOfCandidates),D+=this.printFingerprints(N.fingerprints),D+=this.printSetup(N.setup),D+=this.printMid(N.mid),D+=this.printExtmap(N.extmaps),D+=this.printRTPRelated(N),D+=this.printPtime(N.ptime),D+=this.printMaxPtime(N.maxPtime),D+=this.printDirection(N.direction),D+=this.printSSRCGroups(N.ssrcGroups),D+=this.printSSRC(N.ssrcs),D+=this.printRTCPMux(N.rtcpMux),D+=this.printRTCPMuxOnly(N.rtcpMuxOnly),D+=this.printRTCPRsize(N.rtcpRsize),D+=this.printMSId(N.msids),D+=this.printImageattr(N.imageattr),D+=this.printRid(N.rids),D+=this.printSimulcast(N.simulcast),D+=this.printSCTPPort(N.sctpPort),D+=this.printMaxMessageSize(N.maxMessageSize),D+=this.printUnrecognized(N.unrecognized),D}printCandidates(S){return S.map(N=>"a=candidate:".concat(N.foundation).concat(f).concat(N.componentId).concat(f).concat(N.transport).concat(f).concat(N.priority).concat(f).concat(N.connectionAddress).concat(f).concat(N.port).concat(f,"typ").concat(f).concat(N.type).concat(N.relAddr?"".concat(f,"raddr").concat(f).concat(N.relAddr):"").concat(N.relPort?"".concat(f,"rport").concat(f).concat(N.relPort):"").concat(Object.keys(N.extension).map(D=>"".concat(f).concat(D).concat(f).concat(N.extension[D])).join("")).concat(this.eol)).join("")}printRemoteCandidatesList(S){return S.map(N=>"a=remote-candidates:".concat(N.join(f)).concat(this.eol)).join("")}printEndOfCandidates(S){return S===void 0?"":"a=end-of-candidates"+this.eol}printRTPRelated(S){if(!S.payloads)return"";const N=S.payloads;let D="";D+=S.rtcpFeedbackWildcards.map(z=>this.printRTCPFeedback("*",z)).join("");for(const z of N)D+=this.printRtpMap(z.payloadType,z.rtpMap),D+=this.printFmtp(z.payloadType,z.fmtp),D+=z.rtcpFeedbacks.map(Oe=>this.printRTCPFeedback(z.payloadType,Oe)).join("");return D}printFmtp(S,N){if(!N)return"";const D=Object.keys(N.parameters);return D.length===1&&N.parameters[D[0]]===null?"a=fmtp:".concat(S).concat(f).concat(D[0]).concat(this.eol):"a=fmtp:".concat(S).concat(f).concat(Object.keys(N.parameters).map(z=>"".concat(z,"=").concat(N.parameters[z])).join(";")).concat(this.eol)}printRtpMap(S,N){return N?"a=rtpmap:".concat(S).concat(f).concat(N.encodingName,"/").concat(N.clockRate).concat(N.encodingParameters?"/".concat(N.encodingParameters):"").concat(this.eol):""}printRTCPFeedback(S,N){let D="a=rtcp-fb:".concat(S).concat(f),z=N;switch(z.type){case"trr-int":D+="ttr-int".concat(f).concat(z.interval);break;case"ack":case"nack":default:z=z,D+="".concat(z.type),z.parameter&&(D+="".concat(f).concat(z.parameter),z.additional&&(D+="".concat(f).concat(z.additional)))}return D+this.eol}printPtime(S){return S===void 0?"":"a=ptime:".concat(S).concat(this.eol)}printMaxPtime(S){return S===void 0?"":"a=maxptime:".concat(S).concat(this.eol)}printDirection(S){return S===void 0?"":"a=".concat(S).concat(this.eol)}printSSRC(S){return S.map(N=>Object.keys(N.attributes).map(D=>"a=ssrc:".concat(N.ssrcId.toString(10)).concat(f).concat(D).concat(N.attributes[D]?":".concat(N.attributes[D]):"").concat(this.eol)).join("")).join("")}printRTCPMux(S){return S===void 0?"":"a=rtcp-mux".concat(this.eol)}printRTCPMuxOnly(S){return S===void 0?"":"a=rtcp-mux-only".concat(this.eol)}printRTCPRsize(S){return S===void 0?"":"a=rtcp-rsize".concat(this.eol)}printRTCP(S){if(S===void 0)return"";let N="a=rtcp:".concat(S.port);return S.netType&&(N+="".concat(f).concat(S.netType)),S.addressType&&(N+="".concat(f).concat(S.addressType)),S.address&&(N+="".concat(f).concat(S.address)),N+this.eol}printMSId(S){return S.map(N=>"a=msid:".concat(N.id).concat(N.appdata?"".concat(f).concat(N.appdata):"").concat(this.eol)).join("")}printImageattr(S){return S.map(N=>"a=imageattr:".concat(N).concat(this.eol)).join("")}printRid(S){return S.map(N=>{let D="a=rid:".concat(N.id).concat(f).concat(N.direction);return N.payloads&&(D+="".concat(f,"pt=").concat(N.payloads.join(","))),N.params.length>0&&(D+="".concat(f).concat(N.params.map(z=>z.type==="depend"?"depend=".concat(z.rids.join(",")):"".concat(z.type,"=").concat(z.val)).join(";"))),D+this.eol}).join("")}printSimulcast(S){return S===void 0?"":"a=simulcast:".concat(S).concat(this.eol)}printSCTPPort(S){return S===void 0?"":"a=sctp-port:".concat(S).concat(this.eol)}printMaxMessageSize(S){return S===void 0?"":"a=max-message-size:".concat(S).concat(this.eol)}printMid(S){return S===void 0?"":"a=mid:".concat(S).concat(this.eol)}printSSRCGroups(S){return S.map(N=>"a=ssrc-group:".concat(N.semantic).concat(N.ssrcIds.map(D=>"".concat(f).concat(D.toString(10))).join("")).concat(this.eol)).join("")}}function Ce(te){return new ct().parse(te)}function We(te,S){return new or().print(te,S)}}},r={};function o(a){if(r[a])return r[a].exports;var d=r[a]={exports:{}};return n[a](d,d.exports,o),d.exports}return o.d=(a,d)=>{for(var u in d)o.o(d,u)&&!o.o(a,u)&&Object.defineProperty(a,u,{enumerable:!0,get:d[u]})},o.o=(a,d)=>Object.prototype.hasOwnProperty.call(a,d),o.r=a=>{typeof Symbol<"u"&&Symbol.toStringTag&&Object.defineProperty(a,Symbol.toStringTag,{value:"Module"}),Object.defineProperty(a,"__esModule",{value:!0})},o(8)})()})(jt);class vB{constructor(t){g(this,"sessionDesc",void 0),g(this,"localCapabilities",void 0),g(this,"rtpCapabilities",void 0),g(this,"candidates",void 0),g(this,"iceParameters",void 0),g(this,"dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),t=Vt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:u,sdkCodec:h,cname:m}=t,f=jt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE audio video
a=msid-semantic: WMS
a=ice-lite
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:audio
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendrecv
a=rtcp-mux
a=rtcp-rsize
a=mid:video
`);this.rtpCapabilities=a,this.candidates=o,this.iceParameters=n,this.dtlsParameters=r,this.setup=d,this.localCapabilities=u,this.cname=m;for(let E=0;E<f.mediaDescriptions.length;E++){const T=f.mediaDescriptions[E];T.attributes.iceUfrag=n.iceUfrag,T.attributes.icePwd=n.icePwd,T.attributes.fingerprints=r.fingerprints,T.attributes.candidates=o,T.attributes.setup=d,T.media.mediaType==="video"&&(T.media.fmts=a.videoCodecs.map(R=>R.payloadType.toString(10)),T.attributes.payloads=a.videoCodecs,T.attributes.extmaps=a.videoExtensions),T.media.mediaType==="audio"&&(T.media.fmts=a.audioCodecs.map(R=>R.payloadType.toString(10)),T.attributes.payloads=a.audioCodecs,T.attributes.extmaps=a.audioExtensions),f.mediaDescriptions[E]=this.mungMediaDesc(T)}this.sessionDesc=f,this.currentMidIndex=f.mediaDescriptions.length-1}toString(){return jt.exports.print(this.sessionDesc)}send(t,n,r){const{ssrcs:o,ssrcGroups:a}=Jr(n,this.cname),d=this.sessionDesc.mediaDescriptions.find(m=>t===be.VIDEO?m.media.mediaType==="video":m.media.mediaType==="audio"),u=o[0].attributes.label,h=o[0].attributes.mslabel;return d.attributes.ssrcs=d.attributes.ssrcs.concat(o),d.attributes.ssrcGroups=d.attributes.ssrcGroups.concat(a),{id:u,mslabel:h}}batchSend(t){return t.map(n=>{let{kind:r,ssrcMsg:o}=n;return this.send(r,o,void 0)})}stopSending(t){this.sessionDesc.mediaDescriptions.forEach(n=>{const r=[],o=[],a=[];n.attributes.ssrcs.forEach(d=>{t.includes(d.attributes.label||"")?a.push(d):r.push(d)}),n.attributes.ssrcGroups.forEach(d=>{a.map(u=>u.ssrcId).includes(d.ssrcIds[0])||o.push(d)}),n.attributes.ssrcs=r,n.attributes.ssrcGroups=o})}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}receive(t,n,r){t.forEach((o,a)=>{const d=o._mediaStreamTrack,u=this.sessionDesc.mediaDescriptions.findIndex(m=>m.attributes.mid===d.kind),h=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[u],o);this.sessionDesc.mediaDescriptions[u]=h})}stopReceiving(t){}updateCandidates(t){t===dn.TCP?this.candidates.forEach(n=>{this.candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this.candidates.push(AO(AO({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this.candidates=this.candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Vt(t),this.iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}mungRecvMediaDsec(t,n){const r=Vt(t);return Qa(r,n),UE(r,n),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}updateTrackLabel(t,n,r){const o=this.sessionDesc.mediaDescriptions.find(d=>t===be.VIDEO?d.attributes.mid==="video":d.attributes.mid==="audio");if(o){const d=o.attributes.ssrcs.find(u=>u.attributes.label===n);var a;d&&(d.attributes.label=r,(a=d.attributes.msid)===null||a===void 0||a.replace(n,r))}}mungMediaDesc(t){const n=Vt(t);return ME(n),function(r){const o=r.attributes.extmaps.find(a=>a.extensionName==="http://www.ietf.org/id/draft-holmer-rmcat-transport-wide-cc-extensions-01");o&&r.attributes.extmaps.splice(r.attributes.extmaps.indexOf(o),1),r.attributes.payloads.forEach(a=>{const d=a.rtcpFeedbacks.findIndex(u=>u.type==="transport-cc");d!==-1&&a.rtcpFeedbacks.splice(d,1)})}(n),n}getSSRC(t){for(const n of this.sessionDesc.mediaDescriptions)for(const r of n.attributes.ssrcs)if(r.attributes.label===t)return[r]}}function hi(e){if(Array.isArray(e))return e.map(n=>n);if(!OO(e))return e;const t={};for(const n in e)OO(e[n])||Array.isArray(e[n])?t[n]=hi(e[n]):t[n]=e[n];return t}function OO(e){return!(typeof e!="object"||Array.isArray(e)||!e)}function yB(){const e=navigator.userAgent.toLocaleLowerCase().match(/chrome\/[\d]*/i);return e&&e[0]?Number(e[0].split("/")[1]):null}function RB(e){return window.RTCStatsReport?e.getStats()instanceof de:!1}class VE{constructor(t){g(this,"input",[]),g(this,"size",void 0),this.size=t}add(t){this.input.push(t),this.input.length>this.size&&this.input.splice(0,1)}diffMean(){return this.input.length===0?0:(this.input[this.input.length-1]-this.input[0])/this.input.length}}const es={address:"unknown",candidateType:"unknown",id:"unknown",port:0,priority:0,protocol:"unknown",type:"unknown"},fd={timestamp:0,bitrate:{actualEncoded:0,transmit:0},sendPacketLossRate:0,recvPacketLossRate:0,videoRecv:[],videoSend:[],audioRecv:[],audioSend:[],selectedCandidatePair:{id:"unknown",localCandidate:es,remoteCandidate:es}},wO={firsCount:0,nacksCount:0,plisCount:0,framesDecodeCount:0,framesDecodeInterval:0,framesDecodeFreezeTime:0,decodeFrameRate:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,qpSumPerFrame:0},NO={firsCount:0,nacksCount:0,plisCount:0,frameCount:0,bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0,qpSumPerFrame:0},bO={bytes:0,packets:0,packetsLost:0,packetLostRate:0,ssrc:0,rttMs:0},DO={jitterBufferMs:0,jitterMs:0,bytes:0,packetsLost:0,packetLostRate:0,packets:0,ssrc:0,receivedFrames:0,droppedFrames:0,concealedSamples:0};function PO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function LO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?PO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):PO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class FE{constructor(t,n){g(this,"onFirstVideoReceived",void 0),g(this,"onFirstVideoDecoded",void 0),g(this,"onFirstAudioReceived",void 0),g(this,"onFirstVideoDecodedTimeout",void 0),g(this,"onFirstAudioDecoded",void 0),g(this,"onSelectedLocalCandidateChanged",void 0),g(this,"onSelectedRemoteCandidateChanged",void 0),g(this,"videoIsReady",!1),g(this,"videoIsReady2",{}),g(this,"pc",void 0),g(this,"options",void 0),g(this,"intervalTimer",void 0),g(this,"stats",hi(fd)),g(this,"isFirstVideoReceived",{}),g(this,"isFirstVideoDecoded",{}),g(this,"isFirstAudioReceived",{}),g(this,"isFirstAudioDecoded",{}),g(this,"isFirstVideoDecodedTimeout",{}),g(this,"lossRateWindowStats",[]),this.pc=t,this.options=n,this.intervalTimer=window.setInterval(async()=>{this.updateStats()},this.options.updateInterval)}getStats(){return this.stats}getSelectedCandidatePair(){return new de(t=>{t({local:LO({},es),remote:LO({},es)})})}setVideoIsReady(t){this.videoIsReady=t}setVideoIsReady2(t,n){this.videoIsReady2[t]=n}getVideoIsReady(t){return this.videoIsReady2[t]||!1}setIsFirstAudioDecoded(t){}destroy(){window.clearInterval(this.intervalTimer),this.pc=void 0}calcLossRate(t){this.lossRateWindowStats.push(t),this.lossRateWindowStats.length>this.options.lossRateInterval&&this.lossRateWindowStats.splice(0,1);const n=this.lossRateWindowStats.length,r=["videoSend","audioSend","videoRecv","audioRecv"];let o=0,a=0,d=0,u=0;for(const h of r)t[h].forEach((m,f)=>{if(!this.lossRateWindowStats[n-1][h][f]||!this.lossRateWindowStats[0][h][f])return;const E=this.lossRateWindowStats[n-1][h][f].packets-this.lossRateWindowStats[0][h][f].packets,T=this.lossRateWindowStats[n-1][h][f].packetsLost-this.lossRateWindowStats[0][h][f].packetsLost;h==="videoSend"||h==="audioSend"?(o+=E,d+=T):(a+=E,u+=T),Number.isNaN(E)||Number.isNaN(E)?m.packetLostRate=0:m.packetLostRate=E<=0||T<=0?0:T/(E+T)});t.sendPacketLossRate=o<=0||d<=0?0:d/(o+d),t.recvPacketLossRate=a<=0||u<=0?0:u/(a+u)}}function kO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function CB(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?kO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):kO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class IB extends FE{constructor(){super(...arguments),g(this,"_stats",fd),g(this,"lastDecodeVideoReceiverStats",new Map)}async updateStats(){const t=await this._getStats(),n=this.statsResponsesToObjects(t);this._stats=hi(fd);const r=n.filter(a=>a.type==="ssrc");this.processSSRCStats(r);const o=n.find(a=>a.type==="VideoBwe");o&&this.processBandwidthStats(o),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}processBandwidthStats(t){this._stats.bitrate={actualEncoded:Number(t.googActualEncBitrate),targetEncoded:Number(t.googTargetEncBitrate),retransmit:Number(t.googRetransmitBitrate),transmit:Number(t.googTransmitBitrate)},this._stats.sendBandwidth=Number(t.googAvailableSendBandwidth)}processSSRCStats(t){t.forEach(n=>{const r=n.id.includes("send");switch("".concat(n.mediaType,"_").concat(r?"send":"recv")){case"video_send":{const o=hi(NO);o.codec=n.googCodecName,o.adaptionChangeReason="none",n.googCpuLimitedResolution&&(o.adaptionChangeReason="cpu"),n.googBandwidthLimitedResolution&&(o.adaptionChangeReason="bandwidth"),o.avgEncodeMs=Number(n.googAvgEncodeMs),o.inputFrame={width:Number(n.googFrameWidthInput)||Number(n.googFrameWidthSent),height:Number(n.googFrameHeightInput)||Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.sentFrame={width:Number(n.googFrameWidthSent),height:Number(n.googFrameHeightSent),frameRate:Number(n.googFrameRateInput)},o.firsCount=Number(n.googFirReceived),o.nacksCount=Number(n.googNacksReceived),o.plisCount=Number(n.googPlisReceived),o.frameCount=Number(n.framesEncoded),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.videoSend.push(o),this._stats.rtt=o.rttMs;break}case"video_recv":{const o=hi(wO),a=this.lastDecodeVideoReceiverStats.get(Number(n.ssrc));if(o.codec=n.googCodecName,o.targetDelayMs=Number(n.googTargetDelayMs),o.renderDelayMs=Number(n.googRenderDelayMs),o.currentDelayMs=Number(n.googCurrentDelayMs),o.minPlayoutDelayMs=Number(n.googMinPlayoutDelayMs),o.decodeMs=Number(n.googDecodeMs),o.maxDecodeMs=Number(n.googMaxDecodeMs),o.receivedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateReceived)},o.decodedFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateDecoded)},o.decodeFrameRate=Number(n.googFrameRateDecoded),o.outputFrame={width:Number(n.googFrameWidthReceived),height:Number(n.googFrameHeightReceived),frameRate:Number(n.googFrameRateOutput)},o.jitterBufferMs=Number(n.googJitterBufferMs),o.firsCount=Number(n.googFirsSent),o.nacksCount=Number(n.googNacksSent),o.plisCount=Number(n.googPlisSent),o.framesDecodeCount=Number(n.framesDecoded),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.packets>0&&!this.isFirstVideoReceived[o.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(o.ssrc),this.isFirstVideoReceived[o.ssrc]=!0),o.framesDecodeCount>0&&!this.isFirstVideoDecoded[o.ssrc]&&(this.onFirstVideoDecoded&&this.onFirstVideoDecoded(o.ssrc,o.decodedFrame.width,o.decodedFrame.height),this.isFirstVideoDecoded[o.ssrc]=!0),a){const d=a.stats,u=Date.now()-a.lts;o.framesDecodeFreezeTime=d.framesDecodeFreezeTime,o.framesDecodeInterval=d.framesDecodeInterval,o.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[o.ssrc]?(a.lts=Date.now(),o.framesDecodeInterval=u,o.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(n.ssrc,10))?o.framesDecodeFreezeTime+=o.framesDecodeInterval:this.setVideoIsReady2(parseInt(n.ssrc,10),!0))):o.framesDecodeCount<a.stats.framesDecodeCount&&(o.framesDecodeInterval=0)}this.lastDecodeVideoReceiverStats.set(o.ssrc,{stats:CB({},o),lts:Date.now()}),this._stats.videoRecv.push(o);break}case"audio_recv":{const o=hi(DO);o.codec=n.googCodecName,o.outputLevel=Math.abs(Number(n.audioOutputLevel))/32767,o.decodingCNG=Number(n.googDecodingCNG),o.decodingCTN=Number(n.googDecodingCTN),o.decodingCTSG=Number(n.googDecodingCTSG),o.decodingNormal=Number(n.googDecodingNormal),o.decodingPLC=Number(n.googDecodingPLC),o.decodingPLCCNG=Number(n.googDecodingPLCCNG),o.expandRate=Number(n.googExpandRate),o.accelerateRate=Number(n.googAccelerateRate),o.preemptiveExpandRate=Number(n.googPreemptiveExpandRate),o.secondaryDecodedRate=Number(n.googSecondaryDecodedRate),o.speechExpandRate=Number(n.googSpeechExpandRate),o.preferredJitterBufferMs=Number(n.googPreferredJitterBufferMs),o.jitterBufferMs=Number(n.googJitterBufferMs),o.jitterMs=Number(n.googJitterReceived),o.bytes=Number(n.bytesReceived),o.packets=Number(n.packetsReceived),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.receivedFrames=Number(n.googDecodingCTN)||Number(n.packetsReceived),o.droppedFrames=Number(n.googDecodingPLC)+Number(n.googDecodingPLCCNG)||Number(n.packetsLost),o.receivedFrames>0&&!this.isFirstAudioReceived[o.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(o.ssrc),this.isFirstAudioReceived[o.ssrc]=!0),o.decodingNormal>0&&!this.isFirstAudioDecoded[o.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(o.ssrc),this.isFirstAudioDecoded[o.ssrc]=!0),this._stats.audioRecv.push(o);break}case"audio_send":{const o=hi(bO);o.codec=n.googCodecName,o.inputLevel=Math.abs(Number(n.audioInputLevel))/32767,o.aecReturnLoss=Number(n.googEchoCancellationReturnLoss||0),o.aecReturnLossEnhancement=Number(n.googEchoCancellationReturnLossEnhancement||0),o.residualEchoLikelihood=Number(n.googResidualEchoLikelihood||0),o.residualEchoLikelihoodRecentMax=Number(n.googResidualEchoLikelihoodRecentMax||0),o.bytes=Number(n.bytesSent),o.packets=Number(n.packetsSent),o.packetsLost=Number(n.packetsLost),o.ssrc=Number(n.ssrc),o.rttMs=Number(n.googRtt||0),this._stats.rtt=o.rttMs,this._stats.audioSend.push(o);break}}})}_getStats(){return new de((t,n)=>{this.pc.getStats(t,n)})}statsResponsesToObjects(t){const n=[];return t.result().forEach(r=>{const o={id:r.id,timestamp:r.timestamp.valueOf().toString(),type:r.type};r.names().forEach(a=>{o[a]=r.stat(a)}),n.push(o)}),n}}function MO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function $s(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?MO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):MO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class UO extends FE{constructor(){super(...arguments),g(this,"_stats",fd),g(this,"report",void 0),g(this,"lastDecodeVideoReceiverStats",new Map),g(this,"lastVideoFramesRecv",new Map),g(this,"lastVideoFramesSent",new Map),g(this,"lastVideoFramesDecode",new Map),g(this,"lastVideoJBDelay",new Map),g(this,"lastAudioJBDelay",new Map),g(this,"mediaBytesSent",new Map),g(this,"mediaBytesRetransmit",new Map),g(this,"mediaBytesTargetEncode",new Map),g(this,"lastEncoderMs",new Map)}async updateStats(){this.report=await this.pc.getStats(),this._stats=hi(fd),this.report.forEach(t=>{switch(t.type){case vr.OUTBOUND:t.mediaType==="audio"?this.processAudioOutboundStats(t):t.mediaType==="video"&&this.processVideoOutboundStats(t);break;case vr.INBOUND:t.mediaType==="audio"?this.processAudioInboundStats(t):t.mediaType==="video"&&this.processVideoInboundStats(t);break;case vr.TRANSPORT:{const n=this.report.get(t.selectedCandidatePairId);n&&this.processCandidatePairStats(n);break}case vr.CANDIDATE_PAIR:t.selected&&this.processCandidatePairStats(t)}}),this.updateSendBitrate(),this._stats.timestamp=Date.now(),this.calcLossRate(this._stats),this.stats=this._stats}async getSelectedCandidatePair(){const t=await this.pc.getStats(),n={local:$s({},es),remote:$s({},es)};return t.forEach(r=>{let o;if(r.type===vr.TRANSPORT&&(o=t.get(r.selectedCandidatePairId)),r.type===vr.CANDIDATE_PAIR&&r.selected&&(o=r),o){const a=(d,u)=>{d.type=u.type,d.id=u.id,u.address&&(d.address=u.address),u.candidateType&&(d.candidateType=u.candidateType),u.port&&(d.port=u.port),u.priority&&(d.priority=u.priority),u.protocol&&(d.protocol=u.protocol),u.relayProtocol&&(d.relayProtocol=u.relayProtocol)};if(o.localCandidateId){const d=t.get(o.localCandidateId);d&&a(n.local,d)}if(o.remoteCandidateId){const d=t.get(o.remoteCandidateId);d&&a(n.remote,d)}}}),n}processCandidatePairStats(t){if(this._stats.sendBandwidth=t.availableOutgoingBitrate||0,t.currentRoundTripTime&&(this._stats.rtt=1e3*t.currentRoundTripTime),this._stats.videoSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.audioSend.forEach(n=>{t.currentRoundTripTime&&(n.rttMs=1e3*t.currentRoundTripTime)}),this._stats.selectedCandidatePair.id=t.id,t.localCandidateId){const n=this.report.get(t.localCandidateId);n&&this.processCandidateStats(n)}if(t.remoteCandidateId){const n=this.report.get(t.remoteCandidateId);n&&this.processCandidateStats(n)}}processCandidateStats(t){let n;t.type===vr.LOCAL_CANDIDATE&&(n=this._stats.selectedCandidatePair.localCandidate),t.type===vr.REMOTE_CANDIDATE&&(n=this._stats.selectedCandidatePair.remoteCandidate),n&&(n.type=t.type,n.id=t.id,t.address&&(n.address=t.address),t.candidateType&&(n.candidateType=t.candidateType),t.port&&(n.port=t.port),t.priority&&(n.priority=t.priority),t.protocol&&(n.protocol=t.protocol),t.relayProtocol&&(n.relayProtocol=t.relayProtocol),t.type===vr.LOCAL_CANDIDATE&&this.stats.selectedCandidatePair.localCandidate.id!==n.id&&this.onSelectedLocalCandidateChanged&&this.onSelectedLocalCandidateChanged($s({},n),$s({},this.stats.selectedCandidatePair.localCandidate)),t.type===vr.REMOTE_CANDIDATE&&this.stats.selectedCandidatePair.remoteCandidate.id!==n.id&&this.onSelectedRemoteCandidateChanged&&this.onSelectedRemoteCandidateChanged($s({},n),$s({},this.stats.selectedCandidatePair.remoteCandidate)))}processAudioInboundStats(t){let n=this._stats.audioRecv.find(r=>r.ssrc===t.ssrc);n||(n=hi(DO),this._stats.audioRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.jitterMs=1e3*t.jitter,this.processAudioTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),n.receivedFrames||(n.receivedFrames=t.packetsReceived),n.droppedFrames||(n.droppedFrames=t.packetsLost),n.receivedFrames>0&&!this.isFirstAudioReceived[n.ssrc]&&(this.onFirstAudioReceived&&this.onFirstAudioReceived(n.ssrc),this.isFirstAudioReceived[n.ssrc]=!0),n.outputLevel&&n.outputLevel>0&&!this.isFirstAudioDecoded[n.ssrc]&&(this.onFirstAudioDecoded&&this.onFirstAudioDecoded(n.ssrc),this.isFirstAudioDecoded[n.ssrc]=!0),typeof t.concealedSamples=="number"&&(n.concealedSamples=t.concealedSamples)}processVideoInboundStats(t){let n=this._stats.videoRecv.find(d=>d.ssrc===t.ssrc);n||(n=hi(wO),this._stats.videoRecv.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsReceived,n.packetsLost=t.packetsLost,n.bytes=t.bytesReceived,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.framesDecodeCount=t.framesDecoded,n.totalInterFrameDelay=t.totalInterFrameDelay,n.totalSquaredInterFrameDelay=t.totalSquaredInterFrameDelay;const r=this.lastDecodeVideoReceiverStats.get(n.ssrc),o=this.lastVideoFramesDecode.get(n.ssrc),a=Date.now();if(n.framesDecodeCount>0&&!this.isFirstVideoDecoded[n.ssrc]){const d=n.decodedFrame?n.decodedFrame.width:0,u=n.decodedFrame?n.decodedFrame.height:0;this.onFirstVideoDecoded&&this.onFirstVideoDecoded(n.ssrc,d,u),this.isFirstVideoDecoded[n.ssrc]=!0}if(r){const d=r.stats,u=a-r.lts;n.framesDecodeFreezeTime=d.framesDecodeFreezeTime,n.framesDecodeInterval=d.framesDecodeInterval,!this.isFirstVideoDecoded[n.ssrc]&&u>this.options.firstVideoDecodedTimeout&&!this.isFirstVideoDecodedTimeout[n.ssrc]&&(this.onFirstVideoDecodedTimeout&&this.onFirstVideoDecodedTimeout(n.ssrc),this.isFirstVideoDecodedTimeout[n.ssrc]=!0),n.framesDecodeCount>d.framesDecodeCount&&this.isFirstVideoDecoded[n.ssrc]?(r.lts=Date.now(),n.framesDecodeInterval=u,n.framesDecodeInterval>=this.options.freezeRateLimit&&(this.getVideoIsReady(parseInt(t.ssrc))?n.framesDecodeFreezeTime+=n.framesDecodeInterval:this.setVideoIsReady2(parseInt(t.ssrc,10),!0))):n.framesDecodeCount<d.framesDecodeCount&&(n.framesDecodeInterval=0),t.framesDecoded&&t.qpSum&&(r.stats.framesDecodeCount>t.framesDecoded?n.qpSumPerFrame=t.qpSum/t.framesDecoded:n.qpSumPerFrame=(t.qpSum-r.qpSum)/(t.framesDecoded-r.stats.framesDecodeCount))}o&&a-o.lts>=800?(n.decodeFrameRate=Math.round((n.framesDecodeCount-o.count)/((a-o.lts)/1e3)),this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:n.decodeFrameRate})):o?n.decodeFrameRate=o.rate:this.lastVideoFramesDecode.set(n.ssrc,{count:n.framesDecodeCount,lts:a,rate:0}),t.totalDecodeTime&&(n.decodeMs=1e3*t.totalDecodeTime),this.processVideoTrackReceiverStats(t,t.trackId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.framerateMean&&(n.framesRateFirefox=t.framerateMean),n.packets>0&&!this.isFirstVideoReceived[n.ssrc]&&(this.onFirstVideoReceived&&this.onFirstVideoReceived(n.ssrc),this.isFirstVideoReceived[n.ssrc]=!0),this.lastDecodeVideoReceiverStats.set(n.ssrc,{stats:$s({},n),lts:r?r.lts:Date.now(),qpSum:t.qpSum})}processVideoOutboundStats(t){let n=this._stats.videoSend.find(o=>o.ssrc===t.ssrc);n||(n=hi(NO),this._stats.videoSend.push(n));const r=this.mediaBytesSent.get(t.ssrc);if(r)r.add(t.bytesSent);else{const o=new VE(10);o.add(t.bytesSent),this.mediaBytesSent.set(t.ssrc,o)}if(t.retransmittedBytesSent!==void 0){const o=this.mediaBytesRetransmit.get(t.ssrc);if(o)o.add(t.retransmittedBytesSent);else{const a=new VE(10);a.add(t.retransmittedBytesSent),this.mediaBytesRetransmit.set(t.ssrc,a)}}if(t.totalEncodedBytesTarget){const o=this.mediaBytesTargetEncode.get(t.ssrc);if(o)o.add(t.totalEncodedBytesTarget);else{const a=new VE(10);a.add(t.totalEncodedBytesTarget),this.mediaBytesTargetEncode.set(t.ssrc,a)}}if(n.ssrc=t.ssrc,n.bytes=t.bytesSent,n.packets=t.packetsSent,n.firsCount=t.firCount,n.nacksCount=t.nackCount,n.plisCount=t.pliCount,n.frameCount=t.framesEncoded,n.adaptionChangeReason=t.qualityLimitationReason,n.scalabilityMode=t.scalabilityMode,t.totalEncodeTime&&t.framesEncoded){const o=this.lastEncoderMs.get(t.ssrc);if(!o||o.lastFrameCount>t.framesEncoded)n.avgEncodeMs=1e3*t.totalEncodeTime/t.framesEncoded;else{const a=t.framesEncoded-o.lastFrameCount,d=t.totalEncodeTime-o.lastEncoderTime;n.avgEncodeMs=1e3*d/a}}if(t.framesEncoded&&t.qpSum){const o=this.lastEncoderMs.get(t.ssrc);!o||o.lastFrameCount>t.framesEncoded?n.qpSumPerFrame=t.qpSum/t.framesEncoded:n.qpSumPerFrame=(t.qpSum-o.lastQpSum)/(t.framesEncoded-o.lastFrameCount)}if(this.lastEncoderMs.set(t.ssrc,{lastFrameCount:t.framesEncoded,lastEncoderTime:t.totalEncodeTime,lastQpSum:t.qpSum,lts:Date.now()}),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),t.mediaSourceId&&this.processVideoMediaSource(t.mediaSourceId,n),this.processVideoTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const o=this.findRemoteStatsId(t.ssrc,vr.REMOTE_INBOUND);o&&this.processRemoteInboundStats(o,n)}}processAudioOutboundStats(t){let n=this._stats.audioSend.find(r=>r.ssrc===t.ssrc);if(n||(n=hi(bO),this._stats.audioSend.push(n)),n.ssrc=t.ssrc,n.packets=t.packetsSent,n.bytes=t.bytesSent,t.mediaSourceId&&this.processAudioMediaSource(t.mediaSourceId,n),t.codecId&&(n.codec=this.getCodecFromCodecStats(t.codecId)),this.processAudioTrackSenderStats(t,t.trackId,n),t.remoteId)this.processRemoteInboundStats(t.remoteId,n);else{const r=this.findRemoteStatsId(t.ssrc,vr.REMOTE_INBOUND);r&&this.processRemoteInboundStats(r,n)}}findRemoteStatsId(t,n){var r;const o=Array.from(qi(r=this.report).call(r)).find(a=>a.type===n&&a.ssrc===t);return o?o.id:null}processVideoMediaSource(t,n){const r=this.report.get(t);r&&r.width&&r.height&&r.framesPerSecond&&(n.inputFrame={width:r.width,height:r.height,frameRate:r.framesPerSecond})}processAudioMediaSource(t,n){const r=this.report.get(t);r&&(n.inputLevel=r.audioLevel)}processVideoTrackSenderStats(t,n,r){var o,a,d;const u=n?this.report.get(n):void 0,h=(o=u==null?void 0:u.framesSent)!==null&&o!==void 0?o:t.framesSent;let m=(a=u==null?void 0:u.frameWidth)!==null&&a!==void 0?a:t.frameWidth,f=(d=u==null?void 0:u.frameHeight)!==null&&d!==void 0?d:t.frameHeight;if(typeof h!="number")return;typeof m=="number"&&typeof f=="number"||(m=0,f=0);let E=0;const T=Date.now(),R=this.lastVideoFramesSent.get(r.ssrc);R&&T-R.lts>=800?(E=Math.round((h-R.count)/((T-R.lts)/1e3)),this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:T,rate:E})):R?E=R.rate:this.lastVideoFramesSent.set(r.ssrc,{count:h,lts:T,rate:0}),r.sentFrame={width:m,height:f,frameRate:Math.max(0,E)}}processVideoTrackReceiverStats(t,n,r){var o,a,d,u,h;const m=n?this.report.get(n):void 0,f=(o=m==null?void 0:m.framesReceived)!==null&&o!==void 0?o:t.framesReceived,E=(a=m==null?void 0:m.frameWidth)!==null&&a!==void 0?a:t.frameWidth,T=(d=m==null?void 0:m.frameHeight)!==null&&d!==void 0?d:t.frameHeight,R=(u=m==null?void 0:m.jitterBufferDelay)!==null&&u!==void 0?u:t.jitterBufferDelay,A=(h=m==null?void 0:m.jitterBufferEmittedCount)!==null&&h!==void 0?h:t.jitterBufferEmittedCount;if(typeof f=="number"){const O=this.lastVideoFramesRecv.get(r.ssrc),w=Date.now();r.framesReceivedCount=f;let x=0;O&&w-O.lts>=800?(x=Math.round((f-O.count)/((w-O.lts)/1e3)),this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:w,rate:x})):O?x=O.rate:this.lastVideoFramesRecv.set(r.ssrc,{count:f,lts:w,rate:0}),r.receivedFrame={width:E||0,height:T||0,frameRate:x||0},r.decodedFrame={width:E||0,height:T||0,frameRate:r.decodeFrameRate||0},r.outputFrame={width:E||0,height:T||0,frameRate:r.decodeFrameRate||0}}if(R&&A){let O=this.lastVideoJBDelay.get(r.ssrc);this.lastVideoJBDelay.set(r.ssrc,{jitterBufferDelay:R,jitterBufferEmittedCount:A}),O||(O={jitterBufferDelay:0,jitterBufferEmittedCount:0});const w=1e3*(R-O.jitterBufferDelay)/(A-O.jitterBufferEmittedCount);r.jitterBufferMs=w,r.currentDelayMs=Math.round(w)}}processAudioTrackSenderStats(t,n,r){var o,a,d,u;const h=n?this.report.get(n):void 0,m=(o=(a=h==null?void 0:h.echoReturnLoss)!==null&&a!==void 0?a:t.echoReturnLoss)!==null&&o!==void 0?o:0,f=(d=(u=h==null?void 0:h.echoReturnLossEnhancement)!==null&&u!==void 0?u:t.echoReturnLossEnhancement)!==null&&d!==void 0?d:0;r.aecReturnLoss=m,r.aecReturnLossEnhancement=f}processAudioTrackReceiverStats(t,n,r){var o,a,d,u,h,m,f;const E=n?this.report.get(n):void 0,T=(o=E==null?void 0:E.removedSamplesForAcceleration)!==null&&o!==void 0?o:t.removedSamplesForAcceleration,R=(a=E==null?void 0:E.totalSamplesReceived)!==null&&a!==void 0?a:t.totalSamplesReceived,A=(d=E==null?void 0:E.jitterBufferDelay)!==null&&d!==void 0?d:t.jitterBufferDelay,O=(u=E==null?void 0:E.jitterBufferEmittedCount)!==null&&u!==void 0?u:t.jitterBufferEmittedCount,w=(h=E==null?void 0:E.audioLevel)!==null&&h!==void 0?h:t==null?void 0:t.audioLevel,x=(m=E==null?void 0:E.totalSamplesDuration)!==null&&m!==void 0?m:t==null?void 0:t.totalSamplesDuration,V=(f=E==null?void 0:E.concealedSamples)!==null&&f!==void 0?f:t.concealedSamples;if(T&&R&&(r.accelerateRate=T/R),A&&O){let le=this.lastAudioJBDelay.get(r.ssrc);this.lastAudioJBDelay.set(r.ssrc,{jitterBufferDelay:A,jitterBufferEmittedCount:O}),le||(le={jitterBufferDelay:0,jitterBufferEmittedCount:0});const $=1e3*(A-le.jitterBufferDelay)/(O-le.jitterBufferEmittedCount);r.jitterBufferMs=Math.round($)}r.outputLevel=w;let X=1920;x&&R&&(X=R/x/50,r.receivedFrames=Math.round(R/X)),V&&(r.droppedFrames=Math.round(V/X))}processRemoteInboundStats(t,n){const r=this.report.get(t);r&&(n.packetsLost=r.packetsLost,r.roundTripTime&&(n.rttMs=1e3*r.roundTripTime))}getCodecFromCodecStats(t){const n=this.report.get(t);if(!n)return"";const r=n.mimeType.match(/\/(.*)$/);return r&&r[1]?r[1]:""}updateSendBitrate(){let t=0,n=null,r=null;this.mediaBytesSent.forEach(a=>{t+=a.diffMean()}),this.mediaBytesRetransmit.forEach(a=>{n=n===null?a.diffMean():n+a.diffMean()}),this.mediaBytesTargetEncode.forEach(a=>{r=r===null?a.diffMean():r+a.diffMean()});const o=n!==null?t-n:t;this._stats.bitrate={actualEncoded:8*o/(this.options.updateInterval/1e3),transmit:8*t/(this.options.updateInterval/1e3)},n!==null&&(this._stats.bitrate.retransmit=8*n/(this.options.updateInterval/1e3)),r!==null&&(this._stats.bitrate.targetEncoded=8*r/(this.options.updateInterval/1e3))}}class AB extends FE{updateStats(){return de.resolve()}}function jE(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:250,n=arguments.length>2&&arguments[2]!==void 0?arguments[2]:8,r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:500,o=arguments.length>4&&arguments[4]!==void 0?arguments[4]:1e4;const a=yB();return a?a<76?new IB(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new UO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):RB(e)?new UO(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o}):new AB(e,{updateInterval:t,lossRateInterval:n,freezeRateLimit:r,firstVideoDecodedTimeout:o})}var nt;function xO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function VO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?xO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):xO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let md=(Y((nt=class kd extends _u{get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"statsFilter",void 0),g(this,"useRTX",!1),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"establishPromise",void 0),g(this,"mutex",new Vn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(kd.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=jE(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{const t=await this.peerConnection.createOffer({offerToReceiveAudio:!0,offerToReceiveVideo:!0});if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Qs(t.sdp),r=kE(t.sdp,!this.useRTX,k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"),["opus"]);return this.localCapabilities=r,this.initialOffer=t,VO(VO({},n),{},{rtpCapabilities:{send:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},recv:{audioCodecs:[],audioExtensions:[],videoCodecs:[],videoExtensions:[]},sendrecv:r},offerSDP:t.sdp})}catch(t){throw new b(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,o,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new vB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o.send,remoteSetup:a,localCapabilities:this.localCapabilities,sdkCodec:this.store.codec,cname:d});const u=this.remoteSDP.toString();await this.peerConnection.setLocalDescription(this.initialOffer),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}send(t,n){var r=this;return ui(function*(){const o=yield xe(r.mutex.lock());try{if(!r.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const a=t.map(T=>r.peerConnection.addTrack(T._mediaStreamTrack)),d=yield xe(r.peerConnection.createOffer()),u=jt.exports.parse(d.sdp),h=t.map(T=>{const R=T._mediaStreamTrack,A=u.mediaDescriptions.find(O=>O.attributes.mid===R.kind);if(!A)throw new Error("Cannot extract ssrc from mediaDescription.");return function(O,w,x){const V=O.attributes.ssrcs.filter(le=>le.attributes.label===w),X=O.attributes.ssrcGroups;if(V.length===0)throw new Error("Cannot extract ssrc from plan-b SDP.");if(X&&V.length>1){const le=X.find($=>$.ssrcIds.indexOf(V[0].ssrcId)!==-1);return le?[{ssrcId:le.ssrcIds[0],rtx:x?le.ssrcIds[1]:void 0}]:[{ssrcId:V[0].ssrcId}]}return[{ssrcId:V[0].ssrcId}]}(A,R.id,r.useRTX)});let m;try{m=yield h}catch(T){throw a.forEach(R=>{kn()&&R.replaceTrack(null),r.peerConnection.removeTrack(R)}),T}const f=r.mungSendOfferSDP(d.sdp,t);r.remoteSDP.receive(t,n,m);const E=r.remoteSDP.toString();return yield xe(r.peerConnection.setLocalDescription({type:"offer",sdp:f})),yield xe(r.applySendEncodings(a,t)),yield xe(r.peerConnection.setRemoteDescription({type:"answer",sdp:E})),t.map((T,R)=>{const A=T._mediaStreamTrack.id;return{localSSRC:h[R],id:A}})}catch(a){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(a.toString()))}finally{o()}})()}async stopSending(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const n=this.peerConnection.getSenders().filter(a=>{var d;return t.indexOf(((d=a.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");n.map(a=>{kn()&&a.replaceTrack(null),this.peerConnection.removeTrack(a)});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r),this.remoteSDP.stopReceiving(t);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(n.toString()))}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{id:a,mslabel:d}=this.remoteSDP.send(t,n,o),u=new de((f,E)=>{const T=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(a)))},1e4),R=A=>{const O=qe();if((O.name==="Safari"&&Number(O.version)===11||Mn())&&A.track.id!==a&&A.streams[0].id===d){var w;const x=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(t,a,A.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(T),void f(x)}if(A.track.id===a)return this.peerConnection.removeEventListener("track",R),clearTimeout(T),void f(A.track)};this.peerConnection.addEventListener("track",R)}),h=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const m=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(m),{track:await u,id:a}}catch(a){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const r=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(r)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){}async unmuteRemote(t){}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(r=>{var o;return t.indexOf(((o=r.track)===null||o===void 0?void 0:o.id)||"")!==-1});if(n.length!==t.length)throw new Error("sender' length doesn't match mids' length.");n.map(r=>{if(kn()&&r.track)r.track.enabled=!1;else{const o=r.getParameters();o.encodings.forEach(a=>a.active=!1),r.setParameters(o)}})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getSenders().filter(a=>{var d;return t.indexOf(((d=a.track)===null||d===void 0?void 0:d.id)||"")!==-1});if(n.length!==t.length)throw new Error("Senders' length doesn't match mids' length.");n.map(async a=>{if(kn()&&a.track)a.track.enabled=!0;else{const d=a.getParameters();d.encodings.forEach(u=>u.active=!0),await a.setParameters(d)}});const r=await this.peerConnection.createOffer();await this.peerConnection.setLocalDescription(r);const o=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"answer",sdp:o})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ui(function*(){const r=yield xe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(bt().supportPCSetConfiguration){const h=n.peerConnection.getConfiguration(),m=t===dn.RELAY?"relay":"all";h.iceTransportPolicy!==m&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(h.iceTransportPolicy,"] to [").concat(m,"]")),h.iceTransportPolicy=m,n.peerConnection.setConfiguration(h))}else if(t===dn.RELAY)return;t!==dn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield xe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Qs(o.sdp),{remoteIceParameters:d}=yield a.iceParameters;n.remoteSDP.restartICE(d);const u=n.remoteSDP.toString();yield xe(n.peerConnection.setLocalDescription(o)),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n]);this.remoteSDP.updateRecvMedia(n._mediaStreamTrack.kind,n);const a=this.remoteSDP.toString();await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new b(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getSenders().filter(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===t});r.length===1&&await this.applySendEncodings(r,[n])}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getSenders().find(o=>{var a;return((a=o.track)===null||a===void 0?void 0:a.id)===n});r&&await r.replaceTrack(t._mediaStreamTrack)}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[],sdpSemantics:"plan-b"};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&($c(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...kd.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...kd.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let o=0;o<t.length;o++){var r;const a=t[o],d=n[o];if(!d)continue;const u={},h={};if(d instanceof Ft)switch(d._optimizationMode){case"motion":u.degradationPreference="maintain-framerate";break;case"detail":u.degradationPreference="maintain-resolution";break;default:u.degradationPreference="balanced"}if(k("DSCP_TYPE")&&xs()){const E=k("DSCP_TYPE");["very-low","low","medium","high"].includes(E)&&(h.networkPriority=E)}const m=a.getParameters(),f=(r=m.encodings)===null||r===void 0?void 0:r[0];f&&Object.assign(f,h),Object.assign(m,u),await a.setParameters(m)}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n){const r=jt.exports.parse(t);return n.forEach((o,a)=>{const d=o._mediaStreamTrack,u=r.mediaDescriptions.find(h=>h.attributes.mid===d.kind);u&&Qa(u,o)}),jt.exports.print(r)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const n=this.remoteSDP.batchSend(t).map((a,d)=>{let{id:u,mslabel:h}=a;const{kind:m}=t[d];return new de((f,E)=>{const T=setTimeout(()=>{E(new Error("Cannot receive track, id: ".concat(u)))},1e4),R=A=>{const O=qe();if(O.name==="Safari"&&Number(O.version)===11&&A.track.id!==u&&A.streams[0].id===h){var w;const x=A.streams[0].getTracks()[0];return(w=this.remoteSDP)===null||w===void 0||w.updateTrackLabel(m,u,A.track.id),this.peerConnection.removeEventListener("track",R),clearTimeout(T),void f({track:x,id:u})}if(A.track.id===u)return this.peerConnection.removeEventListener("track",R),clearTimeout(T),void f({track:A.track,id:u})};this.peerConnection.addEventListener("track",R)})}),r=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:r});const o=await this.peerConnection.createAnswer();return await this.peerConnection.setLocalDescription(o),await de.all(n)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(bt().supportPCSetConfiguration){const n=kd.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"connect"),nt.prototype),Y(nt.prototype,"stopSending",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"stopSending"),nt.prototype),Y(nt.prototype,"receive",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"receive"),nt.prototype),Y(nt.prototype,"stopReceiving",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"stopReceiving"),nt.prototype),Y(nt.prototype,"muteRemote",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"muteRemote"),nt.prototype),Y(nt.prototype,"unmuteRemote",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"unmuteRemote"),nt.prototype),Y(nt.prototype,"muteLocal",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"muteLocal"),nt.prototype),Y(nt.prototype,"unmuteLocal",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"unmuteLocal"),nt.prototype),Y(nt.prototype,"close",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"close"),nt.prototype),Y(nt.prototype,"updateEncoderConfig",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"updateEncoderConfig"),nt.prototype),Y(nt.prototype,"updateSendParameters",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"updateSendParameters"),nt.prototype),Y(nt.prototype,"replaceTrack",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"replaceTrack"),nt.prototype),Y(nt.prototype,"getRemoteSSRC",[Xr],Object.getOwnPropertyDescriptor(nt.prototype,"getRemoteSSRC"),nt.prototype),nt);function Xr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("Locking from P2PConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{a()}},n}function FO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function jO(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?FO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):FO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const ju="9",BO=4e4;class OB{get localCapabilities(){return Vt(this._localCapabilities)}get rtpCapabilities(){return Vt(this._rtpCapabilities)}get candidates(){return Vt(this._candidates)}get iceParameters(){return Vt(this._iceParameters)}get dtlsParameters(){return Vt(this._dtlsParameters)}constructor(t){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),t=Vt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:u,cname:h}=t,m=jt.exports.parse(`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0 1
a=msid-semantic: WMS
a=ice-lite
m=video 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:0
m=audio 9 UDP/TLS/RTP/SAVPF 0
c=IN IP4 127.0.0.1
a=rtcp:9 IN IP4 0.0.0.0
a=sendonly
a=rtcp-mux
a=rtcp-rsize
a=mid:1
`);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=u,this.setup=d,this.cname=h;const f=this.rtpCapabilities.send;for(const E of m.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=o,E.attributes.setup=d,E.media.mediaType==="video"&&(E.media.fmts=f.videoCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=f.videoCodecs,E.attributes.extmaps=f.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=Jr([{ssrcId:BO,rtx:k("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=R}if(E.media.mediaType==="audio"&&(E.media.fmts=f.audioCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=f.audioCodecs,E.attributes.extmaps=f.audioExtensions,Zo(E),k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=Jr([{ssrcId:2e4}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=R}}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}preloadRemoteMedia(){const t=k("PRELOAD_MEDIA_COUNT");this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let d=1;d<t;d++){const u=2*d+2e4,h=2*d+BO,{ssrcs:m,ssrcGroups:f}=Jr([{ssrcId:u}],this.cname),{ssrcs:E,ssrcGroups:T}=Jr([{ssrcId:h,rtx:k("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:ju,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:ju,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d+1)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return jt.exports.print(this.sessionDesc)}send(t,n,r,o){const{ssrcs:a,ssrcGroups:d}=Jr(n,this.cname,k("SYNC_GROUP")?r:void 0),u=this.findPreloadMediaDesc(a);if(u){if(Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,a);let m;return h===-1||h===1&&(kn()||ky())||h===0&&k("USE_SUB_RTX")||My()?(m=this.createOrRecycleSendMedia(t,a,d,"sendonly",o),this.updateBundleMids()):(m=Vt(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="sendonly",m.attributes.ssrcs=a,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(m,o)),Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:d,ssrcMsg:u,mslabel:h}=a;return this.send(d,u,h)}),r=[];let o=!1;return n.forEach(a=>{let{mid:d,needExchangeSDP:u}=a;u&&(o=!0),r.push(d)}),{mids:r,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||Tt()||My()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,o){t.forEach((a,d)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,o[d])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===dn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(jO(jO({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Vt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Tt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,r,o,a,d){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=this.localCapabilities.send;let f=[];if(u===be.VIDEO){var E,T;if(k("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(f=h.videoCodecs.filter(x=>{var V,X;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes(o)&&(x==null||(X=x.fmtp)===null||X===void 0?void 0:X.parameters["profile-level-id"])===k("H264_PROFILE_LEVEL_ID")})),!f||((E=f)===null||E===void 0?void 0:E.length)===0){const x=m.videoCodecs.filter(V=>{var X;return(((X=V.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(o)});x.length!==0&&(f=h.videoCodecs.filter(V=>x.some(X=>X.payloadType===V.payloadType)))}if(k("USE_PUB_RTX")){const x=f.map(X=>X.payloadType.toString()),V=h.videoCodecs.filter(X=>{var le,$;return((le=X.rtpMap)===null||le===void 0?void 0:le.encodingName)==="rtx"&&x.includes((($=X.fmtp)===null||$===void 0?void 0:$.parameters.apt)||"")});f=[...f,...V]}f.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((T=h.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),f=h.videoCodecs)}else f=h.audioCodecs.filter(x=>{var V;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes(a)}),f.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),f=h.audioCodecs.filter(x=>{var V;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes("opus")}));const R=u===be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const A="".concat(this.currentMidIndex);let O={media:{mediaType:u,port:ju,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};O=this.mungRecvMediaDsec(O,t,d);const w=this.findFirstClosedMedia(u);if(w){const x=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[x]=O}else this.sessionDesc.mediaDescriptions.push(O);return O}createOrRecycleSendMedia(t,n,r,o,a){const d=this.rtpCapabilities.send,u=t===be.VIDEO?d.videoCodecs:d.audioCodecs,h=t===be.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:ju,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};f=this.mungSendMediaDesc(f,a);const E=this.findFirstClosedMedia(t);if(E){const T=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[T]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const o=Vt(t);return ME(o),Qa(o,n),UE(o,n),yO(o),Vu(o,r,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const r=Vt(t);return Vu(r,n,this.localCapabilities.recv),Zo(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Tt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r,o;return((r=n.attributes)===null||r===void 0||(o=r.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var rt;function GO(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function $a(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?GO(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):GO(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let To=(Y((rt=class Md extends _u{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}get dtlsTransportState(){var t,n,r;return(t=(n=this.peerConnection.getReceivers()[0])===null||n===void 0||(r=n.transport)===null||r===void 0?void 0:r.state)!==null&&t!==void 0?t:null}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"selectedCandidatePairTimer",void 0),g(this,"establishPromise",void 0),g(this,"mutex",new Vn("P2PConnection-mutex")),this.store=n,this.peerConnection=new RTCPeerConnection(Md.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.statsFilter=jE(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(){try{this.peerConnection.addTransceiver("video",{direction:"recvonly"}),this.peerConnection.addTransceiver("audio",{direction:"recvonly"});const t=await this.peerConnection.createOffer();if(!t.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const n=Qs(t.sdp),r=await CO(!k("USE_PUB_RTX")&&!k("USE_SUB_RTX"),k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"));return this.localCapabilities=xE(r),this.initialOffer=t,$a($a({},n),{},{rtpCapabilities:r,offerSDP:t.sdp})}catch(t){throw new b(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,t.toString())}}async connect(t,n,r,o,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish P2PConnection without initial offer.");this.remoteSDP=new OB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:this.localCapabilities,cname:d});const u=this.remoteSDP.toString(),h=jt.exports.parse(this.initialOffer.sdp),m=h.mediaDescriptions.find(R=>R.media.mediaType==="audio");m&&Zo(m);const f=jt.exports.print(h),E=this.logSDPExchange(f||"","offer","local","connect");this.store.descriptionStart(),await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u});const T=this.peerConnection.getTransceivers()[0];if(T!=null&&T.receiver&&this.tryBindTransportEvents(T.receiver),k("PRELOAD_MEDIA_COUNT")>0){this.remoteSDP.preloadRemoteMedia();const R=this.remoteSDP.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:R});const A=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(A)}}catch(u){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.connect failed; ".concat(u.toString()))}}send(t,n,r){var o=this;return ui(function*(){const a=yield xe(o.mutex.lock("From P2PConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call P2PConnection.send before remote SDP created");const d=[];t.forEach(O=>{const w=o.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});d.push(w),O._updateRtpTransceiver(w)}),Tt()&&k("SIMULCAST")===!0&&(yield xe(o.applySimulcastForFirefox(d,t)));const u=yield xe(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(t.length),m=o.mungSendOfferSDP(u.sdp,t,h),f=jt.exports.parse(m),E=h.map(O=>{const w=f.mediaDescriptions.find(x=>x.attributes.mid===O);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return TO(w,k("USE_PUB_RTX"))});let T;try{T=yield E}catch(O){T=[],o.remoteSDP.receive(t,n,r,T);const w=o.remoteSDP.toString();throw yield xe(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield xe(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield xe(o.stopSending(h,!0)),O}o.remoteSDP.receive(t,n,r,T);const R=o.remoteSDP.toString(),A=o.logSDPExchange(m,"offer","local","send");return yield xe(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield xe(o.applySimulcastEncodings(d,t)),yield xe(o.applySendEncodings(d,t)),A==null||A(R),yield xe(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),d.map((O,w)=>{const x=h[w];return{localSSRC:E[w],id:x,transceiver:O}})}catch(d){throw d instanceof b?d:new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.send failed; ".concat(d.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From P2PConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call P2PConnection.stopSending.");o.map(h=>{var m;h.direction="inactive",(m=h.stop)===null||m===void 0||m.call(h)});const a=await this.peerConnection.createOffer(),d=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:d}=this.remoteSDP.send(t,n,r,o);if(d){const h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(f.sdp,a,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] receive ").concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a,transceiver:u}}catch(a){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const d=await this.peerConnection.createAnswer();a==null||a(d.sdp||""),await this.peerConnection.setLocalDescription(d),v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive by exchanging SDP."))}else v.debug("[".concat(this.store.clientId,"] [P2PConnection] batchReceive no need to exchange SDP."));return n.map(o=>{const a=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o,transceiver:a}})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,u)=>{d.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"P2PConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ui(function*(){const r=yield xe(n.mutex.lock("From P2PConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(bt().supportPCSetConfiguration){const m=n.peerConnection.getConfiguration(),f=t===dn.RELAY?"relay":"all";m.iceTransportPolicy!==f&&(v.debug("[".concat(n.store.clientId,"] restartICE change iceTransportPolicy from [").concat(m.iceTransportPolicy,"] to [").concat(f,"]")),m.iceTransportPolicy=f,n.peerConnection.setConfiguration(m))}else if(t===dn.RELAY)return;t!==dn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield xe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Qs(o.sdp),{remoteIceParameters:d}=yield a.iceParameters;n.remoteSDP.restartICE(d);const u=n.remoteSDP.toString(),h=n.logSDPExchange(o.sdp||"","offer","local","restartICE");n.store.descriptionStart(),yield xe(n.peerConnection.setLocalDescription(o)),h==null||h(u),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){v.warning("[".concat(n.store.clientId,"] restart ICE failed, abort operation"),o)}finally{r()}})()}close(){var t;this.peerConnection.close(),(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.tryUnbindTransportEvents(),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call P2PConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new b(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Tt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}async getSelectedCandidatePair(){const t=this.peerConnection.getReceivers();if(t.length>0&&t[0].transport&&t[0].transport.iceTransport&&t[0].transport.iceTransport.getSelectedCandidatePair&&t[0].transport.iceTransport.getSelectedCandidatePair()){const n=t[0].transport.iceTransport,{local:r,remote:o}=n.getSelectedCandidatePair();return{local:$a($a({},es),{},{candidateType:r.type,protocol:r.protocol,address:r.address,port:r.port}),remote:$a($a({},es),{},{candidateType:o.type,protocol:o.protocol,address:o.address,port:o.port})}}return this.statsFilter.getSelectedCandidatePair()}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&($c(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Md.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Md.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),k("ENABLE_ENCODED_TRANSFORM")&&bt().supportWebRTCEncodedTransform&&(n.encodedInsertableStreams=!0),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Cu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}tryBindTransportEvents(t){const n=t.transport;if(n){this.transportEventReceiver=t,n.onstatechange=()=>{var o;n!=null&&n.state&&((o=this.onDTLSTransportStateChange)===null||o===void 0||o.call(this,n.state))},n.onerror=o=>{var a;(a=this.onDTLSTransportError)===null||a===void 0||a.call(this,"error"in o?o.error:o)};const r=n.iceTransport;r&&(r.onstatechange=()=>{const o=n==null?void 0:n.iceTransport.state;var a;o&&((a=this.onICETransportStateChange)===null||a===void 0||a.call(this,o))},r.getSelectedCandidatePair&&(r.onselectedcandidatepairchange=()=>{if(r.getSelectedCandidatePair()){const{local:o,remote:a}=r.getSelectedCandidatePair();v.info("[".concat(this.store.clientId,"] [pc-").concat(this.store.p2pId,"] selectedcandidatepairchange: local ").concat(JSON.stringify({candidateType:o.type,protocol:o.protocol}),", remote ").concat(JSON.stringify({candidateType:a.type,protocol:a.protocol,address:a.address,port:a.port})," )"))}}))}}tryUnbindTransportEvents(){this.transportEventReceiver&&this.transportEventReceiver.transport&&(this.transportEventReceiver.transport.onstatechange=null,this.transportEventReceiver.transport.onerror=null,this.transportEventReceiver.transport.iceTransport&&(this.transportEventReceiver.transport.iceTransport.onstatechange=null))}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const f=t[m],E=n[m];if(E&&E instanceof Ft){var r,o;if(this.isVP8Simulcast(E))continue;const T={},R={};switch(E._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var a,d,u,h;if((r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(R.maxBitrate=1e3*((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),E._hints.includes(zt.LOW_STREAM)&&((d=E._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(R.maxFramerate=_o(E._encoderConfig.frameRate)),(u=E._encoderConfig)!==null&&u!==void 0&&u.scaleResolutionDownBy&&((h=E._encoderConfig)===null||h===void 0?void 0:h.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),k("DSCP_TYPE")&&xs()){const w=k("DSCP_TYPE");["very-low","low","medium","high"].includes(w)&&(R.networkPriority=w)}const A=f.sender.getParameters(),O=(o=A.encodings)===null||o===void 0?void 0:o[0];Tt()&&!O&&(T.encodings=[R]),O&&Object.assign(O,R),Object.assign(A,T),await f.sender.setParameters(A)}}}catch{v.debug("[".concat(this.store.clientId,"] Apply RTPSendEncodings failed."))}}mungSendOfferSDP(t,n,r){const o=jt.exports.parse(t);return n.forEach((a,d)=>{const u=r[d],h=o.mediaDescriptions.find(m=>m.attributes.mid===u);h&&(Qa(h,a),RO(h,a,this.store.codec))}),jt.exports.print(o)}mungReceiveAnswerSDP(t,n,r){const o=jt.exports.parse(t),a=o.mediaDescriptions.find(d=>d.attributes.mid===n);return a&&r===be.AUDIO&&a.media.mediaType==="audio"&&Zo(a),jt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,o,a,d;const h=t[u],m=n[u];if(m instanceof Ft&&!m._hints.includes(zt.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=m._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=m._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const T=h.sender.getParameters();await h.sender.setParameters(Object.assign(T,f))}}}async applySimulcastEncodings(t,n){if(!Tt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof Ft&&this.isVP8Simulcast(o)){const a=t[r],d={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,d))}}}isVP8Simulcast(t){var n,r,o,a;return!!(t instanceof Ft&&k("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(zt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(k("SDP_LOGGING"))return v.upload("[".concat(this.store.clientId,"] exchanging ").concat(r," ").concat(n," SDP during P2PConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(bt().supportPCSetConfiguration){const n=Md.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"connect"),rt.prototype),Y(rt.prototype,"receive",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"receive"),rt.prototype),Y(rt.prototype,"batchReceive",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"batchReceive"),rt.prototype),Y(rt.prototype,"stopReceiving",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"stopReceiving"),rt.prototype),Y(rt.prototype,"muteRemote",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"muteRemote"),rt.prototype),Y(rt.prototype,"unmuteRemote",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteRemote"),rt.prototype),Y(rt.prototype,"muteLocal",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"muteLocal"),rt.prototype),Y(rt.prototype,"unmuteLocal",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"unmuteLocal"),rt.prototype),Y(rt.prototype,"close",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"close"),rt.prototype),Y(rt.prototype,"updateEncoderConfig",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"updateEncoderConfig"),rt.prototype),Y(rt.prototype,"updateSendParameters",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"updateSendParameters"),rt.prototype),Y(rt.prototype,"replaceTrack",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"replaceTrack"),rt.prototype),Y(rt.prototype,"getRemoteSSRC",[Qr],Object.getOwnPropertyDescriptor(rt.prototype,"getRemoteSSRC"),rt.prototype),rt);function Qr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{a()}},n}function WO(e,t){let n=document.createElement("video"),r=document.createElement("canvas");n.setAttribute("style","display:none"),r.setAttribute("style","display:none"),n.setAttribute("muted",""),n.muted=!0,n.setAttribute("autoplay",""),n.autoplay=!0,n.setAttribute("playsinline",""),r.width=_o(t.width),r.height=_o(t.height);const o=_o(t.framerate||15);document.body.append(n),document.body.append(r);let a=e._mediaStreamTrack;n.srcObject=new MediaStream([a]),n.play();const d=r.getContext("2d");if(!d)throw new b(I.UNEXPECTED_ERROR,"can not get canvas context");const u=bt(),h=r.captureStream(u.supportRequestFrame?0:o).getVideoTracks()[0],m=uC(()=>(()=>{if(n.paused&&n.play(),n.videoHeight>2&&n.videoWidth>2){const E=n.videoWidth,T=n.videoHeight/E,R=r.width*T;Math.abs(R-r.height)>=2&&(v.debug("adjust low stream resolution","".concat(r.width,"x").concat(r.height," -> ").concat(r.width,"x").concat(R)),r.height=R)}d.drawImage(n,0,0,r.width,r.height),h.requestFrame&&h.requestFrame(),a!==e._mediaStreamTrack&&(a=e._mediaStreamTrack,n.srcObject=new MediaStream([a]))})(),o),f=h.stop;return h.stop=()=>{f.call(h),m(),n&&(n.remove(),n=null),r&&(r.width=0,r.remove(),r=null),v.debug("clean low stream renderer")},h}var HO,KO,zO,YO,$r,qO,JO,XO,QO,$O,ZO,bn;function ew(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Bu(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?ew(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):ew(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class tw extends aC{getUserId(){return this._userId}constructor(t,n,r,o){super(t,"track-".concat(t.kind,"-").concat(n,"-").concat(o.clientId,"_").concat(ut(5,""))),g(this,"_userId",void 0),g(this,"_uintId",void 0),g(this,"_isDestroyed",!1),g(this,"store",void 0),g(this,"processor",void 0),g(this,"processorContext",void 0),this._userId=n,this._uintId=r,this.store=o}_updateOriginMediaStreamTrack(t){this._originMediaStreamTrack=t,this._mediaStreamTrack=t,this._updatePlayerSource(),this.processor&&this.processor.updateInput({track:this._originMediaStreamTrack,context:this.processorContext})}_destroy(){this._isDestroyed=!0,v.info("[".concat(this.getTrackId(),"] is destroyed")),this.stop(),super.close()}getProcessorStats(){return this.processorContext.gatherStats()}getProcessorUsage(){return this.processorContext.gatherUsage()}}let Gu=(HO=Te({argsMap:(e,t,n)=>[e.getTrackId(),typeof t=="string"?t:t instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement",n]}),KO=Te({argsMap:e=>[e.getTrackId()]}),zO=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),YO=Te({argsMap:e=>[e.getTrackId()]}),Y(($r=class extends tw{get isPlaying(){return!(!this._player||this._player.videoElementStatus!==gn.PLAYING)}get __className__(){return"RemoteVideoTrack"}constructor(e,t,n,r){super(e,t,n,r),g(this,"_videoVisibleTimer",null),g(this,"_previousVideoVisibleStatus",void 0),g(this,"_clearPreviousVideoVisibleStatus",()=>this._previousVideoVisibleStatus=void 0),g(this,"trackMediaType","video"),g(this,"_videoWidth",void 0),g(this,"_videoHeight",void 0),g(this,"_player",void 0),g(this,"processorDestination",void 0),g(this,"processorContext",void 0),this.updateMediaStreamTrackResolution(),this.processorContext=new RC(this.getTrackId(),"remote"),this.processorDestination=new yC(this.processorContext),this.bindProcessorDestinationEvents()}getStats(){return nd(()=>{v.warning("[deprecated] RemoteVideoTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteVideoStats instead")},"remoteVideoTrackGetStatsWarning"),li(this,Re.GET_STATS)||Bu({},FR)}play(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};if(typeof e=="string"){const r=document.getElementById(e);r?e=r:(v.warning("[".concat(this.getTrackId(),'] can not find "#').concat(e,'" element, use document.body')),e=document.body)}v.debug("[".concat(this.getTrackId(),"] start video playback in ").concat(e instanceof HTMLVideoElement?"HTMLVideoElement":"HTMLElement"),JSON.stringify(t));const n=Bu(Bu({fit:"cover"},t),{},{trackId:this.getTrackId(),element:e});this._player?this._player.updateConfig(n):(e instanceof HTMLVideoElement?this._player=new mE(n):this._player=new rA(n),this._player.updateVideoTrack(this._mediaStreamTrack),this._player.onFirstVideoFrameDecoded=()=>{this.store.subscribe(this.getUserId(),"video",void 0,void 0,Date.now()),this.safeEmit(Fa.FIRST_FRAME_DECODED)}),this._player.play(this.store.sessionId||void 0),this._videoVisibleTimer&&window.clearInterval(this._videoVisibleTimer),this._clearPreviousVideoVisibleStatus(),this._videoVisibleTimer=window.setInterval(()=>{try{const r=this.getVideoElementVisibleStatus();this.safeEmit(Fa.VIDEO_ELEMENT_VISIBLE_STATUS,r)}catch{}},k("CHECK_VIDEO_VISIBLE_INTERVAL"))}stop(){this._player&&(this._videoVisibleTimer&&(window.clearInterval(this._videoVisibleTimer),this._videoVisibleTimer=null),this._clearPreviousVideoVisibleStatus(),this._player.destroy(),this._player=void 0,v.debug("[".concat(this.getTrackId(),"] stop video playback")))}getCurrentFrameData(){return this._player?this._player.getCurrentFrame():new ImageData(2,2)}updateMediaStreamTrackResolution(){SI(this._originMediaStreamTrack).then(e=>{let[t,n]=e;this._videoHeight=n,this._videoWidth=t}).catch(Au)}_updatePlayerSource(){v.debug("[".concat(this.getTrackId(),"] update player source track")),this._player&&this._player.updateVideoTrack(this._mediaStreamTrack)}getVideoElementVisibleStatus(){try{var e,t;const n=this==null||(e=this._player)===null||e===void 0?void 0:e.getContainerElement(),r={track:this,element:this==null||(t=this._player)===null||t===void 0?void 0:t.getVideoElement(),slot:n==null?void 0:n.parentElement},{element:o,slot:a}=r;if(this.isPlaying&&o instanceof HTMLVideoElement&&a instanceof HTMLElement){const d=xA.checkOneElementVisible(o),u=Object.assign({},d);if(u.visible!==this._previousVideoVisibleStatus){this._previousVideoVisibleStatus=u.visible;const h=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.REMOTE_VIDEO_TRACK_GET_VIDEO_VISIBLE,options:[this.getTrackId()]});u.visible?h.onSuccess("Video is visible"):h.onSuccess("Invisible because of ".concat(u.reason))}return u}return}catch(n){throw new b(I.GET_VIDEO_ELEMENT_VISIBLE_ERROR,n.message)}}pipe(e){if(this.processor===e)return e;if(e._source)throw new b(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,context:this.processorContext}),e}unpipe(){if(!this.processor)return;const e=this.processor;this.processor._source=void 0,this.processor=void 0,e.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource()):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vn.ON_TRACK)}_destroy(){super._destroy(),this.unbindProcessorDestinationEvents()}}).prototype,"play",[HO],Object.getOwnPropertyDescriptor($r.prototype,"play"),$r.prototype),Y($r.prototype,"stop",[KO],Object.getOwnPropertyDescriptor($r.prototype,"stop"),$r.prototype),Y($r.prototype,"pipe",[zO],Object.getOwnPropertyDescriptor($r.prototype,"pipe"),$r.prototype),Y($r.prototype,"unpipe",[YO],Object.getOwnPropertyDescriptor($r.prototype,"unpipe"),$r.prototype),$r),Wu=(qO=Te({argsMap:(e,t)=>[e.getTrackId(),t],throttleTime:300}),JO=Te({argsMap:(e,t)=>[e.getTrackId(),t]}),XO=Te({argsMap:e=>[e.getTrackId()]}),QO=Te({argsMap:e=>[e.getTrackId()]}),$O=Te({argsMap:(e,t)=>[e.getTrackId(),t.name]}),ZO=Te({argsMap:e=>[e.getTrackId()]}),Y((bn=class extends tw{get isPlaying(){return this._useAudioElement?mr.isPlaying(this.getTrackId()):this._source.isPlayed}get __className__(){return"RemoteAudioTrack"}constructor(e,t,n,r){super(e,t,n,r),g(this,"trackMediaType","audio"),g(this,"_source",void 0),g(this,"_useAudioElement",!0),g(this,"_volume",100),g(this,"processorContext",void 0),g(this,"processorDestination",void 0),g(this,"_played",!1),g(this,"_bypassWebAudio",!1),k("DISABLE_WEBAUDIO")?(this._source=new tE,this._bypassWebAudio=!0,this._useAudioElement=!0):(this._source=new $m(e,!0),k("REMOTE_AUDIO_TRACK_USES_WEB_AUDIO")&&(this._useAudioElement=!1)),this._source.once(tr.RECEIVE_TRACK_BUFFER,()=>{this.safeEmit(Fa.FIRST_FRAME_DECODED)}),this.processorContext=new IC(this._source.context,this.getTrackId(),"remote"),this.processorDestination=new CC(this.processorContext),this.bindProcessorDestinationEvents(),this._source.on(tr.UPDATE_SOURCE,()=>{this.processor&&this.processor.updateInput({node:this._source.processSourceNode,context:this.processorContext})})}setAudioFrameCallback(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:4096;if(!e)return this._source.removeAllListeners(tr.ON_AUDIO_BUFFER),void this._source.stopGetAudioBuffer();this._source.startGetAudioBuffer(t),this._source.removeAllListeners(tr.ON_AUDIO_BUFFER),this._source.on(tr.ON_AUDIO_BUFFER,n=>e(n))}setVolume(e){this._volume=e,this._useAudioElement?mr.setVolume(this.getTrackId(),e):this._source.setVolume(e/100)}async setPlaybackDevice(e){if(!this._useAudioElement)throw new b(I.NOT_SUPPORTED,"your browser does not support setting the audio output device");await mr.setSinkID(this.getTrackId(),e)}getVolumeLevel(){return this._source.getAccurateVolumeLevel()}getStats(){return nd(()=>{v.warning("[deprecated] RemoteAudioTrack.getStats will be removed in the future, use AgoraRTCClient.getRemoteAudioStats instead")},"remoteAudioTrackGetStatsWarning"),li(this,Re.GET_STATS)||Bu({},VR)}play(){v.debug("[".concat(this.getTrackId(),"] start audio playback")),this._played=!0,this._useAudioElement?(v.debug("[".concat(this.getTrackId(),"] use audio element to play")),mr.play(this._mediaStreamTrack,this.getTrackId(),this._volume,this.store.sessionId||void 0)):this._source.play()}stop(){v.debug("[".concat(this.getTrackId(),"] stop audio playback")),this._played=!1,this._useAudioElement?mr.stop(this.getTrackId()):this._source.stop()}_destroy(){super._destroy(),this._played=!1,this.unbindProcessorDestinationEvents(),this._source.destroy()}_isFreeze(){return this._source.isFreeze}_updatePlayerSource(){let e=!(arguments.length>0&&arguments[0]!==void 0)||arguments[0];v.debug("[".concat(this.getTrackId(),"] update player source track")),e&&this._source.updateTrack(this._mediaStreamTrack),this._useAudioElement&&mr.updateTrack(this.getTrackId(),this._mediaStreamTrack)}pipe(e){if(this._bypassWebAudio)throw new b(I.NOT_SUPPORTED,"can not pipe extension when WebAudio disabled");if(this.processor===e)return e;if(e._source)throw new b(I.INVALID_OPERATION,"Processor ".concat(e.name," already piped, please call unpipe beforehand."));return this.unpipe(),this.processor=e,this.processor._source=this,e.updateInput({track:this._originMediaStreamTrack,node:this._source.processSourceNode,context:this.processorContext}),e}unpipe(){var e;if(this._bypassWebAudio)throw new b(I.NOT_SUPPORTED,"can not unpipe extension when WebAudio disabled");if(!this.processor)return;const t=this.processor;(e=this._source.processSourceNode)===null||e===void 0||e.disconnect(),this.processor._source=!1,this.processor=void 0,t.reset()}bindProcessorDestinationEvents(){this.processorDestination.on(vn.ON_TRACK,async e=>{e?e!==this._mediaStreamTrack&&(this._mediaStreamTrack=e,this._updatePlayerSource(!1),this._source.processedNode=this._source.createMediaStreamSourceNode(e)):this._mediaStreamTrack!==this._originMediaStreamTrack&&(this._mediaStreamTrack=this._originMediaStreamTrack,this._updatePlayerSource())}),this.processorDestination.on(vn.ON_NODE,e=>{this._source.processedNode=e;const t=!e;this._useAudioElement!==t&&(this._played?(this.stop(),this._useAudioElement=t,this.play()):this._useAudioElement=t)})}unbindProcessorDestinationEvents(){this.processorDestination.removeAllListeners(vn.ON_TRACK),this.processorDestination.removeAllListeners(vn.ON_NODE)}}).prototype,"setVolume",[qO],Object.getOwnPropertyDescriptor(bn.prototype,"setVolume"),bn.prototype),Y(bn.prototype,"setPlaybackDevice",[JO],Object.getOwnPropertyDescriptor(bn.prototype,"setPlaybackDevice"),bn.prototype),Y(bn.prototype,"play",[XO],Object.getOwnPropertyDescriptor(bn.prototype,"play"),bn.prototype),Y(bn.prototype,"stop",[QO],Object.getOwnPropertyDescriptor(bn.prototype,"stop"),bn.prototype),Y(bn.prototype,"pipe",[$O],Object.getOwnPropertyDescriptor(bn.prototype,"pipe"),bn.prototype),Y(bn.prototype,"unpipe",[ZO],Object.getOwnPropertyDescriptor(bn.prototype,"unpipe"),bn.prototype),bn);function nw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function rw(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?nw(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):nw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}class wB extends gt{constructor(){super(),g(this,"uplinkStatsUploadInterval",void 0),g(this,"uplinkRelatedStatsUploadInterval",void 0),g(this,"uplinkDenoiserStatsUploadInterval",void 0),g(this,"transportStatsUploadInterval",void 0),g(this,"uplinkExtensionStatsUploadInterval",void 0),g(this,"downlinkExtensionStatsUploadInterval",void 0),g(this,"extensionUsageStatsUploadInterval",void 0),g(this,"downlinkStatsUploadInterval",void 0),g(this,"downlinkRelatedStatsUploadInterval",void 0),g(this,"lastStats",void 0),g(this,"uploadUnplinkStarted",!1),g(this,"uploadDownlinkStarted",!1),g(this,"uploadTransportStarted",!1),g(this,"uploadExtensionUsageStarted",!1),g(this,"requestStats",void 0),g(this,"requestLocalMedia",void 0),g(this,"requestRemoteMedia",void 0),g(this,"requestAllTracks",void 0),g(this,"requestVideoIsReady",void 0),g(this,"requestUpload",void 0)}startUploadTransportStats(){this.uploadTransportStarted||(this.uploadTransportStarted=!0,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadTransportStats(n)},1e3))}startUploadExtensionUsageStats(){if(this.uploadExtensionUsageStarted)return;this.uploadExtensionUsageStarted=!0,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval);const t=new Map;this.extensionUsageStatsUploadInterval=window.setInterval(async()=>{var n,r,o;const a=Date.now(),d={connectionInterval:k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3,details:[],lts:a};let u=[];const h=((n=this.requestAllTracks)===null||n===void 0?void 0:n.call(this))||[];for(const T of h)!T.muted&&T.enabled&&(u=u.concat(await T.getProcessorUsage()));const m=((r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this))||[];for(const[T,R]of m)R.has(be.VIDEO)&&T.videoTrack&&(u=u.concat(await T.videoTrack.getProcessorUsage())),R.has(be.AUDIO)&&T.audioTrack&&(u=u.concat(await T.audioTrack.getProcessorUsage()));if(u.length===0)return;d.details=function(T,R){const A={};for(const{id:V,value:X,level:le,direction:$}of T){var O;const ee=(O=R.get(V))!==null&&O!==void 0?O:0,q=X===2?ee+k("EXTENSION_USAGE_UPLOAD_INTERVAL")/1e3:ee;var w,x;R.set(V,q),A[V]?(X===2&&(A[V].value=X),le>A[V].level&&(A[V].level=le),$==="remote"&&(A[V].remoteUidCount+=1),A[V].totalTs=(w=R.get(V))!==null&&w!==void 0?w:0):A[V]={value:X,level:le,remoteUidCount:$==="local"?0:1,totalTs:(x=R.get(V))!==null&&x!==void 0?x:0}}return Object.keys(A).map(V=>{const{level:X,value:le,totalTs:$}=A[V];return{id:V,level:X,value:le,totalTs:$}})}(u,t);const f=Date.now(),E=f>a?f:a+1;(o=this.requestUpload)===null||o===void 0||o.call(this,pr.EXTENSION_USAGE_STATS,{usageStats:d,sendTs:E})},k("EXTENSION_USAGE_UPLOAD_INTERVAL"))}startUploadUplinkStats(){this.uploadUnplinkStarted||(this.uploadUnplinkStarted=!0,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&(this.uploadUplinkStats(n),this.lastStats=n)},3e3),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkRelatedStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestStats)===null||t===void 0?void 0:t.call(this);n&&this.uploadRelatedUplinkStats(n,this.lastStats),this.lastStats=n},1e3),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadDenoiserStats(n)},2e3),this.uplinkExtensionStatsUploadInterval&&window.clearInterval(this.uplinkExtensionStatsUploadInterval),this.uplinkExtensionStatsUploadInterval=window.setInterval(()=>{var t;const n=(t=this.requestAllTracks)===null||t===void 0?void 0:t.call(this);n&&this.uploadExtensionStats(n)},2e3))}uploadTransportStats(t){Li(()=>{var n;(n=this.requestUpload)===null||n===void 0||n.call(this,pr.TRANSPORT_STATS,function(r){const o={connectionType:100,googRtt:r.rtt};if(r.selectedCandidatePair.localCandidate.candidateType==="relay"){const a=r.selectedCandidatePair.localCandidate.relayProtocol;a==="udp"&&(o.connectionType=101),a==="tcp"&&(o.connectionType=103),a==="tls"&&(o.connectionType=104)}return o}(t))})}uploadUplinkStats(t){var n;(((n=this.requestLocalMedia)===null||n===void 0?void 0:n.call(this))||[]).forEach(r=>{let[o,{track:a,ssrcs:d}]=r;switch(o){case ue.LocalVideoLowTrack:case ue.LocalVideoTrack:{const u=function(f,E,T){var R;const A=E.videoSend.find(w=>w.ssrc===f);if(!A)return null;const O={id:ut(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:A.ssrc.toString()};switch(O.A_vstd=T._originMediaStreamTrack&&!T._originMediaStreamTrack.enabled||T._mediaStreamTrack&&!T._mediaStreamTrack.enabled?"1":"0",A.sentFrame&&(O.A_fhs=A.sentFrame.height.toString(),O.A_frs=A.sentFrame.frameRate.toString(),O.A_fws=A.sentFrame.width.toString()),A.adaptionChangeReason){case"none":O.A_ac="0";break;case"cpu":O.A_ac="1";break;case"bandwidth":O.A_ac="2";break;case"other":O.A_ac="3"}return O.A_lvps=Lm[T._player?T._player.videoElementStatus:"uninit"].toString(),O.A_nr=(R=A.nacksCount)===null||R===void 0?void 0:R.toString(),A.avgEncodeMs&&(O.A_aem=A.avgEncodeMs.toFixed(0).toString()),O}(d[0].ssrcId,t,a),h=o===ue.LocalVideoTrack?function(f,E,T){var R,A,O,w,x,V,X,le;const $=E.videoSend.find(Se=>Se.ssrc===f);if(!$)return null;const ee={id:ut(10,""),timestamp:new Date(E.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:$.ssrc.toString()},q=(R=(A=(O=$.inputFrame)===null||O===void 0?void 0:O.height)!==null&&A!==void 0?A:T==null?void 0:T._videoHeight)!==null&&R!==void 0?R:0,re=(w=(x=(V=$.inputFrame)===null||V===void 0?void 0:V.width)!==null&&x!==void 0?x:T==null?void 0:T._videoWidth)!==null&&w!==void 0?w:0,ze=(X=(le=$.inputFrame)===null||le===void 0?void 0:le.frameRate)!==null&&X!==void 0?X:0;return q&&(ee.A_fhi=q+""),re&&(ee.A_fwi=re+""),ze&&(ee.A_fri=ze+""),ee}(d[0].ssrcId,t,a):null;u&&Li(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,pr.PUBLISH_STATS,{stream_type:o===ue.LocalVideoLowTrack?"low":"high",stats:rw(rw({},u),h)})});const m=function(f){const E={id:"bweforvideo",timestamp:new Date(f.timestamp).toISOString(),type:"VideoBwe"};return f.bitrate.retransmit&&(E.A_rb=f.bitrate.retransmit.toString()),f.bitrate.targetEncoded&&(E.A_teb=f.bitrate.targetEncoded.toString()),E.A_aeb=f.bitrate.actualEncoded.toString(),E.A_tb=f.bitrate.transmit.toString(),f.sendBandwidth!==void 0&&(E.A_asb=f.sendBandwidth.toString()),E}(t);m&&setTimeout(()=>{var f;return(f=this.requestUpload)===null||f===void 0?void 0:f.call(this,pr.PUBLISH_STATS,{stream_type:o===ue.LocalVideoLowTrack?"low":"high",stats:m})},1e3);break}case ue.LocalAudioTrack:{const u=function(h,m,f){const E=m.audioSend.find(R=>R.ssrc===h);if(!E)return null;const T={id:ut(10,""),timestamp:new Date(m.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:E.ssrc.toString()};return T.A_astd=f._originMediaStreamTrack&&!f._originMediaStreamTrack.enabled||f._mediaStreamTrack&&!f._mediaStreamTrack.enabled?"1":"0",E.inputLevel?T.A_ail=Math.round(100*E.inputLevel).toString():T.A_ail=Math.round(100*f._source.getAccurateVolumeLevel()).toString(),T.A_apil=Math.round(100*f._source.getAccurateVolumeLevel()).toString(),E.aecReturnLoss&&(T.A_ecrl=Math.round(E.aecReturnLoss).toString()),E.aecReturnLossEnhancement&&(T.A_ecrle=Math.round(E.aecReturnLossEnhancement).toString()),T}(d[0].ssrcId,t,a);u&&Li(()=>{var h;return(h=this.requestUpload)===null||h===void 0?void 0:h.call(this,pr.PUBLISH_STATS,{stream_type:"high",stats:u})});break}}})}uploadRelatedUplinkStats(t,n){var r;(((r=this.requestLocalMedia)===null||r===void 0?void 0:r.call(this))||[]).filter(o=>{let[a]=o;return a===ue.LocalVideoLowTrack||a===ue.LocalVideoTrack}).forEach(o=>{let[a,{ssrcs:d}]=o;const u=function(h,m){const f=m.videoSend.find(E=>E.ssrc===h);return f?{mediaType:"video",isVideoMute:!1,frameRateInput:f.inputFrame&&f.inputFrame.frameRate.toString(),frameRateSent:f.sentFrame&&f.sentFrame.frameRate.toString(),googRtt:f.rttMs.toString(),qpSumPerFrame:Math.floor(f.qpSumPerFrame).toString()}:null}(d[0].ssrcId,t);u&&Li(()=>{var h;(h=this.requestUpload)===null||h===void 0||h.call(this,pr.PUBLISH_RELATED_STATS,{stream_type:a===ue.LocalVideoLowTrack?"low":"high",stats:u})})})}uploadDenoiserStats(t){for(let a=0;a<t.length;a++){const d=t[a];if(d instanceof yu){var n,r,o;const u=(n=(r=d._external).getDenoiserStats)===null||n===void 0?void 0:n.call(r);return void(u&&((o=this.requestUpload)===null||o===void 0||o.call(this,pr.DENOISER_STATS,u)))}}}uploadExtensionStats(t){for(let n=0;n<t.length;n++)t[n].getProcessorStats().forEach(r=>{var o;(o=this.requestUpload)===null||o===void 0||o.call(this,r.type,r.stats)})}stopUploadUplinkStats(){this.uploadUnplinkStarted&&(this.uploadUnplinkStarted=!1,this.uplinkStatsUploadInterval&&window.clearInterval(this.uplinkStatsUploadInterval),this.uplinkRelatedStatsUploadInterval&&window.clearInterval(this.uplinkRelatedStatsUploadInterval),this.uplinkDenoiserStatsUploadInterval&&window.clearInterval(this.uplinkDenoiserStatsUploadInterval),this.uplinkStatsUploadInterval=void 0,this.uplinkRelatedStatsUploadInterval=void 0,this.uplinkDenoiserStatsUploadInterval=void 0)}startUploadDownlinkStats(){if(this.uploadDownlinkStarted)return;let t;this.uploadDownlinkStarted=!0,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval);let n=!1;this.downlinkStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestStats)===null||r===void 0?void 0:r.call(this);o&&(this.uploadDownlinkStats(o,n,t),t=o),n=!n},3e3),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkRelatedStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestStats)===null||r===void 0?void 0:r.call(this);o&&(this.uploadRelatedDownlinkStats(o,this.lastStats),this.lastStats=o)},1e3),this.downlinkExtensionStatsUploadInterval&&window.clearInterval(this.downlinkExtensionStatsUploadInterval),this.downlinkExtensionStatsUploadInterval=window.setInterval(()=>{var r;const o=(r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this);o&&this.uploadDownlinkExtensionStats(o)},2e3)}uploadDownlinkStats(t,n,r){var o;(((o=this.requestRemoteMedia)===null||o===void 0?void 0:o.call(this))||[]).forEach(a=>{let[d,u]=a;if(u.has(be.VIDEO)&&d.videoTrack){const h=d.videoTrack?function(m,f,E,T,R){const A=f.videoRecv.find(V=>V.ssrc===m);if(!A)return null;const O={id:ut(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"video",type:"ssrc",ssrc:A.ssrc.toString()};var w,x;if(O.bytesReceived=A.bytes.toString(),O.packetsLost=A.packetsLost.toString(),O.packetsReceived=A.packets.toString(),A.framesRateFirefox&&(O.A_frr=A.framesRateFirefox.toString()),A.receivedFrame?(O.A_frr=A.receivedFrame.frameRate.toString(),O.A_fhr=A.receivedFrame.height.toString(),O.A_fwr=A.receivedFrame.width.toString()):(O.A_fhr=(w=T._videoHeight)===null||w===void 0?void 0:w.toString(),O.A_fwr=(x=T._videoWidth)===null||x===void 0?void 0:x.toString()),O.A_frd=A.decodeFrameRate.toString(),A.outputFrame&&(O.A_fro=A.outputFrame.frameRate.toString()),A.jitterBufferMs!==void 0&&(O.A_jbm=Math.floor(A.jitterBufferMs).toString()),A.currentDelayMs!==void 0&&(O.A_cdm=Math.floor(A.currentDelayMs).toString()),O.A_fs=A.firsCount.toString(),O.A_ns=A.nacksCount.toString(),O.A_ps=A.plisCount.toString(),T&&(O.A_vrtd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),T._player&&T._player.freezeTimeCounterList.length>0&&(O.A_vrft=Math.round(T._player.freezeTimeCounterList.splice(0,1)[0]).toString()),R&&T._player&&Eo.visibility==="visible"){const V=Math.min(6e3,T._player.renderFreezeAccTime);O.A_vrrft=Math.round(V).toString(),T._player.renderFreezeAccTime=Math.max(0,T._player.renderFreezeAccTime-V)}if(O.A_rvps=Lm[T._player?T._player.videoElementStatus:"uninit"].toString(),E){const V=E.videoRecv.find(X=>X.ssrc===m);if(V&&A.totalInterFrameDelay!==void 0&&A.totalSquaredInterFrameDelay!==void 0&&V.totalInterFrameDelay!==void 0&&V.totalSquaredInterFrameDelay!==void 0){const X=A.totalInterFrameDelay-V.totalInterFrameDelay,le=A.totalSquaredInterFrameDelay-V.totalSquaredInterFrameDelay,$=A.framesDecodeCount-V.framesDecodeCount,ee=X/$*1e3,q=Math.round(1e3*Math.sqrt((le-Math.pow(X,2)/$)/$));!isNaN(q)&&ee+q>Math.max(3*ee,ee+150)&&(O.A_ifdsd=q.toString())}}return O}(d._videoSSRC,t,r,d.videoTrack,n):void 0;h&&Li(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,pr.SUBSCRIBE_STATS,{stream_id:d.uid,stats:h})})}if(u.has(be.AUDIO)&&d.audioTrack){const h=d.audioTrack?function(m,f,E,T){const R=f.audioRecv.find(O=>O.ssrc===m);if(!R)return null;const A={id:ut(10,""),timestamp:new Date(f.timestamp).toISOString(),mediaType:"audio",type:"ssrc",ssrc:R.ssrc.toString()};if(A.bytesReceived=R.bytes.toString(),A.packetsLost=R.packetsLost.toString(),A.packetsReceived=R.packets.toString(),R.outputLevel?A.A_aol=Math.round(100*R.outputLevel).toString():A.A_aol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),A.A_apol=Math.round(100*T._source.getAccurateVolumeLevel()).toString(),T&&(A.A_artd=T._originMediaStreamTrack.enabled&&T._mediaStreamTrack.enabled?"0":"1"),A.A_jr=R.jitterMs.toString(),A.A_jbm=Math.floor(R.jitterBufferMs).toString(),A.A_cdm=Math.floor(R.jitterBufferMs).toString(),A.A_raps=Lm[mr.getPlayerState(T.getTrackId())].toString(),E){const O=E.audioRecv.find(w=>w.ssrc===m);if(O){const w=R.concealedSamples-O.concealedSamples;w>0&&(A.A_cs=Math.round(w).toString())}}return A}(d._audioSSRC,t,r,d.audioTrack):void 0;h&&Li(()=>{var m;return(m=this.requestUpload)===null||m===void 0?void 0:m.call(this,pr.SUBSCRIBE_STATS,{stream_id:d.uid,stats:h})})}})}uploadRelatedDownlinkStats(t,n){var r;(((r=this.requestRemoteMedia)===null||r===void 0?void 0:r.call(this))||[]).forEach(o=>{let[a,d]=o;if(d.has(be.VIDEO)&&a.videoTrack){var u;const h=(a._videoSSRC&&((u=this.requestVideoIsReady)===null||u===void 0?void 0:u.call(this,a._videoSSRC))||!1)===!0,m=function(f,E,T,R,A,O){const w=T.videoRecv.find(le=>le.ssrc===f),x=A?A.videoRecv.find(le=>le.ssrc===f):void 0;if(!w)return null;const V=Ha.isRemoteVideoFreeze(O,w,x)&&E,X={mediaType:"video",isVideoMute:!1,peerId:R,frameRateReceived:w.receivedFrame&&w.receivedFrame.frameRate.toString(),frameRateDecoded:w.decodedFrame&&w.decodedFrame.frameRate.toString(),isFreeze:V,bytesReceived:w.bytes.toString(),packetsReceived:w.packets.toString(),packetsLost:w.packetsLost.toString(),qpSumPerFrame:Math.floor(w.qpSumPerFrame).toString()};return w.framesRateFirefox&&(X.frameRateDecoded=w.framesRateFirefox.toString(),X.frameRateReceived=w.framesRateFirefox.toString()),X}(a._videoSSRC,h,t,a.uid,n,a.videoTrack);m&&Li(()=>{var f;(f=this.requestUpload)===null||f===void 0||f.call(this,pr.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:m})})}if(d.has(be.AUDIO)&&a.audioTrack){const h=function(m,f,E,T){const R=f.audioRecv.find(O=>O.ssrc===m);if(!R)return null;const A=Ha.isRemoteAudioFreeze(T);return{mediaType:"audio",isAudioMute:!1,peerId:E,googJitterReceived:R.jitterMs.toString(),isFreeze:A,bytesReceived:R.bytes.toString(),packetsReceived:R.packets.toString(),packetsLost:R.packetsLost.toString(),frameReceived:R.receivedFrames.toString(),frameDropped:R.droppedFrames.toString()}}(a._audioSSRC,t,a.uid,a.audioTrack);h&&Li(()=>{var m;(m=this.requestUpload)===null||m===void 0||m.call(this,pr.SUBSCRIBE_RELATED_STATS,{stream_id:a.uid,stats:h})})}})}stopUploadDownlinkStats(){this.uploadDownlinkStarted&&(this.uploadDownlinkStarted=!1,this.downlinkStatsUploadInterval&&window.clearInterval(this.downlinkStatsUploadInterval),this.downlinkRelatedStatsUploadInterval&&window.clearInterval(this.downlinkRelatedStatsUploadInterval),this.downlinkStatsUploadInterval=void 0,this.downlinkRelatedStatsUploadInterval=void 0)}stopUploadTransportStats(){this.uploadTransportStarted&&(this.uploadTransportStarted=!1,this.transportStatsUploadInterval&&window.clearInterval(this.transportStatsUploadInterval),this.transportStatsUploadInterval=void 0)}stopUploadExtensionUsageStats(){this.uploadExtensionUsageStarted&&(this.uploadExtensionUsageStarted=!1,this.extensionUsageStatsUploadInterval&&window.clearInterval(this.extensionUsageStatsUploadInterval),this.extensionUsageStatsUploadInterval=void 0)}uploadDownlinkExtensionStats(t){t.forEach(n=>{let[r,o]=n;o.has(be.VIDEO)&&r.videoTrack&&r.videoTrack.getProcessorStats().forEach(a=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,a.type,a.stats)}),o.has(be.AUDIO)&&r.audioTrack&&r.audioTrack.getProcessorStats().forEach(a=>{var d;(d=this.requestUpload)===null||d===void 0||d.call(this,a.type,a.stats)})})}}function iw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ow(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?iw(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):iw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const sw=`v=0
o=- 0 0 IN IP4 127.0.0.1
s=AgoraGateway
t=0 0
a=group:BUNDLE 0
a=msid-semantic: WMS
a=ice-lite
m=application 9 UDP/DTLS/SCTP webrtc-datachannel
c=IN IP4 127.0.0.1
a=mid:0
`,Hu="9",BE=2e4,GE=4e4;class NB{get localCapabilities(){return Vt(this._localCapabilities)}get rtpCapabilities(){return Vt(this._rtpCapabilities)}get candidates(){return Vt(this._candidates)}get iceParameters(){return Vt(this._iceParameters)}get dtlsParameters(){return Vt(this._dtlsParameters)}constructor(t){g(this,"sessionDesc",void 0),g(this,"_localCapabilities",void 0),g(this,"_rtpCapabilities",void 0),g(this,"_candidates",void 0),g(this,"_iceParameters",void 0),g(this,"_dtlsParameters",void 0),g(this,"setup",void 0),g(this,"currentMidIndex",void 0),g(this,"cname",void 0),g(this,"firefoxSsrcMidMap",new Map),t=Vt(t);const{remoteIceParameters:n,remoteDtlsParameters:r,candidates:o,remoteRTPCapabilities:a,remoteSetup:d,localCapabilities:u,cname:h}=t,m=jt.exports.parse(sw);this._rtpCapabilities=a,this._candidates=o,this._iceParameters=n,this._dtlsParameters=r,this._localCapabilities=u,this.setup=d,this.cname=h;const f=this.rtpCapabilities.send;for(const E of m.mediaDescriptions){if(E.attributes.iceUfrag=n.iceUfrag,E.attributes.icePwd=n.icePwd,E.attributes.fingerprints=r.fingerprints,E.attributes.candidates=o,E.attributes.setup=d,E.media.mediaType==="application"&&(E.attributes.sctpPort="5000"),E.media.mediaType==="video"&&(E.media.fmts=f.videoCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=f.videoCodecs,E.attributes.extmaps=f.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=Jr([{ssrcId:GE,rtx:k("USE_SUB_RTX")?40001:void 0}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=R}if(E.media.mediaType==="audio"&&(E.media.fmts=f.audioCodecs.map(T=>T.payloadType.toString(10)),E.attributes.payloads=f.audioCodecs,E.attributes.extmaps=f.audioExtensions,Zo(E),k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:T,ssrcGroups:R}=Jr([{ssrcId:BE}],this.cname);E.attributes.ssrcs=T,E.attributes.ssrcGroups=R}}this.sessionDesc=m,this.currentMidIndex=m.mediaDescriptions.length-1}updateRemoteRTPCapabilities(t){const n=jt.exports.parse(sw);this._rtpCapabilities=t;const r=this.rtpCapabilities.send;for(const o of n.mediaDescriptions){if(o.attributes.iceUfrag=this._iceParameters.iceUfrag,o.attributes.icePwd=this._iceParameters.icePwd,o.attributes.fingerprints=this._dtlsParameters.fingerprints,o.attributes.candidates=this._candidates,o.attributes.setup=this.setup,o.media.mediaType==="application"&&(o.attributes.sctpPort="5000"),o.media.mediaType==="video"&&(o.media.fmts=r.videoCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=r.videoCodecs,o.attributes.extmaps=r.videoExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:d}=Jr([{ssrcId:GE,rtx:k("USE_SUB_RTX")?40001:void 0}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=d}if(o.media.mediaType==="audio"&&(o.media.fmts=r.audioCodecs.map(a=>a.payloadType.toString(10)),o.attributes.payloads=r.audioCodecs,o.attributes.extmaps=r.audioExtensions,k("PRELOAD_MEDIA_COUNT")>0)){const{ssrcs:a,ssrcGroups:d}=Jr([{ssrcId:BE}],this.cname);o.attributes.ssrcs=a,o.attributes.ssrcGroups=d}}this.sessionDesc=n,this.currentMidIndex=n.mediaDescriptions.length-1}preloadRemoteMedia(t){this.rtpCapabilities;const n=this.candidates,r=this.dtlsParameters,o=this.iceParameters,a=this.rtpCapabilities.send;for(let d=1;d<t;d++){const u=2*d+BE,h=2*d+GE,{ssrcs:m,ssrcGroups:f}=Jr([{ssrcId:u}],this.cname),{ssrcs:E,ssrcGroups:T}=Jr([{ssrcId:h,rtx:k("USE_SUB_RTX")?h+1:void 0}],this.cname);this.sessionDesc.mediaDescriptions.push({media:{mediaType:"video",port:Hu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.videoCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.videoExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:E,ssrcGroups:T,rtcpFeedbackWildcards:[],payloads:a.videoCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d-1)}}),this.sessionDesc.mediaDescriptions.push({media:{mediaType:"audio",port:Hu,protos:["UDP","TLS","RTP","SAVPF"],fmts:a.audioCodecs.map(R=>R.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:o.iceUfrag,icePwd:o.icePwd,unrecognized:[],candidates:n,extmaps:a.audioExtensions,fingerprints:r.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:m,ssrcGroups:f,rtcpFeedbackWildcards:[],payloads:a.audioCodecs,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:"sendonly",rtcpMux:!0,rtcpRsize:!0,mid:"".concat(2*d)}}),this.currentMidIndex+=2}this.updateBundleMids()}toString(){return jt.exports.print(this.sessionDesc)}send(t,n,r,o){const{ssrcs:a,ssrcGroups:d}=Jr(n,this.cname,k("SYNC_GROUP")?r:void 0),u=this.findPreloadMediaDesc(a);if(u){if(Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,u.attributes.mid),o&&(o.twcc||o.remb)){const h=this.sessionDesc.mediaDescriptions.indexOf(u);return this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(u,o),{mid:u.attributes.mid,needExchangeSDP:!0}}return{mid:u.attributes.mid,needExchangeSDP:!1}}{const h=this.findAvailableMediaIndex(t,a);let m;return h===-1||kn()||Mn()||ky()||h===0&&k("USE_SUB_RTX")?(m=this.createOrRecycleSendMedia(t,a,d,"sendonly",o),this.updateBundleMids()):(m=Vt(this.sessionDesc.mediaDescriptions[h]),m.attributes.direction="sendonly",m.attributes.ssrcs=a,m.attributes.ssrcGroups=d,this.sessionDesc.mediaDescriptions[h]=this.mungSendMediaDesc(m,o)),Tt()&&this.firefoxSsrcMidMap.set(a[0].ssrcId,m.attributes.mid),{mid:m.attributes.mid,needExchangeSDP:!0}}}batchSend(t){const n=t.map(a=>{let{kind:d,ssrcMsg:u,mslabel:h}=a;return this.send(d,u,h)}),r=[];let o=!1;return n.forEach(a=>{let{mid:d,needExchangeSDP:u}=a;u&&(o=!0),r.push(d)}),{mids:r,needExchangeSDP:o}}stopSending(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>r.attributes.mid&&t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.stopSending.");n.forEach(r=>{r.attributes.mid==="0"||Tt()||kn()||Mn()?r.attributes.ssrcs=[]:(r.attributes.ssrcs=[],r.attributes.direction="inactive",r.media.port="0")}),this.updateBundleMids()}mute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.mute."));n.attributes.direction="inactive"}unmute(t){const n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t);if(!n)throw new Error("mediaDescription not found with ".concat(t," in remote SDP when calling RemoteSDP.unmute."));n.attributes.direction="sendonly"}muteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="inactive"})}unmuteRemote(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.includes(r.attributes.mid||""));if(n.length!==t.length)throw new Error("mediaDescriptions' length doesn't match mids' length when calling RemoteSDP.muteRemote.");n.forEach(r=>{r.attributes.direction="recvonly"})}receive(t,n,r,o){t.forEach((a,d)=>{this.createOrRecycleRecvMedia(a,[],"recvonly",n,r,o[d])}),this.updateBundleMids()}stopReceiving(t){const n=this.sessionDesc.mediaDescriptions.filter(r=>t.indexOf(r.attributes.mid)!==-1);if(n.length!==t.length)throw new Error("MediaDescriptions' length doesn't match mids's length when calling RemoteSDP.receive.");n.forEach(r=>{r.media.port="0",r.attributes.direction="inactive"}),this.updateBundleMids()}updateCandidates(t){t===dn.TCP?this._candidates.forEach(n=>{this._candidates.findIndex(r=>r.transport==="tcp"&&r.connectionAddress===n.connectionAddress&&r.port===n.port)===-1&&this._candidates.push(ow(ow({},n),{},{foundation:"tcpcandidate",priority:Number(n.priority)-1+"",transport:"tcp",port:Number(n.port)+90+""}))}):this._candidates=this._candidates.filter(n=>n.transport!=="tcp");for(const n of this.sessionDesc.mediaDescriptions)n.attributes.candidates=this.candidates}restartICE(t){t=Vt(t),this._iceParameters=t,this.sessionDesc.mediaDescriptions.forEach(n=>{n.attributes.iceUfrag=t.iceUfrag,n.attributes.icePwd=t.icePwd})}predictReceivingMids(t){const n=[];for(let r=0;r<t;r++)n.push((this.currentMidIndex+r+1).toString(10));return n}findAvailableMediaIndex(t,n){return this.sessionDesc.mediaDescriptions.findIndex(r=>{const o=r.media.mediaType===t&&r.media.port!=="0"&&(r.attributes.direction==="sendonly"||r.attributes.direction==="sendrecv")&&r.attributes.ssrcs.length===0;if(Tt()){if(o){const a=this.firefoxSsrcMidMap.get(n[0].ssrcId);return!(a||r.attributes.mid!=="0"&&r.attributes.mid!=="1")||!(!a||a!==r.attributes.mid)}return!1}return o})}createOrRecycleRecvMedia(t,n,r,o,a,d){const u=t._mediaStreamTrack.kind,h=this.rtpCapabilities.recv,m=this.localCapabilities.send;let f=[];if(u===be.VIDEO){var E,T;if(k("H264_PROFILE_LEVEL_ID")&&o==="h264"&&(f=h.videoCodecs.filter(x=>{var V,X;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes(o)&&(x==null||(X=x.fmtp)===null||X===void 0?void 0:X.parameters["profile-level-id"])===k("H264_PROFILE_LEVEL_ID")})),!f||((E=f)===null||E===void 0?void 0:E.length)===0){const x=m.videoCodecs.filter(V=>{var X;return(((X=V.rtpMap)===null||X===void 0?void 0:X.encodingName.toLowerCase())||"").includes(o)});x.length!==0&&(f=h.videoCodecs.filter(V=>x.some(X=>X.payloadType===V.payloadType)))}if(k("USE_PUB_RTX")){const x=f.map(X=>X.payloadType.toString()),V=h.videoCodecs.filter(X=>{var le,$;return((le=X.rtpMap)===null||le===void 0?void 0:le.encodingName)==="rtx"&&x.includes((($=X.fmtp)===null||$===void 0?void 0:$.parameters.apt)||"")});f=[...f,...V]}f.length===0&&(v.warning("codec ".concat(o," not included in rtpCapabilities, fallback to default payloads: ").concat((T=h.videoCodecs[0].rtpMap)===null||T===void 0?void 0:T.encodingName)),f=h.videoCodecs)}else f=h.audioCodecs.filter(x=>{var V;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes(a)}),f.length===0&&(v.warning("codec ".concat(a," not included in rtpCapabilities, fallback to opus")),f=h.audioCodecs.filter(x=>{var V;return(((V=x.rtpMap)===null||V===void 0?void 0:V.encodingName.toLowerCase())||"").includes("opus")}));const R=u===be.VIDEO?h.videoExtensions:h.audioExtensions;this.currentMidIndex+=1;const A="".concat(this.currentMidIndex);let O={media:{mediaType:u,port:Hu,protos:["UDP","TLS","RTP","SAVPF"],fmts:f.map(x=>x.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:R,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:[],rtcpFeedbackWildcards:[],payloads:f,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:r,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(A)}};O=this.mungRecvMediaDsec(O,t,d);const w=this.findFirstClosedMedia(u);if(w){const x=this.sessionDesc.mediaDescriptions.indexOf(w);this.sessionDesc.mediaDescriptions[x]=O}else this.sessionDesc.mediaDescriptions.push(O);return O}createOrRecycleSendMedia(t,n,r,o,a){const d=this.rtpCapabilities.send,u=t===be.VIDEO?d.videoCodecs:d.audioCodecs,h=t===be.VIDEO?d.videoExtensions:d.audioExtensions;this.currentMidIndex+=1;const m="".concat(this.currentMidIndex);let f={media:{mediaType:t,port:Hu,protos:["UDP","TLS","RTP","SAVPF"],fmts:u.map(T=>T.payloadType.toString(10))},connections:[{nettype:"IN",addrtype:"IP4",address:"127.0.0.1"}],bandwidths:[],attributes:{iceUfrag:this.iceParameters.iceUfrag,icePwd:this.iceParameters.icePwd,unrecognized:[],candidates:this.candidates,extmaps:h,fingerprints:this.dtlsParameters.fingerprints,imageattr:[],msids:[],remoteCandidatesList:[],rids:[],ssrcs:n,ssrcGroups:r,rtcpFeedbackWildcards:[],payloads:u,rtcp:{port:"9",netType:"IN",addressType:"IP4",address:"0.0.0.0"},setup:this.setup,direction:o,rtcpMux:!0,rtcpRsize:!0,mid:"".concat(m)}};f=this.mungSendMediaDesc(f,a);const E=this.findFirstClosedMedia(t);if(E){const T=this.sessionDesc.mediaDescriptions.indexOf(E);this.sessionDesc.mediaDescriptions[T]=f}else this.sessionDesc.mediaDescriptions.push(f);return f}updateBundleMids(){this.sessionDesc.attributes.groups[0].identificationTag=this.sessionDesc.mediaDescriptions.filter(t=>t.media.port!=="0").map(t=>t.attributes.mid)}mungRecvMediaDsec(t,n,r){const o=Vt(t);return ME(o),Qa(o,n),UE(o,n),yO(o),Vu(o,r,this.localCapabilities.send),o}mungSendMediaDesc(t,n){const r=Vt(t);return Vu(r,n,this.localCapabilities.recv),Zo(r),r}updateRecvMedia(t,n){const r=this.sessionDesc.mediaDescriptions.findIndex(o=>o.attributes.mid===t);if(r!==-1){const o=this.mungRecvMediaDsec(this.sessionDesc.mediaDescriptions[r],n);this.sessionDesc.mediaDescriptions[r]=o}}bumpMid(t){this.currentMidIndex+=t}findFirstClosedMedia(t){return this.sessionDesc.mediaDescriptions.find(n=>Tt()?n.media.port==="0"&&n.media.mediaType===t:n.media.port==="0")}findPreloadMediaDesc(t){return this.sessionDesc.mediaDescriptions.find(n=>{var r,o;return((r=n.attributes)===null||r===void 0||(o=r.ssrcs[0])===null||o===void 0?void 0:o.ssrcId)===t[0].ssrcId})}getSSRC(t){var n;return(n=this.sessionDesc.mediaDescriptions.find(r=>r.attributes.mid===t))===null||n===void 0?void 0:n.attributes.ssrcs}}var $e;function aw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ku(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?aw(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):aw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let bB=(Y(($e=class Oh extends _u{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n,r){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"remoteSDP",void 0),g(this,"initialOffer",void 0),g(this,"transportEventReceiver",void 0),g(this,"statsFilter",void 0),g(this,"localCapabilities",void 0),g(this,"localCandidateCount",0),g(this,"allCandidatesReceived",!1),g(this,"establishPromise",void 0),g(this,"mutex",new Vn("NVExtentionsConnection-mutex")),g(this,"rtcMedia",void 0),this.store=n,this.peerConnection=r,this.statsFilter=jE(this.peerConnection,k("STATS_UPDATE_INTERVAL"),void 0,Tt()?1200:void 0),this.bindPCEvents(),this.bindStatsEvents(),this.store.p2pId=this.store.p2pId+1,this.establishPromise=this.establish()}async establish(t){try{const n=await this.peerConnection.createOffer();if(!n.sdp)throw new Error("Cannot get initialOffer.sdp when trying to establish PeerConnection.");const r=Qs(n.sdp),o=await CO(!k("USE_PUB_RTX")&&!k("USE_SUB_RTX"),k("FILTER_VIDEO_FEC"),k("FILTER_AUDIO_FEC"));return this.localCapabilities=o,this.initialOffer=n,Ku(Ku({},r),{},{rtpCapabilities:o,offerSDP:n.sdp})}catch(n){throw new b(I.GET_LOCAL_CONNECTION_PARAMS_FAILED,n.toString())}}async connect(t,n,r,o,a,d){try{if(!this.initialOffer)throw new Error("Cannot establish NVConnection without initial offer.");this.remoteSDP=new NB({remoteIceParameters:t,remoteDtlsParameters:n,candidates:r,remoteRTPCapabilities:o,remoteSetup:a,localCapabilities:xE(this.localCapabilities),cname:d});const u=this.remoteSDP.toString(),h=jt.exports.parse(this.initialOffer.sdp),m=h.mediaDescriptions.find(T=>T.media.mediaType==="audio");m&&Zo(m);const f=jt.exports.print(h),E=this.logSDPExchange(f||"","offer","local","connect");await this.peerConnection.setLocalDescription({type:"offer",sdp:f}),E==null||E(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(u){throw new b(I.EXCHANGE_SDP_FAILED,"NV.connect failed; ".concat(u.toString()))}}async updateRemoteConnect(t){var n,r,o;(n=this.remoteSDP)===null||n===void 0||n.updateRemoteRTPCapabilities(t),(r=this.remoteSDP)===null||r===void 0||r.preloadRemoteMedia(2);const a=(o=this.remoteSDP)===null||o===void 0?void 0:o.toString();await this.peerConnection.setRemoteDescription({type:"offer",sdp:a});const d=await this.peerConnection.createAnswer();await this.peerConnection.setLocalDescription(d),v.debug("[NVExtentionsConnection] updateRemoteRTPCapabilities by exchanging SDP.")}send(t,n,r){var o=this;return ui(function*(){const a=yield xe(o.mutex.lock("From NVExtentionsConnection.send"));try{if(!o.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.send before remote SDP created");const d=[];t.forEach(O=>{const w=o.peerConnection.addTransceiver(O._mediaStreamTrack,{direction:"sendonly"});d.push(w)}),Tt()&&k("SIMULCAST")===!0&&(yield xe(o.applySimulcastForFirefox(d,t)));const u=yield xe(o.peerConnection.createOffer()),h=o.remoteSDP.predictReceivingMids(t.length),m=o.mungSendOfferSDP(u.sdp,t,h),f=jt.exports.parse(m),E=h.map(O=>{const w=f.mediaDescriptions.find(x=>x.attributes.mid===O);if(!w)throw new Error("Cannot extract ssrc from mediaDescription.");return TO(w,k("USE_PUB_RTX"))});let T;try{T=yield E}catch(O){T=[],o.remoteSDP.receive(t,n,r,T);const w=o.remoteSDP.toString();throw yield xe(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield xe(o.peerConnection.setRemoteDescription({type:"answer",sdp:w})),yield xe(o.stopSending(h,!0)),O}o.remoteSDP.receive(t,n,r,T);const R=o.remoteSDP.toString(),A=o.logSDPExchange(m,"offer","local","send");return yield xe(o.peerConnection.setLocalDescription({type:"offer",sdp:m})),yield xe(o.applySimulcastEncodings(d,t)),yield xe(o.applySendEncodings(d,t)),A==null||A(R),yield xe(o.peerConnection.setRemoteDescription({type:"answer",sdp:R})),d.map((O,w)=>{const x=h[w];return{localSSRC:E[w],id:x,transceiver:O}})}catch(d){throw d instanceof b?d:new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.send failed; ".concat(d.toString()))}finally{a()}})()}async stopSending(t,n){const r=n?void 0:await this.mutex.lock("From NVExtentionsConnection.stopSending");try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopSending before remote SDP created");const o=this.peerConnection.getTransceivers().filter(h=>t.indexOf(h.mid)!==-1);if(o.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length when trying to call NVExtentionsConnection.stopSending.");o.map(h=>{var m;h.direction="inactive",(m=h.stop)===null||m===void 0||m.call(h)});const a=await this.peerConnection.createOffer(),d=this.logSDPExchange(a.sdp||"","offer","local","stopSending");await this.peerConnection.setLocalDescription(a),this.remoteSDP.stopReceiving(t);const u=this.remoteSDP.toString();d==null||d(u),await this.peerConnection.setRemoteDescription({type:"answer",sdp:u})}catch(o){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.stopSending failed; ".concat(o.toString()))}finally{r&&r()}}async receive(t,n,r,o){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.receive ".concat(t," before remoteSDP created."));const{mid:a,needExchangeSDP:d}=this.remoteSDP.send(t,n,r,o);if(d){const h=this.remoteSDP.toString(),m=this.logSDPExchange(h,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:h});const f=await this.peerConnection.createAnswer(),E=this.mungReceiveAnswerSDP(f.sdp,a,t);m==null||m(E||""),await this.peerConnection.setLocalDescription({type:"answer",sdp:E}),v.debug("[NVExtentionsConnection] receive ".concat(t," by exchanging SDP."))}else v.debug("[NVExtentionsConnection] receive ".concat(t," no need to exchange SDP."));const u=this.peerConnection.getTransceivers().find(h=>h.mid===a);if(!u)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:u.receiver.track,id:a}}catch(a){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(a.toString()))}}async batchReceive(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.batchReceive before remoteSDP created.");const{mids:n,needExchangeSDP:r}=this.remoteSDP.batchSend(t);if(r){const o=this.remoteSDP.toString(),a=this.logSDPExchange(o,"offer","remote","receive");await this.peerConnection.setRemoteDescription({type:"offer",sdp:o});const d=await this.peerConnection.createAnswer();a==null||a(d.sdp||""),await this.peerConnection.setLocalDescription(d),v.debug("[NVExtentionsConnection] batchReceive by exchanging SDP.")}else v.debug("[NVExtentionsConnection] batchReceive no need to exchange SDP.");return n.map(o=>{const a=this.peerConnection.getTransceivers().find(d=>d.mid===o);if(!a)throw new Error("Cannot get transceiver after setLocalDescription.");return{track:a.receiver.track,id:o}})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.receive failed; ".concat(n.toString()))}}async stopReceiving(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.stopReceiving before remote SDP created.");this.remoteSDP.stopSending(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","stopReceiving");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection stopReceiving failed; ".concat(n.toString()))}}async muteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.mute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","muteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteRemote failed; ".concat(n.toString()))}}async unmuteRemote(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteRemote mid=".concat(t," before remote SDP created."));this.remoteSDP.unmute(t);const n=this.remoteSDP.toString(),r=this.logSDPExchange(n,"offer","remote","unmuteRemote");await this.peerConnection.setRemoteDescription({type:"offer",sdp:n});const o=await this.peerConnection.createAnswer();r==null||r(o.sdp||""),await this.peerConnection.setLocalDescription(o)}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteRemote failed; ".concat(n.toString()))}}async muteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.muteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(d=>{d.direction="inactive"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","muteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.muteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.muteLocal failed; ".concat(n.toString()))}}async unmuteLocal(t){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.unmuteLocal before remote SDP created.");const n=this.peerConnection.getTransceivers().filter(d=>d.mid&&t.indexOf(d.mid)!==-1);if(n.length!==t.length)throw new Error("Transceivers' length doesn't match mids' length.");n.map(async(d,u)=>{d.direction="sendonly"});const r=await this.peerConnection.createOffer(),o=this.logSDPExchange(r.sdp||"","offer","local","unmuteLocal");await this.peerConnection.setLocalDescription(r),this.remoteSDP.unmuteRemote(t);const a=this.remoteSDP.toString();o==null||o(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(n){throw new b(I.EXCHANGE_SDP_FAILED,"NVExtentionsConnection.unmuteLocal failed; ".concat(n.toString()))}}restartICE(t){var n=this;return ui(function*(){const r=yield xe(n.mutex.lock("From NVExtentionsConnection.restartICE"));try{if(!n.remoteSDP)throw new Error("Cannot restartICE before remoteSDP created.");if(bt().supportPCSetConfiguration){const m=n.peerConnection.getConfiguration(),f=t===dn.RELAY?"relay":"all";m.iceTransportPolicy!==f&&(v.debug("restartICE change iceTransportPolicy from [".concat(m.iceTransportPolicy,"] to [").concat(f,"]")),m.iceTransportPolicy=f,n.peerConnection.setConfiguration(m))}else if(t===dn.RELAY)return;t!==dn.RELAY&&n.remoteSDP.updateCandidates(t);const o=yield xe(n.peerConnection.createOffer({iceRestart:!0}));if(!o.sdp)throw new Error("Cannot restartICE because restart offer SDP does not exist.");const a=Qs(o.sdp),{remoteIceParameters:d}=yield a.iceParameters;n.remoteSDP.restartICE(d);const u=n.remoteSDP.toString(),h=n.logSDPExchange(o.sdp||"","offer","local","restartICE");yield xe(n.peerConnection.setLocalDescription(o)),h==null||h(u),yield xe(n.peerConnection.setRemoteDescription({type:"answer",sdp:u}))}catch(o){v.warning("restart ICE failed, abort operation",o)}finally{r()}})()}close(){var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,"closed"),this.unbindPCEvents(),this.unbindStatsEvents(),this.removeAllListeners(),this.transportEventReceiver=void 0,this.statsFilter.destroy()}getStats(){return this.statsFilter.getStats()}getRemoteVideoIsReady(t){return this.statsFilter.getVideoIsReady(t)}async updateEncoderConfig(t,n){try{if(!this.remoteSDP)throw new Error("Cannot call NVExtentionsConnection.updateEncoderConfig before remote SDP created.");const r=await this.peerConnection.createOffer(),o=this.mungSendOfferSDP(r.sdp,[n],[t]);this.remoteSDP.updateRecvMedia(t,n);const a=this.remoteSDP.toString(),d=this.logSDPExchange(o,"offer","local","updateEncoderConfig");await this.peerConnection.setLocalDescription({type:"offer",sdp:o}),d==null||d(a),await this.peerConnection.setRemoteDescription({type:"answer",sdp:a})}catch(r){throw new b(I.EXCHANGE_SDP_FAILED,r.toString())}}async updateSendParameters(t,n){const r=this.peerConnection.getTransceivers().filter(o=>o.mid===t);r.length===1&&(this.isVP8Simulcast(n)?Tt()||await this.applySimulcastEncodings(r,[n]):await this.applySendEncodings(r,[n]))}setStatsRemoteVideoIsReady(t,n){this.statsFilter.setVideoIsReady2(t,n)}async replaceTrack(t,n){const r=this.peerConnection.getTransceivers().find(o=>o.mid===n);r&&await r.sender.replaceTrack(t._mediaStreamTrack)}getP2PConnectionParams(){var t;if((t=this.peerConnection.currentLocalDescription)===null||t===void 0||!t.sdp||!this.localCapabilities)throw new Error;return Ku(Ku({},Qs(this.peerConnection.currentLocalDescription.sdp)),{},{rtpCapabilities:this.localCapabilities})}bindPCEvents(){this.peerConnection.oniceconnectionstatechange=()=>{var t;(t=this.onICEConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.iceConnectionState)},this.peerConnection.onconnectionstatechange=()=>{var t;(t=this.onConnectionStateChange)===null||t===void 0||t.call(this,this.peerConnection.connectionState)},this.peerConnection.onicecandidate=t=>{t.candidate?this.localCandidateCount+=1:(this.peerConnection.onicecandidate=null,this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] local candidate count"),this.localCandidateCount))},setTimeout(()=>{this.allCandidatesReceived||(this.allCandidatesReceived=!0,v.debug("[pc-".concat(this.store.p2pId,"] onicecandidate timeout, local candidate count"),this.localCandidateCount))},k("CANDIDATE_TIMEOUT"))}unbindPCEvents(){this.peerConnection.oniceconnectionstatechange=null,this.peerConnection.onconnectionstatechange=null,this.peerConnection.onsignalingstatechange=null,this.peerConnection.onicecandidateerror=null,this.peerConnection.onicecandidate=null,this.peerConnection.ontrack=null}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&($c(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...Oh.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...Oh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Cu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}async applySendEncodings(t,n){try{if(!bt().supportSetRtpSenderParameters||t.length!==n.length)return;for(let m=0;m<t.length;m++){const f=t[m],E=n[m];if(E&&E instanceof Ft){var r,o;if(this.isVP8Simulcast(E))continue;const T={},R={};switch(E._optimizationMode){case"motion":T.degradationPreference="maintain-framerate";break;case"detail":T.degradationPreference="maintain-resolution";break;default:T.degradationPreference="balanced"}var a,d,u,h;if((r=E._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&(R.maxBitrate=1e3*((a=E._encoderConfig)===null||a===void 0?void 0:a.bitrateMax)),E._hints.includes(zt.LOW_STREAM)&&((d=E._encoderConfig)!==null&&d!==void 0&&d.frameRate&&(R.maxFramerate=_o(E._encoderConfig.frameRate)),(u=E._encoderConfig)!==null&&u!==void 0&&u.scaleResolutionDownBy&&((h=E._encoderConfig)===null||h===void 0?void 0:h.scaleResolutionDownBy)>1&&(R.scaleResolutionDownBy=E._encoderConfig.scaleResolutionDownBy)),k("DSCP_TYPE")&&xs()){const w=k("DSCP_TYPE");["very-low","low","medium","high"].includes(w)&&(R.networkPriority=w)}const A=f.sender.getParameters(),O=(o=A.encodings)===null||o===void 0?void 0:o[0];Tt()&&!O&&(T.encodings=[R]),O&&Object.assign(O,R),Object.assign(A,T),await f.sender.setParameters(A)}}}catch{v.debug("Apply RTPSendEncodings failed.")}}mungSendOfferSDP(t,n,r){const o=jt.exports.parse(t);return n.forEach((a,d)=>{const u=r[d],h=o.mediaDescriptions.find(m=>m.attributes.mid===u);h&&(Qa(h,a),RO(h,a,this.store.codec))}),jt.exports.print(o)}mungReceiveAnswerSDP(t,n,r){const o=jt.exports.parse(t),a=o.mediaDescriptions.find(d=>d.attributes.mid===n);return a&&r===be.AUDIO&&a.media.mediaType==="audio"&&Zo(a),jt.exports.print(o)}bindStatsEvents(){this.statsFilter.onFirstAudioReceived=t=>{var n;(n=this.onFirstAudioReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoReceived=t=>{var n;(n=this.onFirstVideoReceived)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstAudioDecoded=t=>{var n;(n=this.onFirstAudioDecoded)===null||n===void 0||n.call(this,t)},this.statsFilter.onFirstVideoDecoded=(t,n,r)=>{var o;(o=this.onFirstVideoDecoded)===null||o===void 0||o.call(this,t,n,r)},this.statsFilter.onSelectedLocalCandidateChanged=(t,n)=>{var r;(r=this.onSelectedLocalCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onSelectedRemoteCandidateChanged=(t,n)=>{var r;(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0||r.call(this,t,n)},this.statsFilter.onFirstVideoDecodedTimeout=t=>{var n;(n=this.onFirstVideoDecodedTimeout)===null||n===void 0||n.call(this,t)}}unbindStatsEvents(){this.statsFilter.onFirstAudioReceived=void 0,this.statsFilter.onFirstVideoReceived=void 0,this.statsFilter.onFirstAudioDecoded=void 0,this.statsFilter.onFirstVideoDecoded=void 0,this.statsFilter.onSelectedLocalCandidateChanged=void 0,this.statsFilter.onSelectedRemoteCandidateChanged=void 0,this.statsFilter.onFirstVideoDecodedTimeout=void 0}async applySimulcastForFirefox(t,n){if(t.length===n.length)for(let u=0;u<t.length;u++){var r,o,a,d;const h=t[u],m=n[u];if(m instanceof Ft&&!m._hints.includes(zt.LOW_STREAM)&&(r=m._encoderConfig)!==null&&r!==void 0&&r.bitrateMax&&((o=m._encoderConfig)===null||o===void 0?void 0:o.bitrateMax)>200&&(a=m._scalabiltyMode)!==null&&a!==void 0&&a.numSpatialLayers&&((d=m._scalabiltyMode)===null||d===void 0?void 0:d.numSpatialLayers)>1&&this.store.codec==="vp8"){const f={},E={high:1e3*(m._encoderConfig.bitrateMax-50),medium:5e4};f.encodings=[{rid:"m",active:!0,maxBitrate:E.medium,scaleResolutionDownBy:4},{rid:"h",active:!0,maxBitrate:E.high}];const T=h.sender.getParameters();await h.sender.setParameters(Object.assign(T,f))}}}async applySimulcastEncodings(t,n){if(!Tt()&&t.length===n.length)for(let r=0;r<t.length;r++){const o=n[r];if(o instanceof Ft&&this.isVP8Simulcast(o)){const a=t[r],d={},u={high:1e3*(o._encoderConfig.bitrateMax-50),medium:5e4};d.encodings=[{active:!0,adaptivePtime:!1,networkPriority:"high",priority:"high",maxBitrate:u.high},{active:!0,adaptivePtime:!1,networkPriority:"low",priority:"low",maxBitrate:u.medium,scaleResolutionDownBy:4}];const h=a.sender.getParameters();await a.sender.setParameters(Object.assign(h,d))}}}isVP8Simulcast(t){var n,r,o,a;return!!(t instanceof Ft&&k("SIMULCAST")&&this.store.codec==="vp8"&&!t._hints.includes(zt.LOW_STREAM)&&(n=t._encoderConfig)!==null&&n!==void 0&&n.bitrateMax&&((r=t._encoderConfig)===null||r===void 0?void 0:r.bitrateMax)>200&&(o=t._scalabiltyMode)!==null&&o!==void 0&&o.numSpatialLayers&&((a=t._scalabiltyMode)===null||a===void 0?void 0:a.numSpatialLayers)>1)}logSDPExchange(t,n,r,o){if(k("SDP_LOGGING"))return v.upload("exchanging ".concat(r," ").concat(n," SDP during NVExtentionsConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}async getRemoteSSRC(t){if(!this.remoteSDP)return;const n=this.remoteSDP.getSSRC(t);return n==null?void 0:n[0].ssrcId}setConfiguration(t){if(bt().supportPCSetConfiguration){const n=Oh.resolvePCConfiguration(t);this.peerConnection.setConfiguration(n)}}}).prototype,"connect",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"connect"),$e.prototype),Y($e.prototype,"updateRemoteConnect",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"updateRemoteConnect"),$e.prototype),Y($e.prototype,"receive",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"receive"),$e.prototype),Y($e.prototype,"batchReceive",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"batchReceive"),$e.prototype),Y($e.prototype,"stopReceiving",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"stopReceiving"),$e.prototype),Y($e.prototype,"muteRemote",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"muteRemote"),$e.prototype),Y($e.prototype,"unmuteRemote",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"unmuteRemote"),$e.prototype),Y($e.prototype,"muteLocal",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"muteLocal"),$e.prototype),Y($e.prototype,"unmuteLocal",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"unmuteLocal"),$e.prototype),Y($e.prototype,"close",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"close"),$e.prototype),Y($e.prototype,"updateEncoderConfig",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"updateEncoderConfig"),$e.prototype),Y($e.prototype,"updateSendParameters",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"updateSendParameters"),$e.prototype),Y($e.prototype,"replaceTrack",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"replaceTrack"),$e.prototype),Y($e.prototype,"getRemoteSSRC",[Pr],Object.getOwnPropertyDescriptor($e.prototype,"getRemoteSSRC"),$e.prototype),$e);function Pr(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From NVExtentionsConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{a()}},n}var at;function cw(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=_O,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new WE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function WE(e){function t(n){if(Object(n)!==n)return de.reject(new TypeError(n+" is not an object."));var r=n.done;return de.resolve(n.value).then(function(o){return{value:o,done:r}})}return(WE=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?de.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?de.reject(n):t(r.apply(this.s,arguments))}},new WE(e)}let ts=(Y((at=class wh extends _u{get currentLocalDescription(){return this.peerConnection.currentLocalDescription}get currentRemoteDescription(){return this.peerConnection.currentRemoteDescription}get peerConnectionState(){return this.peerConnection.connectionState}get iceConnectionState(){return this.peerConnection.iceConnectionState}constructor(t,n){super(t,n),g(this,"store",void 0),g(this,"peerConnection",void 0),g(this,"cname",void 0),g(this,"mutex",new Vn("DataChannelConnection-mutex")),g(this,"dataChannel",void 0),g(this,"_p2pConnection",void 0),g(this,"establishPromise",void 0),g(this,"_nvMedia",void 0),this.store=n,this.store.dcId=this.store.dcId+1,this.peerConnection=new RTCPeerConnection(wh.resolvePCConfiguration(t),{optional:[{googDscp:!0}]}),this.dataChannel=this.peerConnection.createDataChannel("agora-signal",{ordered:!1,maxPacketLifeTime:50}),this.dataChannel.binaryType="arraybuffer",this._p2pConnection=new bB(t,n,this.peerConnection),this.bindPCEvents(),this.establishPromise=this._p2pConnection.establishPromise}async establish(){var t;const n=(t=this._nvMedia)===null||t===void 0?void 0:t.getLocalRtpCapabilities();return await this._p2pConnection.establish(n)}getP2PConnectionParams(){return this._p2pConnection.getP2PConnectionParams()}async connect(t,n,r,o,a,d){return this.cname=d,await this._p2pConnection.connect(t,n,r,o,a,d),await new de((u,h)=>{const m=setTimeout(()=>{this.closeSignal(),h(new b(I.DATACHANNEL_CONNECTION_TIMEOUT,"Datachannel connection timed out, candidates: ".concat(JSON.stringify(r))))},2e3);this.dataChannel.onopen=()=>{if(this.dataChannel.readyState==="open")return clearTimeout(m),void u()},this.dataChannel.onerror=f=>{this.closeSignal(),h(f)}}),{transmitter:this.dataChannel,close:this.closeSignal.bind(this)}}send(t,n,r){var o=this;return ui(function*(){const a=yield xe(o.mutex.lock("From DataChannelConnection.send"));try{return yield*xu(cw(o._p2pConnection.send(t,n,r)),xe)}finally{a()}})()}async stopSending(t,n){return this._p2pConnection.stopSending(t,n)}async receive(t,n,r,o){return this._nvMedia?(v.debug("[DataChannelConnection] receive ".concat(t," by DataChannel.")),await this._nvMedia.reveiveByRTCMedia(t,n,this.cname)):(v.debug("[DataChannelConnection] receive ".concat(t," by WebRTC.")),await this._p2pConnection.receive(t,n,r,o))}async batchReceive(t){return[...await this._p2pConnection.batchReceive(t)]}async stopReceiving(t){return await this._p2pConnection.stopReceiving(t)}async muteRemote(t){return await this._p2pConnection.muteRemote(t)}async unmuteRemote(t){return await this._p2pConnection.unmuteRemote(t)}async muteLocal(t){return await this._p2pConnection.muteLocal(t)}async unmuteLocal(t){return await this._p2pConnection.unmuteLocal(t)}restartICE(t){var n=this;return ui(function*(){return yield*xu(cw(n._p2pConnection.restartICE(t)),xe)})()}close(){var t;(t=this._nvMedia)===null||t===void 0||t.close(),this._p2pConnection.close(),this.unbindConnectionEvents(this._p2pConnection)}getStats(){return this._p2pConnection.getStats()}getRemoteVideoIsReady(t){return this._p2pConnection.getRemoteVideoIsReady(t)}updateRemoteConnect(t){var n;(n=this._nvMedia)===null||n===void 0||n.setRemoteRtpCapabilities(t),this._p2pConnection.updateRemoteConnect(t)}async updateEncoderConfig(t,n){return await this._p2pConnection.updateEncoderConfig(t,n)}async updateSendParameters(t,n){return await this._p2pConnection.updateSendParameters(t,n)}setStatsRemoteVideoIsReady(t,n){this._p2pConnection.setStatsRemoteVideoIsReady(t,n)}async replaceTrack(t,n){return await this._p2pConnection.replaceTrack(t,n)}async getRemoteSSRC(t){return this._p2pConnection.getRemoteSSRC(t)}logSDPExchange(t,n,r,o){if(k("SDP_LOGGING"))return v.upload("exchanging ".concat(r," ").concat(n," SDP during DataChannelConnection.").concat(o,`
`),t),n==="offer"?a=>{this.logSDPExchange(a,"answer",r==="local"?"remote":"local",o)}:void 0}static resolvePCConfiguration(t){const n={iceServers:[]};return t.iceServers?n.iceServers=t.iceServers:t.turnServer&&t.turnServer.mode!=="off"&&($c(t.turnServer.servers)?n.iceServers=t.turnServer.servers:(n.iceServers&&n.iceServers.push(...wh.turnServerConfigToIceServers(t.turnServer.servers)),k("USE_TURN_SERVER_OF_GATEWAY")&&n.iceServers&&t.turnServer.serversFromGateway&&n.iceServers.push(...wh.turnServerConfigToIceServers(t.turnServer.serversFromGateway)),k("FORCE_TURN_TCP")?n.iceTransportPolicy="relay":t.turnServer.servers.concat(t.turnServer.serversFromGateway||[]).forEach(r=>{r.forceturn&&(n.iceTransportPolicy="relay")}))),n}static turnServerConfigToIceServers(t){const n=[];return t.forEach(r=>{r.security?r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turns:".concat(Cu(r.turnServerURL),":").concat(r.tcpport,"?transport=tcp")}):(r.udpport&&!k("FORCE_TURN_TCP")&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.udpport,"?transport=udp")}),r.tcpport&&n.push({username:r.username,credential:r.password,credentialType:"password",urls:"turn:".concat(r.turnServerURL,":").concat(r.tcpport,"?transport=tcp")}))}),n}bindPCEvents(){this._p2pConnection.onICEConnectionStateChange=t=>{var n;return(n=this.onICEConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onConnectionStateChange=t=>{var n;return(n=this.onConnectionStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportStateChange=t=>{var n;return(n=this.onDTLSTransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onDTLSTransportError=t=>{var n;return(n=this.onDTLSTransportError)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onICETransportStateChange=t=>{var n;return(n=this.onICETransportStateChange)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioReceived=t=>{var n;return(n=this.onFirstAudioReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoReceived=t=>{var n;return(n=this.onFirstVideoReceived)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstAudioDecoded=t=>{var n;return(n=this.onFirstAudioDecoded)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onFirstVideoDecoded=(t,n,r)=>{var o;return(o=this.onFirstVideoDecoded)===null||o===void 0?void 0:o.call(this,t,n,r)},this._p2pConnection.onFirstVideoDecodedTimeout=t=>{var n;return(n=this.onFirstVideoDecodedTimeout)===null||n===void 0?void 0:n.call(this,t)},this._p2pConnection.onSelectedLocalCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedLocalCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)},this._p2pConnection.onSelectedRemoteCandidateChanged=(t,n)=>{var r;return(r=this.onSelectedRemoteCandidateChanged)===null||r===void 0?void 0:r.call(this,t,n)}}closeSignal(){this.dataChannel.close(),this.peerConnection.close()}unbindConnectionEvents(t){t.onConnectionStateChange=void 0,t.onICEConnectionStateChange=void 0,t.onICETransportStateChange=void 0,t.onDTLSTransportStateChange=void 0,t.onDTLSTransportError=void 0,t.onFirstAudioDecoded=void 0,t.onFirstAudioReceived=void 0,t.onFirstVideoDecoded=void 0,t.onFirstVideoReceived=void 0,t.onSelectedLocalCandidateChanged=void 0,t.onSelectedRemoteCandidateChanged=void 0,t.onFirstVideoDecodedTimeout=void 0}setConfiguration(t){this._p2pConnection.setConfiguration(t)}}).prototype,"connect",[pi],Object.getOwnPropertyDescriptor(at.prototype,"connect"),at.prototype),Y(at.prototype,"receive",[pi],Object.getOwnPropertyDescriptor(at.prototype,"receive"),at.prototype),Y(at.prototype,"stopReceiving",[pi],Object.getOwnPropertyDescriptor(at.prototype,"stopReceiving"),at.prototype),Y(at.prototype,"muteRemote",[pi],Object.getOwnPropertyDescriptor(at.prototype,"muteRemote"),at.prototype),Y(at.prototype,"unmuteRemote",[pi],Object.getOwnPropertyDescriptor(at.prototype,"unmuteRemote"),at.prototype),Y(at.prototype,"muteLocal",[pi],Object.getOwnPropertyDescriptor(at.prototype,"muteLocal"),at.prototype),Y(at.prototype,"unmuteLocal",[pi],Object.getOwnPropertyDescriptor(at.prototype,"unmuteLocal"),at.prototype),Y(at.prototype,"close",[pi],Object.getOwnPropertyDescriptor(at.prototype,"close"),at.prototype),Y(at.prototype,"updateEncoderConfig",[pi],Object.getOwnPropertyDescriptor(at.prototype,"updateEncoderConfig"),at.prototype),Y(at.prototype,"updateSendParameters",[pi],Object.getOwnPropertyDescriptor(at.prototype,"updateSendParameters"),at.prototype),Y(at.prototype,"replaceTrack",[pi],Object.getOwnPropertyDescriptor(at.prototype,"replaceTrack"),at.prototype),Y(at.prototype,"getRemoteSSRC",[pi],Object.getOwnPropertyDescriptor(at.prototype,"getRemoteSSRC"),at.prototype),at);function pi(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From DataChannelConnection.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{a()}},n}var He;function dw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function ns(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?dw(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):dw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function lw(e){var t,n,r,o=2;for(typeof Symbol<"u"&&(n=_O,r=Symbol.iterator);o--;){if(n&&(t=e[n])!=null)return t.call(e);if(r&&(t=e[r])!=null)return new HE(t.call(e));n="@@asyncIterator",r="@@iterator"}throw new TypeError("Object is not async iterable")}function HE(e){function t(n){if(Object(n)!==n)return de.reject(new TypeError(n+" is not an object."));var r=n.done;return de.resolve(n.value).then(function(o){return{value:o,done:r}})}return(HE=function(n){this.s=n,this.n=n.next}).prototype={s:null,n:null,next:function(){return t(this.n.apply(this.s,arguments))},return:function(n){var r=this.s.return;return r===void 0?de.resolve({value:n,done:!0}):t(r.apply(this.s,arguments))},throw:function(n){var r=this.s.return;return r===void 0?de.reject(n):t(r.apply(this.s,arguments))}},new HE(e)}let DB=(Y((He=class extends gt{get state(){return this._state}set state(e){const t=this._state;this._state=e,this.emit(Be.StateChange,t,this._state)}constructor(e,t){super(),g(this,"store",void 0),g(this,"statsUploader",void 0),g(this,"connection",void 0),g(this,"localTrackMap",new Map),g(this,"remoteUserMap",new Map),g(this,"pendingLocalTracks",[]),g(this,"pendingRemoteTracks",[]),g(this,"statsCollector",void 0),g(this,"isPlanB",!1),g(this,"shouldForwardP2PCreation",void 0),g(this,"iceFailedCount",0),g(this,"dtlsFailedCount",0),g(this,"mutex",new Vn("P2PChannel-mutex")),g(this,"_state",Yt.Disconnected),g(this,"_pcStatsUploadType",k("NEW_ICE_RESTART")?Di.FIRST_CONNECTION:Di.OLD_FIRST_CONNECTION),g(this,"_isInRestartIce",!1),g(this,"_isStartRestartIce",!1),g(this,"_restartStates",["disconnected","failed"]),g(this,"_restartTimer",void 0),g(this,"_isFirstConnected",!0),g(this,"handleMuteLocalTrack",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleMuteLocalTrack");try{if(!this.connection||this.state!==Yt.Connected)return void o(new b(I.INVALID_OPERATION,"Cannot call P2PChannel.handleMuteLocalTrack before connection established."));const d=this.filterTobeMutedTracks(n);if(d.length===0)return void r();const u=d.find(m=>m[0]==="videoLowTrack");u&&u[1].track._originMediaStreamTrack.stop(),await this.connection.muteLocal(d.map(m=>{let[,{id:f}]=m;return f}));const h=this.createMuteMessage(d);await Rt(this,Be.RequestMuteLocal,h),r()}catch(d){o(d)}finally{a()}}),g(this,"handleUnmuteLocalTrack",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleUnmuteLocalTrack");try{if(!this.connection||this.state!==Yt.Connected)return void o(new b(I.INVALID_OPERATION,"Cannot call P2PChannel.handleUnmuteLocalTrack before connection established."));const d=this.filterTobeUnmutedTracks(n);if(d.length===0)return void r();const u=d.find(m=>m[0]==="videoLowTrack");if(u){const m=u[1];if(m.track._originMediaStreamTrack.stop(),bt().supportDualStreamEncoding){const f=n._mediaStreamTrack.clone();m.track._mediaStreamTrack=f,m.track._originMediaStreamTrack=f}else{const f=WO(n,Ys(this,Be.RequestLowStreamParameter));m.track._mediaStreamTrack=f,m.track._originMediaStreamTrack=f}await new de((f,E)=>{this.handleReplaceTrack(m.track,f,E,!0)})}await this.connection.unmuteLocal(d.map(m=>{let[,{id:f}]=m;return f}));const h=this.createUnmuteMessage(d);await Rt(this,Be.RequestUnmuteLocal,h),r()}catch(d){o(d)}finally{a()}}),g(this,"handleUpdateVideoEncoder",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetVideoEncoder");try{const d=this.localTrackMap.get(ue.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Yt.Connected)return void r();const{id:u,track:h}=d;await this.connection.updateSendParameters(u,h),await this.connection.updateEncoderConfig(u,h),this.emit(Be.UpdateVideoEncoder,h),r()}catch(d){o(d)}finally{a()}}),g(this,"handleSetOptimizationMode",async(n,r,o)=>{const a=await this.mutex.lock("Locking from P2PChannel.handleSetOptimizationMode");try{const d=this.localTrackMap.get(ue.LocalVideoTrack);if(!this.connection||!d||d.track!==n||this.state!==Yt.Connected)return;const{id:u,track:h}=d;await this.connection.updateSendParameters(u,h),r()}catch(d){o(d)}finally{a()}}),g(this,"handleReplaceTrack",async(n,r,o,a)=>{let d;v.debug("[".concat(this.store.clientId,"] P2PChannel handleReplaceTrack for [track-id-").concat(n.getTrackId(),"]")),typeof a=="boolean"&&a||(d=await this.mutex.lock("From P2PChannel.handleReplaceTrack"));try{var u;const m=Array.from(this.localTrackMap.entries()).find(f=>{let[,{track:E}]=f;return n===E});if(!this.connection||!m||this.state!==Yt.Connected)return void r();if(await((u=this.connection)===null||u===void 0?void 0:u.replaceTrack(n,m[1].id)),this.isPlanB){const f=m[1];f.id=n._mediaStreamTrack.id,this.localTrackMap.set(m[0],f)}if(m[0]===ue.LocalVideoTrack&&bt().supportDualStreamEncoding){const f=this.localTrackMap.get(ue.LocalVideoLowTrack);if(f){const E=n._mediaStreamTrack.clone();f.track._originMediaStreamTrack.stop(),f.track._mediaStreamTrack=E,f.track._originMediaStreamTrack=E,await new de((T,R)=>{this.handleReplaceTrack(f.track,T,R,!0)})}}r()}catch(m){o(m)}finally{var h;(h=d)===null||h===void 0||h()}}),g(this,"handleGetLocalVideoStats",n=>{n(this.statsCollector.getLocalVideoTrackStats())}),g(this,"handleGetLocalAudioStats",n=>{n(this.statsCollector.getLocalAudioTrackStats())}),g(this,"handleGetRemoteVideoStats",n=>this.statsCollector.getRemoteVideoTrackStats(n.uid)[n.uid]),g(this,"handleGetRemoteAudioStats",n=>this.statsCollector.getRemoteAudioTrackStats(n.uid)[n.uid]),this.store=e,this.statsCollector=t,this.statsCollector.addP2PChannel(this),this.statsUploader=new wB,this.bindStatsUploaderEvents(),this.isPlanB=!bt().supportUnifiedPlan||k("CHROME_FORCE_PLAN_B")&&xs(),this.shouldForwardP2PCreation=k("FORWARD_P2P_CREATION")&&bt().supportPCSetConfiguration,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ts({},this.store):this.isPlanB?new md({},this.store):new To({},this.store),this.bindConnectionEvents(this.connection))}async startP2PConnection(e,t){var n;this.state=Yt.New;const r=this.shouldForwardP2PCreation&&((n=this.connection)===null||n===void 0?void 0:n.peerConnectionState)==="closed";if(this.shouldForwardP2PCreation&&!r||(r&&this.connection&&(v.warning("[".concat(this.store.clientId,"] P2PChannel.startP2PConnection ForwardP2P closed.")),this.connection.close(),this.unbindConnectionEvents(this.connection)),this.connection=this.store.useDataChannel?new ts(e,this.store):this.isPlanB?new md(e,this.store):new To(e,this.store),this.bindConnectionEvents(this.connection)),!this.connection)throw new b(I.UNEXPECTED_ERROR,"Cannot P2PChannel.startConnection before P2PConnection initialization .");return this._pcStatsUploadType=k("NEW_ICE_RESTART")?Di.FIRST_CONNECTION:Di.OLD_FIRST_CONNECTION,this._isFirstConnected=!0,this._isInRestartIce=!1,this._isStartRestartIce=!1,this.connection.setConfiguration(e),this.connection.establishPromise}async connect(e,t,n,r,o,a){if(!this.connection)throw new b(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.connection instanceof ts?this.connection.updateRemoteConnect(r):(this.store.peerConnectionStart(),await this.connection.connect(e,t,n,r,o,a),this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yt.Connected)}async preConnect(e,t,n,r,o,a){if(!this.connection)throw new b(I.UNEXPECTED_ERROR,"Cannot P2PChannel.connect before P2PChannel.startP2PConnection .");this.store.peerConnectionStart();const d=await this.connection.connect(e,t,n,r,o,a);return this.statsUploader.startUploadTransportStats(),this.statsUploader.startUploadExtensionUsageStats(),this.state=Yt.Connected,d}getEstablishParams(){if(this.connection instanceof ts)return this.connection.getP2PConnectionParams();throw new Error("Only DataChannelConnection needs to obtain establishParams")}publish(e,t,n){var r=this;return ui(function*(){const o=yield xe(r.mutex.lock("From P2PChannel.publish"));try{if(!r.connection||r.state!==Yt.Connected){if(r.state===Yt.Disconnected)throw new b(I.UNEXPECTED_ERROR,"PeerConnection already disconnected.");r.throwIfTrackTypeNotMatch(e);const d=e.filter(u=>r.pendingLocalTracks.indexOf(u)===-1);return void(r.pendingLocalTracks=r.pendingLocalTracks.concat(d))}r.store.pubId=r.store.pubId+1,zr.markPublishStart(r.store.clientId,r.store.pubId);const a=r.filterTobePublishedTracks(e,t,n);if(a.length===0)return void(yield xe(r.tryToUnmuteAudio(e)));yield*xu(lw(r.doPublish(r.connection,a)),xe)}finally{o()}})()}doPublish(e,t){var n=this;return ui(function*(){t.forEach(m=>{let{track:f,type:E}=m;const T=Date.now();n.store.publish(f.getTrackId(),E===ue.LocalAudioTrack?"audio":"video",T)}),n.bindLocalTrackEvents(t);const r=yield xe(e.send(t.map(m=>{let{track:f}=m;return f}),n.store.codec,n.store.audioCodec)),o=(yield xe(r.next())).value,a=n.createGatewayPublishMessage(t,o);let d;try{d=yield a}catch(m){throw r.throw(m),(m==null?void 0:m.code)===I.WS_ABORT&&t.forEach(f=>{let{track:E}=f;n.pendingLocalTracks.indexOf(E)===-1&&n.pendingLocalTracks.push(E)}),n.unbindLocalTrackEvents(t),m}const u=n.mapPubResToRemoteConfig(a,d),h=(yield xe(r.next(u))).value;t.forEach(m=>{let{type:f}=m;n.statsCollector.addLocalStats(f)}),n.assignLocalTracks(t,h),n.statsUploader.startUploadUplinkStats(),t.forEach(m=>{let{track:f,type:E}=m;const T=Date.now();n.store.publish(f.getTrackId(),E===ue.LocalAudioTrack?"audio":"video",void 0,T)})})()}publishLowStream(e){var t=this;return ui(function*(){if(!t.connection||t.state!==Yt.Connected)return;const n=yield xe(t.mutex.lock("Locking from P2PChannel.publishLowStream"));try{const o=t.localTrackMap.get(ue.LocalVideoTrack);if(!o)throw new b(I.UNEXPECTED_ERROR,"Could not find high stream");if(t.localTrackMap.has(ue.LocalVideoLowTrack))throw new b(I.UNEXPECTED_ERROR,"[".concat(t.store.clientId,"] Can't publish low stream when stream already publish"));const a=[{track:t.getLowVideoTrack(o.track,e),type:ue.LocalVideoLowTrack}];if(yield*xu(lw(t.doPublish(t.connection,a)),xe),o.track.muted||!o.track.enabled){var r;const d=(r=t.localTrackMap.get(ue.LocalVideoLowTrack))===null||r===void 0?void 0:r.id;d!==void 0&&(yield xe(t.connection.muteLocal([d])))}}finally{n()}})()}async republish(){this.pendingLocalTracks.length>0&&(v.debug("[".concat(this.store.clientId,"] Emit P2PChannelEvents.RequestRePublish to republish tracks.")),await Cn(this,Be.RequestRePublish,this.pendingLocalTracks),this.emit(Be.MediaReconnectEnd,this.store.uid),this.pendingLocalTracks=[])}async reSubscribe(e){for(let t=this.pendingRemoteTracks.length-1;t>=0;t--){const{user:n,kind:r}=this.pendingRemoteTracks[t];(r!==be.AUDIO||n._audio_added_&&n._audioSSRC)&&(r!==be.VIDEO||n._video_added_&&n._videoSSRC)||this.pendingRemoteTracks.splice(t,1)}if(e)await Cn(this,Be.RequestReSubscribe,this.pendingRemoteTracks);else for(const{user:t,kind:n}of this.pendingRemoteTracks)await this.subscribe(t,n,n===be.VIDEO?t._videoSSRC:t._audioSSRC);this.pendingRemoteTracks.forEach(t=>{let{user:n}=t;this.emit(Be.MediaReconnectEnd,n.uid)}),this.pendingRemoteTracks=[]}async unpublish(e){if(!this.connection||this.state!==Yt.Connected)return void e.forEach(r=>{const o=this.pendingLocalTracks.indexOf(r);o!==-1&&this.pendingLocalTracks.splice(o,1)});const t=this.filterTobeUnpublishedTracks(e);if(t.length===0)return;const n=t.find(r=>r[0]==="videoLowTrack");return n&&n[1].track.close(),this.doUnpublish(this.connection,t)}async unpublishLowStream(){if(!this.connection||this.state!==Yt.Connected)return;const e=this.localTrackMap.get(ue.LocalVideoLowTrack);if(!e)return;e.track.close();const t=[[ue.LocalVideoLowTrack,e]];return this.doUnpublish(this.connection,t)}async doUnpublish(e,t){const n=this.createGatewayUnpublishMessage(t);return await e.stopSending(t.map(r=>{let[,{id:o}]=r;return o})),this.withdrawLocalTracks(t),this.unbindLocalTrackEvents(t.map(r=>{let[o,{track:a}]=r;return{type:o,track:a}})),t.forEach(r=>{let[o]=r;this.statsCollector.removeLocalStats(o)}),this.localTrackMap.size===0&&this.statsUploader.stopUploadUplinkStats(),n}async subscribe(e,t,n,r,o){var a;if(!this.connection||this.state!==Yt.Connected)throw new b(I.INVALID_OPERATION,"Cannot subscribe remote user when peerConnection disconnected.");if((a=this.remoteUserMap.get(e))!==null&&a!==void 0&&a.has(t))return;let d,u,h;if(o){const E=o.find(R=>{let{stream_type:A}=R;return A===t});if(!E)throw new b(I.UNEXPECTED_ERROR,"Cannot subscribe to remote ".concat(t," for user: ").concat(e.uid," because subscribe answer from gateway does not contain stream_type: ").concat(t,"."));const T=await this.connection.receive(t,E.ssrcs,String(e._uintid),E.attributes);this.connection instanceof To&&(h=T.transceiver),d=T.track,u=T.id}else{const E=await this.connection.receive(t,[{ssrcId:n,rtx:r}],String(e._uintid),void 0);this.connection instanceof To&&(h=E.transceiver),d=E.track,u=E.id}t===be.AUDIO?(e._audioTrack?e._audioTrack._updateOriginMediaStreamTrack(d):(e._audioTrack=new Wu(d,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(e._audioTrack.getTrackId()))),h&&e._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._audioTrack)):(e._videoTrack?e._videoTrack._updateOriginMediaStreamTrack(d):(e._videoTrack=new Gu(d,e.uid,e._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(e._videoTrack.getTrackId()))),h&&e._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(e,e._videoTrack));const m=this.remoteUserMap.get(e);m?m.set(t,u):this.remoteUserMap.set(e,new Map([[t,u]])),this.statsCollector.addRemoteStats(e.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(E=>{let{user:T,kind:R}=E;return T.uid===e.uid&&t===R});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Be.MediaReconnectEnd,e.uid))}async massSubscribe(e){return this.massSubscribeNoLock(e)}async massSubscribeNoLock(e){if(!this.connection||this.state!==Yt.Connected)throw new b(I.INVALID_OPERATION,"Cannot subscribeAll remote users when peerConnection disconnected.");e=e.filter(n=>{var r;let{user:o,mediaType:a}=n;return!((r=this.remoteUserMap.get(o))!==null&&r!==void 0&&r.has(a))});const t=await this.connection.batchReceive(e.map(n=>{let{user:r,mediaType:o,ssrcId:a,rtxSsrcId:d}=n;return{kind:o,ssrcMsg:[{ssrcId:a,rtx:d}],mslabel:String(r._uintid)}}));e.forEach((n,r)=>{let{user:o,mediaType:a}=n;const{track:d,id:u,transceiver:h}=t[r];a===be.AUDIO?(o._audioTrack?o._audioTrack._updateOriginMediaStreamTrack(d):(o._audioTrack=new Wu(d,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote audio track: ").concat(o._audioTrack.getTrackId()))),h&&o._audioTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(o,o._audioTrack)):(o._videoTrack?o._videoTrack._updateOriginMediaStreamTrack(d):(o._videoTrack=new Gu(d,o.uid,o._uintid,this.store),v.info("[".concat(this.store.clientId,"] [").concat(this.store.p2pId,"] create remote video track: ").concat(o._videoTrack.getTrackId()))),h&&o._videoTrack._updateRtpTransceiver(h),this.bindRemoteTrackEvents(o,o._videoTrack));const m=this.remoteUserMap.get(o);m?m.set(a,u):this.remoteUserMap.set(o,new Map([[a,u]])),this.statsCollector.addRemoteStats(o.uid),this.statsUploader.startUploadDownlinkStats();const f=this.pendingRemoteTracks.findIndex(E=>{let{user:T,kind:R}=E;return T.uid===o.uid&&a===R});f!==-1&&(this.pendingRemoteTracks.splice(f,1),this.emit(Be.MediaReconnectEnd,o.uid))})}async unsubscribe(e,t,n){const r=this.pendingRemoteTracks.filter(d=>{let{user:u,kind:h}=d;return t!==void 0?u.uid===e.uid&&t===h:u.uid===e.uid});if(r.forEach(d=>{const u=this.pendingRemoteTracks.indexOf(d);this.pendingRemoteTracks.splice(u,1)}),this.connection&&this.state===Yt.Connected||n||r.forEach(d=>{let{kind:u}=d;var h;if(u===be.AUDIO)(h=e._audioTrack)===null||h===void 0||h._destroy(),e._audioTrack=void 0;else if(u===be.VIDEO){var m;(m=e._videoTrack)===null||m===void 0||m._destroy(),e._videoTrack=void 0}}),!this.connection||this.state!==Yt.Connected)return;const o=this.filterTobeUnSubscribedTracks(e,t);if(o.length===0)return;await this.connection.stopReceiving(o.map(d=>{let[,{id:u}]=d;return u}));const a=this.createUnsubscribeMessage(o);return this.withdrawRemoteTracks(o),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),o.forEach(d=>{let[u,{kind:h}]=d;var m,f;if(h===be.VIDEO&&u._videoSSRC&&((m=this.connection)===null||m===void 0||m.setStatsRemoteVideoIsReady(u._videoSSRC,!1)),h===be.VIDEO)this.unbindRemoteTrackEvents(u._videoTrack),n||((f=u._videoTrack)===null||f===void 0||f._destroy(),u._videoTrack=void 0);else if(h===be.AUDIO){var E;this.unbindRemoteTrackEvents(u._audioTrack),!n&&((E=u._audioTrack)===null||E===void 0||E._destroy(),u._audioTrack=void 0)}}),a}async massUnsubscribe(e){return this.massUnsubscribeNoLock(e)}async massUnsubscribeNoLock(e){let t=[];for(const{user:o,mediaType:a}of e){const d=this.pendingRemoteTracks.filter(u=>{let{user:h,kind:m}=u;return a!==void 0?h.uid===o.uid&&a===m:h.uid===o.uid});d.forEach(u=>{const h=this.pendingRemoteTracks.indexOf(u);this.pendingRemoteTracks.splice(h,1)}),t=t.concat(d)}if(!this.connection||this.state!==Yt.Connected)return void t.forEach(o=>{let{user:a,kind:d}=o;var u;if(d===be.AUDIO)(u=a._audioTrack)===null||u===void 0||u._destroy(),a._audioTrack=void 0;else if(d===be.VIDEO){var h;(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0}});const n=Fo(e).call(e,(o,a)=>{let{user:d,mediaType:u}=a;const h=this.filterTobeUnSubscribedTracks(d,u);return o.concat(h)},[]);if(n.length===0)return;await this.connection.stopReceiving(n.map(o=>{let[,{id:a}]=o;return a}));const r=this.createUnsubscribeAllMessage(n);return this.withdrawRemoteTracks(n),this.remoteUserMap.size===0&&this.statsUploader.stopUploadDownlinkStats(),n.forEach(o=>{let[a,{kind:d}]=o;var u,h;if(d===be.VIDEO&&a._videoSSRC&&((u=this.connection)===null||u===void 0||u.setStatsRemoteVideoIsReady(a._videoSSRC,!1)),d===be.VIDEO)this.unbindRemoteTrackEvents(a._videoTrack),(h=a._videoTrack)===null||h===void 0||h._destroy(),a._videoTrack=void 0;else if(d===be.AUDIO){var m;this.unbindRemoteTrackEvents(a._audioTrack),(m=a._audioTrack)===null||m===void 0||m._destroy(),a._audioTrack=void 0}}),r}async muteRemote(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid,"."));if(!n.get(t))return void v.warning("[".concat(this.store.clientId,"] P2PChannel.muteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."));const r=t===be.VIDEO?e._videoSSRC:e._audioSSRC;r!==void 0&&this.connection.setStatsRemoteVideoIsReady(r,!1)}async unmuteRemote(e,t){return this.unmuteRemoteNoLock(e,t)}async unmuteRemoteNoLock(e,t){if(!this.connection)return;const n=this.remoteUserMap.get(e);if(!n)return void v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid,"."));n.get(t)||v.warning("[".concat(this.store.clientId,"] P2PChannel.unmuteRemote has no remote user ").concat(e.uid," media type ").concat(t,"."))}getAllTracks(e){const t=this.localTrackMap.get(ue.LocalAudioTrack);if((t==null?void 0:t.track)instanceof rr){const n=t.track;return Array.from(this.localTrackMap.entries()).filter(r=>{let[o]=r;return o!==ue.LocalAudioTrack}).filter(r=>{let[o]=r;return!(e&&o===ue.LocalVideoLowTrack)}).map(r=>{let[,{track:o}]=r;return o}).concat(n.trackList)}return Array.from(this.localTrackMap.entries()).filter(n=>{let[r]=n;return!(e&&r===ue.LocalVideoLowTrack)}).map(n=>{let[,{track:r}]=n;return r})}reportPublishEvent(e,t,n,r,o){if(e){const d=this.localTrackMap.get(ue.LocalAudioTrack),u=r?this.localTrackMap.get(ue.LocalVideoLowTrack):this.localTrackMap.get(ue.LocalVideoTrack);he.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.track.getTrackLabel(),videoName:u==null?void 0:u.track.getTrackLabel(),screenshare:(u==null?void 0:u.track._hints.indexOf(zt.SCREEN_TRACK))!==-1,audio:!!d,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}else{var a;n||(n=[]);const d=n.find(h=>h instanceof yn),u=r?(a=this.localTrackMap.get(ue.LocalVideoTrack))===null||a===void 0?void 0:a.track:n.find(h=>h instanceof Ft);he.publish(this.store.sessionId,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:e,ec:t,audioName:d==null?void 0:d.getTrackLabel(),videoName:u==null?void 0:u.getTrackLabel(),screenshare:(u==null?void 0:u._hints.indexOf(zt.SCREEN_TRACK))!==-1,audio:!!d,video:!!u,p2pid:this.store.p2pId,publishRequestid:this.store.pubId,extend:o})}}reportSubscribeEvent(e,t,n,r){const o=r===be.VIDEO?n._videoSSRC:n._audioSSRC;o&&he.subscribe(this.store.sessionId,{succ:e,ec:t,video:r===be.VIDEO,audio:r===be.AUDIO,peerid:n.uid,subscribeRequestid:r===be.VIDEO?n._videoSSRC:n._audioSSRC,p2pid:this.store.p2pId,eventElapse:zr.measureFromSubscribeStart(this.store.clientId,o)})}reset(){v.debug("[".concat(this.store.clientId,"] P2PChannel.reset")),this.mutex=new Vn("P2PChannel-mutex"),this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ts({},this.store):this.isPlanB?new md({},this.store):new To({},this.store),this.bindConnectionEvents(this.connection)),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),this.statsUploader.stopUploadExtensionUsageStats(),this.unbindLocalTrackEvents(),this.unbindAllRemoteTrackEvents(),this.unbindRtpTransceiver();const e=this.localTrackMap.get(ue.LocalAudioTrack);if((e==null?void 0:e.track)instanceof rr){if(e.track.trackList.length>0){const t=e.track;e.track.trackList.forEach(n=>{t.removeAudioTrack(n)})}e.track.close()}this.localTrackMap.clear(),this.remoteUserMap.clear(),this.statsCollector.removeRemoteStats(),this.statsCollector.removeLocalStats(),this.iceFailedCount=0,this.dtlsFailedCount=0,this.pendingLocalTracks=[],this.pendingRemoteTracks=[],this.state=Yt.Disconnected}getStats(){var e;return(e=this.connection)===null||e===void 0?void 0:e.getStats()}getRemoteVideoIsReady(e){var t;return((t=this.connection)===null||t===void 0?void 0:t.getRemoteVideoIsReady(e))||!1}getLocalAudioVolume(){const e=this.localTrackMap.get(ue.LocalAudioTrack);if(e)return e.track.getVolumeLevel()}getLocalVideoSize(){const e=this.localTrackMap.get(ue.LocalVideoTrack);if(e)return{width:e.track._videoWidth||0,height:e.track._videoHeight||0}}getEncoderConfig(e){const t=this.localTrackMap.get(e);return t&&t.track instanceof Ft||t&&t.track instanceof yn?t.track._encoderConfig:void 0}getLocalMedia(e){return this.localTrackMap.get(e)}hasLocalMedia(){return this.localTrackMap.size>0}hasRemoteMedia(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}async hasRemoteMediaWithLock(e,t){if(!e)return this.remoteUserMap.size>0;const n=this.remoteUserMap.get(e);return!!n&&(!t||n.has(t))}getRemoteMedia(e){var t;const n=Array.from(Ws(t=this.remoteUserMap).call(t)).find(r=>r.uid===e);return n?{audioTrack:n.audioTrack,audioSSRC:n._audioSSRC,videoTrack:n.videoTrack,videoSSRC:n._videoSSRC}:{}}getAudioLevels(){let e=Array.from(this.remoteUserMap.entries()).map(n=>{let[r]=n;return{uid:r.uid,level:r.audioTrack?100*r.audioTrack._source.getAccurateVolumeLevel():0}});const t=this.localTrackMap.get(ue.LocalAudioTrack);return t&&e.push({level:100*t.track._source.getAccurateVolumeLevel(),uid:this.store.uid}),e=Nm(e).call(e,(n,r)=>n.level-r.level),e}async disconnectForReconnect(){this.connection&&(v.debug("[".concat(this.store.clientId,"] P2PChannel.disconnectForReconnect closing P2PConnection")),this.state=Yt.Reconnecting,k("KEEP_LAST_FRAME")&&this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t]=e;var n;t._videoTrack&&t._videoTrack._player&&((n=t._videoTrack._player.getVideoElement())===null||n===void 0||n.pause(),t._videoTrack._player.isKeepLastFrame=!0,t._videoTrack._originMediaStreamTrack.stop())}),this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0,this.shouldForwardP2PCreation&&(this.connection=this.store.useDataChannel?new ts({},this.store):this.isPlanB?new md({},this.store):new To({},this.store),this.bindConnectionEvents(this.connection)),this.localTrackMap.size!==0&&(Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;switch(t){case ue.LocalVideoTrack:n._hints.includes(zt.LOW_STREAM)?n.close():this.pendingLocalTracks.push(n);break;case ue.LocalAudioTrack:n instanceof rr?this.pendingLocalTracks=this.pendingLocalTracks.concat(n.trackList):this.pendingLocalTracks.push(n);break;case ue.LocalVideoLowTrack:}}),this.emit(Be.MediaReconnectStart,this.store.uid)),this.unbindLocalTrackEvents(),this.localTrackMap.clear(),this.remoteUserMap.size!==0&&Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;Array.from(Ws(n).call(n)).forEach(r=>{this.setPendingRemoteMedia(t,r)}),this.emit(Be.MediaReconnectStart,t.uid)}),this.unbindAllRemoteTrackEvents(),this.remoteUserMap.clear(),this.statsUploader.stopUploadUplinkStats(),this.statsUploader.stopUploadDownlinkStats(),this.statsUploader.stopUploadTransportStats(),v.debug("[".concat(this.store.clientId,"] P2PChannel disconnected, waiting to reconnect.")))}hasPendingRemoteMedia(e,t){for(const n of this.pendingRemoteTracks){const{user:r,kind:o}=n;if((e instanceof EE?e.uid:e)===r.uid&&t===o)return!0}return!1}setPendingRemoteMedia(e,t){this.hasPendingRemoteMedia(e,t)||this.pendingRemoteTracks.push({user:e,kind:t})}restartICE(e){var t=this;return ui(function*(){if(!t.connection||t.state!==Yt.Connected||t.connection instanceof ts)return;const n=yield xe(t.mutex.lock("From P2PChannel.restartICE"));let r;try{r=yield xe(t.connection.restartICE(e));const a=yield xe(r.next());if(a.done)return;const d=a.value,u=yield d;switch(t.reportPCDisconnectedOrFailed(e),e){case dn.TCP:t._pcStatsUploadType=Di.TCP_RESTART;break;case dn.RELAY:t._pcStatsUploadType=Di.RELAY_RESTART;break;default:t._pcStatsUploadType=Di.OLD_RESTART}t._isInRestartIce=!0,r.next(u)}catch(a){var o;(o=r)===null||o===void 0||o.throw(a)}finally{n()}})()}getUplinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats(),t=this.localTrackMap.get(ue.LocalVideoTrack),n=this.localTrackMap.get(ue.LocalAudioTrack),r=e.videoSend.find(R=>R.ssrc===(t==null?void 0:t.ssrcs[0].ssrcId)),o=e.audioSend.find(R=>R.ssrc===(n==null?void 0:n.ssrcs[0].ssrcId));if(!r||!o)return 1;const a=li(this,Be.NeedSignalRTT),d=r?r.rttMs:void 0,u=o?o.rttMs:void 0,h=d&&u?(d+u)/2:d||u,m=(h&&a?(h+a)/2:h||a)||0,f=100*e.sendPacketLossRate*.7/50+.3*m/1500,E=f<.17?1:f<.36?2:f<.59?3:f<.1?4:5,T=t==null?void 0:t.track;if(T&&T._encoderConfig&&T._hints.indexOf(zt.SCREEN_TRACK)===-1){const R=T._encoderConfig.bitrateMax,A=e.bitrate.actualEncoded;if(R&&A){const O=(1e3*R-A)/(1e3*R);return aV[O<.15?0:O<.3?1:O<.45?2:O<.6?3:4][E]}}return E}getDownlinkNetworkQuality(){if(!this.connection)return 0;const e=this.connection.getStats();let t=0;return Array.from(this.remoteUserMap.entries()).forEach(n=>{let[r]=n;const o=r._audioSSRC,a=r._videoSSRC,d=e.audioRecv.find(A=>A.ssrc===o),u=e.videoRecv.find(A=>A.ssrc===a);if(!d&&!u)return void(t+=1);const h=li(this,Be.NeedSignalRTT),m=e.rtt,f=(m&&h?(m+h)/2:m||h)||0,E=d?d.jitterMs:void 0,T=e.recvPacketLossRate;let R=.7*T*100/50+.3*f/1500;E&&(R=.6*T*100/50+.2*f/1500+.2*E/400),t+=R<.1?1:R<.17?2:R<.36?3:R<.59?4:5}),this.remoteUserMap.size>0?Math.round(t/this.remoteUserMap.size):t}async muteLocalTrack(e){return new de((t,n)=>{this.handleMuteLocalTrack(e,t,n)})}filterTobePublishedTracks(e,t,n){const r=[],o=bt(),a=this.getAllTracks();e=TI(e=e.filter(h=>a.indexOf(h)===-1));let d=!1,u=!1;for(const h of e){if(h instanceof Ft&&(this.localTrackMap.has(ue.LocalVideoTrack)||d?new b(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS).throw():(r.push({track:h,type:ue.LocalVideoTrack}),d=!0),t)){const m=this.getLowVideoTrack(h,n);r.push({track:m,type:ue.LocalVideoLowTrack})}if(h instanceof yn){const m=this.localTrackMap.get(ue.LocalAudioTrack);if(m){if(!(m.track instanceof rr))throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");m.track.addAudioTrack(h),this.bindLocalAudioTrackEvents(h,!0)}else if(u){const f=r.find(E=>{let{type:T}=E;return T===ue.LocalAudioTrack});if(!(f.track instanceof rr))throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser does not support audio mixing");if(h._bypassWebAudio)throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio");f.track.addAudioTrack(h)}else{if(!o.webAudioMediaStreamDest||h instanceof rr||h._bypassWebAudio)r.push({track:h,type:ue.LocalAudioTrack});else{const f=new rr;f.addAudioTrack(h),r.push({track:f,type:ue.LocalAudioTrack})}u=!0}}}return r}filterTobeUnpublishedTracks(e){const t=[],n=this.getAllTracks();e=TI(e=e.filter(r=>n.indexOf(r)!==-1));for(const r of e){if(r instanceof yn){const o=this.localTrackMap.get(ue.LocalAudioTrack);if(!o)continue;o.track instanceof rr?(o.track.removeAudioTrack(r),this.unbindLocalAudioTrackEvents(r),o.track.trackList.length===0&&(t.push([ue.LocalAudioTrack,o]),o.track.close())):t.push([ue.LocalAudioTrack,o])}if(r instanceof Ft){const o=this.localTrackMap.get(ue.LocalVideoTrack);if(!o)continue;t.push([ue.LocalVideoTrack,o]);const a=this.localTrackMap.get(ue.LocalVideoLowTrack);a&&t.push([ue.LocalVideoLowTrack,a])}}return t}bindLocalTrackEvents(e){e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ue.LocalVideoTrack:n.addListener(Re.GET_STATS,this.handleGetLocalVideoStats),n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.addListener(Re.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ue.LocalAudioTrack:this.bindLocalAudioTrackEvents(n);break;case ue.LocalVideoLowTrack:}})}bindLocalAudioTrackEvents(e,t){e instanceof rr?e.trackList.forEach(n=>{n.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),n.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.addListener(Re.GET_STATS,this.handleGetLocalAudioStats),e.addListener(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.addListener(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.addListener(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack),t||e.addListener(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack))}unbindLocalTrackEvents(e){e||(e=Array.from(this.localTrackMap.entries()).map(t=>{let[n,{track:r}]=t;return{track:r,type:n}})),e.forEach(t=>{let{track:n,type:r}=t;switch(r){case ue.LocalVideoTrack:n.off(Re.GET_STATS,this.handleGetLocalVideoStats),n.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),n.off(Re.NEED_UPDATE_VIDEO_ENCODER,this.handleUpdateVideoEncoder),n.off(Re.SET_OPTIMIZATION_MODE,this.handleSetOptimizationMode),n.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),n.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),n.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack);break;case ue.LocalAudioTrack:this.unbindLocalAudioTrackEvents(n);break;case ue.LocalVideoLowTrack:}})}unbindLocalAudioTrackEvents(e){e instanceof rr?e.trackList.forEach(t=>{t.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),t.off(Re.GET_STATS,this.handleGetLocalAudioStats),t.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),t.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack)}):(e.off(Re.GET_STATS,this.handleGetLocalAudioStats),e.off(Re.NEED_DISABLE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_ENABLE_TRACK,this.handleUnmuteLocalTrack),e.off(Re.NEED_REPLACE_TRACK,this.handleReplaceTrack),e.off(Re.NEED_MUTE_TRACK,this.handleMuteLocalTrack),e.off(Re.NEED_UNMUTE_TRACK,this.handleUnmuteLocalTrack))}bindRemoteTrackEvents(e,t){t instanceof Gu&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteVideoStats(e))}),t instanceof Wu&&t.addListener(Re.GET_STATS,n=>{n(this.handleGetRemoteAudioStats(e))})}unbindRemoteTrackEvents(e){e&&e.removeAllListeners(Re.GET_STATS)}unbindAllRemoteTrackEvents(){Array.from(this.remoteUserMap.entries()).forEach(e=>{let[t,n]=e;n.has(be.AUDIO)&&this.unbindRemoteTrackEvents(t._audioTrack),n.has(be.VIDEO)&&this.unbindRemoteTrackEvents(t._videoTrack)})}createGatewayPublishMessage(e,t){return e.map((n,r)=>{let o,a,{track:d,type:u}=n;switch(u){case ue.LocalAudioTrack:o=Wt.Audio,a={dtx:d instanceof yu&&d._config.DTX,hq:!1,lq:!1,stereo:!1,speech:!1};break;case ue.LocalVideoTrack:o=d._hints.includes(zt.SCREEN_TRACK)?Wt.Screen:Wt.High,a=ns(ns({},EI(d)),{},{codec:this.store.codec});break;case ue.LocalVideoLowTrack:o=Wt.Low,a=ns(ns({},EI(d)),{},{codec:this.store.codec})}return{stream_type:o,attributes:a,ssrcs:t[r]}})}createGatewayUnpublishMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:d}]=t;switch(r){case ue.LocalVideoTrack:n=o._hints.includes(zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ue.LocalAudioTrack:n=Wt.Audio;break;case ue.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:a,mid:d}})}assignLocalTracks(e,t){e.forEach((n,r)=>{let{track:o,type:a}=n;this.localTrackMap.set(a,{track:o,id:t[r].id,ssrcs:t[r].localSSRC})})}withdrawLocalTracks(e){e.forEach(t=>{let[n]=t;this.localTrackMap.delete(n)})}bindConnectionEvents(e){e.onConnectionStateChange=async t=>{if(v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onConnectionStateChange(").concat(t,")")),this.emit(Be.PeerConnectionStateChange,t),t!=="connected"||this.store.keyMetrics.peerConnectionEnd||this.store.peerConnectionEnd(),t==="connected"&&(this._restartTimer&&(clearTimeout(this._restartTimer),this._restartTimer=void 0),(this._isFirstConnected||this._isInRestartIce)&&this.reportPCStats(Date.now(),!0,this._pcStatsUploadType),this._isInRestartIce=!1,this._isFirstConnected=!1,this._isStartRestartIce=!1),k("NEW_ICE_RESTART")){if(this._restartStates.includes(t)){if(this._isStartRestartIce)return;this._isStartRestartIce=!0;const n=a=>{(e.iceConnectionState==="disconnected"||e.iceConnectionState==="checking"||e.iceConnectionState==="failed")&&(v.debug("[".concat(this.store.clientId,"] [P2PChannel] start use restartICE, type is ").concat(a)),li(this,Be.QueryClientConnectionState)==="CONNECTED"&&this.emit(Be.RequestRestartICE,a))},r=()=>{e.iceConnectionState!=="disconnected"&&e.iceConnectionState!=="checking"&&e.iceConnectionState!=="failed"||(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),v.debug("[".concat(this.store.clientId,"] P2PConnection disconnected timeout, force reconnect")),setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},o=k("ICE_RESTART_INTERVAL");return void(this._restartTimer=window.setTimeout(()=>{if(k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&bt().supportPCSetConfiguration)n(dn.RELAY),this._restartTimer=window.setTimeout(r,o);else if(Tt())n(dn.UDP),this._restartTimer=window.setTimeout(r,4e3);else{if(n(dn.TCP),bt().supportPCSetConfiguration)return void(this._restartTimer=window.setTimeout(()=>{n(dn.RELAY),this._restartTimer=window.setTimeout(r,o)},o));this._restartTimer=window.setTimeout(r,o)}},800))}}else{if(t==="disconnected"&&e.iceConnectionState==="disconnected")return setTimeout(()=>{e.iceConnectionState==="disconnected"&&k("ICE_RESTART")&&li(this,Be.QueryClientConnectionState)==="CONNECTED"&&this.emit(Be.RequestRestartICE)},800),void setTimeout(()=>{e.peerConnectionState==="disconnected"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection disconnected timeout 4000ms, force reconnect")),this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isInRestartIce=!1,setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,this.requestReconnect())},4e3);t==="failed"&&(v.debug("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection state failed, force reconnect")),this.reportPCDisconnectedOrFailed(),setTimeout(()=>this.emit(Be.P2PLost),0),this.iceFailedCount+=1,await this.requestReconnect())}},e.onICEConnectionStateChange=t=>{t!=="connected"||this.store.keyMetrics.iceConnectionEnd||this.store.iceConnectionEnd(),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICEConnectionStateChange(").concat(t,")")),he.reportApiInvoke(this.store.sessionId,{name:"ICEConnectionStateChange",options:t,tag:Et.TRACER}).onSuccess(),this.emit(Be.IceConnectionStateChange,t)},e.onICETransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onICETransportStateChange(").concat(t,")"))},e.onDTLSTransportStateChange=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportStateChange(").concat(t,")"))},e.onDTLSTransportError=t=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.onDTLSTransportError(").concat(t,")"))},e.onFirstAudioDecoded=t=>{var n;const r=Array.from(Ws(n=this.remoteUserMap).call(n)).find(a=>a._audioSSRC===t);var o;r&&(this.store.subscribe(r.uid,"audio",void 0,void 0,void 0,Date.now()),(o=r.audioTrack)===null||o===void 0||o.emit(Fa.FIRST_FRAME_DECODED),he.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_DECODE,St.FIRST_AUDIO_DECODE,{peer:r._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId}))},e.onFirstAudioReceived=t=>{var n;const r=Array.from(Ws(n=this.remoteUserMap).call(n)).find(o=>o._audioSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,cn.FIRST_AUDIO_RECEIVED,St.FIRST_AUDIO_RECEIVED,{peer:r._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onFirstVideoDecoded=(t,n,r)=>{this.reportVideoFirstFrameDecoded(t,n,r)},e.onFirstVideoReceived=t=>{var n;const r=Array.from(Ws(n=this.remoteUserMap).call(n)).find(o=>o._videoSSRC===t);r&&he.firstRemoteFrame(this.store.sessionId,cn.FIRST_VIDEO_RECEIVED,St.FIRST_VIDEO_RECEIVED,{peer:r._uintid,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,t),subscribeRequestid:t,p2pid:this.store.p2pId})},e.onSelectedLocalCandidateChanged=(t,n)=>{const r=t.candidateType==="relay",o=n.candidateType==="relay";n.candidateType!=="unknown"&&r===o||this.emit(Be.ConnectionTypeChange,r),v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedLocalCandidateChanged(").concat(JSON.stringify(Iu(n))," -> ").concat(JSON.stringify(Iu(t)),")"))},e.onSelectedRemoteCandidateChanged=(t,n)=>{v.info("[".concat(this.store.clientId,"] [p2pId: ").concat(this.store.p2pId,"]: P2PConnection.SelectedRemoteCandidateChanged(").concat(JSON.stringify(Iu(n))," -> ").concat(JSON.stringify(Iu(t)),")"))},e.onFirstVideoDecodedTimeout=t=>{this.reportVideoFirstFrameDecoded(t,void 0,void 0,!0)}}unbindConnectionEvents(e){e.onConnectionStateChange=void 0,e.onICEConnectionStateChange=void 0,e.onICETransportStateChange=void 0,e.onDTLSTransportStateChange=void 0,e.onDTLSTransportError=void 0,e.onFirstAudioDecoded=void 0,e.onFirstAudioReceived=void 0,e.onFirstVideoDecoded=void 0,e.onFirstVideoReceived=void 0,e.onSelectedLocalCandidateChanged=void 0,e.onSelectedRemoteCandidateChanged=void 0,e.onFirstVideoDecodedTimeout=void 0}filterTobeMutedTracks(e){const t=[];if(this.getAllTracks().indexOf(e)===-1)return t;const n=this.localTrackMap.get(ue.LocalAudioTrack);if(e instanceof yn&&(n==null?void 0:n.track)instanceof rr)return n.track.isActive||t.push([ue.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(r&&(t.push(r),r[0]===ue.LocalVideoTrack)){const o=this.localTrackMap.get(ue.LocalVideoLowTrack);o&&t.push([ue.LocalVideoLowTrack,o])}return t}filterTobeUnmutedTracks(e){const t=[],n=this.localTrackMap.get(ue.LocalAudioTrack);if(e instanceof yn&&(n==null?void 0:n.track)instanceof rr)return n.track.isActive&&t.push([ue.LocalAudioTrack,n]),t;const r=Array.from(this.localTrackMap.entries()).find(o=>{let[,{track:a}]=o;return e===a});if(r)if(r[0]===ue.LocalVideoTrack){t.push(r);const o=this.localTrackMap.get(ue.LocalVideoLowTrack);o&&t.push([ue.LocalVideoLowTrack,o])}else t.push(r);return t}createMuteMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:d}]=t;switch(r){case ue.LocalAudioTrack:n=Wt.Audio;break;case ue.LocalVideoTrack:n=o._hints.includes(zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ue.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:a,mid:d}})}createUnmuteMessage(e){return e.map(t=>{let n,[r,{track:o,ssrcs:a,id:d}]=t;switch(r){case ue.LocalAudioTrack:n=Wt.Audio;break;case ue.LocalVideoTrack:n=o._hints.includes(zt.SCREEN_TRACK)?Wt.Screen:Wt.High;break;case ue.LocalVideoLowTrack:n=Wt.Low}return{stream_type:n,ssrcs:a,mid:d}})}filterTobeUnSubscribedTracks(e,t){const n=[],r=this.remoteUserMap.get(e);if(!r)return n;if(t){const o=r.get(t);if(!o)return n;n.push([e,{kind:t,id:o}])}else Array.from(r.entries()).forEach(o=>{let[a,d]=o;n.push([e,{kind:a,id:d}])});return n}createUnsubscribeMessage(e){const t=[];return e.forEach(n=>{let[r,{kind:o,id:a}]=n;switch(o){case be.VIDEO:return void(r._videoSSRC&&t.push({stream_type:be.VIDEO,ssrcId:r._videoSSRC}));case be.AUDIO:return void(r._audioSSRC&&t.push({stream_type:be.AUDIO,ssrcId:r._audioSSRC}))}}),t}createUnsubscribeAllMessage(e){const t=new Map;return e.forEach(n=>{let[r,{kind:o}]=n;if(t.has(r)){let a=t.get(r);o===be.VIDEO?a|=Ut.Video:a|=Ut.Audio,t.set(r,a)}else o===be.VIDEO?t.set(r,Ut.Video):t.set(r,Ut.Audio)}),{users:Array.from(t.entries()).map(n=>{let[r,o]=n;return{stream_id:r.uid,stream_type:o}})}}withdrawRemoteTracks(e){e.forEach(t=>{let[n,{kind:r}]=t;const o=this.remoteUserMap.get(n);o&&(o.delete(r),Array.from(o.entries()).length===0&&this.remoteUserMap.delete(n))})}async updateBitrateLimit(e){const t=this.localTrackMap.get(ue.LocalVideoTrack),n=this.localTrackMap.get(ue.LocalVideoLowTrack);t&&await t.track.setBitrateLimit(e.uplink),n&&e.low_stream_uplink&&await n.track.setBitrateLimit({max_bitrate:e.low_stream_uplink.bitrate,min_bitrate:e.low_stream_uplink.bitrate||0})}isP2PDisconnected(){return this.connection?this.connection.peerConnectionState!=="connected":!0}mapPubResToRemoteConfig(e,t){return e.map((n,r)=>{var o;let{stream_type:a}=n;return(o=t.find(d=>{let{stream_type:u}=d;return a===u}))===null||o===void 0?void 0:o.attributes})}async tryToUnmuteAudio(e){for(let n=0;n<e.length;n++)if(e[n]instanceof yn){var t;const r=this.filterTobeUnmutedTracks(e[n]);if(r.length===0)continue;await((t=this.connection)===null||t===void 0?void 0:t.unmuteLocal(r.map(a=>{let[,{id:d}]=a;return d})));const o=this.createUnmuteMessage(r);return void await Rt(this,Be.RequestUnmuteLocal,o)}}bindStatsUploaderEvents(){this.statsUploader.requestStats=()=>this.getStats(),this.statsUploader.requestLocalMedia=()=>Array.from(this.localTrackMap.entries()),this.statsUploader.requestRemoteMedia=()=>Array.from(this.remoteUserMap.entries()),this.statsUploader.requestVideoIsReady=e=>{var t;return!((t=this.connection)===null||t===void 0||!t.getRemoteVideoIsReady(e))},this.statsUploader.requestUpload=(e,t)=>this.emit(Be.RequestUploadStats,e,t),this.statsUploader.requestAllTracks=()=>this.getAllTracks()}unbindStatsUploaderEvents(){this.statsUploader.requestStats=void 0,this.statsUploader.requestLocalMedia=void 0,this.statsUploader.requestRemoteMedia=void 0,this.statsUploader.requestVideoIsReady=void 0}async requestReconnect(){this.dtlsFailedCount+=1,await Rn(Sm(this.dtlsFailedCount,kt)),this.emit(Be.RequestReconnect)}async reconnectP2P(){const e=Array.from(this.localTrackMap.entries()),t=this.createGatewayUnpublishMessage(e);Array.from(this.remoteUserMap.entries()),t.length>0&&await Cn(this,Be.RequestUnpublishForReconnectPC,t),this.disconnectForReconnect(),this.emit(Be.RequestReconnectPC)}canPublishLowStream(){return this.localTrackMap.has(ue.LocalVideoTrack)||this.pendingLocalTracks.some(e=>e instanceof Ft)}throwIfTrackTypeNotMatch(e){if(e.filter(t=>t instanceof Ft).length>1)throw new b(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(e.filter(t=>t instanceof yn).length>1&&(e.some(t=>t instanceof yn&&t._bypassWebAudio)||!bt().webAudioMediaStreamDest))throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode");for(const t of e){if(t instanceof Ft&&this.pendingLocalTracks.some(n=>n instanceof Ft))throw new b(I.CAN_NOT_PUBLISH_MULTIPLE_VIDEO_TRACKS);if(t instanceof yn&&this.pendingLocalTracks.some(n=>n instanceof yn)&&(!bt().webAudioMediaStreamDest||t._bypassWebAudio||this.pendingLocalTracks.some(n=>n instanceof yn&&n._bypassWebAudio)))throw new b(I.NOT_SUPPORTED,"cannot publish multiple tracks which one of them configured with bypassWebAudio or your browser doesn't support MediaStreamDestNode")}}getLowVideoTrack(e,t){const n=bt().supportDualStreamEncoding,r=ns(ns({},{width:160,height:120,framerate:15,bitrate:50}),t);let o;o=n?e._mediaStreamTrack.clone():WO(e,r);const a=ut(8,"track-low-"),d=new Ft(o,ns(ns({},n&&{scaleResolutionDownBy:lj(r,e)}),{},{frameRate:r.framerate,bitrateMax:r.bitrate,bitrateMin:r.bitrate}),void 0,void 0,a);return d.on(Zc.TRANSCEIVER_UPDATED,u=>{e._updateRtpTransceiver(u,Va.LOW_STREAM)}),d._hints.push(zt.LOW_STREAM),e.addListener(Re.NEED_CLOSE,()=>{d.close()}),d}async globalLock(){return this.mutex.lock("From P2PChannel.globalLock")}async reportPCStats(e,t,n){let r=arguments.length>3&&arguments[3]!==void 0?arguments[3]:null;if(this.connection&&this.connection instanceof To){var o,a,d,u;const h=this.store.keyMetrics.descriptionStart||0,{iceConnectionState:m,dtlsTransportState:f,peerConnectionState:E}=this.connection,{local:T,remote:R}=await this.connection.getSelectedCandidatePair();he.pcStats(this.store.sessionId,{startTime:h,eventElapse:e-h||0,iceconnectionsate:m,dtlsstate:f,connectionstate:E,intSucc:t?1:2,error:r,selectedLocalCandidateProtocol:(o=T==null?void 0:T.protocol)!==null&&o!==void 0?o:"",selectedLocalCandidateType:(a=T.candidateType)!==null&&a!==void 0?a:"",selectedLocalCandidateAddress:"".concat(T.address,":").concat(T.port),selectedRemoteCandidateProtocol:(d=R.protocol)!==null&&d!==void 0?d:"",selectedRemoteCandidateType:(u=R.candidateType)!==null&&u!==void 0?u:"",selectedRemoteCandidateAddress:"".concat(R.address,":").concat(R.port),restartCnt:n})}}reportVideoFirstFrameDecoded(e,t,n,r){var o;const a=Array.from(Ws(o=this.remoteUserMap).call(o)).find(d=>d._videoSSRC===e);if(a){r||this.store.subscribe(a.uid,"video",void 0,void 0,void 0,void 0,Date.now());const d=this.store.keyMetrics,u=d.subscribe.find(h=>h.userId===a.uid&&h.type==="video");he.firstRemoteVideoDecode(this.store.sessionId,cn.FIRST_VIDEO_DECODE,St.FIRST_VIDEO_DECODE,{peer:a._uintid,videowidth:t,videoheight:n,subscribeElapse:zr.measureFromSubscribeStart(this.store.clientId,e),subscribeRequestid:e,p2pid:this.store.p2pId,apEnd:d.requestAPEnd||0,apStart:d.requestAPStart||0,joinGwEnd:d.joinGatewayEnd||0,joinGwStart:d.joinGatewayStart||0,pcEnd:d.peerConnectionEnd||0,pcStart:d.peerConnectionStart||0,subscriberEnd:(u==null?void 0:u.subscribeEnd)||0,subscriberStart:(u==null?void 0:u.subscribeStart)||0,videoAddNotify:(u==null?void 0:u.streamAdded)||0,state:r?1:0})}}async remoteMediaSsrcChanged(e,t,n){if(!this.connection)return!1;const r=this.remoteUserMap.get(e);if(!r)return!1;const o=r.get(t);if(!o)return!1;const a=await this.connection.getRemoteSSRC(o);return a!==void 0&&a!==n}resetConnection(e){v.debug("[".concat(this.store.clientId,"] [P2PChannel] reset connection to ").concat(e)),this.state===Yt.Connected?(v.debug("[".concat(this.store.clientId,"] [P2PChannel] fallback to websocket but P2PChannel state still connected, disconnect first")),this.disconnectForReconnect()):(this.connection&&(this.connection.close(),this.unbindConnectionEvents(this.connection),this.connection=void 0),this.shouldForwardP2PCreation&&(this.connection=e===mu.datachannel?new ts({},this.store):this.isPlanB?new md({},this.store):new To({},this.store),this.bindConnectionEvents(this.connection)))}unbindRtpTransceiver(){this.localTrackMap.size!==0&&Array.from(this.localTrackMap.entries()).forEach(e=>{let[t,{track:n}]=e;t===ue.LocalVideoLowTrack?n._updateRtpTransceiver(void 0,Va.LOW_STREAM):n._updateRtpTransceiver(void 0)})}reportPCDisconnectedOrFailed(e){this.connection&&this.connection instanceof To&&(this.connection.iceConnectionState!=="disconnected"&&this.connection.iceConnectionState!=="checking"&&this.connection.iceConnectionState!=="failed"||(this._isFirstConnected?(this.reportPCStats(Date.now(),!1,this._pcStatsUploadType),this._isFirstConnected=!1):this._pcStatsUploadType===Di.TCP_RESTART&&e===dn.RELAY?this.reportPCStats(Date.now(),!1,this._pcStatsUploadType):this.reportPCStats(Date.now(),!1,Di.DISCONNECTED_OR_FAILED)))}}).prototype,"startP2PConnection",[Er],Object.getOwnPropertyDescriptor(He.prototype,"startP2PConnection"),He.prototype),Y(He.prototype,"connect",[Er],Object.getOwnPropertyDescriptor(He.prototype,"connect"),He.prototype),Y(He.prototype,"preConnect",[Er],Object.getOwnPropertyDescriptor(He.prototype,"preConnect"),He.prototype),Y(He.prototype,"unpublish",[Er],Object.getOwnPropertyDescriptor(He.prototype,"unpublish"),He.prototype),Y(He.prototype,"unpublishLowStream",[Er],Object.getOwnPropertyDescriptor(He.prototype,"unpublishLowStream"),He.prototype),Y(He.prototype,"subscribe",[Er],Object.getOwnPropertyDescriptor(He.prototype,"subscribe"),He.prototype),Y(He.prototype,"massSubscribe",[Er],Object.getOwnPropertyDescriptor(He.prototype,"massSubscribe"),He.prototype),Y(He.prototype,"unsubscribe",[Er],Object.getOwnPropertyDescriptor(He.prototype,"unsubscribe"),He.prototype),Y(He.prototype,"massUnsubscribe",[Er],Object.getOwnPropertyDescriptor(He.prototype,"massUnsubscribe"),He.prototype),Y(He.prototype,"muteRemote",[Er],Object.getOwnPropertyDescriptor(He.prototype,"muteRemote"),He.prototype),Y(He.prototype,"unmuteRemote",[Er],Object.getOwnPropertyDescriptor(He.prototype,"unmuteRemote"),He.prototype),Y(He.prototype,"hasRemoteMediaWithLock",[Er],Object.getOwnPropertyDescriptor(He.prototype,"hasRemoteMediaWithLock"),He.prototype),Y(He.prototype,"disconnectForReconnect",[Er],Object.getOwnPropertyDescriptor(He.prototype,"disconnectForReconnect"),He.prototype),Y(He.prototype,"updateBitrateLimit",[Er],Object.getOwnPropertyDescriptor(He.prototype,"updateBitrateLimit"),He.prototype),Y(He.prototype,"remoteMediaSsrcChanged",[Er],Object.getOwnPropertyDescriptor(He.prototype,"remoteMediaSsrcChanged"),He.prototype),He);function Er(e,t,n){const r=e[t];if(typeof r!="function")throw new Error("Cannot use mutex on object property.");return n.value=async function(){const o=this.mutex,a=await o.lock("From P2PChannel.".concat(t));try{for(var d=arguments.length,u=new Array(d),h=0;h<d;h++)u[h]=arguments[h];return await r.apply(this,u)}finally{a()}},n}function uw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function pe(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?uw(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):uw(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}var ke;(function(e){e.SET_SESSION_ID="SET_SESSION_ID",e.SET_P2P_ID="SET_P2P_id",e.SET_DC_ID="SET_DC_id",e.SET_UID="SET_UID",e.SET_PUB_ID="SET_PUB_ID",e.SET_CLOUD_PROXY_SERVER_MODE="SET_CLOUD_PROXY_SERVER_MODE",e.KEY_METRIC_CLIENT_CREATED="KEY_METRIC_CLIENT_CREATED",e.KEY_METRIC_JOIN_START="KEY_METRIC_JOIN_START",e.AVOID_JOIN_START="AVOID_JOIN_START",e.KEY_METRIC_JOIN_END="KEY_METRIC_JOIN_END",e.KEY_METRIC_REQUEST_AP_START="KEY_METRIC_REQUEST_AP_START",e.KEY_METRIC_REQUEST_AP_END="KEY_METRIC_REQUEST_AP_END",e.KEY_METRIC_JOIN_GATEWAY_START="KEY_METRIC_JOIN_GATEWAY_START",e.KEY_METRIC_JOIN_GATEWAY_END="KEY_METRIC_JOIN_GATEWAY_END",e.KEY_METRIC_PEER_CONNECTION_START="KEY_METRIC_PEER_CONNECTION_START",e.KEY_METRIC_PEER_CONNECTION_END="KEY_METRIC_PEER_CONNECTION_END",e.KEY_METRIC_DESCRIPTION_START="KEY_METRIC_DESCRIPTION_START",e.KEY_METRIC_ICE_CONNECTION_END="KEY_METRIC_ICE_CONNECTION_END",e.KEY_METRIC_SIGNAL_CHANNEL_OPEN="KEY_METRIC_SIGNAL_CHANNEL_OPEN",e.KEY_METRIC_PUBLISH="KEY_METRIC_PUBLISH",e.KEY_METRIC_SUBSCRIBE="KEY_METRIC_SUBSCRIBE",e.RECORD_JOIN_CHANNEL_SERVICE="RECORD_JOIN_CHANNEL_SERVICE",e.RESET_JOIN_CHANNEL_SERVICE_RECORDS="RESET_JOIN_CHANNEL_SERVICE_RECORDS",e.RESET_KEY_METRICS="RESET_KEY_METRICS",e.SET_USE_DATACHANNEL="SET_USE_DATACHANNEL"})(ke||(ke={}));class PB{constructor(t,n,r,o){g(this,"state",void 0),this.state={codec:t,audioCodec:n,mode:r,clientId:o,sessionId:null,p2pId:0,dcId:0,pubId:0,subId:0,avoidJoinStart:0,keyMetrics:{publish:[],subscribe:[]},joinChannelServiceRecords:[],cloudProxyServerMode:"disabled",useDataChannel:!1}}dispatch(t){this.state=function(n,r){switch(r.type){case ke.SET_SESSION_ID:return pe(pe({},n),{},{sessionId:r.sessionId});case ke.SET_P2P_ID:return pe(pe({},n),{},{p2pId:r.p2pId});case ke.SET_UID:return pe(pe({},n),{},{uid:r.uid});case ke.SET_PUB_ID:return pe(pe({},n),{},{pubId:r.pubId});case ke.KEY_METRIC_CLIENT_CREATED:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{clientCreated:r.metric})});case ke.KEY_METRIC_JOIN_START:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{joinStart:r.metric})});case ke.AVOID_JOIN_START:return pe(pe({},n),{},{avoidJoinStart:r.avoidJoinStart});case ke.KEY_METRIC_JOIN_END:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{joinEnd:r.metric})});case ke.KEY_METRIC_REQUEST_AP_START:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{requestAPStart:r.metric})});case ke.KEY_METRIC_REQUEST_AP_END:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{requestAPEnd:r.metric})});case ke.KEY_METRIC_JOIN_GATEWAY_START:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{joinGatewayStart:r.metric})});case ke.KEY_METRIC_JOIN_GATEWAY_END:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{joinGatewayEnd:r.metric})});case ke.KEY_METRIC_PEER_CONNECTION_START:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{peerConnectionStart:r.metric})});case ke.KEY_METRIC_PEER_CONNECTION_END:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{peerConnectionEnd:r.metric})});case ke.KEY_METRIC_DESCRIPTION_START:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{descriptionStart:r.metric})});case ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{signalChannelOpen:r.metric})});case ke.KEY_METRIC_ICE_CONNECTION_END:return pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{iceConnectionEnd:r.metric})});case ke.KEY_METRIC_PUBLISH:{const o=n.keyMetrics.publish,a=o.findIndex(d=>d.trackId===r.metric.trackId);return a!==-1?(o[a]=pe(pe({},o[a]),r.metric),pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{publish:[...o]})})):pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{publish:[...n.keyMetrics.publish,r.metric]})})}case ke.KEY_METRIC_SUBSCRIBE:{const o=n.keyMetrics.subscribe,a=o.findIndex(d=>d.userId===r.metric.userId&&d.type===r.metric.type);return a!==-1?(o[a]=pe(pe({},o[a]),r.metric),pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{subscribe:[...o]})})):pe(pe({},n),{},{keyMetrics:pe(pe({},n.keyMetrics),{},{subscribe:[...n.keyMetrics.subscribe,r.metric]})})}case ke.SET_CLOUD_PROXY_SERVER_MODE:return n.cloudProxyServerMode=r.mode,n;case ke.RECORD_JOIN_CHANNEL_SERVICE:return typeof r.index!="number"?n.joinChannelServiceRecords=[...n.joinChannelServiceRecords,r.record]:(n.joinChannelServiceRecords[r.index]=pe(pe({},n.joinChannelServiceRecords[r.index]),r.record),n.joinChannelServiceRecords=[...n.joinChannelServiceRecords]),n;case ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS:return n.joinChannelServiceRecords=[],n;case ke.RESET_KEY_METRICS:return n.keyMetrics={publish:[],subscribe:[]},n;case ke.SET_USE_DATACHANNEL:return pe(pe({},n),{},{useDataChannel:r.val});default:return n}}(this.state,t)}set sessionId(t){this.dispatch({type:ke.SET_SESSION_ID,sessionId:t})}get sessionId(){return this.state.sessionId}get codec(){return this.state.codec}get audioCodec(){return this.state.audioCodec}get clientId(){return this.state.clientId}set p2pId(t){this.dispatch({type:ke.SET_P2P_ID,p2pId:t})}get p2pId(){return this.state.p2pId}set dcId(t){this.dispatch({type:ke.SET_DC_ID,dcId:t})}get dcId(){return this.state.dcId}set uid(t){this.dispatch({type:ke.SET_UID,uid:t})}get uid(){return this.state.uid}set pubId(t){this.dispatch({type:ke.SET_PUB_ID,pubId:t})}get pubId(){return this.state.pubId}set cloudProxyServerMode(t){this.dispatch({type:ke.SET_CLOUD_PROXY_SERVER_MODE,mode:t})}get cloudProxyServerMode(){return this.state.cloudProxyServerMode}set useDataChannel(t){this.dispatch({type:ke.SET_USE_DATACHANNEL,val:t})}get useDataChannel(){return this.state.useDataChannel}clientCreated(){this.dispatch({type:ke.KEY_METRIC_CLIENT_CREATED,metric:Date.now()})}joinStart(){this.dispatch({type:ke.KEY_METRIC_JOIN_START,metric:Date.now()})}joinEnd(){this.dispatch({type:ke.KEY_METRIC_JOIN_END,metric:Date.now()})}requestAPStart(){this.dispatch({type:ke.KEY_METRIC_REQUEST_AP_START,metric:Date.now()})}requestAPEnd(){this.dispatch({type:ke.KEY_METRIC_REQUEST_AP_END,metric:Date.now()})}joinGatewayStart(){this.dispatch({type:ke.KEY_METRIC_JOIN_GATEWAY_START,metric:Date.now()})}joinGatewayEnd(){this.dispatch({type:ke.KEY_METRIC_JOIN_GATEWAY_END,metric:Date.now()})}peerConnectionStart(){this.dispatch({type:ke.KEY_METRIC_PEER_CONNECTION_START,metric:Date.now()})}peerConnectionEnd(){this.dispatch({type:ke.KEY_METRIC_PEER_CONNECTION_END,metric:Date.now()})}descriptionStart(){this.dispatch({type:ke.KEY_METRIC_DESCRIPTION_START,metric:Date.now()})}signalChannelOpen(){this.dispatch({type:ke.KEY_METRIC_SIGNAL_CHANNEL_OPEN,metric:Date.now()})}iceConnectionEnd(){this.dispatch({type:ke.KEY_METRIC_ICE_CONNECTION_END,metric:Date.now()})}publish(t,n,r,o){this.dispatch({type:ke.KEY_METRIC_PUBLISH,metric:pe(pe({trackId:t,type:n},r&&{publishStart:r}),o&&{publishEnd:o})})}subscribe(t,n,r,o,a,d,u){this.dispatch({type:ke.KEY_METRIC_SUBSCRIBE,metric:pe(pe(pe(pe(pe({userId:t,type:n},r&&{subscribeStart:r}),o&&{subscribeEnd:o}),a&&{firstFrame:a}),d&&{streamAdded:d}),u&&{firstDecoded:u})})}massSubscribe(t,n,r,o){t.forEach(a=>{this.dispatch({type:ke.KEY_METRIC_SUBSCRIBE,metric:pe(pe(pe({userId:a.userId,type:a.type},n&&{subscribeStart:n}),r&&{subscribeEnd:r}),o&&{firstFrame:o})})})}get keyMetrics(){return this.state.keyMetrics}recordJoinChannelService(t,n){t.service==="gateway"&&Array.isArray(t.urls)&&(t.urls=t.urls.map(r=>r.replace(/(\d+)-\d+-\d+-(\d+)/,"$1-*-*-$2")));try{return typeof n!="number"?(this.dispatch({type:ke.RECORD_JOIN_CHANNEL_SERVICE,record:pe(pe({},t),{},{sessionId:this.sessionId,cloudProxyMode:this.cloudProxyServerMode,uid:this.uid})}),this.state.joinChannelServiceRecords.length-1):(n<0||n>=this.state.joinChannelServiceRecords.length||this.dispatch({type:ke.RECORD_JOIN_CHANNEL_SERVICE,record:t,index:n}),n)}catch{return 0}}resetJoinChannelServiceRecords(){this.dispatch({type:ke.RESET_JOIN_CHANNEL_SERVICE_RECORDS})}resetKeyMetrics(){this.dispatch({type:ke.RESET_KEY_METRICS})}get joinChannelServiceRecords(){try{return this.state.joinChannelServiceRecords}catch{return[]}}get avoidJoinStart(){return this.state.avoidJoinStart}set avoidJoinStart(t){this.dispatch({type:ke.AVOID_JOIN_START,avoidJoinStart:t})}}let zu;const LB=()=>(zu||zu||(zu=(window.location.protocol.split(":")[0]||"").toUpperCase(),zu))==="HTTPS",hw=()=>window.isSecureContext!==void 0;function kB(e){let t=mw();return function(n,r){let o=n.appId;o!==void 0&&(Ke(r,10),Qi(r,o));let a=n.cid;a!==void 0&&(Ke(r,16),Ke(r,a));let d=n.cname;d!==void 0&&(Ke(r,26),Qi(r,d));let u=n.deviceId;u!==void 0&&(Ke(r,34),Qi(r,u));let h=n.elapse;h!==void 0&&(Ke(r,40),rs(r,h));let m=n.fileSize;m!==void 0&&(Ke(r,48),rs(r,Za(m)));let f=n.height;f!==void 0&&(Ke(r,56),rs(r,Za(f)));let E=n.jpg;E!==void 0&&(Ke(r,66),Ke(r,E.length),function(or,K){let Q=ec(or,K.length);or.bytes.set(K,Q)}(r,E));let T=n.networkType;T!==void 0&&(Ke(r,72),rs(r,Za(T)));let R=n.osType;R!==void 0&&(Ke(r,80),rs(r,Za(R)));let A=n.requestId;A!==void 0&&(Ke(r,90),Qi(r,A));let O=n.sdkVersion;O!==void 0&&(Ke(r,98),Qi(r,O));let w=n.sequence;w!==void 0&&(Ke(r,104),rs(r,Za(w)));let x=n.sid;x!==void 0&&(Ke(r,114),Qi(r,x));let V=n.timestamp;V!==void 0&&(Ke(r,120),rs(r,V));let X=n.uid;X!==void 0&&(Ke(r,128),Ke(r,X));let le=n.vid;le!==void 0&&(Ke(r,136),Ke(r,le));let $=n.width;$!==void 0&&(Ke(r,144),rs(r,Za($)));let ee=n.service;ee!==void 0&&(Ke(r,152),Ke(r,ee));let q=n.callbackData;q!==void 0&&(Ke(r,162),Qi(r,q));let re=n.jpgEncryption;re!==void 0&&(Ke(r,168),Ke(r,re));let ze=n.requestType;ze!==void 0&&(Ke(r,176),Ke(r,ze));let Se=n.scorePorn;Se!==void 0&&(Ke(r,185),JE(r,Se));let ct=n.scoreSexy;ct!==void 0&&(Ke(r,193),JE(r,ct));let tt=n.scoreNeutral;tt!==void 0&&(Ke(r,201),JE(r,tt));let Pt=n.scene;Pt!==void 0&&(Ke(r,208),Ke(r,Pt));let un=n.ossFilePrefix;un!==void 0&&(Ke(r,218),Qi(r,un));let Ot=n.serviceVendor;if(Ot!==void 0)for(let or of Ot){Ke(r,226);let K=mw();xB(or,K),Ke(r,K.limit),BB(r,K),jB(K)}}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function MB(e){return function(n){let r={};e:for(;!Ew(n);){let o=$i(n);switch(o>>>3){case 0:break e;case 1:r.code=$i(n);break;case 2:r.msg=_w(n,$i(n));break;case 3:{let a=VB(n);r.data=UB(n),n.limit=a;break}default:pw(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function UB(e){let t={};e:for(;!Ew(e);){let n=$i(e);switch(n>>>3){case 0:break e;case 1:t.requestId=_w(e,$i(e));break;case 2:t.requestType=$i(e)>>>0;break;case 3:t.scorePorn=qE(e);break;case 4:t.scoreSexy=qE(e);break;case 5:t.scoreNeutral=qE(e);break;case 6:t.requestScene=$i(e)>>>0;break;case 7:t.scene=$i(e)>>>0;break;default:pw(e,7&n)}}return t}function xB(e,t){let n=e.service;n!==void 0&&(Ke(t,8),Ke(t,n));let r=e.vendor;r!==void 0&&(Ke(t,16),Ke(t,r));let o=e.token;o!==void 0&&(Ke(t,26),Qi(t,o));let a=e.callbackUrl;a!==void 0&&(Ke(t,34),Qi(t,a))}function VB(e){let t=$i(e),n=e.limit;return e.limit=e.offset+t,n}function pw(e,t){switch(t){case 0:for(;128&gw(e););break;case 2:zE(e,$i(e));break;case 5:zE(e,4);break;case 1:zE(e,8);break;default:throw new Error("Unimplemented type: "+t)}}let FB=new Float32Array(1);new Uint8Array(FB.buffer);let KE=new Float64Array(1),ir=new Uint8Array(KE.buffer);function Za(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let fw=[];function mw(){const e=fw.pop();return e?(e.offset=e.limit=0,e):{bytes:new Uint8Array(64),offset:0,limit:0}}function jB(e){fw.push(e)}function zE(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function Ew(e){return e.offset>=e.limit}function ec(e,t){let n=e.bytes,r=e.offset,o=e.limit,a=r+t;if(a>n.length){let d=new Uint8Array(2*a);d.set(n),e.bytes=d}return e.offset=a,a>o&&(e.limit=a),r}function YE(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function _w(e,t){let n=YE(e,t),r=String.fromCharCode,o=e.bytes,a="�",d="";for(let u=0;u<t;u++){let h,m,f,E,T=o[u+n];128&T?(224&T)==192?u+1>=t?d+=a:(h=o[u+n+1],(192&h)!=128?d+=a:(E=(31&T)<<6|63&h,E<128?d+=a:(d+=r(E),u++))):(240&T)==224?u+2>=t?d+=a:(h=o[u+n+1],m=o[u+n+2],(49344&(h|m<<8))!=32896?d+=a:(E=(15&T)<<12|(63&h)<<6|63&m,E<2048||E>=55296&&E<=57343?d+=a:(d+=r(E),u+=2))):(248&T)==240?u+3>=t?d+=a:(h=o[u+n+1],m=o[u+n+2],f=o[u+n+3],(12632256&(h|m<<8|f<<16))!=8421504?d+=a:(E=(7&T)<<18|(63&h)<<12|(63&m)<<6|63&f,E<65536||E>1114111?d+=a:(E-=65536,d+=r(55296+(E>>10),56320+(1023&E)),u+=3))):d+=a:d+=r(T)}return d}function Qi(e,t){let n=t.length,r=0;for(let d=0;d<n;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<n&&(u=(u<<10)+t.charCodeAt(++d)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}Ke(e,r);let o=ec(e,r),a=e.bytes;for(let d=0;d<n;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<n&&(u=(u<<10)+t.charCodeAt(++d)-56613888),u<128?a[o++]=u:(u<2048?a[o++]=u>>6&31|192:(u<65536?a[o++]=u>>12&15|224:(a[o++]=u>>18&7|240,a[o++]=u>>12&63|128),a[o++]=u>>6&63|128),a[o++]=63&u|128)}}function BB(e,t){let n=ec(e,t.limit),r=e.bytes,o=t.bytes;for(let a=0,d=t.limit;a<d;a++)r[a+n]=o[a]}function gw(e){return e.bytes[YE(e,1)]}function Sw(e,t){let n=ec(e,1);e.bytes[n]=t}function qE(e){let t=YE(e,8),n=e.bytes;return ir[0]=n[t++],ir[1]=n[t++],ir[2]=n[t++],ir[3]=n[t++],ir[4]=n[t++],ir[5]=n[t++],ir[6]=n[t++],ir[7]=n[t++],KE[0]}function JE(e,t){let n=ec(e,8),r=e.bytes;KE[0]=t,r[n++]=ir[0],r[n++]=ir[1],r[n++]=ir[2],r[n++]=ir[3],r[n++]=ir[4],r[n++]=ir[5],r[n++]=ir[6],r[n++]=ir[7]}function $i(e){let t,n=0,r=0;do t=gw(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Ke(e,t){for(t>>>=0;t>=128;)Sw(e,127&t|128),t>>>=7;Sw(e,t)}function rs(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,d=ec(e,a),u=e.bytes;switch(a){case 10:u[d+9]=o>>>7&1;case 9:u[d+8]=a!==9?128|o:127&o;case 8:u[d+7]=a!==8?r>>>21|128:r>>>21&127;case 7:u[d+6]=a!==7?r>>>14|128:r>>>14&127;case 6:u[d+5]=a!==6?r>>>7|128:r>>>7&127;case 5:u[d+4]=a!==5?128|r:127&r;case 4:u[d+3]=a!==4?n>>>21|128:n>>>21&127;case 3:u[d+2]=a!==3?n>>>14|128:n>>>14&127;case 2:u[d+1]=a!==2?n>>>7|128:n>>>7&127;case 1:u[d]=a!==1?128|n:127&n}}const GB=async(e,t,n)=>{const r=function(d){const u=[];for(let h=0;h<d.length;h+=2)u.push(parseInt(d.slice(h,h+2),16));return Uint8Array.from(u)}(function(d){const u="0123456789abcdef";function h(ze){let Se,ct="";for(Se=0;Se<=3;Se++)ct+=u.charAt(ze>>8*Se+4&15)+u.charAt(ze>>8*Se&15);return ct}function m(ze,Se){const ct=(65535&ze)+(65535&Se);return(ze>>16)+(Se>>16)+(ct>>16)<<16|65535&ct}function f(ze,Se,ct,tt,Pt,un){return m(function(Ot,or){return Ot<<or|Ot>>>32-or}(m(m(Se,ze),m(tt,un)),Pt),ct)}function E(ze,Se,ct,tt,Pt,un,Ot){return f(Se&ct|~Se&tt,ze,Se,Pt,un,Ot)}function T(ze,Se,ct,tt,Pt,un,Ot){return f(Se&tt|ct&~tt,ze,Se,Pt,un,Ot)}function R(ze,Se,ct,tt,Pt,un,Ot){return f(Se^ct^tt,ze,Se,Pt,un,Ot)}function A(ze,Se,ct,tt,Pt,un,Ot){return f(ct^(Se|~tt),ze,Se,Pt,un,Ot)}const O=function(ze){let Se;const ct=1+(ze.length+8>>6),tt=new Array(16*ct);for(Se=0;Se<16*ct;Se++)tt[Se]=0;for(Se=0;Se<ze.length;Se++)tt[Se>>2]|=ze.charCodeAt(Se)<<Se%4*8;return tt[Se>>2]|=128<<Se%4*8,tt[16*ct-2]=8*ze.length,tt}(d);let w,x,V,X,le,$=1732584193,ee=-271733879,q=-1732584194,re=271733878;for(w=0;w<O.length;w+=16)x=$,V=ee,X=q,le=re,$=E($,ee,q,re,O[w+0],7,-680876936),re=E(re,$,ee,q,O[w+1],12,-389564586),q=E(q,re,$,ee,O[w+2],17,606105819),ee=E(ee,q,re,$,O[w+3],22,-1044525330),$=E($,ee,q,re,O[w+4],7,-176418897),re=E(re,$,ee,q,O[w+5],12,1200080426),q=E(q,re,$,ee,O[w+6],17,-1473231341),ee=E(ee,q,re,$,O[w+7],22,-45705983),$=E($,ee,q,re,O[w+8],7,1770035416),re=E(re,$,ee,q,O[w+9],12,-1958414417),q=E(q,re,$,ee,O[w+10],17,-42063),ee=E(ee,q,re,$,O[w+11],22,-1990404162),$=E($,ee,q,re,O[w+12],7,1804603682),re=E(re,$,ee,q,O[w+13],12,-40341101),q=E(q,re,$,ee,O[w+14],17,-1502002290),ee=E(ee,q,re,$,O[w+15],22,1236535329),$=T($,ee,q,re,O[w+1],5,-165796510),re=T(re,$,ee,q,O[w+6],9,-1069501632),q=T(q,re,$,ee,O[w+11],14,643717713),ee=T(ee,q,re,$,O[w+0],20,-373897302),$=T($,ee,q,re,O[w+5],5,-701558691),re=T(re,$,ee,q,O[w+10],9,38016083),q=T(q,re,$,ee,O[w+15],14,-660478335),ee=T(ee,q,re,$,O[w+4],20,-405537848),$=T($,ee,q,re,O[w+9],5,568446438),re=T(re,$,ee,q,O[w+14],9,-1019803690),q=T(q,re,$,ee,O[w+3],14,-187363961),ee=T(ee,q,re,$,O[w+8],20,1163531501),$=T($,ee,q,re,O[w+13],5,-1444681467),re=T(re,$,ee,q,O[w+2],9,-51403784),q=T(q,re,$,ee,O[w+7],14,1735328473),ee=T(ee,q,re,$,O[w+12],20,-1926607734),$=R($,ee,q,re,O[w+5],4,-378558),re=R(re,$,ee,q,O[w+8],11,-2022574463),q=R(q,re,$,ee,O[w+11],16,1839030562),ee=R(ee,q,re,$,O[w+14],23,-35309556),$=R($,ee,q,re,O[w+1],4,-1530992060),re=R(re,$,ee,q,O[w+4],11,1272893353),q=R(q,re,$,ee,O[w+7],16,-155497632),ee=R(ee,q,re,$,O[w+10],23,-1094730640),$=R($,ee,q,re,O[w+13],4,681279174),re=R(re,$,ee,q,O[w+0],11,-358537222),q=R(q,re,$,ee,O[w+3],16,-722521979),ee=R(ee,q,re,$,O[w+6],23,76029189),$=R($,ee,q,re,O[w+9],4,-640364487),re=R(re,$,ee,q,O[w+12],11,-421815835),q=R(q,re,$,ee,O[w+15],16,530742520),ee=R(ee,q,re,$,O[w+2],23,-995338651),$=A($,ee,q,re,O[w+0],6,-198630844),re=A(re,$,ee,q,O[w+7],10,1126891415),q=A(q,re,$,ee,O[w+14],15,-1416354905),ee=A(ee,q,re,$,O[w+5],21,-57434055),$=A($,ee,q,re,O[w+12],6,1700485571),re=A(re,$,ee,q,O[w+3],10,-1894986606),q=A(q,re,$,ee,O[w+10],15,-1051523),ee=A(ee,q,re,$,O[w+1],21,-2054922799),$=A($,ee,q,re,O[w+8],6,1873313359),re=A(re,$,ee,q,O[w+15],10,-30611744),q=A(q,re,$,ee,O[w+6],15,-1560198380),ee=A(ee,q,re,$,O[w+13],21,1309151649),$=A($,ee,q,re,O[w+4],6,-145523070),re=A(re,$,ee,q,O[w+11],10,-1120210379),q=A(q,re,$,ee,O[w+2],15,718787259),ee=A(ee,q,re,$,O[w+9],21,-343485551),$=m($,x),ee=m(ee,V),q=m(q,X),re=m(re,le);return h($)+h(ee)+h(q)+h(re)}(""+t+n)).slice(0,16),o=r.slice(0,12),a=await window.crypto.subtle.importKey("raw",r,"AES-GCM",!0,["encrypt"]);return new Uint8Array(await window.crypto.subtle.encrypt({name:"AES-GCM",iv:o},a,e))},Tw=async(e,t,n)=>await GB(e.buffer,t,n);function vw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}const WB=new Map([["moderation",1],["supervise",2]]);class Yu extends gt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Ht.CONNECTION_STATE_CHANGE,n,t)}get inspectType(){return this._inspectType}set inspectType(t){var n;this._inspectMode=Fo(n=t.map(r=>WB.get(r)||0)).call(n,(r,o)=>r+o),this._inspectType=t}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this.qualityTimer&&(window.clearTimeout(this.qualityTimer),this.qualityTimer=null),this._quality>=1||(this.qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this.qualityRatio},6e4))}constructor(t){super(),g(this,"name","AgoraRTCVideoContentInspect"),g(this,"_connectionState",Ar.CONNECTING),g(this,"_innerConnectionState",void 0),g(this,"sequence",0),g(this,"inspectStartTime",void 0),g(this,"workerManagerConnection",void 0),g(this,"workerConnection",void 0),g(this,"workerMessageLengthLimit",void 0),g(this,"inspectIntervalMinimum",void 0),g(this,"qualityRatio",void 0),g(this,"_connectInfo",void 0),g(this,"_cancelTokenSource",Rr.CancelToken.source()),g(this,"_retryConfig",void 0),g(this,"wmSequence",0),g(this,"inspectInterval",void 0),g(this,"inspectTimer",null),g(this,"ossFilePrefix",void 0),g(this,"extraInfo",void 0),g(this,"_inspectType",void 0),g(this,"_inspectMode",void 0),g(this,"_quality",1),g(this,"qualityTimer",null),g(this,"_inspectId",void 0),g(this,"_needWorkUrlOnly",!1),g(this,"inspectImage",()=>{if(this.connectionState!==Ar.CONNECTED)throw new b(I.OPERATION_ABORTED,"content inspect service connection status is ".concat(this.connectionState));this.inspectTimer&&(window.clearInterval(this.inspectTimer),this.inspectTimer=null),this.inspectTimer=window.setInterval(()=>{this.connectionState===Ar.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._inspectId,"] Inspect State is not connected , "),this.connectionState)},this.inspectInterval<this.inspectIntervalMinimum?this.inspectIntervalMinimum:this.inspectInterval),this.requestToInspectImage()}),this._inspectId=ut(5,"inspect-"),this.workerMessageLengthLimit=k("VIDEO_INSPECT_WORKER_MESSAGE_LENGTH_LIMIT"),this.inspectIntervalMinimum=k("VIDEO_INSPECT_INTERVAL_MINIMUM"),this.qualityRatio=k("VIDEO_INSPECT_QUALITY_RATIO"),this.inspectInterval=t.interval,this.ossFilePrefix=t.ossFilePrefix,this.extraInfo=t.extraInfo,this.inspectType=t.inspectType,this.inspectStartTime=Number(Date.now()),this.workerManagerConnection=new qs("worker-manager-"+this._inspectId,kt),this.on(Ht.STATE_CHANGE,(n,r)=>{this._innerConnectionState=n,v.debug("[".concat(this._inspectId,"] Inspect operation :").concat(Or[n]," ").concat(r||""))}),this.handleWorkerManagerEvents(),this.workerConnection=new qs("worker-"+this._inspectId,kt),this.handleWorkerEvents()}async init(t,n){this.emit(Ht.STATE_CHANGE,Or.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new de((o,a)=>{this.on(Ht.CONNECTION_STATE_CHANGE,(d,u)=>{u===Ar.CONNECTED&&o()}),this.requestAP(t,r,n).then(d=>{this.connectWorkerManager(d)}).catch(d=>{a(d)})})}async requestAP(t,n,r){const o=k("WEBCS_DOMAIN").map(u=>"https://".concat(u,"/api/v1")),a=await function(u,h,m,f){let{appId:E,areaCode:T,cname:R,sid:A,token:O,uid:w}=h;Ya++;const x="image_moderation_api",V={service_name:x,json_body:JSON.stringify({appId:E,areaCode:T,cname:R,command:"allocateEdge",requestId:Ya,seq:Ya,sid:A,token:O,ts:Date.now(),uid:w+""})};let X,le,$=u[0];return Ni(async()=>{X=Date.now();const ee=await ci($,{data:V,cancelToken:m,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if(le=Date.now()-X,ee.code!==0){const Se=new b(I.UNEXPECTED_RESPONSE,"image inspect ap error, code"+ee.code,{retry:!0,responseTime:le});throw v.error(Se.toString()),Se}const q=JSON.parse(ee.json_body);if(q.code!==200){const Se=new b(I.UNEXPECTED_RESPONSE,"image inspect ap error, code: ".concat(q.code,", reason: ").concat(q.reason),{code:q.code,responseTime:le});throw v.error(Se.toString()),Se}if(!q.servers||!Array.isArray(q.servers)||q.servers.length===0){const Se=new b(I.UNEXPECTED_RESPONSE,"image inspect ap empty server",{code:q.code,responseTime:le});throw v.error(Se.toString()),Se}const re=k("VIDEO_INSPECT_WORKER_MANAGER_HOST"),ze=k("VIDEO_INSPECT_WORKER_MANAGER_PORT");return{addressList:q.servers.map(Se=>{let{address:ct,wss:tt}=Se;if(ct&&tt)return"wss://".concat(ct.replace(/\./g,"-"),".").concat(re,":").concat(ze||tt)}).filter(Se=>!!Se),workerToken:q.workerToken,vid:q.vid,responseTime:le}},(ee,q)=>(he.apworkerEvent(A,{success:!0,sc:200,serviceName:x,responseDetail:JSON.stringify(ee.addressList),firstSuccess:q===0,responseTime:le,serverIp:u[q%u.length]}),!1),(ee,q)=>(he.apworkerEvent(A,{success:!1,sc:ee.data&&ee.data.code||200,serviceName:x,responseTime:le,serverIp:u[q%u.length]}),!!(ee.code!==I.OPERATION_ABORTED&&ee.code!==I.UNEXPECTED_RESPONSE||ee.data&&ee.data.retry)&&($=u[(q+1)%u.length],!0)),f)}(o,t,n,r);this.emit(Ht.STATE_CHANGE,Or.AP_CONNECTED);const{addressList:d}=a;return this.wmSequence++,d}async connectWorkerManager(t){let n=arguments.length>1&&arguments[1]!==void 0&&arguments[1];this._needWorkUrlOnly=n,this.emit(Ht.STATE_CHANGE,Or.CONNECT_WORKER_MANAGER),await this.workerManagerConnection.init(t,1e4)}async connectWorker(t){await this.workerConnection.init([t])}handleWorkerManagerEvents(){this.workerManagerConnection.on(Ae.CONNECTED,async()=>{this.emit(Ht.STATE_CHANGE,Or.WORKER_MANAGER_CONNECTED,this.workerManagerConnection.url),this.workerManagerConnection.sendMessage({appId:this._connectInfo.appId,cname:this._connectInfo.cname,uid:this._connectInfo.uid+"",sdkVersion:"4.18.1",sid:this._connectInfo.sid,seq:this.wmSequence,ts:Number(Date.now()),requestId:Math.floor(1e12*Math.random()),allocate:!0,clientRequest:{command:"join"}},!0)}),this.workerManagerConnection.on(Ae.CLOSED,()=>{this._innerConnectionState<Or.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is closed before connecting worker"))}),this.workerManagerConnection.on(Ae.FAILED,()=>{this._innerConnectionState<Or.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Connecting inspect worker manager is failed before connecting worker"))}),this.workerManagerConnection.on(Ae.RECONNECTING,()=>{this._innerConnectionState<Or.GET_WORKER_MANAGER_RESPONSE&&v.debug("[".concat(this._inspectId,"] Inspect worker manager is reconnecting before connecting worker"))}),this.workerManagerConnection.on(Ae.ON_MESSAGE,async t=>{this.emit(Ht.STATE_CHANGE,Or.GET_WORKER_MANAGER_RESPONSE);const n=this.workerManagerConnection.url;this.workerManagerConnection.close();const r=JSON.parse(t.data);if(r.code!==200)throw v.error("[".concat(this._inspectId,"] Unexpected code ").concat(r.code," from worker manager")),new b(I.UNEXPECTED_RESPONSE,"response code of worker is unexpected",r);if(!(r.serverResponse&&r.serverResponse.portWss&&n))throw v.error("[".concat(this._inspectId,"] Unexpected content from worker manager : ").concat(JSON.stringify(r))),new b(I.UNEXPECTED_RESPONSE,"response content of worker is unexpected",r);{const o=k("VIDEO_INSPECT_WORKER_PORT")||r.serverResponse.portWss,a=n.replace(/:\d+\/?$/,":".concat(o));this.emit(Ht.STATE_CHANGE,Or.CONNECT_WORKER,a),this._needWorkUrlOnly?this.emit(Ht.REQUEST_NEW_WORKER_URL,a):await this.connectWorker(a)}}),this.workerManagerConnection.on(Ae.WILL_RECONNECT,(t,n)=>{n(t)}),this.workerManagerConnection.on(Ae.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}handleWorkerEvents(){this.workerConnection.on(Ae.CONNECTED,async()=>{this.emit(Ht.STATE_CHANGE,Or.WORKER_CONNECTED,this.workerConnection.url),this.connectionState=Ar.CONNECTED}),this.workerConnection.on(Ae.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const r=MB(new Uint8Array(t.data));if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")&&v.debug("[".concat(this._inspectId,"] Response message for worker of inspect content "),JSON.stringify(r)),r.code===200){if(Array.isArray(this.inspectType)&&this.inspectType.length===1&&this.inspectType[0]==="supervise")return void this.emit(Ht.INSPECT_RESULT,void 0,void 0);if(r.data&&r.data.scorePorn&&r.data.scoreSexy&&r.data.scoreNeutral){var n;const o={porn:r.data.scorePorn,sexy:r.data.scoreSexy,neutral:r.data.scoreNeutral},a=Fo(n=Object.keys(o)).call(n,(u,h)=>o[u]>o[h]?u:h,"porn"),d=Object.keys(o).find(u=>u===a);this.emit(Ht.INSPECT_RESULT,d)}else this.emit(Ht.INSPECT_RESULT,void 0,new b(I.UNEXPECTED_RESPONSE,r.code+"","There is an unexpected data on message"))}else this.emit(Ht.INSPECT_RESULT,void 0,new b(I.UNEXPECTED_RESPONSE,r.code+"",r.msg))}else v.error("[".concat(this._inspectId,"] Unexpected message type from worker")),this.emit(Ht.INSPECT_RESULT,void 0,new b(I.UNEXPECTED_RESPONSE,"invalid worker message type"))}),this.workerConnection.on(Ae.CLOSED,()=>{this.connectionState=Ar.CLOSED}),this.workerConnection.on(Ae.FAILED,()=>{this.connectionState=Ar.CLOSED}),this.workerConnection.on(Ae.RECONNECTING,()=>{this.connectionState=this.connectionState===Ar.CONNECTED?Ar.RECONNECTING:Ar.CONNECTING}),this.workerConnection.on(Ae.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this.workerConnection.on(Ae.REQUEST_NEW_URLS,(t,n)=>{this.workerManagerConnection.close(),this.once(Ht.REQUEST_NEW_WORKER_URL,r=>{t([r])}),this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(r=>{this.connectWorkerManager(r,!0)}).catch(r=>{n(r)})})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){this.sequence++;const t=li(this,Ht.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void this.emit(Ht.INSPECT_RESULT,void 0,new b(I.INVALID_OPERATION,"Only the track being played can be inspected"));const r=await this.generateRequestData(t,n);this.workerConnection.sendMessage(r,!0,!0)}else this.emit(Ht.INSPECT_RESULT,void 0,new b(I.INVALID_OPERATION,"Only the track being published can be inspected"))}async generateRequestData(t,n){let{appId:r,cname:o,cid:a,vid:d,sid:u,uid:h}=n;const m=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await Tw(f,r,o),T=this.sequence+"-"+a+"-"+h+"-"+m+"-"+ut(12,""),R={appId:r,cid:a,cname:o,deviceId:"",elapse:Yu.intToLong(Number(m-this.inspectStartTime)),fileSize:E.byteLength,jpgEncryption:2,height:f.height,width:f.width,jpg:E,networkType:6,osType:7,requestId:T,sdkVersion:"4.18.1",sequence:this.sequence,sid:u,timestamp:Yu.intToLong(m),uid:h,vid:d,service:this._inspectMode,callbackData:this.extraInfo,ossFilePrefix:this.ossFilePrefix};this.extraInfo===void 0&&delete R.callbackData,this.ossFilePrefix===void 0&&delete R.ossFilePrefix;const A=kB(R);if(A.byteLength<this.workerMessageLengthLimit){if(k("SHOW_VIDEO_INSPECT_WORKER_MESSAGE")){const O=function(w){for(var x=1;x<arguments.length;x++){var V=arguments[x]!=null?arguments[x]:{};x%2?vw(Object(V),!0).forEach(function(X){g(w,X,V[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(V)):vw(Object(V)).forEach(function(X){Object.defineProperty(w,X,Object.getOwnPropertyDescriptor(V,X))})}return w}({},R);delete O.jpg,v.debug("[".concat(this._inspectId,"] Request message for worker of inspect content "),JSON.stringify(O))}return A}{const O=this.quality*this.qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:r,cname:o,cid:a,vid:d,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Rr.CancelToken.source(),this.workerManagerConnection&&this.workerManagerConnection.close(),this.workerConnection&&this.workerConnection.close(),this.inspectTimer&&window.clearInterval(this.inspectTimer),this.inspectTimer=null,this.connectionState=Ar.CLOSED,this.emit(Ht.STATE_CHANGE,Or.CLOSED)}}function HB(e){let t=function(){const n=YB.pop();return n?(n.offset=n.limit=0,n):{bytes:new Uint8Array(64),offset:0,limit:0}}();return function(n,r){let o=n.appId;o!==void 0&&(Dt(r,10),Zs(r,o));let a=n.cid;a!==void 0&&(Dt(r,16),Dt(r,a));let d=n.cname;d!==void 0&&(Dt(r,26),Zs(r,d));let u=n.deviceId;u!==void 0&&(Dt(r,34),Zs(r,u));let h=n.elapse;h!==void 0&&(Dt(r,40),is(r,h));let m=n.fileSize;m!==void 0&&(Dt(r,48),is(r,tc(m)));let f=n.height;f!==void 0&&(Dt(r,56),is(r,tc(f)));let E=n.jpg;E!==void 0&&(Dt(r,66),Dt(r,E.length),Rw(r,E));let T=n.networkType;T!==void 0&&(Dt(r,72),is(r,tc(T)));let R=n.osType;R!==void 0&&(Dt(r,80),is(r,tc(R)));let A=n.requestId;A!==void 0&&(Dt(r,90),Zs(r,A));let O=n.sdkVersion;O!==void 0&&(Dt(r,98),Zs(r,O));let w=n.sequence;w!==void 0&&(Dt(r,104),is(r,tc(w)));let x=n.sid;x!==void 0&&(Dt(r,114),Zs(r,x));let V=n.timestamp;V!==void 0&&(Dt(r,120),is(r,V));let X=n.uid;X!==void 0&&(Dt(r,128),Dt(r,X));let le=n.vid;le!==void 0&&(Dt(r,136),Dt(r,le));let $=n.width;$!==void 0&&(Dt(r,144),is(r,tc($)));let ee=n.service;ee!==void 0&&(Dt(r,152),Dt(r,ee));let q=n.callbackData;q!==void 0&&(Dt(r,162),Dt(r,q.length),Rw(r,q));let re=n.ticket;re!==void 0&&(Dt(r,170),Zs(r,re))}(e,t),function(n){let r=n.bytes,o=n.limit;return r.length===o?r:r.subarray(0,o)}(t)}function KB(e){return function(n){let r={};e:for(;!qB(n);){let o=Ed(n);switch(o>>>3){case 0:break e;case 1:r.code=Ed(n);break;case 2:r.msg=Cw(n,Ed(n));break;case 3:r.requestId=Cw(n,Ed(n));break;case 4:r.timestamp=JB(n,!1);break;default:zB(n,7&o)}}return r}({bytes:t=e,offset:0,limit:t.length});var t}function zB(e,t){switch(t){case 0:for(;128&fi(e););break;case 2:XE(e,Ed(e));break;case 5:XE(e,4);break;case 1:XE(e,8);break;default:throw new Error("Unimplemented type: "+t)}}function tc(e){return{low:e|=0,high:e>>31,unsigned:e>=0}}let YB=[];function XE(e,t){if(e.offset+t>e.limit)throw new Error("Skip past limit");e.offset+=t}function qB(e){return e.offset>=e.limit}function qu(e,t){let n=e.bytes,r=e.offset,o=e.limit,a=r+t;if(a>n.length){let d=new Uint8Array(2*a);d.set(n),e.bytes=d}return e.offset=a,a>o&&(e.limit=a),r}function yw(e,t){let n=e.offset;if(n+t>e.limit)throw new Error("Read past limit");return e.offset+=t,n}function Rw(e,t){let n=qu(e,t.length);e.bytes.set(t,n)}function Cw(e,t){let n=yw(e,t),r=String.fromCharCode,o=e.bytes,a="�",d="";for(let u=0;u<t;u++){let h,m,f,E,T=o[u+n];128&T?(224&T)==192?u+1>=t?d+=a:(h=o[u+n+1],(192&h)!=128?d+=a:(E=(31&T)<<6|63&h,E<128?d+=a:(d+=r(E),u++))):(240&T)==224?u+2>=t?d+=a:(h=o[u+n+1],m=o[u+n+2],(49344&(h|m<<8))!=32896?d+=a:(E=(15&T)<<12|(63&h)<<6|63&m,E<2048||E>=55296&&E<=57343?d+=a:(d+=r(E),u+=2))):(248&T)==240?u+3>=t?d+=a:(h=o[u+n+1],m=o[u+n+2],f=o[u+n+3],(12632256&(h|m<<8|f<<16))!=8421504?d+=a:(E=(7&T)<<18|(63&h)<<12|(63&m)<<6|63&f,E<65536||E>1114111?d+=a:(E-=65536,d+=r(55296+(E>>10),56320+(1023&E)),u+=3))):d+=a:d+=r(T)}return d}function Zs(e,t){let n=t.length,r=0;for(let d=0;d<n;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<n&&(u=(u<<10)+t.charCodeAt(++d)-56613888),r+=u<128?1:u<2048?2:u<65536?3:4}Dt(e,r);let o=qu(e,r),a=e.bytes;for(let d=0;d<n;d++){let u=t.charCodeAt(d);u>=55296&&u<=56319&&d+1<n&&(u=(u<<10)+t.charCodeAt(++d)-56613888),u<128?a[o++]=u:(u<2048?a[o++]=u>>6&31|192:(u<65536?a[o++]=u>>12&15|224:(a[o++]=u>>18&7|240,a[o++]=u>>12&63|128),a[o++]=u>>6&63|128),a[o++]=63&u|128)}}function fi(e){return e.bytes[yw(e,1)]}function Iw(e,t){let n=qu(e,1);e.bytes[n]=t}function Ed(e){let t,n=0,r=0;do t=fi(e),n<32&&(r|=(127&t)<<n),n+=7;while(128&t);return r}function Dt(e,t){for(t>>>=0;t>=128;)Iw(e,127&t|128),t>>>=7;Iw(e,t)}function JB(e,t){let n,r=0,o=0,a=0;return n=fi(e),r=127&n,128&n&&(n=fi(e),r|=(127&n)<<7,128&n&&(n=fi(e),r|=(127&n)<<14,128&n&&(n=fi(e),r|=(127&n)<<21,128&n&&(n=fi(e),o=127&n,128&n&&(n=fi(e),o|=(127&n)<<7,128&n&&(n=fi(e),o|=(127&n)<<14,128&n&&(n=fi(e),o|=(127&n)<<21,128&n&&(n=fi(e),a=127&n,128&n&&(n=fi(e),a|=(127&n)<<7))))))))),{low:r|o<<28,high:o>>>4|a<<24,unsigned:t}}function is(e,t){let n=t.low>>>0,r=(t.low>>>28|t.high<<4)>>>0,o=t.high>>>24,a=o===0?r===0?n<16384?n<128?1:2:n<1<<21?3:4:r<16384?r<128?5:6:r<1<<21?7:8:o<128?9:10,d=qu(e,a),u=e.bytes;switch(a){case 10:u[d+9]=o>>>7&1;case 9:u[d+8]=a!==9?128|o:127&o;case 8:u[d+7]=a!==8?r>>>21|128:r>>>21&127;case 7:u[d+6]=a!==7?r>>>14|128:r>>>14&127;case 6:u[d+5]=a!==6?r>>>7|128:r>>>7&127;case 5:u[d+4]=a!==5?128|r:127&r;case 4:u[d+3]=a!==4?n>>>21|128:n>>>21&127;case 3:u[d+2]=a!==3?n>>>14|128:n>>>14&127;case 2:u[d+1]=a!==2?n>>>7|128:n>>>7&127;case 1:u[d]=a!==1?128|n:127&n}}const Aw={},Ow={},ww=4294967296,Nw=18446744073709552e3,bw=Nw/2,QE=Pw(0,!0),Dw=Pw(0),XB=nc(0,-2147483648,!1),QB=nc(-1,2147483647,!1),$B=nc(-1,-1,!0);function Pw(e,t){let n,r,o;return t?(o=0<=(e>>>=0)&&e<256)&&(r=Ow[e],r)?r:(n=nc(e,0,!0),o&&(Ow[e]=n),n):(o=-128<=(e|=0)&&e<128)&&(r=Aw[e],r)?r:(n=nc(e,e<0?-1:0,!1),o&&(Aw[e]=n),n)}function nc(e,t,n){return{low:0|e,high:0|t,unsigned:!!n}}function ZB(e,t){if(isNaN(e))return t?QE:Dw;if(t){if(e<0)return QE;if(e>=Nw)return $B}else{if(e<=-bw)return XB;if(e+1>=bw)return QB}return e<0?t?QE:Dw:nc(e%ww|0,e/ww|0,t)}function Lw(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}class $E extends gt{get connectionState(){return this._connectionState}set connectionState(t){if(this._connectionState===t)return;const n=this._connectionState;this._connectionState=t,this.emit(Kr.CONNECTION_STATE_CHANGE,t,n)}get quality(){return this._quality}set quality(t){this._quality=t>1?1:t<.1?.1:t,this._qualityTimer&&(window.clearTimeout(this._qualityTimer),this._qualityTimer=null),this._quality>=1||(this._qualityTimer=window.setTimeout(()=>{this.quality=this._quality/this._qualityRatio},6e4))}constructor(t){var n;super(),g(this,"name","AgoraRTCImageModeration"),g(this,"_connectionState",fr.CONNECTING),g(this,"_sequence",0),g(this,"_moderationStartTime",void 0),g(this,"_workerConnection",void 0),g(this,"_workerMessageLengthLimit",void 0),g(this,"_qualityRatio",void 0),g(this,"_connectInfo",void 0),g(this,"_cancelTokenSource",Rr.CancelToken.source()),g(this,"_retryConfig",void 0),g(this,"_moderationInterval",void 0),g(this,"_moderationTimer",null),g(this,"_moderationMode",1),g(this,"_quality",1),g(this,"_qualityTimer",null),g(this,"_ticket",void 0),g(this,"_moderationIntervalMinimum",void 0),g(this,"_uploadFailedNum",0),g(this,"_uploadNum",0),g(this,"_uploadTimer",null),g(this,"_moderationId",void 0),g(this,"inspectImage",()=>{if(this.connectionState!==fr.CONNECTED)throw new b(I.OPERATION_ABORTED,"image moderation service connection status is ".concat(this.connectionState));this._moderationTimer&&(window.clearInterval(this._moderationTimer),this._moderationTimer=null),this._moderationTimer=window.setInterval(()=>{this.connectionState===fr.CONNECTED?this.requestToInspectImage():v.debug("[".concat(this._moderationId,"] Moderation State is not connected , "),this.connectionState)},this._moderationInterval<this._moderationIntervalMinimum?this._moderationIntervalMinimum:this._moderationInterval),this.requestToInspectImage()}),this._moderationId=ut(5,"image-moderation-"),this._workerMessageLengthLimit=k("IMAGE_MODERATION_WORKER_MESSAGE_LENGTH_LIMIT"),this._moderationIntervalMinimum=k("IMAGE_MODERATION_INTERVAL_MINIMUM"),this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,this._qualityRatio=k("IMAGE_MODERATION_QUALITY_RATIO"),this._moderationStartTime=Number(Date.now()),this._workerConnection=new qs("worker-"+this._moderationId,kt),this.on(Kr.STATE_CHANGE,(r,o)=>{v.debug("[".concat(this._moderationId,"] Moderation operation :").concat(Jo[r]," ").concat(o||""))}),this.handleWorkerEvents()}async init(t,n){this.emit(Kr.STATE_CHANGE,Jo.CONNECT_AP),this._connectInfo=t;const r=this._cancelTokenSource.token;return this._retryConfig=n,new de((o,a)=>{this.on(Kr.CONNECTION_STATE_CHANGE,(d,u)=>{d===fr.CONNECTED&&o()}),this.requestAP(t,r,n).then(d=>{this.connectWorker(d)}).catch(d=>{a(d)})})}updateConfig(t){var n;this._moderationInterval=(n=t.interval)!==null&&n!==void 0?n:1e3,v.debug("[".concat(this._moderationId,"] updateConfig: ").concat(JSON.stringify(t))),this.connectionState===fr.CONNECTED&&this.inspectImage()}async requestAP(t,n,r){const o=k("WEBCS_DOMAIN").map(h=>"https://".concat(h,"/api/v1")),a=await function(h,m,f,E){let{appId:T,areaCode:R,cname:A,sid:O,token:w,uid:x}=m;Ya++;const V="moderation_plugin",X={service_name:V,json_body:JSON.stringify({appId:T,areaCode:R,cname:A,command:"allocateEdge",requestId:Ya,seq:Ya,sid:O,appToken:w,ts:Date.now(),uid:x+""})};let le,$,ee=h[0];return Ni(async()=>{le=Date.now();const q=await ci(ee,{data:X,cancelToken:f,headers:{"X-Packet-Service-Type":"0","X-Packet-URI":"61"},params:{action:"wrtc_gateway"}});if($=Date.now()-le,q.code!==0){const Se=new b(I.UNEXPECTED_RESPONSE,"moderation plugin ap error, code"+q.code,{retry:!0,responseTime:$});throw v.error(Se.toString()),Se}const re=JSON.parse(q.json_body);if(re.code!==200){const Se=new b(I.UNEXPECTED_RESPONSE,"moderation plugin ap error, code: ".concat(re.code,", reason: ").concat(re.reason),{code:re.code,responseTime:$});throw v.error(Se.toString()),Se}if(!re.servers||!Array.isArray(re.servers)||re.servers.length===0){const Se=new b(I.UNEXPECTED_RESPONSE,"moderation plugin ap empty server",{code:re.code,responseTime:$});throw v.error(Se.toString()),Se}if(!re.servers.some(Se=>!!Se.wss)){const Se=new b(I.UNEXPECTED_RESPONSE,"moderation plugin ap empty port",{code:re.code,responseTime:$});throw v.error(Se.toString()),Se}const ze=k("IMAGE_MODERATION_WORKER_HOST");return{addressList:re.servers.map(Se=>{let{address:ct,wss:tt}=Se;if(ct&&tt)return"wss://".concat(ct.replace(/\./g,"-"),".").concat(ze,":").concat(tt,"/moderation")}).filter(Se=>!!Se),workerToken:re.workerToken,vid:re.vid,ticket:re.appTicket,responseTime:$}},(q,re)=>(he.apworkerEvent(O,{success:!0,sc:200,serviceName:V,responseDetail:JSON.stringify(q.addressList),firstSuccess:re===0,responseTime:$,serverIp:h[re%h.length]}),!1),(q,re)=>(he.apworkerEvent(O,{success:!1,sc:q.data&&q.data.code||200,serviceName:V,responseTime:$,serverIp:h[re%h.length]}),!!(q.code!==I.OPERATION_ABORTED&&q.code!==I.UNEXPECTED_RESPONSE||q.data&&q.data.retry)&&(ee=h[(re+1)%h.length],!0)),E)}(o,t,n,r);this.emit(Kr.STATE_CHANGE,Jo.AP_CONNECTED);const{addressList:d,ticket:u}=a;return this._ticket=u,d}async connectWorker(t){this.emit(Kr.STATE_CHANGE,Jo.CONNECT_WORKER),await this._workerConnection.init(t,1e4)}handleWorkerEvents(){this._workerConnection.on(Ae.CONNECTED,async()=>{this.emit(Kr.STATE_CHANGE,Jo.WORKER_CONNECTED,this._workerConnection.url),this.connectionState=fr.CONNECTED}),this._workerConnection.on(Ae.CLOSED,()=>{this.connectionState=fr.CLOSED}),this._workerConnection.on(Ae.FAILED,()=>{this.connectionState=fr.CLOSED}),this._workerConnection.on(Ae.RECONNECTING,()=>{this.connectionState=this.connectionState===fr.CONNECTED?fr.RECONNECTING:fr.CONNECTING}),this._workerConnection.on(Ae.ON_MESSAGE,async t=>{if(t.data instanceof ArrayBuffer){const n=KB(new Uint8Array(t.data));k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("[".concat(this._moderationId,"] Response message for worker of image moderation "),JSON.stringify(n)),this._uploadNum++,n.code===void 0||n.code===0||(this._uploadFailedNum++,v.error("[".concat(this._moderationId,"] Error response from worke, code is ").concat(n.code,", msg is ").concat(n.msg)),this._uploadTimer||(this._uploadTimer=window.setTimeout(()=>{he.reportApiInvoke(this._connectInfo.sid||null,{name:Mt.IMAGE_MODERATION_UPLOAD,options:[this._uploadFailedNum,this._uploadNum,n.code],tag:Et.TRACER}).onError(new b(I.IMAGE_MODERATION_UPLOAD_FAILED,n.msg)),this._uploadTimer=null},k("IMAGE_MODERATION_UPLOAD_REPORT_INTERVAL"))))}else v.error("[".concat(this._moderationId,"] Unexpected message type from worker"))}),this._workerConnection.on(Ae.WILL_RECONNECT,(t,n)=>{t==="recover"&&n(t),n("tryNext")}),this._workerConnection.on(Ae.REQUEST_NEW_URLS,(t,n)=>{this.requestAP(this._connectInfo,this._cancelTokenSource.token,this._retryConfig).then(t).catch(n)})}static intToLong(t){return{low:t|=0,high:t>>31,unsigned:t>=0}}async requestToInspectImage(){const t=li(this,Kr.CLIENT_LOCAL_VIDEO_TRACK),n={appId:this._connectInfo.appId,cname:this._connectInfo.cname,cid:this._connectInfo.cid,sid:this._connectInfo.sid,uid:this._connectInfo.uid,vid:this._connectInfo.vid};if(t){if(!t.isPlaying)return void(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being played can be inspected"));this._sequence++;const r=await this.generateRequestData(t,n);this._workerConnection.sendMessage(r,!0,!0)}else k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")&&v.debug("Only the track being published can be inspected")}async generateRequestData(t,n){let{appId:r,cname:o,cid:a,vid:d,sid:u,uid:h}=n;const m=Date.now(),f=await t.getCurrentFrameImage("image/jpeg",this.quality),E=await Tw(f,r,o),T=this._sequence+"-"+a+"-"+h+"-"+m+"-"+ut(12,""),R={appId:r,cid:a,cname:o,deviceId:"",elapse:$E.intToLong(Number(m-this._moderationStartTime)),fileSize:f.buffer.byteLength,height:f.height,width:f.width,jpg:E,networkType:6,osType:7,requestId:T,sdkVersion:"4.18.1",sequence:this._sequence,sid:u,timestamp:ZB(m),uid:h,vid:d,service:this._moderationMode,ticket:this._ticket},A=HB(R);if(A.byteLength<this._workerMessageLengthLimit){if(k("SHOW_IMAGE_MODERATION_WORKER_MESSAGE")){const O=function(w){for(var x=1;x<arguments.length;x++){var V=arguments[x]!=null?arguments[x]:{};x%2?Lw(Object(V),!0).forEach(function(X){g(w,X,V[X])}):Object.getOwnPropertyDescriptors?Object.defineProperties(w,Object.getOwnPropertyDescriptors(V)):Lw(Object(V)).forEach(function(X){Object.defineProperty(w,X,Object.getOwnPropertyDescriptor(V,X))})}return w}({},R);delete O.jpg,v.debug("[".concat(this._moderationId,"] Request message for worker of image moderation service: "),JSON.stringify(O))}return A}{const O=this.quality*this._qualityRatio;return this.quality=O,await this.generateRequestData(t,{appId:r,cname:o,cid:a,vid:d,sid:u,uid:h})}}close(){this._cancelTokenSource.cancel(),this._cancelTokenSource=Rr.CancelToken.source(),this._workerConnection&&this._workerConnection.close(),this._moderationTimer&&window.clearInterval(this._moderationTimer),this._moderationTimer=null,this._uploadTimer&&window.clearTimeout(this._uploadTimer),this._uploadTimer=null,this.connectionState=fr.CLOSED,this.emit(Kr.STATE_CHANGE,Jo.CLOSED)}}var kw,Mw,Uw,xw,Vw,Fw,jw,Bw,Gw,Ww,Hw,Kw,zw,Yw,qw,Jw,Xw,Qw,$w,Zw,e0,t0,n0,r0,i0,o0,s0,a0,c0,d0,l0,u0,h0,p0,f0,m0,E0,_0,g0,oe;function S0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function _d(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?S0(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):S0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}let e3=(kw=Te(),Mw=Te({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),t.map(n=>n?Object(n).toString():"null"))}),Uw=Te({argsMap:(e,t)=>(t||(t=[]),Array.isArray(t)||(t=[t]),t.map(n=>n.getTrackId()))}),xw=Te({argsMap:(e,t,n)=>[t.uid,n]}),Vw=Te({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return[r==null?void 0:r.uid,o]})}),Fw=Te({argsMap:(e,t,n)=>[t.uid,n]}),jw=Te({argsMap:(e,t)=>t.map(n=>{let{user:r,mediaType:o}=n;return{uid:r==null?void 0:r.uid,mediaType:o}})}),Bw=Te(),Gw=Te(),Ww=Te(),Hw=Te(),Kw=Te(),zw=Te(),Yw=Te(),qw=Te(),Jw=Te(),Xw=Te(),Qw=Te(),$w=Te(),Zw=Te(),e0=Te(),t0=Te({argsMap:(e,t)=>[t]}),n0=Te(),r0=Te(),i0=Te(),o0=Te(),s0=Te(),a0=Te(),c0=Te(),d0=Te(),l0=Te(),u0=Te(),h0=Te({argsMap:(e,t)=>(Array.isArray(t)||(t=[t]),[JSON.stringify(t)])}),p0=Te(),f0=Te(),m0=Te(),E0=Te(),_0=Te({reportResult:!0}),g0=Te(),Y((oe=class extends gt{get connectionState(){return this._gateway.state}get remoteUsers(){return this._users}get localTracks(){return this._p2pChannel.getAllTracks(!0)}get uid(){return this._uid}get channelName(){return this._channelName}get mode(){return this._config.mode}get role(){var e;return((e=this._config)===null||e===void 0?void 0:e.role)||"audience"}get codec(){return this._config.codec}get audioCodec(){return this._config.audioCodec||"opus"}get isStringUID(){return!!this._joinInfo&&!!this._joinInfo.stringUid}get __className__(){return"Client"}constructor(e){let t;if(super(),g(this,"store",void 0),g(this,"_uid",void 0),g(this,"_channelName",void 0),g(this,"_uintUid",void 0),g(this,"_users",[]),g(this,"_config",void 0),g(this,"_clientId",void 0),g(this,"_appId",void 0),g(this,"_sessionId",null),g(this,"_key",void 0),g(this,"_joinInfo",void 0),g(this,"_gateway",void 0),g(this,"_statsCollector",void 0),g(this,"_configDistribute",void 0),g(this,"_leaveMutex",new Vn("client-leave")),g(this,"_publishMutex",new Vn("client-publish")),g(this,"_renewTokenMutex",new Vn("client-renewtoken")),g(this,"_subscribeMutex",new Vn("client-subscribe")),g(this,"_encryptionMode","none"),g(this,"_encryptionSecret",null),g(this,"_encryptionSalt",null),g(this,"_proxyServer",void 0),g(this,"_turnServer",{servers:[],mode:"auto"}),g(this,"_cloudProxyServerMode","disabled"),g(this,"_isDualStreamEnabled",!1),g(this,"_defaultStreamFallbackType",void 0),g(this,"_lowStreamParameter",void 0),g(this,"_streamFallbackTypeCacheMap",new Map),g(this,"_remoteStreamTypeCacheMap",new Map),g(this,"_axiosCancelSource",Rr.CancelToken.source()),g(this,"_audioVolumeIndicationInterval",void 0),g(this,"_networkQualityInterval",void 0),g(this,"_userOfflineTimeout",void 0),g(this,"_streamRemovedTimeout",void 0),g(this,"_injectStreamingClient",void 0),g(this,"_liveTranscodeStreamingClient",void 0),g(this,"_liveRawStreamingClient",void 0),g(this,"_channelMediaRelayClient",void 0),g(this,"_networkQualitySensitivity","normal"),g(this,"_p2pChannel",void 0),g(this,"_useLocalAccessPoint",!1),g(this,"_setLocalAPVersion",void 0),g(this,"_joinAndNotLeaveYet",!1),g(this,"_numberOfJoinCount",0),g(this,"_remoteDefaultVideoStreamType",void 0),g(this,"_inspect",void 0),g(this,"_moderation",void 0),g(this,"_license",void 0),g(this,"_handleLocalTrackEnable",(n,r,o)=>{this.publish(n,!1).then(r).catch(o)}),g(this,"_handleLocalTrackDisable",(n,r,o)=>{this.unpublish(n).then(r).catch(o)}),g(this,"_handleUserOnline",n=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(n.uid,this.channelName))return void v.debug("[".concat(n.uid,"] will be ignored in local"));this.isStringUID&&typeof n.uid!="string"&&v.error("[".concat(this._clientId,"] StringUID is Mixed with UintUID"));const r=this._users.find(o=>o.uid===n.uid);if(r)r._trust_in_room_=!0;else{const o=new EE(n.uid,n.uint_id||n.uid);this._users.push(o),v.debug("[".concat(this._clientId,"] user online"),n.uid),this.safeEmit(Me.USER_JOINED,o)}}),g(this,"_handleUserOffline",n=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(n.uid,this.channelName))return;const r=this._users.find(o=>o.uid===n.uid);r&&(this._handleRemoveStream(n),sE(this._users,r),this._remoteStreamTypeCacheMap.delete(r.uid),this._streamFallbackTypeCacheMap.delete(r.uid),v.debug("[".concat(this._clientId,"] user offline"),n.uid,"reason:",n.reason),this.safeEmit(Me.USER_LEAVED,r,n.reason))}),g(this,"_handleAddAudioOrVideoStream",(n,r,o,a,d,u,h)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(r,this.channelName))return;const m=this._users.find(E=>E.uid===r);if(!m)return void v.error("[".concat(this._clientId,"] can not find target user!(on_add_stream)"));v.debug("[".concat(this._clientId,"] stream added with uid ").concat(r,", type ").concat(n)),this.store.subscribe(m.uid,n,void 0,void 0,void 0,Date.now());const f=n==="audio"?m.hasAudio:m.hasVideo;m._uintid||(m._uintid=d||r),n==="audio"?m._trust_audio_stream_added_state_=!0:m._trust_video_stream_added_state_=!0,n==="audio"?(m._audio_added_=!0,o!==void 0&&(m._audioSSRC=o),a!==void 0&&(m._cname=a),u&&(m._audioOrtc=u)):(m._video_added_=!0,o!==void 0&&(m._videoSSRC=o),a!==void 0&&(m._cname=a),h!==void 0&&(m._rtxSsrcId=h),u&&(m._videoOrtc=u)),(n==="audio"?m.hasAudio:m.hasVideo)&&!f&&(v.info("[".concat(this._clientId,"] remote user ").concat(m.uid," published ").concat(n)),this.safeEmit(Me.USER_PUBLISHED,m,n)),n==="video"?he.onGatewayStream(this._sessionId,cn.ON_ADD_VIDEO_STREAM,St.ON_ADD_VIDEO_STREAM,{peer:d||r}):he.onGatewayStream(this._sessionId,cn.ON_ADD_AUDIO_STREAM,St.ON_ADD_AUDIO_STREAM,{peer:d||r}),this._p2pChannel.remoteMediaSsrcChanged(m,n,o).then(E=>{if(E)return v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(m.uid," after rejoin because SSRC id changed.")),this._p2pChannel.unsubscribe(m,n,!0).then(()=>this._subscribe(m,n,!0).catch(T=>{v.error("[".concat(this._clientId,"] resubscribe error"),T.toString())}))}),this._p2pChannel.hasPendingRemoteMedia(m,n)&&(v.debug("[".concat(this._clientId,"] resubscribe ").concat(n," for user ").concat(m.uid," after reconnect.")),this._subscribe(m,n,!0).catch(E=>{v.error("[".concat(this._clientId,"] resubscribe error"),E.toString())}))}),g(this,"_handleRemoveStream",n=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(n.uid,this.channelName))return;const r=this._users.find(a=>a.uid===n.uid);if(!r)return void v.warning("[".concat(this._clientId,"] can not find target user!(on_remove_stream)"));v.debug("[".concat(this._clientId,"] stream removed with uid ").concat(n.uid));let o=()=>{};r.hasAudio&&r.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"audio"),v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"video")}:r.hasVideo?o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished video track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"video")}:r.hasAudio&&(o=()=>{v.info("[".concat(this._clientId,"] remote user ").concat(r.uid," unpublished audio track")),this.safeEmit(Me.USER_UNPUBLISHED,r,"audio")}),r._trust_audio_stream_added_state_=!0,r._trust_video_stream_added_state_=!0,r._audio_added_=!1,r._video_added_=!1,this._p2pChannel.unsubscribe(r).then(a=>{if(a)return this._gateway.unsubscribe(a,r.uid)}),r._audioSSRC=void 0,r._videoSSRC=void 0,r._audioOrtc=void 0,r._videoOrtc=void 0,r._rtxSsrcId=void 0,he.onGatewayStream(this._sessionId,cn.ON_REMOVE_STREAM,St.ON_REMOVE_STREAM,{peer:n.uint_id||n.uid}),o()}),g(this,"_handleSetStreamLocalEnable",(n,r,o)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(r,this.channelName))return;const a=this._users.find(h=>h.uid===r);if(!a)return void v.error("[".concat(this._clientId,"] can not find target user!(disable_local)"));v.debug("[".concat(this._clientId,"] local ").concat(n," ").concat(o?"enabled":"disabled"," with uid ").concat(r));const d=n==="audio"?a.hasAudio:a.hasVideo;if(n==="audio"){a._trust_audio_enabled_state_=!0;const h=a._audio_enabled_;if(a._audio_enabled_=o,a._audio_enabled_===h)return;{const m=a._audio_enabled_?"enable-local-audio":"disable-local-audio";v.debug("[".concat(this._clientId,"] user-info-updated, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(Me.USER_INFO_UPDATED,r,m)}}else{a._trust_video_enabled_state_=!0;const h=a._video_enabled_;if(a._video_enabled_=o,a._video_enabled_===h)return;{const m=a._video_enabled_?"enable-local-video":"disable-local-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(r,", msg: ").concat(m)),this.safeEmit(Me.USER_INFO_UPDATED,r,m)}}const u=n==="audio"?a.hasAudio:a.hasVideo;return d!==u?!d&&u?(v.info("[".concat(this._clientId,"] remote user ").concat(r," published ").concat(n)),void this.safeEmit(Me.USER_PUBLISHED,a,n)):(n==="video"&&a._videoTrack&&a._videoTrack._destroy(),n==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,n),v.info("[".concat(this._clientId,"] remote user ").concat(r," unpublished ").concat(n)),void this.safeEmit(Me.USER_UNPUBLISHED,a,n)):void 0}),g(this,"_handleMuteStream",(n,r,o)=>{if(k("BLOCK_LOCAL_CLIENT")&&Gs(n,this.channelName))return;v.debug("[".concat(this._clientId,"] receive mute message"),n,r,o);const a=this._users.find(h=>h.uid===n);if(!a)return void v.warning("[".concat(this._clientId,"] can not find remote user, ignore mute event, uid: ").concat(n));const d=r==="audio"?a.hasAudio:a.hasVideo;if(r==="audio"){a._trust_audio_mute_state_=!0;const h=a._audio_muted_;if(a._audio_muted_=o,a._audio_muted_===h)return;{const m=a._audio_muted_?"mute-audio":"unmute-audio";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(m)),this.safeEmit(Me.USER_INFO_UPDATED,n,m)}}else{a._trust_video_mute_state_=!0;const h=a._video_muted_;if(a._video_muted_=o,a._video_muted_===h)return;{const m=a._video_muted_?"mute-video":"unmute-video";v.debug("[".concat(this._clientId,"] user-info-update, uid: ").concat(n,", msg: ").concat(m)),this.safeEmit(Me.USER_INFO_UPDATED,n,m)}}const u=r==="audio"?a.hasAudio:a.hasVideo;if(d!==u){if(!d&&u)return(r==="audio"?a._audioSSRC:a._videoSSRC)?(v.info("[".concat(this._clientId,"] remote user ").concat(n," published ").concat(r)),void this.safeEmit(Me.USER_PUBLISHED,a,r)):void v.warning("[".concat(this._clientId,"] remote user ").concat(n," receive ").concat(r," unmute message  before add stream message, ").concat(r," SSRC doesn't exist yet."));r==="video"&&a._videoTrack&&a._videoTrack._destroy(),r==="audio"&&a._audioTrack,this._p2pChannel.muteRemote(a,r),v.info("[".concat(this._clientId,"] remote user ").concat(n," unpublished ").concat(r)),this.safeEmit(Me.USER_UNPUBLISHED,a,r)}}),g(this,"_handleP2PLost",async n=>{v.debug("[".concat(this._clientId,"] receive p2p lost"),n),parseInt(n.p2pid,10)===this.store.p2pId?await this._p2pChannel.requestReconnect():v.warning("[".concat(this._clientId,"] P2PLost stream not found"),n)}),g(this,"_handleTokenWillExpire",()=>{v.debug("[".concat(this._clientId,"] received message onTokenPrivilegeWillExpire")),this.safeEmit(Me.ON_TOKEN_PRIVILEGE_WILL_EXPIRE)}),g(this,"_handleBeforeUnload",n=>{n.type==="beforeunload"&&n.returnValue!==void 0&&n.returnValue!==""||(this.leave(),v.info("[".concat(this._clientId,"] auto leave onbeforeunload or pagehide")))}),g(this,"_handleUpdateNetworkQuality",()=>{if(this._networkQualitySensitivity==="normal")return;if(navigator&&navigator.onLine!==void 0&&!navigator.onLine)return void this.safeEmit(Me.NETWORK_QUALITY,{downlinkNetworkQuality:6,uplinkNetworkQuality:6});const n={downlinkNetworkQuality:0,uplinkNetworkQuality:0};n.uplinkNetworkQuality=this._p2pChannel.getUplinkNetworkQuality(),n.downlinkNetworkQuality=this._p2pChannel.getDownlinkNetworkQuality(),this.safeEmit(Me.NETWORK_QUALITY,n)}),this._config=e,this._clientId=ut(5,"client-"),this.store=new PB(e.codec,e.audioCodec,e.mode,this._clientId),this.store.clientCreated(),e.proxyServer&&this.setProxyServer(e.proxyServer,!0),e.turnServer&&this.setTurnServer(e.turnServer,!0),v.info("[".concat(this._clientId,"] Initializing AgoraRTC client v").concat(Hr," build: ").concat(vm,", mode: ").concat(this.mode,", codec: ").concat(this.codec)),e.clientRoleOptions)try{xR(e.clientRoleOptions),t=Object.assign({},e.clientRoleOptions)}catch(n){v.warning("[".concat(this._clientId,"] ").concat(n.toString()))}this._statsCollector=new Ha(this.store),this._statsCollector.onStatsException=(n,r,o)=>{v.debug("[".concat(this._clientId,"] receive exception msg, code: ").concat(n,", msg: ").concat(r,", uid: ").concat(o)),this.safeEmit(Me.EXCEPTION,{code:n,msg:r,uid:o})},this._statsCollector.onUploadPublishDuration=(n,r,o,a)=>{const d=this._users.find(u=>u.uid===n);d&&he.peerPublishStatus(this._sessionId,{subscribeElapse:a,audioPublishDuration:r,videoPublishDuration:o,peer:d._uintid})},this.store.useDataChannel=bt().supportDataChannel&&k("SIGNAL_CHANNEL"),this._gateway=new Ej(this.store,{clientId:this._clientId,mode:this.mode,codec:this.codec,websocketRetryConfig:e.websocketRetryConfig||kt,httpRetryConfig:e.httpRetryConfig||kt,forceWaitGatewayResponse:e.forceWaitGatewayResponse===void 0||e.forceWaitGatewayResponse,statsCollector:this._statsCollector,role:e.role,clientRoleOptions:t}),this._configDistribute=new Ij,this._p2pChannel=new DB(this.store,this._statsCollector),this._handleP2PChannelEvents(),this._handleGatewayEvents(),this._handleGatewaySignalEvents()}async join(e,t,n,r,o){const a=++this._numberOfJoinCount;this.store.joinStart(),r&&(this.store.uid=r);const d=LB(),u=hw()?window.isSecureContext:"Browser Not Support";if(!hw()&&!d||!window.isSecureContext){const R="The website must be running in a secure context (About secure context: https://developer.mozilla.org/en-US/docs/Web/Security/Secure_Contexts ), otherwise the media collection will be restricted by the browser";v.warning(R)}const h=oE();this.connectionState==="DISCONNECTED"&&(this.store.avoidJoinStart=Math.round(Date.now()),v.debug("[".concat(this._clientId,"] set avoidJoinStart to ").concat(this.store.avoidJoinStart)));const m=he.reportApiInvoke(h,{name:Mt.JOIN,options:[e,t,n,r],states:{isHttps:d,isSecureContext:u},tag:Et.TRACER});he.setAppId(e);try{if(!n&&n!==null)throw new b(I.INVALID_PARAMS,"Invalid token: ".concat(n,". If you don not use token, set it to null"));n&&_n(n,"token",1,2047),_n(e,"appid",1,2047),Dm(t),r&&Pm(r),o&&_n(o,"optionalInfo",1,2047)}catch(R){throw m.onError(R),R}if(v.info("[".concat(this._clientId,"] start join channel ").concat(t,", join number: ").concat(a)),this._leaveMutex.isLocked&&(v.debug("[".concat(this._clientId,"] join: waiting leave operation")),(await this._leaveMutex.lock())(),v.debug("[".concat(this._clientId,"] join: continue"))),this._joinAndNotLeaveYet=!0,this.connectionState!=="DISCONNECTED"){const R=new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already in connecting/connected state"));throw m.onError(R),R}this._sessionId||(this._sessionId=h,this.store.sessionId=this._sessionId),this._gateway.state="CONNECTING";const f=_d({clientId:this._clientId,appId:e,sid:this._sessionId,cname:t,uid:typeof r!="string"?r:null,turnServer:this._turnServer,proxyServer:this._proxyServer,token:n||e,cloudProxyServer:this._cloudProxyServerMode,optionalInfo:o,license:this._license,useLocalAccessPoint:this._useLocalAccessPoint},this._remoteDefaultVideoStreamType!==void 0&&{defaultVideoStream:this._remoteDefaultVideoStreamType});if(this._useLocalAccessPoint&&(f.setLocalAPVersion=this._setLocalAPVersion),typeof r=="string"&&(f.stringUid=r,this._uintUid?(f.uid=this._uintUid,this._uintUid=void 0):f.uid=0),this._encryptionMode!=="none"&&this._encryptionSecret){if(f.aesmode=this._encryptionMode,f.aespassword=await(async R=>{const A=aE(`MIGfMA0GCSqGSIb3DQEBAQUAA4GNADCBiQKBgQDCMnXAHkKIGAM+x4N22gCI+Wyu
STM9ztkT3uYslTT2PuKmZfPzhH6kVdO7PTjGCOZnAsyb3oTtWat0KcxQ4jxvqQV+
HvYl3iI1Yd4vl2c3qRMJPLtRDfNxa2Mcxgq7e9aEUibzdd0st+OJAy3tOj/Y0aVy
xQiYDz3vqa6bP29adwIDAQAB`),O=await window.crypto.subtle.importKey("spki",A,{name:"RSA-OAEP",hash:"SHA-256"},!0,["encrypt"]),w=Jm(R),x=await window.crypto.subtle.encrypt({name:"RSA-OAEP"},O,w);return Ou(new Uint8Array(x))})(this._encryptionSecret),!this._joinAndNotLeaveYet)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this._encryptionSalt&&(f.aessalt=this._encryptionSalt)}this._startSession(this._sessionId,{channel:t,appId:e});const E=this._sessionId;setTimeout(()=>{this.connectionState==="CONNECTING"&&E===this._sessionId&&he.joinChannelTimeout(this._sessionId,5)},5e3);try{let R;const A=f.cloudProxyServer;if(["proxy3","proxy4","proxy5"].includes(A)){const V=k("PROXY_SERVER_TYPE3");Array.isArray(V)?f.proxyServer=V[0]:f.proxyServer=V}if(he.setProxyServer(f.proxyServer),v.setProxyServer(f.proxyServer),this.store.requestAPStart(),f.stringUid&&!f.uid){const V=await HI(f.stringUid,f,this._axiosCancelSource.token,this._config.httpRetryConfig||kt,this.store);v.debug("[".concat(this._clientId,"] getUserAccount Success ").concat(f.stringUid," => ").concat(V)),f.uid=V,R=await WI(f,this._axiosCancelSource.token,this._config.httpRetryConfig||kt,!0,this.store)}else R=await WI(f,this._axiosCancelSource.token,this._config.httpRetryConfig||kt,!0,this.store);if(!this._joinAndNotLeaveYet)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));this.store.requestAPEnd(),setTimeout(()=>{this._configDistribute.startGetConfigDistribute(f,this._axiosCancelSource.token),this._configDistribute.on(ed.UPDATE_BITRATE_LIMIT,V=>{this._p2pChannel.updateBitrateLimit(V)})},0),this._key=n||e;const O=R.gatewayInfo;this._joinInfo=_d(_d({},f),{},{cid:O.cid,uid:f.uid?f.uid:O.uid,vid:O.vid,apResponse:O.res,uni_lbs_ip:O.uni_lbs_ip,gatewayAddrs:O.gatewayAddrs});const w=await this._joinGateway();if(!this._joinAndNotLeaveYet)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client already left"));m.onSuccess(w),this._appId=e,this._channelName=f.cname,this._uid=w,this.store.uid=w,setTimeout(()=>{this._networkQualityInterval&&window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=window.setInterval(this._handleUpdateNetworkQuality,2e3),window.addEventListener(kn()?"beforeunload":"pagehide",this._handleBeforeUnload)},0);const x=f.stringUid?"string uid: ".concat(f.stringUid,",uid: ").concat(f.uid):"uid: ".concat(this._uid);return v.info("[".concat(this._clientId,"] Joining channel success: channel: ").concat(t,",").concat(x)),setTimeout(()=>{v.startUpload()},5e3),this.store.joinEnd(),T=this,Bs.includes(T)||Bs.push(T),w}catch(R){const A=Array.isArray(R)?R[0]:R;throw A&&A.code===I.OPERATION_ABORTED?v.warning("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),A):v.error("[".concat(this._clientId,"] join number: ").concat(a,", Joining channel failed, rollback"),A),A.code!==I.OPERATION_ABORTED&&this._numberOfJoinCount===a&&(this._gateway.state="DISCONNECTED",this._reset()),m.onError(A),A}var T}_joinGateway(){if(!this._joinInfo||!this._key)throw new b(I.INVALID_OPERATION);return this._gateway.join(this._joinInfo,this._key,!(this._joinInfo.cloudProxyServer!=="disabled"||this._joinInfo.proxyServer||!k("JOIN_WITH_FALLBACK_SIGNAL_PROXY"))).then(e=>e).catch(e=>{if(e.code===I.INIT_WEBSOCKET_TIMEOUT)return this._gateway.leave(!0,Je.FALLBACK),e;if(e.code===I.INIT_DATACHANNEL_TIMEOUT)return this._gateway.leave(!0,Je.FALLBACK),e;throw e}).then(e=>{if(e instanceof b){if(e.code===I.INIT_WEBSOCKET_TIMEOUT){if(v.info("[".concat(this._clientId,"] join timeout, fallback to proxy")),!this._joinInfo||!this._key)throw new b(I.INVALID_OPERATION);this._joinInfo.cloudProxyServer="fallback",this._cloudProxyServerMode="fallback",this.store.cloudProxyServerMode="fallback";const t=k("PROXY_SERVER_TYPE3");if(Array.isArray(t))if(this._joinInfo.apUrl){const r=/^https?:\/\/(.+?)(\/.*)?$/.exec(this._joinInfo.apUrl)[1].split("."),o=r.slice(r.length-2).join(".");t.forEach(a=>{this._joinInfo&&a.includes(o)&&(this._joinInfo.proxyServer=a)}),this._joinInfo.proxyServer||(this._joinInfo.proxyServer=t[0])}else this._joinInfo.proxyServer=t[0];else this._joinInfo.proxyServer=t;const n=k("LOG_UPLOAD_SERVER").match(/.+:(\d{1,5})$/);return n&&n[1]&&n[1]!=="443"&&v.setProxyServer(this._joinInfo.proxyServer),k("STATS_COLLECTOR_PORT").toString()!=="443"&&he.setProxyServer(this._joinInfo.proxyServer),he.reportApiInvoke(this._sessionId,{name:Mt.JOIN_FALLBACK_TO_PROXY,options:[this._joinInfo.proxyServer],tag:Et.TRACER}).onSuccess(),this.safeEmit(Me.JOIN_FALLBACK_TO_PROXY,this._joinInfo.proxyServer),k("JOIN_WITH_FALLBACK_MEDIA_PROXY_FORCE")&&this._joinInfo.turnServer.servers.forEach(r=>{"forceturn"in r&&(r.forceturn=!0)}),this._gateway.join(this._joinInfo,this._key)}if(v.info("[".concat(this._clientId,"] join by datachannel timeout, fallback to websocket")),!this._joinInfo||!this._key)throw new b(I.INVALID_OPERATION);return he.reportApiInvoke(this._sessionId,{name:Mt.DATACHANNEL_FAILBACK,options:[this.store.clientId],tag:Et.TRACER}).onSuccess(),this._joinGateway()}return e}).then(e=>e)}async leave(){v.info("[".concat(this._clientId,"] Leaving channel")),window.removeEventListener(kn()?"beforeunload":"pagehide",this._handleBeforeUnload),this._reset(),function(t){const n=Bs.indexOf(t);n!==-1&&Bs.splice(n,1)}(this);const e=await this._leaveMutex.lock();if(this.connectionState==="DISCONNECTED")return v.info("[".concat(this._clientId,"] Leaving channel repeated, success")),void e();await this._gateway.leave(this.connectionState!=="CONNECTED"),v.info("[".concat(this._clientId,"] Leaving channel success")),this._joinAndNotLeaveYet=!1,this.store.resetJoinChannelServiceRecords(),e()}async publish(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(Array.isArray(e)||(e=[e]),e.length===0)throw new b(I.INVALID_PARAMS,"track list is empty");if(this._gateway.role==="audience")throw new b(I.INVALID_OPERATION,"audience can not publish stream");for(const r of e){if(!(r instanceof Xm))throw new b(I.INVALID_PARAMS,"parameter is not local track");if(!r._enabled&&t)throw new b(I.TRACK_IS_DISABLED,"can not publish a disabled track: ".concat(r.getTrackId()))}v.info("[".concat(this._clientId,"] Publishing tracks, id ").concat(e.map(r=>"".concat(r.getTrackId()," "))));const n=await this._publishMutex.lock();await this._configDistribute.awaitConfigDistributeComplete(),t&&e.forEach(r=>{const o=this._configDistribute.getBitrateLimit();r instanceof Ft&&o&&r.setBitrateLimit(o.uplink)});try{await this._publishHighStream(e),v.info("[".concat(this._clientId,"] Publish success, id ").concat(e.map(r=>"".concat(r.getTrackId()," "))))}catch(r){throw v.error("[".concat(this._clientId,"] publish error"),r.toString()),r}finally{n()}}async unpublish(e){if(!this._joinInfo||this._uid===void 0)throw new b(I.INVALID_OPERATION,"Can't unpublish stream, haven't joined yet!");e?Array.isArray(e)||(e=[e]):e=this._p2pChannel.getAllTracks(!0),v.info("[".concat(this._clientId,"] Unpublish tracks, tracks ").concat(e.map(n=>"".concat(n.getTrackId()," "))," "));const t=await this._publishMutex.lock();try{const n=await this._p2pChannel.unpublish(e);n&&await this._gateway.unpublish(n,this._uid),v.info("[".concat(this._clientId,"] Unpublish success,tracks ").concat(e.map(r=>"".concat(r.getTrackId()))))}catch(n){throw v.error("[".concat(this._clientId,"] unpublish error"),n.toString()),n}finally{t&&t()}}async subscribe(e,t){return this._subscribe(e,t)}async _subscribe(e,t,n){if(tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new b(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));if(!this._users.find(h=>h===e)){const h=new b(I.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", this user is not in the channel")),h}if(!e.hasAudio&&!e.hasVideo){const h=new b(I.INVALID_REMOTE_USER,"user is not published");throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid,", user is not published")),h}if(!(n||(t!=="audio"||e.hasAudio&&e._audioSSRC!==void 0)&&(t!=="video"||e.hasVideo&&e._videoSSRC!==void 0))){const h=new b(I.REMOTE_USER_IS_NOT_PUBLISHED);throw v.error("[".concat(this._clientId,"] can not subscribe ").concat(e.uid," with mediaType ").concat(t,", remote track is not published")),h}const r=t==="audio"?e._audioSSRC:e._videoSSRC,o=t==="audio"?e._audioOrtc:e._videoOrtc,a=t==="video"?e._rtxSsrcId:void 0,d={stream_type:t==="audio"?be.AUDIO:be.VIDEO,ssrcId:r},u=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"] subscribe user ").concat(e.uid,", mediaType: ").concat(t));try{if(await this._p2pChannel.hasRemoteMediaWithLock(e,t))await this._p2pChannel.unmuteRemote(e,t);else try{zr.markSubscribeStart(this.store.clientId,r),this.store.subscribe(e.uid,t,Date.now()),await this._p2pChannel.subscribe(e,t,r,a,o);try{await this._gateway.subscribe(e.uid,d,!0)}catch(m){if((m==null?void 0:m.code)!==I.WS_ABORT)throw await this._p2pChannel.unsubscribe(e,t),m;await this._p2pChannel.unsubscribe(e,t,!0),this._p2pChannel.setPendingRemoteMedia(e,t)}this.store.subscribe(e.uid,t,void 0,Date.now()),this._p2pChannel.reportSubscribeEvent(!0,null,e,t)}catch(m){throw this._p2pChannel.reportSubscribeEvent(!1,m==null?void 0:m.code,e,t),m}v.info("[".concat(this._clientId,"] subscribe success user ").concat(e.uid,", mediaType: ").concat(t)),this._defaultStreamFallbackType&&this.setStreamFallbackOption(e.uid,this._defaultStreamFallbackType).catch(m=>{v.warning("[".concat(this._clientId,"] auto set fallback failed"),m)});const h=t==="audio"?e._audioTrack:e._videoTrack;if(!h)throw new b(I.UNEXPECTED_ERROR,"can not find remote track in user object");return h}catch(h){throw v.error("[".concat(this._clientId,"] subscribe user ").concat(e.uid," error"),h),h}finally{u()}}async massSubscribe(e){if(fo(e,"subscribeList"),!this._joinInfo)throw new b(I.INVALID_OPERATION,"Can't subscribe stream, not joined");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"Can't subscribe stream in ".concat(this.connectionState," state"));const t=Date.now(),n=new Map,r=await this._subscribeMutex.lock();v.info("[".concat(this._clientId,"]start massSubscribe user ").concat(e.map(u=>{let{user:h,mediaType:m}=u;return"user: ".concat(h==null?void 0:h.uid,", mediaType: ").concat(m)}).join("; ")));const o=(e=[...e]).map(u=>{let{user:h,mediaType:m}=u;return{user:h,mediaType:m}}),a=await this._p2pChannel.globalLock();try{var d;for(let h=e.length-1;h>=0;h--){const m=e[h],{user:f,mediaType:E}=m;if(tn(E,"mediaType",["audio","video"]),!f){const A=new b(I.INVALID_PARAMS,"user property does not exist in subscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in subscribeList item")),A}if(!this._users.find(A=>A===f)){const A=new b(I.INVALID_REMOTE_USER,"user is not in the channel");v.error("[".concat(this._clientId,"] can not massSubscribe ").concat(f.uid,", this user is not in the channel")),o[h].error=A,e.splice(h,1);continue}if(E==="audio"&&(!f.hasAudio||f._audioSSRC===void 0)||E==="video"&&(!f.hasVideo||f._videoSSRC===void 0)){const A=new b(I.REMOTE_USER_IS_NOT_PUBLISHED);v.error("[".concat(this._clientId,"] can not subscribe ").concat(f.uid," with mediaType ").concat(E,", remote user is not published")),o[h].error=A,e.splice(h,1);continue}const T=Ut.Video|Ut.LwoVideo,R=n.get(f);if(R){if(E==="video"?R&T:R&Ut.Audio){e.splice(h,1),v.warning("[".concat(this._clientId,"] repeat massSubscribe user:").concat(f.uid,", mediaType:").concat(E," twice"));continue}n.set(f,R|(E==="video"?T:Ut.Audio))}else n.set(f,E==="video"?T:Ut.Audio)}for(let h=e.length-1;h>=0;h--){const m=e[h],{user:f,mediaType:E}=m,T=Ut.Video|Ut.LwoVideo;if(this._p2pChannel.hasRemoteMedia(f,E)){await this._p2pChannel.unmuteRemoteNoLock(f,E);const R=n.get(f);n.set(f,E==="video"?R^T:R^Ut.Audio),e.splice(h,1)}}this.store.massSubscribe(e.map(h=>({userId:h.user.uid,type:h.mediaType})),t);const u=Fo(d=Array.from(n.entries())).call(d,(h,m)=>{let[f,E]=m;if(E===0)return h;const T={stream_id:f.uid,stream_type:E};return E&Ut.Audio&&(T.audio_ssrc=f._audioSSRC),E&Ut.Video&&(T.video_ssrc=f._videoSSRC),h.push(T),h},[]);try{e.length>0&&await this._p2pChannel.massSubscribeNoLock(e.map(m=>{let{user:f,mediaType:E}=m;return{user:f,mediaType:E,ssrcId:E===be.VIDEO?f._videoSSRC:f._audioSSRC,rtxSsrcId:E===be.VIDEO?f._rtxSsrcId:void 0}}));const h=new Map;if(u.length>0){const m=await this._gateway.subscribeAll(u,!0);((m==null?void 0:m.users)||[]).forEach(f=>{let{stream_id:E,video_error_code:T,audio_error_code:R,error_code:A}=f;(T||R||A)&&h.set(E,{video_error_code:T,audio_error_code:R,error_code:A})})}if(Array.from(h.entries()).length>0){const m=Array.from(h.entries()).map(f=>{let E,[T,R]=f;return R.error_code||R.video_error_code&&R.audio_error_code?E=void 0:R.video_error_code?E=be.VIDEO:R.audio_error_code&&(E=be.AUDIO),{user:this.remoteUsers.find(A=>A.uid===T),mediaType:E}});await this._p2pChannel.massUnsubscribeNoLock(m)}for(const m of o){const f=h.get(m.user.uid);if(f){const E=f.error_code||m.mediaType==="audio"&&f.audio_error_code||m.mediaType==="video"&&f.video_error_code;if(E){const T=id(E);v.error("user:".concat(m.user.uid," mediaType:").concat(m.mediaType," has massSubscribe error ").concat(T.desc)),m.error=new b(I.SUBSCRIBE_FAILED,"code ".concat(E,": ").concat(T.desc))}}m.error||(m.mediaType==="video"?m.track=m.user.videoTrack:m.track=m.user.audioTrack)}return this.store.massSubscribe(o.filter(m=>!m.error).map(m=>({userId:m.user.uid,type:m.mediaType})),void 0,Date.now()),o.forEach(m=>{var f;he.subscribe(this.store.sessionId,{succ:!!m.error,ec:((f=m.error)===null||f===void 0?void 0:f.code)||null,video:m.mediaType===be.VIDEO,audio:m.mediaType===be.AUDIO,peerid:m.user.uid,subscribeRequestid:m.mediaType===be.VIDEO?m.user._videoSSRC:m.user._audioSSRC,p2pid:this.store.p2pId,eventElapse:Math.floor(performance.now()-t)},!0)}),v.info("[".concat(this._clientId,"] massSubscribe success ").concat(e.map(m=>{let{user:f,mediaType:E}=m;return"user: ".concat(f==null?void 0:f.uid,", mediaType: ").concat(E)}).join("; "))),o}catch(h){throw await this._p2pChannel.massUnsubscribeNoLock(e),h}}finally{a(),r()}}async unsubscribe(e,t){if(t&&tn(t,"mediaType",["audio","video"]),!this._joinInfo)throw new b(I.INVALID_OPERATION,"Can't unsubscribe stream, haven't joined yet!");if(!this._users.find(r=>r===e)){const r=new b(I.INVALID_REMOTE_USER,"user is not in the channel");throw v.error("[".concat(this._clientId,"] can not unsubscribe ").concat(e.uid,", user is not in the channel")),r}v.info("[".concat(this._clientId,"] unsubscribe uid: ").concat(e.uid,", mediaType: ").concat(t));const n=await this._subscribeMutex.lock();try{const r=await this._p2pChannel.unsubscribe(e,t);r&&await this._gateway.unsubscribe(r,e.uid),v.info("[".concat(this._clientId,"] unsubscribe success uid: ").concat(e.uid,", mediaType: ").concat(t))}catch(r){if(r.code===I.DISCONNECT_P2P)return void v.warning("disconnecting p2p, abort unsubscribe request.");throw v.error("[".concat(this._clientId,"] unsubscribe user ").concat(e.uid," error"),r.toString()),r}finally{n()}}async massUnsubscribe(e){if(fo(e,"unsubscribeList"),!this._joinInfo)throw new b(I.INVALID_OPERATION,"Can't unsubscribeAll stream, haven't joined yet!");v.info("[".concat(this._clientId,"] start massUnsubscribe ").concat(e.map(n=>{let{user:r,mediaType:o}=n;return"user: ".concat(r==null?void 0:r.uid,", mediaType: ").concat(o,";")}).join())),e=[...e];const t=new Map;for(let n=e.length-1;n>=0;n--){const{user:r,mediaType:o}=e[n];if(!r){const d=new b(I.INVALID_PARAMS,"user property does not exist in unsubscribeList item");throw v.error("[".concat(this._clientId,"] user property does not exist in unsubscribeList item")),d}if(tn(o,"mediaType",["video","audio",void 0]),!this._users.find(d=>d===r)){v.warning("[".concat(this._clientId,"] can not unsubscribe ").concat(r.uid,", user is not in the channel")),e.splice(n,1);continue}const a=Ut.Video|Ut.LwoVideo;if(t.has(r)){const d=t.get(r);let u;switch(o){case"video":u=d&a;break;case"audio":u=d&Ut.Audio;break;default:u=d&(Ut.Audio|a)}if(u){v.warning("[".concat(this._clientId,"] repeat massUnsubscribe user:").concat(r.uid,",mediaType:").concat(o," twice.")),e.splice(n,1);continue}o?o==="audio"?t.set(r,d|Ut.Audio):o==="video"&&t.set(r,d|a):t.set(r,d|Ut.Audio|a)}else o?o==="audio"?t.set(r,Ut.Audio):o==="video"&&t.set(r,a):t.set(r,Ut.Audio|a)}try{const n=await this._p2pChannel.massUnsubscribe(e);n&&await this._gateway.massUnsubscribe(n),v.info("[".concat(this._clientId,"] massUnsubscribe success ").concat(e.map(r=>{let{user:o,mediaType:a}=r;return"user: ".concat(o==null?void 0:o.uid,", mediaType: ").concat(a,";")}).join()))}catch(n){if(n.code===I.DISCONNECT_P2P)return void v.warning("[".concat(this._clientId,"] disconnecting p2p, abort unsubscribe request."));throw v.error("[".concat(this._clientId,"] massUnsubscribe error"),n.toString()),n}}setLowStreamParameter(e){(function(n){if(!n)throw new b(I.INVALID_PARAMS);ht(n.width)||bm(n.width,"streamParameter.width"),ht(n.height)||bm(n.height,"streamParameter.height"),ht(n.framerate)||bm(n.framerate,"streamParameter.framerate"),ht(n.bitrate)||st(n.bitrate,"streamParameter.bitrate")})(e),(!e.width&&e.height||e.width&&!e.height)&&v.warning("[".concat(this._clientId,"] The width and height parameters take effect only when both are set")),v.info("[".concat(this._clientId,"] set low stream parameter to"),JSON.stringify(e));const t=this._configDistribute.getLowStreamConfigDistribute();t&&t.bitrate&&e.bitrate&&t.bitrate<e.bitrate&&(e.bitrate=t.bitrate),this._lowStreamParameter=e}async enableDualStream(){if(!bt().supportDualStream)throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),new b(I.NOT_SUPPORTED,"Your browser is not support dual stream");if(this._isDualStreamEnabled)throw new b(I.INVALID_OPERATION,"Dual stream is already enabled");if(this._p2pChannel.canPublishLowStream())try{await this._publishLowStream()}catch(e){throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!1}),e}this._isDualStreamEnabled=!0,he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!0,succ:!0}),v.info("[".concat(this._clientId,"] enable dual stream"))}async disableDualStream(){if(this._isDualStreamEnabled){if(!this._joinInfo)throw new b(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this._p2pChannel.getLocalMedia(ue.LocalVideoLowTrack))try{const e=await this._p2pChannel.unpublishLowStream();e&&await this._gateway.unpublish(e,this._joinInfo.stringUid||this._joinInfo.uid)}catch(e){throw he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!1}),e}this._isDualStreamEnabled=!1,he.streamSwitch(this._sessionId,{lts:Date.now(),isdual:!1,succ:!0}),v.info("[".concat(this._clientId,"] disable dual stream"))}}async setClientRole(e,t){if(function(n){tn(n,"role",["audience","host"])}(e),t&&xR(t),this.mode==="rtc")throw v.warning("[".concat(this._clientId,"]rtc mode can not use setClientRole")),new b(I.INVALID_OPERATION,"rtc mode can not use setClientRole");if(t&&t.level&&e==="host")throw new b(I.INVALID_OPERATION,"host mode can not set audience latency level");if(e==="audience"&&this._p2pChannel.hasLocalMedia())throw new b(I.INVALID_OPERATION,"can not set client role to audience when publishing stream");await this._gateway.setClientRole(e,t),this._config.role=e,v.info("[".concat(this._clientId,"] set client role to ").concat(e,", level: ").concat(t&&t.level))}setProxyServer(e,t){if(_n(e,"proxyServer"),!t){if(this.connectionState!=="DISCONNECTED")throw new b(I.INVALID_OPERATION,"Set proxy server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new b(I.INVALID_OPERATION,"You have already set the proxy")}this._proxyServer=e,he.setProxyServer(this._proxyServer),v.setProxyServer(this._proxyServer),v.info("[".concat(this._clientId,"] Set proxy server ").concat(t?"by initialize call":""," success."))}setTurnServer(e,t){if(Array.isArray(e)||(e=[e]),!t){if(this.connectionState!=="DISCONNECTED")throw new b(I.INVALID_OPERATION,"Set turn server before join channel");if(this._cloudProxyServerMode!=="disabled"||this._useLocalAccessPoint)throw new b(I.INVALID_OPERATION,"You have already set the proxy")}if($c(e))return this._turnServer={servers:e,mode:"original-manual"},void v.info("[".concat(this._clientId,"] Set original turnserver ").concat(t?"by initialize call":""," success: ").concat(e.map(n=>n.urls).join(","),"."));e.forEach(n=>UR(n)),this._turnServer={servers:e,mode:"manual"},v.info("[".concat(this._clientId,"] Set turnserver ").concat(t?"by initialize call":""," success."))}setLicense(e){if(this.connectionState!=="DISCONNECTED")throw new b(I.INVALID_OPERATION,"you should set license before join channel");if(_n(e,"license",32,32),!/^[A-Za-z\d]+$/.test(e))throw new b(I.INVALID_PARAMS,"license should only contains characters from A-Z a-z 0-9");this._license=e,v.info("[".concat(this._clientId,"] set license success"),e)}startProxyServer(e){if(this.connectionState!=="DISCONNECTED")throw new b(I.INVALID_OPERATION,"Start proxy server before join channel");if(this._proxyServer||this._turnServer.mode==="manual"||this._useLocalAccessPoint)throw new b(I.INVALID_OPERATION,"You have already set the proxy");const t=[3,4,5];let n;switch(e===void 0&&(e=3),e){case 1:case 2:throw new b(I.NOT_SUPPORTED,"proxy mode 1/2 has been deprecated and not supported.");case 3:n="proxy3";break;case 4:n="proxy4";break;case 5:n="proxy5";break;default:throw new b(I.INVALID_PARAMS,"proxy server mode must be ".concat(t.join("|")))}this._cloudProxyServerMode=n,this.store.cloudProxyServerMode=n,v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode)}stopProxyServer(){if(this.connectionState!=="DISCONNECTED")throw new b(I.INVALID_OPERATION,"Stop proxy server after leave channel");he.setProxyServer(),v.setProxyServer(),this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled",v.info("[".concat(this._clientId,"] set cloud proxy server mode to"),this._cloudProxyServerMode),this._proxyServer=void 0,this._turnServer={mode:"auto",servers:[]}}setLocalAccessPointsV2(e){if(!e.accessPoints)throw new b(I.INVALID_PARAMS,"accessPoints is required.");fo(e.accessPoints.serverList,"accessPoints.serverList"),_n(e.accessPoints.domain,"accessPoints.domain");const t=(T,R)=>{st(T,R,0,65535,!0)};let n=443;if(e.accessPoints.port&&(t(e.accessPoints.port,"accessPoints.port"),n=e.accessPoints.port),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new b(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");k("CLOSE_AFB_FOR_LOCAL_AP")&&(it("JOIN_WITH_FALLBACK_SIGNAL_PROXY",!1),it("JOIN_WITH_FALLBACK_MEDIA_PROXY",!1));const r=/^((\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.){3}(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/,o=e.accessPoints.domain,a=e.accessPoints.serverList.map(T=>r.test(T)?"".concat(T.replace(/\./g,"-"),".").concat(o):T),d=a.map(T=>"".concat(T,":").concat(n));this._useLocalAccessPoint=!0,this._setLocalAPVersion=2,it("WEBCS_DOMAIN",d),it("WEBCS_DOMAIN_BACKUP_LIST",d),it("GATEWAY_DOMAINS",[o]),e.report&&e.report.hostname&&Array.isArray(e.report.hostname)&&e.report.hostname.length?(fo(e.report.hostname,"report.hostname"),it("EVENT_REPORT_DOMAIN",e.report.hostname[0]),it("EVENT_REPORT_BACKUP_DOMAIN",e.report.hostname[1]||e.report.hostname[0])):(it("EVENT_REPORT_DOMAIN",a[0]),it("EVENT_REPORT_BACKUP_DOMAIN",a[1]||a[0]));let u=6443;e.report&&e.report.port&&(t(e.report.port,"report.port"),u=e.report.port),it("STATS_COLLECTOR_PORT",u),e.report?it("ENABLE_EVENT_REPORT",!0):it("ENABLE_EVENT_REPORT",!1);let h="";e.log&&e.log.hostname&&Array.isArray(e.log.hostname)&&e.log.hostname.length?(fo(e.log.hostname,"log.hostname"),h=e.log.hostname[0]):h=a[0];let m=6444;e.log&&e.log.port&&(t(e.log.port,"log.port"),m=e.log.port),it("LOG_UPLOAD_SERVER","".concat(h,":").concat(m));let f=[];e.cds&&e.cds.hostname&&Array.isArray(e.cds.hostname)&&e.cds.hostname.length?(fo(e.cds.hostname,"cds.hostname"),f=e.cds.hostname):f=a;let E=443;e.cds&&e.cds.port&&(t(e.cds.port,"cds.port"),E=e.cds.port),it("CDS_AP",f.map(T=>"".concat(T,":").concat(E))),e.cds?it("ENABLE_CONFIG_DISTRIBUTE",!0):it("ENABLE_CONFIG_DISTRIBUTE",!1),v.info("set local access point v2 success")}setLocalAccessPoints(e,t){if(fo(e,"serverList"),_n(t,"domain"),this._proxyServer||this._cloudProxyServerMode!=="disabled")throw new b(I.INVALID_OPERATION,"set local access point failed, You have already set the cloud proxy");const n=/^(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])\.(\d{1,2}|1\d\d|2[0-4]\d|25[0-5])$/;e=e.map(r=>n.test(r)?"".concat(r.replace(/\./g,"-"),".").concat(t):r),this._useLocalAccessPoint=!0,this._setLocalAPVersion=1,it("WEBCS_DOMAIN",e),it("WEBCS_DOMAIN_BACKUP_LIST",e),it("GATEWAY_DOMAINS",[t]),it("EVENT_REPORT_DOMAIN",e[0]),it("EVENT_REPORT_BACKUP_DOMAIN",e[1]||e[0]),it("LOG_UPLOAD_SERVER","".concat(e[0],":6444")),v.info("[".concat(this._clientId,"] set local access point success"))}async setRemoteDefaultVideoStreamType(e){if(tn(e,"streamType",[0,1]),this._remoteDefaultVideoStreamType=e,this._joinInfo)try{await this._gateway.setDefaultRemoteVideoStreamType(e),this._joinInfo.defaultVideoStream=this._remoteDefaultVideoStreamType}catch(t){throw v.error("[".concat(this._clientId,"] set default remote video stream type error"),t.toString()),t}else v.debug("[".concat(this._clientId,"] haven't joined yet, cache remoteDefaultVideoStreamType ").concat(e))}async setRemoteVideoStreamType(e,t){tn(t,"streamType",[0,1]);try{await this._gateway.setRemoteVideoStreamType(e,t),setTimeout(()=>{const n=this._users.find(r=>r.uid===e);n&&n.videoTrack&&n.videoTrack.updateMediaStreamTrackResolution()},2e3)}catch(n){throw v.error("[".concat(this._clientId,"] set remote video stream type error"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," video stream type to ").concat(t)),this._remoteStreamTypeCacheMap.set(e,t)}async setStreamFallbackOption(e,t){tn(t,"fallbackType",[0,1,2]);try{await this._gateway.setStreamFallbackOption(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] set stream fallback option"),n.toString()),n}v.info("[".concat(this._clientId,"] set remote ").concat(e," stream fallback type to ").concat(t)),this._streamFallbackTypeCacheMap.set(e,t)}setEncryptionConfig(e,t,n){if(function(r){tn(r,"encryptionMode",["aes-128-xts","aes-256-xts","aes-128-ecb","sm4-128-ecb","aes-128-gcm","aes-256-gcm","aes-128-gcm2","aes-256-gcm2","none"])}(e),_n(t,"secret"),["aes-128-gcm2","aes-256-gcm2"].includes(e)){if(!n||!(n instanceof Uint8Array&&n.length===32))throw new b(I.INVALID_PARAMS,"salt must be an Uint8Array and exactly equal to 32 bytes")}else if(n)throw new b(I.INVALID_PARAMS,"current encrypt mode does not need salt");new RegExp(`^(?=.*[a-z])(?=.*[A-Z])(?=.*[0-9])(?=.*[!@#$%^&*,.<>?/:;'"|{}\\[\\]])(?=.{8,})`).test(t)||v.warning(`The secret is not strong:
      The secret must contain at least 1 lowercase alphabetical character,
      The secret must contain at least 1 uppercase alphabetical character,
      The secret must contain at least 1 numeric character,
      The secret must contain at least one special character,
      The secret must be eight characters or longer.
      `),this._encryptionMode=e,this._encryptionSecret=t,n&&(this._encryptionSalt=Ou(n))}async renewToken(e){if(_n(e,"token",1,2047),!this._key||!this._joinInfo)throw new b(I.INVALID_OPERATION,"renewToken should not be called before user join");const t=this._key;this._key=e,this._joinInfo&&(this._joinInfo.token=e);const n=await this._renewTokenMutex.lock();try{if(k("USE_NEW_TOKEN")){v.debug("[".concat(this._clientId,"] start renew token with ticket from unilbs"));const r=await Cj(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||kt);v.debug("[".concat(this._clientId,"] get ticket from unilbs success")),await this._gateway.renewToken({token:e,ticket:r})}else v.debug("[".concat(this._clientId,"] start renew token without ticket")),await this._gateway.renewToken({token:e});v.debug("[".concat(this._clientId,"] renewToken success"))}catch(r){throw this._key=t,this._joinInfo.token=t,v.error("[".concat(this._clientId,"] renewToken failed"),r.toString()),r}finally{n()}}enableAudioVolumeIndicator(){this._audioVolumeIndicationInterval?v.warning("you have already enabled audio volume indicator!"):this._audioVolumeIndicationInterval=window.setInterval(()=>{const e=this._p2pChannel.getAudioLevels();this.safeEmit(Me.VOLUME_INDICATOR,e)},k("AUDIO_VOLUME_INDICATION_INTERVAL")||2e3)}getRTCStats(){const e=this._statsCollector.getRTCStats(),t=this._gateway.getInChannelInfo();return e.Duration=Math.round(t.duration/1e3),e}async startLiveStreaming(e,t){if(!t){if(this.codec!=="h264")throw new b(I.LIVE_STREAMING_INVALID_RAW_STREAM,"raw streaming is only support h264");if(!this._p2pChannel.hasLocalMedia())throw new b(I.LIVE_STREAMING_INVALID_RAW_STREAM,"can not find stream to raw streaming")}if(this._liveRawStreamingClient&&this._liveRawStreamingClient.hasUrl(e)||this._liveTranscodeStreamingClient&&this._liveTranscodeStreamingClient.hasUrl(e))throw new b(I.LIVE_STREAMING_TASK_CONFLICT);const n=t?Gt.TRANSCODE:Gt.RAW;return this._createLiveStreamingClient(n).startLiveStreamingTask(e,n)}setLiveTranscoding(e){return this._createLiveStreamingClient(Gt.TRANSCODE).setTranscodingConfig(e)}async stopLiveStreaming(e){const t=[this._liveRawStreamingClient,this._liveTranscodeStreamingClient].filter(n=>n&&n.hasUrl(e));if(!t.length)throw new b(I.INVALID_PARAMS,"can not find live streaming url to stop");await de.all(t.map(n=>n&&n.stopLiveStreamingTask(e)))}async addInjectStreamUrl(e,t){if(!this._joinInfo)throw new b(I.INVALID_OPERATION,"can not addInjectStreamUrl, no joininfo");const n=this._createLiveStreamingClient(Gt.INJECT);n.setInjectStreamConfig(t,0),await n.startLiveStreamingTask(e,Gt.INJECT)}async removeInjectStreamUrl(){var e;const t=this._createLiveStreamingClient(Gt.INJECT),n=Array.from(qi(e=t.streamingTasks).call(e)).find(r=>r.mode===Gt.INJECT);if(!this._joinInfo||!n)throw new b(I.INVALID_OPERATION,"can remove addInjectStreamUrl, no joininfo or inject task");await t.stopLiveStreamingTask(n.url)}async startChannelMediaRelay(e){$I(e),await this._createChannelMediaRelayClient().startChannelMediaRelay(e)}async updateChannelMediaRelay(e){$I(e),await this._createChannelMediaRelayClient().updateChannelMediaRelay(e)}async stopChannelMediaRelay(){await this._createChannelMediaRelayClient().stopChannelMediaRelay(),this._statsCollector.onStatsChanged&&(this._statsCollector.onStatsChanged=void 0)}sendStreamMessage(e){let t=!(arguments.length>1&&arguments[1]!==void 0)||arguments[1];if(!this._joinInfo)throw new b(I.INVALID_OPERATION,"can not send data stream, not joined");if(typeof e=="string"&&(e=new TextEncoder().encode(e)),new Blob([e]).size>1024)throw new b(I.INVALID_PARAMS,"stream message out of range.");return this._gateway.signal.request(ye.DATA_STREAM,{payload:Ou(e)},!t)}sendMetadata(e){if(!this._joinInfo)throw new b(I.INVALID_OPERATION,"can not send metadata, not joined");if(new Blob([e]).size>1024)throw new b(I.METADATA_OUT_OF_RANGE);return this._gateway.signal.request(ye.SEND_METADATA,{session_id:this._joinInfo.sid,metadata:Ou(e)})}async sendCustomReportMessage(e){if(Array.isArray(e)||(e=[e]),e.forEach(VV),!this._joinInfo)throw new b(I.INVALID_OPERATION,"can not send custom report, not joined");await he.sendCustomReportMessage(this._joinInfo.sid,e)}getLocalAudioStats(){return this._statsCollector.getLocalAudioTrackStats()}getRemoteAudioStats(){return this._statsCollector.getRemoteAudioTrackStats()}getLocalVideoStats(){return this._statsCollector.getLocalVideoTrackStats()}getRemoteVideoStats(){return this._statsCollector.getRemoteVideoTrackStats()}getRemoteNetworkQuality(){return this._statsCollector.getRemoteNetworkQualityStats()}async pickSVCLayer(e,t){tn(t.spatialLayer,"spatialLayer",[0,1,2,3]),tn(t.temporalLayer,"temporalLayer",[0,1,2,3]);try{await this._gateway.pickSVCLayer(e,t)}catch(n){throw v.error("[".concat(this._clientId,"] pick SVC layer failed"),n.toString()),n}}_reset(){if(v.debug("[".concat(this._clientId,"] reset client")),this._axiosCancelSource.cancel(),this._axiosCancelSource=Rr.CancelToken.source(),this._streamFallbackTypeCacheMap=new Map,this._remoteStreamTypeCacheMap=new Map,this._configDistribute.stopGetConfigDistribute(),this._joinInfo=void 0,this._proxyServer=void 0,this._defaultStreamFallbackType=void 0,this._sessionId=null,this.store.sessionId=null,this._statsCollector.reset(),this._key=void 0,this._appId=void 0,this._uid=void 0,this.store.uid=void 0,this._channelName=void 0,this._encryptionMode="none",this._encryptionSecret=null,this._encryptionSalt=null,this._users.forEach(e=>{e._audioTrack&&e._audioTrack._destroy(),e._videoTrack&&e._videoTrack._destroy()}),this._users=[],this._audioVolumeIndicationInterval&&(window.clearInterval(this._audioVolumeIndicationInterval),this._audioVolumeIndicationInterval=void 0),this._cloudProxyServerMode==="fallback"&&(this._cloudProxyServerMode="disabled",this.store.cloudProxyServerMode="disabled"),this._p2pChannel.reset(),this._publishMutex=new Vn("client-publish"),this._subscribeMutex=new Vn("client-subscribe"),this._networkQualityInterval&&(window.clearInterval(this._networkQualityInterval),this._networkQualityInterval=void 0),this._injectStreamingClient&&(this._injectStreamingClient.terminate(),this._injectStreamingClient.removeAllListeners(),this._injectStreamingClient=void 0),this._liveRawStreamingClient&&(this._liveRawStreamingClient.terminate(),this._liveRawStreamingClient.removeAllListeners(),this._liveRawStreamingClient=void 0),this._liveTranscodeStreamingClient&&(this._liveTranscodeStreamingClient.terminate(),this._liveTranscodeStreamingClient.removeAllListeners(),this._liveTranscodeStreamingClient=void 0),this._channelMediaRelayClient&&(this._channelMediaRelayClient.dispose(),this._channelMediaRelayClient=void 0),this._inspect)try{this._inspect.close(),this._inspect=void 0}catch{}if(this._moderation)try{this.setImageModeration(!1)}catch{}}_startSession(e,t){const n=e||oE();e?v.debug("[".concat(this._clientId,"] new Session ").concat(n)):v.debug("[".concat(this._clientId,"] renewSession ").concat(this._sessionId," => ").concat(n)),this._sessionId=n,this.store.sessionId=n,t?he.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:t.channel,appid:t.appId,mode:this.mode}):this._joinInfo?he.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._joinInfo.cname,appid:this._joinInfo.appId,mode:this.mode}):this._gateway.joinInfo&&he.sessionInit(this._sessionId,{lts:new Date().getTime(),cname:this._gateway.joinInfo.cname,appid:this._gateway.joinInfo.appId,mode:this.mode}),this._joinInfo&&(this._joinInfo.sid=n),this._gateway.joinInfo&&(this._gateway.joinInfo.sid=n)}async _publishHighStream(e){if(!this._joinInfo||this._uid===void 0)throw new b(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));if(this._turnServer.mode==="auto"&&k("FORCE_TURN")&&!k("TURN_ENABLE_TCP")&&!k("TURN_ENABLE_UDP"))throw new b(I.UNEXPECTED_ERROR,"force TURN With No TURN Configuration");v.debug("[".concat(this._clientId,"] publish high stream"));try{const n=await this._p2pChannel.publish(e,this._isDualStreamEnabled,this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}await n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[])}this._p2pChannel.reportPublishEvent(!0,null);for(const o of e)o instanceof Ft&&o._encoderConfig&&this._gateway.setVideoProfile(o._encoderConfig),!o.muted&&o.enabled||await this._p2pChannel.muteLocalTrack(o)}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,e),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}async _publishLowStream(){if(!this._joinInfo||this._uid===void 0)throw new b(I.INVALID_OPERATION,"Can't publish stream, haven't joined yet!");if(this.connectionState!=="CONNECTED"&&this.connectionState!=="RECONNECTING")throw new b(I.INVALID_OPERATION,"can not publish stream in ".concat(this.connectionState," state"));v.debug("[".concat(this._clientId,"] publish low stream"));const e=this._configDistribute.getLowStreamConfigDistribute();e&&e.bitrate&&(this._lowStreamParameter||(this._lowStreamParameter={width:160,height:120,framerate:15,bitrate:50}),this._lowStreamParameter&&this._lowStreamParameter.bitrate&&e.bitrate<this._lowStreamParameter.bitrate&&(this._lowStreamParameter.bitrate=e.bitrate));try{const n=await this._p2pChannel.publishLowStream(this._lowStreamParameter),r=(await n.next()).value;if(r){var t;let o;try{o=await this._gateway.publish(this._uid,r,!0)}catch(a){if(a.code!==I.DISCONNECT_P2P)throw n.throw(a),a}n.next(((t=o)===null||t===void 0?void 0:t.ortc)||[]),this._p2pChannel.reportPublishEvent(!0,null,void 0,!0)}}catch(n){if(this._p2pChannel.reportPublishEvent(!1,n==null?void 0:n.code,void 0,!0),(n==null?void 0:n.code)===I.WS_ABORT)return;throw n}}_createLiveStreamingClient(e){if(!this._joinInfo||!this._appId)return new b(I.INVALID_OPERATION,"can not create live streaming client, please join channel first").throw();const t=()=>new Oj(this._joinInfo,this._config.websocketRetryConfig||kt,this._config.httpRetryConfig||kt),n=r=>{r.onLiveStreamError=(o,a)=>{he.reportApiInvoke(this._sessionId,{name:Mt.ON_LIVE_STREAM_ERROR,options:[o,a],tag:Et.TRACER}).onSuccess(),this.safeEmit(Me.LIVE_STREAMING_ERROR,o,a)},r.onLiveStreamWarning=(o,a)=>{he.reportApiInvoke(this._sessionId,{name:Mt.ON_LIVE_STREAM_WARNING,options:[o,a],tag:Et.TRACER}).onSuccess(),this.safeEmit(Me.LIVE_STREAMING_WARNING,o,a)},r.on(xa.REQUEST_WORKER_MANAGER_LIST,(o,a,d)=>{if(!this._joinInfo)return d(new b(I.INVALID_OPERATION,"can not find join info to get worker manager"));zI(o,this._joinInfo,this._axiosCancelSource.token,kt).then(a).catch(d)})};switch(e){case Gt.RAW:return this._liveRawStreamingClient||(this._liveRawStreamingClient=t(),n(this._liveRawStreamingClient)),this._liveRawStreamingClient;case Gt.TRANSCODE:return this._liveTranscodeStreamingClient||(this._liveTranscodeStreamingClient=t(),n(this._liveTranscodeStreamingClient)),this._liveTranscodeStreamingClient;case Gt.INJECT:return this._injectStreamingClient||(this._injectStreamingClient=t(),this._injectStreamingClient.on(xa.REQUEST_WORKER_MANAGER_LIST,(r,o,a)=>{if(!this._joinInfo)return a(new b(I.INVALID_OPERATION,"can not find join info to get worker manager"));zI(r,this._joinInfo,this._axiosCancelSource.token,kt).then(o).catch(a)}),this._injectStreamingClient.onInjectStatusChange=(r,o,a)=>{this.emit(Me.INJECT_STREAM_STATUS,r,o,a)}),this._injectStreamingClient}}_createChannelMediaRelayClient(){if(!this._joinInfo)return new b(I.INVALID_OPERATION,"can not create channel media relay client, please join channel first").throw();if(!this._channelMediaRelayClient){const{sendResolutionWidth:e,sendResolutionHeight:t}=this.getLocalVideoStats(),n={width:e,height:t};this._channelMediaRelayClient=new Nj(this._joinInfo,this._clientId,this._config.websocketRetryConfig||kt,this._config.httpRetryConfig||kt,n),this._channelMediaRelayClient.on("state",r=>{r===xn.RELAY_STATE_FAILURE&&this._channelMediaRelayClient&&this._channelMediaRelayClient.dispose(),this.safeEmit(Me.CHANNEL_MEDIA_RELAY_STATE,r)}),this._channelMediaRelayClient.on("event",r=>{this.safeEmit(Me.CHANNEL_MEDIA_RELAY_EVENT,r)}),this._statsCollector.onStatsChanged=(r,o)=>{var a;r==="resolution"&&((a=this._channelMediaRelayClient)===null||a===void 0||a.setVideoProfile(o))}}return this._channelMediaRelayClient}_handleGatewayEvents(){this._gateway.on(_t.DISCONNECT_P2P,async()=>{await this._p2pChannel.disconnectForReconnect()}),this._gateway.on(_t.CONNECTION_STATE_CHANGE,(e,t,n)=>{var r;if(n===Je.FALLBACK)return;const o=()=>{this.safeEmit(Me.CONNECTION_STATE_CHANGE,e,t,n)};if(he.reportApiInvoke(this._sessionId||((r=this._gateway.joinInfo)===null||r===void 0?void 0:r.sid)||null,{name:Mt.CONNECTION_STATE_CHANGE,options:[e,t,n],tag:Et.TRACER}).onSuccess(JSON.stringify({cur:e,prev:t,reason:n})),v.info("[".concat(this._clientId,"] connection state change: ").concat(t," -> ").concat(e)),e==="DISCONNECTED")return this._reset(),void o();if(e==="RECONNECTING")this._users.forEach(d=>{d._trust_in_room_=!1,d._trust_audio_enabled_state_=!1,d._trust_video_enabled_state_=!1,d._trust_audio_mute_state_=!1,d._trust_video_mute_state_=!1,d._trust_audio_stream_added_state_=!1,d._trust_video_stream_added_state_=!1,d._audioSSRC=void 0,d._videoSSRC=void 0,d._videoOrtc=void 0,d._audioOrtc=void 0,d._cname=void 0,d._rtxSsrcId=void 0}),this._userOfflineTimeout&&window.clearTimeout(this._userOfflineTimeout),this._streamRemovedTimeout&&window.clearTimeout(this._streamRemovedTimeout),this._userOfflineTimeout=void 0,this._streamRemovedTimeout=void 0;else if(e==="CONNECTED"){var a;this._streamFallbackTypeCacheMap.forEach((d,u)=>{this._gateway.setStreamFallbackOption(u,d).catch(h=>{v.warning("[".concat(this._clientId,"] auto set stream fallback option failed"),h)})}),this._remoteStreamTypeCacheMap.forEach((d,u)=>{this._gateway.setRemoteVideoStreamType(u,d).catch(h=>{v.warning("[".concat(this._clientId,"] auto set remote stream type failed"),h)})}),this._remoteDefaultVideoStreamType!==void 0&&((a=this._joinInfo)===null||a===void 0?void 0:a.defaultVideoStream)===void 0&&this.setRemoteDefaultVideoStreamType(this._remoteDefaultVideoStreamType).then(()=>{v.debug("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway connected"))}).catch(d=>{v.error("[".concat(this._clientId,"] setRemoteDefaultVideoStreamType after gateway failed, ").concat(d))}),this._p2pChannel.republish(),this._userOfflineTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._userOfflineTimeout=void 0,this._users.filter(d=>!d._trust_in_room_).forEach(d=>{v.debug("[".concat(this._clientId,"] user offline timeout, emit user offline ").concat(d.uid)),this._handleUserOffline({uid:d.uid})}))},3e3),this._streamRemovedTimeout=window.setTimeout(()=>{this.connectionState==="CONNECTED"&&(this._streamRemovedTimeout=void 0,this._users.forEach(d=>{d._trust_audio_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch audio unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,"audio",!1)),d._trust_video_mute_state_||(v.debug("[".concat(this._clientId,"] auto dispatch video unmute event ").concat(d.uid)),this._handleMuteStream(d.uid,"video",!1)),d._trust_audio_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local audio ").concat(d.uid)),this._handleSetStreamLocalEnable("audio",d.uid,!0)),d._trust_video_enabled_state_||(v.debug("[".concat(this._clientId,"] auto dispatch enable local video ").concat(d.uid)),this._handleSetStreamLocalEnable("video",d.uid,!0)),d._trust_video_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset video stream added ").concat(d.uid)),this._handleResetAddStream(d,"video")),d._trust_audio_stream_added_state_||(v.debug("[".concat(this._clientId,"] auto dispatch reset audio stream added ").concat(d.uid)),this._handleResetAddStream(d,"audio")),d._video_added_||d._audio_added_||(v.debug("[".concat(this._clientId,"] auto dispatch stream remove ").concat(d.uid)),this._handleRemoveStream({uid:d.uid,uint_id:d._uintid}))}))},1e3)}o()}),this._gateway.on(_t.REQUEST_NEW_GATEWAY_LIST,(e,t)=>{if(!this._joinInfo)return t(new b(I.UNEXPECTED_ERROR,"can not recover, no join info"));pE(this._joinInfo,this._axiosCancelSource.token,this._config.httpRetryConfig||kt,this.store).then(n=>{this._joinInfo&&(this._joinInfo.apResponse=n.gatewayInfo.res,this._joinInfo.gatewayAddrs=n.gatewayInfo.gatewayAddrs,this._joinInfo.uni_lbs_ip=n.gatewayInfo.uni_lbs_ip),e(n.gatewayInfo.gatewayAddrs.map(r=>{if(this._joinInfo&&this._joinInfo.proxyServer){const o=r.address.split(":");return"wss://".concat(this._joinInfo.proxyServer,"/ws/?h=").concat(o[0],"&p=").concat(o[1])}return"wss://".concat(r.address)}))}).catch(t)}),this._gateway.on(_t.NETWORK_QUALITY,e=>{this._networkQualitySensitivity==="normal"&&this.safeEmit(Me.NETWORK_QUALITY,e)}),this._gateway.on(_t.STREAM_TYPE_CHANGE,(e,t)=>{this.safeEmit(Me.STREAM_TYPE_CHANGED,e,t),he.reportApiInvoke(this._sessionId,{name:Mt.STREAM_TYPE_CHANGE,options:[e,t],tag:Et.TRACER}).onSuccess(JSON.stringify({uid:e,streamType:t}))}),this._gateway.on(_t.IS_P2P_DISCONNECTED,e=>{this._p2pChannel.isP2PDisconnected()?e(!0):this._p2pChannel.hasLocalMedia()||this._p2pChannel.hasRemoteMedia()?e(!1):e(!0)}),this._gateway.on(_t.NEED_RENEW_SESSION,()=>{this._startSession()}),this._gateway.on(_t.REQUEST_P2P_CONNECTION_PARAMS,async(e,t,n)=>{try{t(await this._p2pChannel.startP2PConnection(e))}catch(r){n(r)}}),this._gateway.on(_t.JOIN_RESPONSE,(e,t)=>{const{dtlsParameters:n,iceParameters:r,candidates:o,rtpCapabilities:a,setup:d,cname:u}=vO(e.ortc,t);this._p2pChannel.connect(r,n,o,a,d,u)}),this._gateway.on(_t.REQUEST_DC_CONNECTION_PARAMS,e=>{e(this._p2pChannel.getEstablishParams())}),this._gateway.on(_t.RESET_SIGNAL,e=>{this._p2pChannel.resetConnection(e),this._handleGatewaySignalEvents()}),this._gateway.on(_t.DATACHANNEL_FAILBACK,()=>{this._joinGateway()}),this._gateway.on(_t.DATACHANNEL_PRECONNECT,async(e,t,n,r)=>{var o,a,d,u,h,m;await this._p2pChannel.startP2PConnection({turnServer:(o=this._joinInfo)===null||o===void 0?void 0:o.turnServer},!0);const f=function(E,T){let R;return T&&T.ip&&typeof T.port=="number"?(R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip,port:T.port.toString(),type:"host",extension:{}}],v.debug("Using remote candidate from AP ".concat(T.ip,":").concat(T.port)),T.ip6&&(R.push({foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:T.ip6,port:T.port.toString(),type:"host",extension:{}}),v.debug("Using IPV6 remote candidate from AP ".concat(T.ip6,":").concat(T.port)))):R=[{foundation:"udpcandidate",componentId:"1",transport:"udp",priority:"2103266323",connectionAddress:E.ip,port:E.port.toString(),type:"host",extension:{}}],R}(e,t);return this._p2pChannel.preConnect({iceUfrag:"".concat((a=this._joinInfo)===null||a===void 0?void 0:a.apResponse.cid,"_").concat((d=this._joinInfo)===null||d===void 0?void 0:d.apResponse.cert),icePwd:"".concat((u=this._joinInfo)===null||u===void 0?void 0:u.apResponse.cid,"_").concat((h=this._joinInfo)===null||h===void 0?void 0:h.apResponse.cert)},{fingerprints:[{hashFunction:"sha-256",fingerprint:(m=k("FINGERPRINT"))!==null&&m!==void 0?m:e.fingerprint}]},f,{send:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]},recv:{audioCodecs:[],videoCodecs:[],audioExtensions:[],videoExtensions:[]}},"active","o/i14u9pJrxRKAsu").then(n).catch(r)})}_handleGatewaySignalEvents(){this._gateway.signal.on(Pe.ON_USER_ONLINE,this._handleUserOnline),this._gateway.signal.on(Pe.ON_USER_OFFLINE,this._handleUserOffline),this._gateway.signal.on(Pe.ON_ADD_AUDIO_STREAM,e=>this._handleAddAudioOrVideoStream("audio",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc)),this._gateway.signal.on(Pe.ON_ADD_VIDEO_STREAM,e=>this._handleAddAudioOrVideoStream("video",e.uid,e.ssrcId,e.cname,e.uint_id,e.ortc,e.rtxSsrcId)),this._gateway.signal.on(Pe.ON_REMOVE_STREAM,this._handleRemoveStream),this._gateway.signal.on(Pe.ON_P2P_LOST,this._handleP2PLost),this._gateway.signal.on(Pe.MUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!0)),this._gateway.signal.on(Pe.UNMUTE_AUDIO,e=>this._handleMuteStream(e.uid,"audio",!1)),this._gateway.signal.on(Pe.MUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!0)),this._gateway.signal.on(Pe.UNMUTE_VIDEO,e=>this._handleMuteStream(e.uid,"video",!1)),this._gateway.signal.on(Pe.RECEIVE_METADATA,e=>{const t=aE(e.metadata);this.safeEmit(Me.RECEIVE_METADATA,e.uid,t)}),this._gateway.signal.on(Pe.ON_DATA_STREAM,e=>{e.seq&&delete e.seq,e.payload=aE(e.payload),this.safeEmit(Me.STREAM_MESSAGE,e.uid,e.payload),this.onStreamMessage&&this.onStreamMessage(e)}),this._gateway.signal.on(Pe.ON_CRYPT_ERROR,()=>{nd(()=>{v.warning("[".concat(this._clientId,"] on crypt error")),this.safeEmit(Me.CRYPT_ERROR)},this._sessionId)}),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_WILL_EXPIRE,this._handleTokenWillExpire),this._gateway.signal.on(Pe.ON_TOKEN_PRIVILEGE_DID_EXPIRE,()=>{v.warning("[".concat(this._clientId,"] received message onTokenPrivilegeDidExpire, please get new token and join again")),this._gateway.leave(!0),this.safeEmit(Me.ON_TOKEN_PRIVILEGE_DID_EXPIRE),this._reset()}),this._gateway.signal.on(Pe.ON_STREAM_FALLBACK_UPDATE,e=>{v.debug("[".concat(this._clientId,"] stream fallback peerId: ").concat(e.stream_id,", attr: ").concat(e.stream_type)),this.safeEmit(Me.STREAM_FALLBACK,e.stream_id,e.stream_type===1?"fallback":"recover")}),this._gateway.signal.on(Pe.ON_PUBLISH_STREAM,e=>{this.uid===this._uid&&(this._p2pChannel.reportPublishEvent(!0,null,void 0,!1,JSON.stringify({proxy:e.proxy})),v.info("[".concat(this._clientId,"] on publish stream, ").concat(JSON.stringify(e))))}),this._gateway.signal.on(Pe.ENABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!0)}),this._gateway.signal.on(Pe.DISABLE_LOCAL_VIDEO,e=>{this._handleSetStreamLocalEnable("video",e.uid,!1)}),this._gateway.signal.on(Ee.REQUEST_TIMEOUT,(e,t)=>{if(this._joinInfo)switch(e){case ye.PUBLISH:{if(!t)return;const d=(t=t).ortc;if(d){var n,r,o,a;const u=d.some(f=>{let{stream_type:E}=f;return E===Wt.Audio}),h=d.some(f=>{let{stream_type:E}=f;return E!==Wt.Audio}),m=d.some(f=>{let{stream_type:E}=f;return E===Wt.Screen||E===Wt.ScreenLow});t.state==="offer"&&he.publish(this._joinInfo.sid,{eventElapse:zr.measureFromPublishStart(this.store.clientId,this.store.pubId),succ:!1,ec:I.TIMEOUT,audio:u,video:h,p2pid:t.p2p_id,publishRequestid:this.store.pubId,screenshare:m,audioName:u?(n=d.find(f=>{let{stream_type:E}=f;return E===Wt.Audio}))===null||n===void 0||(r=n.ssrcs[0])===null||r===void 0?void 0:r.ssrcId.toString():void 0,videoName:h?(o=d.find(f=>{let{stream_type:E}=f;return E!==Wt.Audio}))===null||o===void 0||(a=o.ssrcs[0])===null||a===void 0?void 0:a.ssrcId.toString():void 0})}break}case ye.SUBSCRIBE:(t=t)&&he.subscribe(this._joinInfo.sid,{succ:!1,ec:I.TIMEOUT,audio:t.stream_type===be.AUDIO,video:t.stream_type===be.VIDEO,peerid:t.stream_id,subscribeRequestid:t.ssrcId,p2pid:this.store.p2pId,eventElapse:zr.measureFromSubscribeStart(this.store.clientId,t.ssrcId)})}}),this._gateway.signal.on(Pe.ON_P2P_OK,e=>{this.uid,this._uid}),this._gateway.signal.on(Pe.ON_PUBLISHED_USER_LIST,e=>{if(e==null||!e.users)return;k("BLOCK_LOCAL_CLIENT")&&(e.users=e.users.filter(r=>!Gs(r.audio_ssrc,this.channelName)));const t=[],n=[];for(const r of e.users){let o=this._users.find(m=>m.uid===r.stream_id);o?o._trust_in_room_=!0:(o=new EE(r.stream_id,r.stream_id),this._users.push(o),this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(v.debug("[".concat(this._clientId,"] user online"),r.stream_id),this.safeEmit(Me.USER_JOINED,o)));const a=Ut.Audio&r.stream_type,d=(Ut.Video|Ut.LwoVideo)&r.stream_type,u=a&&o.hasAudio,h=d&&o.hasVideo;d&&(o._trust_video_stream_added_state_=!0,o._video_added_=!0,o._videoSSRC=r.video_ssrc,o._rtxSsrcId=r.video_rtx),a&&(o._trust_audio_stream_added_state_=!0,o._audio_added_=!0,o._audioSSRC=r.audio_ssrc),a&&!u&&this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published audio")),this.safeEmit(Me.USER_PUBLISHED,o,"audio")),d&&!h&&this.getListeners(Me.PUBLISHED_USER_LIST).length===0&&(v.info("[".concat(this._clientId,"] remote user ").concat(o.uid," published video")),this.safeEmit(Me.USER_PUBLISHED,o,"video")),(a&&!u||d&&!h)&&t.push(o),d&&this._p2pChannel.hasPendingRemoteMedia(o,"video")&&n.push({user:o,mediaType:"video"}),a&&this._p2pChannel.hasPendingRemoteMedia(o,"audio")&&n.push({user:o,mediaType:"audio"})}n.length>0&&(v.debug("[".concat(this._clientId,"] RE massSubscribe after reconnect ").concat(n.map(r=>"user: ".concat(r.user.uid,", mediaType: ").concat(r.mediaType)).join("; ")," ")),this.massSubscribe(n).catch(r=>{v.error("[".concat(this._clientId,"] mass resubscribe error"),r.toString())})),this.getListeners(Me.PUBLISHED_USER_LIST).length>0?(v.info("[".concat(this._clientId,"] client emit user-list event, users: ").concat(t.map(r=>r.uid).join(", "))),this.safeEmit(Me.PUBLISHED_USER_LIST,t)):v.info("[".concat(this._clientId,"] client not emit user-list event case there is no user-list listener, users: ").concat(t.map(r=>r.uid).join(", ")))})}_handleP2PChannelEvents(){this._p2pChannel.on(Be.RequestMuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.muteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===I.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Be.RequestUnmuteLocal,async(e,t,n)=>{if(this._joinInfo)try{await this._gateway.unmuteLocal(e,this._joinInfo.stringUid||this._joinInfo.uid),t()}catch(r){r.code===I.DISCONNECT_P2P?t():n(r)}else t()}),this._p2pChannel.on(Be.RequestRePublish,(e,t,n)=>{this.publish(e,!1).then(t).catch(n)}),this._p2pChannel.on(Be.RequestReSubscribe,async(e,t,n)=>{try{for(const{user:r,kind:o}of e)o===be.VIDEO?await this.subscribe(r,"video"):await this.subscribe(r,"audio");t()}catch(r){n(r)}}),this._p2pChannel.on(Be.RequestUploadStats,(e,t)=>{this._gateway.uploadStats(e,t)}),this._p2pChannel.on(Be.MediaReconnectStart,e=>{this.safeEmit(Me.MEDIA_RECONNECT_START,e)}),this._p2pChannel.on(Be.MediaReconnectEnd,e=>{this.safeEmit(Me.MEDIA_RECONNECT_END,e)}),this._p2pChannel.on(Be.NeedSignalRTT,e=>{e(this._gateway.getSignalRTT())}),this._p2pChannel.on(Be.RequestRestartICE,async e=>{const t=await this._p2pChannel.restartICE(e),n=await t.next();if(n.done)return;const r=n.value;let o;try{o=await this._gateway.restartICE({iceParameters:r})}catch(d){return void t.throw(d)}const{iceParameters:a}=function(d){const u=d.iceParameters;return{iceParameters:{iceUfrag:u.iceUfrag,icePwd:u.icePwd}}}(o);await t.next({remoteIceParameters:a})}),this._p2pChannel.on(Be.RequestReconnect,async()=>{this._gateway.reconnect()}),this._p2pChannel.on(Be.RequestReconnectPC,async()=>{var e;const{iceParameters:t,dtlsParameters:n,rtpCapabilities:r}=await this._p2pChannel.startP2PConnection({turnServer:(e=this._joinInfo)===null||e===void 0?void 0:e.turnServer}),{gatewayEstablishParams:o,gatewayAddress:a}=await this._gateway.reconnectPC({iceParameters:t,dtlsParameters:n,rtpCapabilities:r}),{dtlsParameters:d,iceParameters:u,candidates:h,rtpCapabilities:m,setup:f,cname:E}=vO(o,a);await this._p2pChannel.connect(u,d,h,m,f,E),await this._p2pChannel.republish(),await this._p2pChannel.reSubscribe()}),this._p2pChannel.on(Be.RequestUnpublishForReconnectPC,async(e,t,n)=>{this._joinInfo&&this._uid!==void 0?(await this._gateway.unpublish(e,this._uid),t()):n()}),this._p2pChannel.on(Be.P2PLost,()=>{this.safeEmit(Me.P2P_LOST,this.store.uid)}),this._p2pChannel.on(Be.UpdateVideoEncoder,e=>{e._encoderConfig&&this._gateway.setVideoProfile(e._encoderConfig)}),this._p2pChannel.on(Be.ConnectionTypeChange,e=>{this.safeEmit(Me.IS_USING_CLOUD_PROXY,e)}),this._p2pChannel.on(Be.RequestLowStreamParameter,e=>{e(this._lowStreamParameter||{width:160,height:120,framerate:15,bitrate:50})}),this._p2pChannel.on(Be.QueryClientConnectionState,e=>{e(this.connectionState)})}getKeyMetrics(){return this.store.keyMetrics}async enableContentInspect(e){if(this.connectionState!=="CONNECTED"||!this._joinInfo)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Client did not join channel"));if(this._inspect)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] Inspect content service already in connecting/connected state"));if(!e)throw new b(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig is necessary"));if(!e.inspectType||!Array.isArray(e.inspectType))throw new b(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.inspectType is necessary and is an instance of Array."));{const t=[...new Set(e.inspectType)];t.forEach(n=>{if(!["supervise","moderation"].includes(n))throw new b(I.INVALID_PARAMS,"[".concat(this._clientId,"] ").concat(n," is not a valid inspect type."))}),e.inspectType=t}if(e&&e.extraInfo&&e.extraInfo.length>1024)throw new b(I.INVALID_PARAMS,"[".concat(this._clientId,"] inspectConfig.extraInfo length cannot exceed 1024 bytes"));try{const t=new Yu(e);this._inspect=t,this.handleVideoInspectEvents(this._inspect),await t.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},kt)}catch(t){throw Array.isArray(t)?t[0]:t}}async disableContentInspect(){if(!this._inspect)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] inspectVideoContent not started"));try{this._inspect.close(),this._inspect=void 0}catch(e){throw Array.isArray(e)?e[0]:e}}async setImageModeration(e,t){if(Ma(e,"enabled"),e){if(!t)throw new b(I.INVALID_PARAMS,"[".concat(this._clientId,"] config is necessary"));if(st(t.interval,"interval",1e3,1/0),this.connectionState!=="CONNECTED"||!this._joinInfo)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,'] can not enable image moderation, not joined"'));try{if(this._moderation)return void this._moderation.updateConfig(t);const n=new $E(t);this._moderation=n,this.handleImageModerationEvents(this._moderation),await n.init({appId:this._joinInfo.appId,areaCode:"",cname:this._joinInfo.cname,sid:this._joinInfo.sid,token:this._joinInfo.token,uid:this._joinInfo.uid,cid:this._joinInfo.cid,vid:this._joinInfo.vid?Number(this._joinInfo.vid):0},kt)}catch(n){throw Array.isArray(n)?n[0]:n}}else{if(!this._moderation)throw new b(I.INVALID_OPERATION,"[".concat(this._clientId,"] image moderation not started"));try{this._moderation.close(),this._moderation.removeAllListeners(),this._moderation=void 0}catch(n){throw Array.isArray(n)?n[0]:n}}}handleImageModerationEvents(e){e.on(Kr.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(Me.IMAGE_MODERATION_CONNECTION_STATE_CHANGE,t,n),t){case fr.CONNECTED:if(this.connectionState!=="CONNECTED")throw this.setImageModeration(!1),new b(I.OPERATION_ABORTED,"Image moderation was cancelled because it left the channel");e.inspectImage()}}),e.on(Kr.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}handleVideoInspectEvents(e){e.on(Ht.CONNECTION_STATE_CHANGE,(t,n)=>{switch(this.emit(Me.CONTENT_INSPECT_CONNECTION_STATE_CHANGE,t,n),n){case Ar.CONNECTED:if(this.connectionState!=="CONNECTED")return void this.emit(Me.CONTENT_INSPECT_ERROR,new b(I.OPERATION_ABORTED,"Content inspect was cancelled because it left the channel"));e.inspectImage()}}),e.on(Ht.INSPECT_RESULT,(t,n)=>{var r;if((n==null?void 0:n.code)===I.INVALID_OPERATION&&this.connectionState==="DISCONNECTED")return v.debug("Stop inspect content because that has left channel"),this==null||(r=this._inspect)===null||r===void 0||r.close(),void(this._inspect=void 0);this.emit(Me.CONTENT_INSPECT_RESULT,t,n)}),e.on(Ht.CLIENT_LOCAL_VIDEO_TRACK,t=>{t(this.localTracks.filter(n=>n.trackMediaType==="video")[0])})}getJoinChannelServiceRecords(){return v.debug("getJoinChannelServiceRecords"),this.store.joinChannelServiceRecords}async setPublishAudioFilterEnabled(e){Ma(e,"enabled"),it("ENABLE_PUBLISH_AUDIO_FILTER",e),this._joinInfo&&await this._gateway.setPublishAudioFilterEnabled(e)}_handleResetAddStream(e,t){switch(t){case"audio":e._audio_added_=!1,e._trust_audio_stream_added_state_=!0;break;case"video":e._video_added_=!1,e._trust_video_stream_added_state_=!0}}}).prototype,"leave",[kw],Object.getOwnPropertyDescriptor(oe.prototype,"leave"),oe.prototype),Y(oe.prototype,"publish",[Mw],Object.getOwnPropertyDescriptor(oe.prototype,"publish"),oe.prototype),Y(oe.prototype,"unpublish",[Uw],Object.getOwnPropertyDescriptor(oe.prototype,"unpublish"),oe.prototype),Y(oe.prototype,"subscribe",[xw],Object.getOwnPropertyDescriptor(oe.prototype,"subscribe"),oe.prototype),Y(oe.prototype,"massSubscribe",[Vw],Object.getOwnPropertyDescriptor(oe.prototype,"massSubscribe"),oe.prototype),Y(oe.prototype,"unsubscribe",[Fw],Object.getOwnPropertyDescriptor(oe.prototype,"unsubscribe"),oe.prototype),Y(oe.prototype,"massUnsubscribe",[jw],Object.getOwnPropertyDescriptor(oe.prototype,"massUnsubscribe"),oe.prototype),Y(oe.prototype,"setLowStreamParameter",[Bw],Object.getOwnPropertyDescriptor(oe.prototype,"setLowStreamParameter"),oe.prototype),Y(oe.prototype,"enableDualStream",[Gw],Object.getOwnPropertyDescriptor(oe.prototype,"enableDualStream"),oe.prototype),Y(oe.prototype,"disableDualStream",[Ww],Object.getOwnPropertyDescriptor(oe.prototype,"disableDualStream"),oe.prototype),Y(oe.prototype,"setClientRole",[Hw],Object.getOwnPropertyDescriptor(oe.prototype,"setClientRole"),oe.prototype),Y(oe.prototype,"setProxyServer",[Kw],Object.getOwnPropertyDescriptor(oe.prototype,"setProxyServer"),oe.prototype),Y(oe.prototype,"setTurnServer",[zw],Object.getOwnPropertyDescriptor(oe.prototype,"setTurnServer"),oe.prototype),Y(oe.prototype,"setLicense",[Yw],Object.getOwnPropertyDescriptor(oe.prototype,"setLicense"),oe.prototype),Y(oe.prototype,"startProxyServer",[qw],Object.getOwnPropertyDescriptor(oe.prototype,"startProxyServer"),oe.prototype),Y(oe.prototype,"stopProxyServer",[Jw],Object.getOwnPropertyDescriptor(oe.prototype,"stopProxyServer"),oe.prototype),Y(oe.prototype,"setLocalAccessPointsV2",[Xw],Object.getOwnPropertyDescriptor(oe.prototype,"setLocalAccessPointsV2"),oe.prototype),Y(oe.prototype,"setLocalAccessPoints",[Qw],Object.getOwnPropertyDescriptor(oe.prototype,"setLocalAccessPoints"),oe.prototype),Y(oe.prototype,"setRemoteDefaultVideoStreamType",[$w],Object.getOwnPropertyDescriptor(oe.prototype,"setRemoteDefaultVideoStreamType"),oe.prototype),Y(oe.prototype,"setRemoteVideoStreamType",[Zw],Object.getOwnPropertyDescriptor(oe.prototype,"setRemoteVideoStreamType"),oe.prototype),Y(oe.prototype,"setStreamFallbackOption",[e0],Object.getOwnPropertyDescriptor(oe.prototype,"setStreamFallbackOption"),oe.prototype),Y(oe.prototype,"setEncryptionConfig",[t0],Object.getOwnPropertyDescriptor(oe.prototype,"setEncryptionConfig"),oe.prototype),Y(oe.prototype,"renewToken",[n0],Object.getOwnPropertyDescriptor(oe.prototype,"renewToken"),oe.prototype),Y(oe.prototype,"enableAudioVolumeIndicator",[r0],Object.getOwnPropertyDescriptor(oe.prototype,"enableAudioVolumeIndicator"),oe.prototype),Y(oe.prototype,"startLiveStreaming",[i0],Object.getOwnPropertyDescriptor(oe.prototype,"startLiveStreaming"),oe.prototype),Y(oe.prototype,"setLiveTranscoding",[o0],Object.getOwnPropertyDescriptor(oe.prototype,"setLiveTranscoding"),oe.prototype),Y(oe.prototype,"stopLiveStreaming",[s0],Object.getOwnPropertyDescriptor(oe.prototype,"stopLiveStreaming"),oe.prototype),Y(oe.prototype,"addInjectStreamUrl",[a0],Object.getOwnPropertyDescriptor(oe.prototype,"addInjectStreamUrl"),oe.prototype),Y(oe.prototype,"removeInjectStreamUrl",[c0],Object.getOwnPropertyDescriptor(oe.prototype,"removeInjectStreamUrl"),oe.prototype),Y(oe.prototype,"startChannelMediaRelay",[d0],Object.getOwnPropertyDescriptor(oe.prototype,"startChannelMediaRelay"),oe.prototype),Y(oe.prototype,"updateChannelMediaRelay",[l0],Object.getOwnPropertyDescriptor(oe.prototype,"updateChannelMediaRelay"),oe.prototype),Y(oe.prototype,"stopChannelMediaRelay",[u0],Object.getOwnPropertyDescriptor(oe.prototype,"stopChannelMediaRelay"),oe.prototype),Y(oe.prototype,"sendCustomReportMessage",[h0],Object.getOwnPropertyDescriptor(oe.prototype,"sendCustomReportMessage"),oe.prototype),Y(oe.prototype,"pickSVCLayer",[p0],Object.getOwnPropertyDescriptor(oe.prototype,"pickSVCLayer"),oe.prototype),Y(oe.prototype,"enableContentInspect",[f0],Object.getOwnPropertyDescriptor(oe.prototype,"enableContentInspect"),oe.prototype),Y(oe.prototype,"disableContentInspect",[m0],Object.getOwnPropertyDescriptor(oe.prototype,"disableContentInspect"),oe.prototype),Y(oe.prototype,"setImageModeration",[E0],Object.getOwnPropertyDescriptor(oe.prototype,"setImageModeration"),oe.prototype),Y(oe.prototype,"getJoinChannelServiceRecords",[_0],Object.getOwnPropertyDescriptor(oe.prototype,"getJoinChannelServiceRecords"),oe.prototype),Y(oe.prototype,"setPublishAudioFilterEnabled",[g0],Object.getOwnPropertyDescriptor(oe.prototype,"setPublishAudioFilterEnabled"),oe.prototype),oe);class t3 extends pC{set currentState(t){t!==this._currentState&&(this._currentState=t,this.safeEmit(tr.AUDIO_SOURCE_STATE_CHANGE,this._currentState))}get currentState(){return this._currentState}constructor(t){let n=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};super(),g(this,"audioBuffer",void 0),g(this,"sourceNode",void 0),g(this,"startPlayTime",0),g(this,"startPlayOffset",0),g(this,"pausePlayTime",0),g(this,"options",void 0),g(this,"currentLoopCount",0),g(this,"currentPlaybackSpeed",100),g(this,"_currentState","stopped"),this.audioBuffer=t,this.options=n,this.startPlayOffset=this.options.startPlayTime||0}createWebAudioDiagram(){return this.context.createGain()}get duration(){return this.audioBuffer.duration}get playbackSpeed(){return this.currentPlaybackSpeed}get currentTime(){return this.currentState==="stopped"?0:this.currentState==="paused"?this.pausePlayTime:((this.context.currentTime-this.startPlayTime)*(this.playbackSpeed/100)+this.startPlayOffset)%this.audioBuffer.duration}updateOptions(t){this.currentState==="stopped"?(this.options=t,this.startPlayOffset=this.options.startPlayTime||0):v.warning("can not set audio source options")}startProcessAudioBuffer(){this.sourceNode&&this.stopProcessAudioBuffer(),this.sourceNode=this.createSourceNode(),this.startSourceNode(),this.currentState="playing"}pauseProcessAudioBuffer(){this.sourceNode&&this.currentState==="playing"&&(this.pausePlayTime=this.currentTime,this.sourceNode.onended=null,this.sourceNode.stop(),this.sourceNode.buffer=null,this.sourceNode=this.createSourceNode(),this.currentState="paused")}seekAudioBuffer(t){this.sourceNode&&(this.sourceNode.onended=null,this.currentState==="playing"&&this.sourceNode.stop(),this.sourceNode=this.createSourceNode(),this.currentState==="playing"?(this.startPlayOffset=t,this.startSourceNode()):this.currentState==="paused"&&(this.pausePlayTime=t))}resumeProcessAudioBuffer(){this.currentState==="paused"&&this.sourceNode&&(this.startPlayOffset=this.pausePlayTime,this.pausePlayTime=0,this.startSourceNode(),this.currentState="playing")}stopProcessAudioBuffer(){if(this.sourceNode){this.sourceNode.onended=null;try{this.sourceNode.stop()}catch{}this.reset()}}setAudioBufferPlaybackSpeed(t){this.sourceNode&&(this.currentState==="playing"&&(this.startPlayOffset=this.currentTime,this.startPlayTime=this.context.currentTime),this.sourceNode.playbackRate.value=t/100),this.currentPlaybackSpeed=t}startSourceNode(){this.sourceNode&&this.sourceNode.buffer&&(this.sourceNode.start(0,this.startPlayOffset),this.startPlayTime=this.context.currentTime,this.sourceNode.onended=this.handleSourceNodeEnded.bind(this))}createSourceNode(){const t=this.context.createBufferSource();return t.buffer=this.audioBuffer,t.loop=!!this.options.loop,t.connect(this.outputNode),t.playbackRate.value=this.currentPlaybackSpeed/100,t}handleSourceNodeEnded(){if(this.currentLoopCount+=1,this.options.cycle&&this.options.cycle>this.currentLoopCount)return this.startPlayOffset=0,this.sourceNode=void 0,void this.startProcessAudioBuffer();this.reset()}reset(){this.startPlayOffset=this.options.startPlayTime||0,this.currentState="stopped",this.sourceNode&&(this.sourceNode.disconnect(),this.sourceNode=void 0),this.currentLoopCount=0}}const T0=new Map;async function n3(e,t){let n=null;if(typeof e=="string"){const o=T0.get(e);if(o)return v.debug("use cached audio resource: ",e),o;try{n=(await Ni(()=>Rr.get(e,{responseType:"arraybuffer"}),void 0,void 0,{maxRetryCount:3})).data}catch(a){throw new b(I.FETCH_AUDIO_FILE_FAILED,a.toString())}}else n=await new de((a,d)=>{const u=new FileReader;u.onload=h=>{h.target?a(h.target.result):d(new b(I.READ_LOCAL_AUDIO_FILE_ERROR))},u.onerror=()=>{d(new b(I.READ_LOCAL_AUDIO_FILE_ERROR))},u.readAsArrayBuffer(e)});const r=await function(o){const a=Ba();return new de((d,u)=>{a.decodeAudioData(o,h=>{d(h)},h=>{u(new b(I.DECODE_AUDIO_FILE_FAILED,h.toString()))})})}(n);return typeof e=="string"&&t&&T0.set(e,r),r}function v0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function Ju(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?v0(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):v0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}function ZE(e,t,n,r){n.optimizationMode&&(r&&r.width&&r.height?(n.encoderConfig=Ju(Ju({},r),{},{bitrateMin:r.bitrateMin,bitrateMax:r.bitrateMax}),n.optimizationMode!=="motion"&&n.optimizationMode!=="detail"||(t.contentHint=n.optimizationMode,t.contentHint===n.optimizationMode?v.debug("[".concat(e,"] set content hint to"),n.optimizationMode):v.debug("[".concat(e,"] set content hint failed")))):v.warning("[".concat(e,"] can not apply optimization mode bitrate config, no encoderConfig")))}const r3=qe().name;function i3(e,t,n,r){let o,a=0,d=null;return new de((u,h)=>{setTimeout(()=>{o&&(o(),u(a))},t),o=uC(()=>{(function(){a>r&&o&&(o(),u(a));const m=n.getContext("2d");if(!m){const T=new b(I.UNEXPECTED_ERROR,"can not get canvas 2d context.");return v.error(T.toString()),void h(T)}m.drawImage(e,0,0,160,120);const f=m.getImageData(0,0,n.width,n.height),E=Math.floor(f.data.length/3);if(d){for(let T=0;T<E;T+=3)if(f.data[T]!==d[T])return a+=1,void(d=f.data);d=f.data}else d=f.data})()},30)})}class gd{constructor(t,n){g(this,"id",0),g(this,"element",void 0),g(this,"peerPair",void 0),g(this,"context",void 0),g(this,"audioPlayerElement",void 0),g(this,"audioTrack",void 0),gd.count+=1,this.id=gd.count,this.element=t,this.context=n}initPeers(){this.peerPair=[new RTCPeerConnection,new RTCPeerConnection],this.peerPair[1].ontrack=t=>{const n=document.createElement("audio");n.srcObject=new MediaStream([t.track]),n.play(),this.audioPlayerElement=n}}async switchSdp(){if(!this.peerPair)return;const t=async(r,o)=>{const a=o==="offer"?await r.createOffer():await r.createAnswer();return await r.setLocalDescription(a),r.iceGatheringState==="complete"?r.localDescription:new de(d=>{r.onicegatheringstatechange=()=>{r.iceGatheringState==="complete"&&d(r.localDescription)}})},n=async(r,o)=>await r.setRemoteDescription(o);try{const r=await t(this.peerPair[0],"offer");await n(this.peerPair[1],r);const o=await t(this.peerPair[1],"answer");await n(this.peerPair[0],o)}catch(r){throw new b(I.LOCAL_AEC_ERROR,r.toString()).print()}}async getTracksFromMediaElement(t){if(this.audioTrack)return this.audioTrack;let n;try{t instanceof HTMLVideoElement&&(t.captureStream?t.captureStream():t.mozCaptureStream()),n=this.context.createMediaStreamDestination(),this.context.createMediaElementSource(t).connect(n)}catch(o){throw new b(I.LOCAL_AEC_ERROR,o.toString()).print()}if(!n)throw new b(I.LOCAL_AEC_ERROR,"no dest node when local aec").print();const r=n.stream.getAudioTracks()[0];return this.audioTrack=r,r}getElement(){return this.element}async startEchoCancellation(){this.context.resume(),this.peerPair&&this.close(),this.initPeers();const t=this.element,n=await this.getTracksFromMediaElement(t);this.peerPair&&this.peerPair[0].addTrack(n),await this.switchSdp()}close(){v.debug("close echo cancellation unit, id is",this.id),this.audioPlayerElement&&this.audioPlayerElement.pause(),this.peerPair&&this.peerPair.forEach(t=>{t.close()}),this.peerPair=void 0,this.audioPlayerElement=void 0}}var y0,Xu;g(gd,"count",0);const o3=window.AudioContext||window.webkitAudioContext,s3=new(y0=Te({report:he}),Y((Xu=class{constructor(){g(this,"units",[]),g(this,"context",void 0)}processExternalMediaAEC(e){if(!this._doesEnvironmentNeedAEC())return v.debug("the system does not need to process local aec"),-1;this.context||(this.context=new o3);let t=this.units.find(n=>n&&n.getElement()===e);return t||(t=new gd(e,this.context),this.units.push(t)),t.startEchoCancellation(),v.debug("start processing local audio echo cancellation, id is",t.id),t.id}_doesEnvironmentNeedAEC(){return qe().name!==Ze.SAFARI}}).prototype,"processExternalMediaAEC",[y0],Object.getOwnPropertyDescriptor(Xu.prototype,"processExternalMediaAEC"),Xu.prototype),Xu);function R0(e,t){var n=Object.keys(e);if(Object.getOwnPropertySymbols){var r=Object.getOwnPropertySymbols(e);t&&(r=r.filter(function(o){return Object.getOwnPropertyDescriptor(e,o).enumerable})),n.push.apply(n,r)}return n}function C0(e){for(var t=1;t<arguments.length;t++){var n=arguments[t]!=null?arguments[t]:{};t%2?R0(Object(n),!0).forEach(function(r){g(e,r,n[r])}):Object.getOwnPropertyDescriptors?Object.defineProperties(e,Object.getOwnPropertyDescriptors(n)):R0(Object(n)).forEach(function(r){Object.defineProperty(e,r,Object.getOwnPropertyDescriptor(n,r))})}return e}const e_=window||document;function I0(e){let t=arguments.length>1&&arguments[1]!==void 0&&arguments[1];if(!e_)return;const n=qt._cspEventHandlerPointer;if(n&&t)return void console.error(n,t);const r=o=>{if(!(o&&o.blockedURI&&(qt.onSecurityPolicyViolation||qt.getListeners(Pi.SECURITY_POLICY_VIOLATION).length>0)))return;const a=o.blockedURI;k("CSP_DETECTED_HOSTNAME_LIST").some(d=>a.includes(d))&&(qt.onSecurityPolicyViolation&&typeof qt.onSecurityPolicyViolation=="function"&&qt.onSecurityPolicyViolation(o),qt.getListeners(Pi.SECURITY_POLICY_VIOLATION).length>0&&qt.safeEmit(Pi.SECURITY_POLICY_VIOLATION,o))};n&&e_.removeEventListener("securitypolicyviolation",n),(t||e&&typeof e=="function"||qt.getListeners(Pi.SECURITY_POLICY_VIOLATION).length>0)&&e_.addEventListener("securitypolicyviolation",r),qt._cspEventHandlerPointer=r}it("PROCESS_ID","process-".concat(ut(8,""),"-").concat(ut(4,""),"-").concat(ut(4,""),"-").concat(ut(4,""),"-").concat(ut(12,""))),function(){const e=qe();wn.getDisplayMedia=function(t){return!!(navigator.mediaDevices&&navigator.mediaDevices.getDisplayMedia)}(),wn.getStreamFromExtension=e.name===Ze.CHROME&&Number(e.version)>34,wn.supportUnifiedPlan=function(){if(!window.RTCRtpTransceiver||!("currentDirection"in RTCRtpTransceiver.prototype))return!1;const t=new RTCPeerConnection;let n=!1;try{t.addTransceiver("audio"),n=!0}catch{}return t.close(),n}(),wn.supportMinBitrate=e.name===Ze.CHROME||e.name===Ze.EDGE,wn.supportSetRtpSenderParameters=function(){const t=qe();return!window.RTCRtpSender||!window.RTCRtpSender.prototype.setParameters||!window.RTCRtpSender.prototype.getParameters?!1:!!xs()||!(!kn()&&!tu())||t.name===Ze.FIREFOX&&Number(t.version)>=64}(),e.name===Ze.SAFARI&&(Number(e.version)>=14?wn.supportDualStream=!0:wn.supportDualStream=!1),wn.webAudioMediaStreamDest=function(){const t=qe();return!(t.name===Ze.SAFARI&&Number(t.version)<12)}(),wn.supportReplaceTrack=function(){return window.RTCRtpSender?typeof RTCRtpSender.prototype.replaceTrack=="function":!1}(),wn.supportWebGL=typeof WebGLRenderingContext<"u",wn.supportRequestFrame=!!window.CanvasCaptureMediaStreamTrack,xs()||(wn.webAudioWithAEC=!0),wn.supportShareAudio=function(){const t=qe();return(t.os===En.WIN_10||t.os===En.WIN_81||t.os===En.WIN_7||t.os===En.LINUX||t.os===En.MAC_OS)&&t.name===Ze.CHROME&&Number(t.version)>=74}(),wn.supportDualStreamEncoding=function(){const t=qe();return k("DISABLE_WEBAUDIO")?!0:t.name==="Safari"&&Number(t.version)>=14||!!(t.name==="Chrome"&&/Windows/i.test(t.os||"")&&Number(t.version)>=100&&k("CHROME_DUAL_STREAM_USE_ENCODING"))}(),wn.supportDataChannel=function(){return!!(nm(76)||function(t){const n=qe();return!(n.name!==Ze.FIREFOX||!n.osVersion)&&Number(n.version)>=t}(68)||function(t){const n=qe();return!(n.name!==Ze.SAFARI||!n.osVersion)&&Number(n.version)>=t}(14))}(),wn.supportPCSetConfiguration=function(){const t=window.RTCPeerConnection;return!Tt()&&!!t&&t.prototype.setConfiguration instanceof Function}(),wn.supportWebRTCEncodedTransform=function(){const t=qe();return t.name==="Chrome"&&Number(t.version)>=86}(),v.info("browser compatibility",JSON.stringify(wn),JSON.stringify(e))}(),function(){let e;try{e=window.localStorage.getItem("websdk_ng_global_parameter")}catch(t){return void v.error("Error loading sdk config",t.message)}if(e)try{const t=JSON.parse(window.atob(e)),n=Date.now();v.debug("Loading global parameters from cache",t),Object.keys(t).forEach(r=>{if(Object.prototype.hasOwnProperty.call(er,r)){const{value:o,expires:a}=t[r];if(a&&a<=n)return;js[r]=o,er[r]=o}})}catch(t){v.error("Error loading mutableParamsCache: ".concat(e),t.message)}}(),Array.isArray(js.AREAS)&&js.AREAS.length>0&&lE(js.AREAS,!0);const qt=function(e){const t=new gt,n=e,r={getListeners:t.getListeners.bind(t),on:(o,a)=>(function(d,u){d===Pi.SECURITY_POLICY_VIOLATION&&I0(u,!0)}(o,a),t.on.bind(t)(o,a)),addListener:t.addListener.bind(t),once:t.once.bind(t),off:t.off.bind(t),removeAllListeners:t.removeAllListeners.bind(t),emit:t.emit.bind(t),safeEmit:t.safeEmit.bind(t)};return C0(C0({},n),r)}({__CLIENT_LIST__:Bs,__TRACK_LIST__:Xc,VERSION:Hr,BUILD:vm,setParameter:(e,t,n)=>{v.debug("setParameter key:".concat(e,", value:").concat(JSON.stringify(t))),it(e,t,n)},getParameter:k,getSupportedCodec:async function(){let e={audio:[],video:[]};try{let t=new RTCPeerConnection;t.addTransceiver("video",{direction:"recvonly"}),t.addTransceiver("audio",{direction:"recvonly"});const n=(await t.createOffer()).sdp;if(!n)return e;t.close(),t=null,e=function(r){const o={video:[],audio:[]};return r.match(/ VP8/i)&&o.video.push("VP8"),r.match(/ VP9/i)&&o.video.push("VP9"),r.match(/ AV1/i)&&o.video.push("AV1"),r.match(/ H264/i)&&o.video.push("H264"),r.match(/ H265/i)&&o.video.push("H265"),r.match(/ opus/i)&&o.audio.push("OPUS"),r.match(/ PCMU/i)&&o.audio.push("PCMU"),r.match(/ PCMA/i)&&o.audio.push("PCMA"),r.match(/ G722/i)&&o.audio.push("G722"),o}(n)}catch(t){throw new b(I.CREATE_OFFER_FAILED,t.toString&&t.toString()).print()}return e},checkSystemRequirements:function(){const e=he.reportApiInvoke(null,{name:Mt.CHECK_SYSTEM_REQUIREMENTS,options:[],tag:Et.TRACER});let t=!1;try{const a=window.RTCPeerConnection,d=navigator.mediaDevices&&navigator.mediaDevices.getUserMedia,u=window.WebSocket;t=!!(a&&d&&u)}catch(a){return v.error("check system requirement failed: ",a),!1}let n=!1;const r=qe();r.name===Ze.CHROME&&Number(r.version)>=58&&(!u2()||l2())&&(n=!0),r.name===Ze.FIREFOX&&Number(r.version)>=56&&(n=!0),r.name===Ze.OPERA&&Number(r.version)>=45&&(n=!0),r.name===Ze.SAFARI&&Number(r.version)>=11&&(n=!0),(xy()||qe().name===Ze.QQ)&&(n=!0),v.debug("checkSystemRequirements, api:",t,"browser",n);const o=t&&n;return e.onSuccess(o),o},getDevices:function(e){return br.enumerateDevices(!0,!0,e)},getMicrophones:function(e){return br.getRecordingDevices(e)},getCameras:function(e){return br.getCamerasDevices(e)},getElectronScreenSources:mC,getPlaybackDevices:function(e){return br.getSpeakers(e)},createClient:function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{codec:"vp8",audioCodec:"opus",mode:"rtc"};const t=he.reportApiInvoke(null,{name:Mt.CREATE_CLIENT,options:[e],tag:Et.TRACER});try{jV(e)}catch(n){throw t.onError(n),n}return e.audioCodec===void 0&&(e.audioCodec="opus"),t.onSuccess(),new e3(_d(_d({forceWaitGatewayResponse:!0},e),{},{role:e.mode==="rtc"?"host":e.role||"audience"}))},createCameraVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_CAM_VIDEO_TRACK,options:[Ju({},e)]}),n=Du(e),r=ut(8,"track-cam-");let o=null;v.info("start create camera video track with config",JSON.stringify(e),"trackId",r);try{o=(await di({video:n},r)).getVideoTracks()[0]||null}catch(d){throw t.onError(d),d}if(!o){const d=new b(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}e.optimizationMode&&ZE(r,o,e,Fs(e.encoderConfig));const a=new FA(o,e,n,e.scalabiltyMode?pu(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,r);return t.onSuccess(a.getTrackId()),v.info("create camera video success, trackId:",r),a},createCustomVideoTrack:function(e){const t=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_CUSTOM_VIDEO_TRACK,options:[e]}),n=new Ft(e.mediaStreamTrack,{width:e.width,height:e.height,frameRate:e.frameRate,bitrateMax:e.bitrateMax,bitrateMin:e.bitrateMin},e.scalabiltyMode?pu(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,ut(8,"track-cus-"),[zt.CUSTOM_TRACK]);return t.onSuccess(n.getTrackId()),v.info("create custom video track success with config",e,"trackId",n.getTrackId()),n},createScreenVideoTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:"disable";const n=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_SCREEN_VIDEO_TRACK,options:[Ju({},e),t]});e.encoderConfig?typeof e.encoderConfig=="string"||e.encoderConfig.width&&e.encoderConfig.height||(e.encoderConfig.width={max:1920},e.encoderConfig.height={max:1080}):e.encoderConfig="1080p_2";const r=bj(e),o=ut(8,"track-scr-v-");let a=null,d=null;const u=bt();if(!u.supportShareAudio&&t==="enable"){const f=new b(I.NOT_SUPPORTED,"your browser or platform is not support share-screen with audio");return n.onError(f),f.throw()}v.info("start create screen video track with config",e,"withAudio",t,"trackId",o);try{const f=await di({screen:r,screenAudio:t==="auto"?u.supportShareAudio:t==="enable"},o);a=f.getVideoTracks()[0]||null,d=f.getAudioTracks()[0]||null}catch(f){throw n.onError(f),f}if(!a){const f=new b(I.UNEXPECTED_ERROR,"can not find track in media stream");return n.onError(f),f.throw()}if(!d&&t==="enable"){a&&a.stop();const f=new b(I.SHARE_AUDIO_NOT_ALLOWED);return n.onError(f),f.throw()}e.optimizationMode||(e.optimizationMode="detail"),e.optimizationMode&&(ZE(o,a,e,e.encoderConfig&&Rm(e.encoderConfig)),e.encoderConfig&&typeof e.encoderConfig!="string"&&(e.encoderConfig.bitrateMin=e.encoderConfig.bitrateMax));const h=new Ft(a,e.encoderConfig?Rm(e.encoderConfig):{},e.scalabiltyMode?pu(e.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},e.optimizationMode,o,[zt.SCREEN_TRACK]);if(!d)return n.onSuccess(h.getTrackId()),v.info("create screen video track success","video:",h.getTrackId()),h;const m=new yn(d,void 0,ut(8,"track-scr-a-"),!1,!0);return n.onSuccess([h.getTrackId(),m.getTrackId()]),v.info("create screen video track success","video:",h.getTrackId(),"audio:",m.getTrackId()),[h,m]},createMicrophoneAndCameraTracks:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{},t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:{};const n=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_MIC_AND_CAM_TRACKS,options:[e,t]}),r=Du(t),o=iA(e),a=ut(8,"track-mic-"),d=ut(8,"track-cam-");let u=null,h=null;v.info("start create camera video track(".concat(d,") and microphone audio track(").concat(a,") with config, audio: ").concat(JSON.stringify(e),", video: ").concat(JSON.stringify(t)));try{const E=await di({audio:o,video:r},"".concat(a,"-").concat(d));u=E.getAudioTracks()[0],h=E.getVideoTracks()[0]}catch(E){throw n.onError(E),E}if(!u||!h){const E=new b(I.UNEXPECTED_ERROR,"can not find tracks in media stream");return n.onError(E),E.throw()}t.optimizationMode&&ZE(d,h,t,Fs(t.encoderConfig));const m=new yu(u,e,o,a),f=new FA(h,t,r,t.scalabiltyMode?pu(t.scalabiltyMode):{numSpatialLayers:1,numTemporalLayers:1},t.optimizationMode,d);return n.onSuccess([m.getTrackId(),f.getTrackId()]),v.info("create camera video track(".concat(d,") and microphone audio track(").concat(a,") success")),[m,f]},createMicrophoneAudioTrack:async function(){let e=arguments.length>0&&arguments[0]!==void 0?arguments[0]:{};const t=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_MIC_AUDIO_TRACK,options:[e]}),n=iA(e),r=ut(8,"track-mic-");let o=null;v.info("start create microphone audio track with config",JSON.stringify(e),"trackId",r);try{o=(await di({audio:n},r)).getAudioTracks()[0]||null}catch(d){throw t.onError(d),d}if(!o){const d=new b(I.UNEXPECTED_ERROR,"can not find track in media stream");return t.onError(d),d.throw()}const a=new yu(o,e,n,r);return t.onSuccess(a.getTrackId()),v.info("create microphone audio track success, trackId:",r),a},createCustomAudioTrack:function(e){const t=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_CUSTOM_AUDIO_TRACK,options:[e]}),n=new yn(e.mediaStreamTrack,e.encoderConfig?fu(e.encoderConfig):{},ut(8,"track-cus-"),!1,!0);return v.info("create custom audio track success with config",e,"trackId",n.getTrackId()),t.onSuccess(n.getTrackId()),n},createBufferSourceAudioTrack:async function(e){const t=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CREATE_BUFFER_AUDIO_TRACK,options:[e]});if(k("DISABLE_WEBAUDIO"))throw new b(I.NOT_SUPPORTED,"can not create BufferSourceAudioTrack when WebAudio disabled");const n=ut(8,"track-buf-");v.info("start create buffer source audio track with config",JSON.stringify(e),"trackId",n);const r=e.source;if(!(e.source instanceof AudioBuffer))try{e.source=await n3(e.source,e.cacheOnlineFile)}catch(d){return t.onError(d),d.throw()}const o=new t3(e.source),a=new aj(r,o,e.encoderConfig?fu(e.encoderConfig):{},n);return v.info("create buffer source audio track success, trackId:",n),t.onSuccess(a.getTrackId()),a},setAppType:function(e){if(v.debug("setAppType: ".concat(e)),!(Number.isInteger(e)&&e>=0))throw v.debug("Invalid appType"),new b(I.INVALID_PARAMS,"invalid app type",e);it("APP_TYPE",Math.floor(e))},setLogLevel:function(e){v.setLogLevel(e)},enableLogUpload:function(){k("USE_NEW_LOG")?it("UPLOAD_LOG",!0):v.enableLogUpload()},disableLogUpload:function(){k("USE_NEW_LOG")?it("UPLOAD_LOG",!1):v.disableLogUpload()},createChannelMediaRelayConfiguration:function(){return new QI},checkAudioTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CHECK_AUDIO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof yn||e instanceof Wu)){const h=new b(I.INVALID_TRACK,"the parameter is not a audio track");return n.onError(h),h.throw()}t&&t<1e3&&(t=1e3);const r=e instanceof yn?e.getTrackLabel():"remote_track",o=e.getVolumeLevel();let a=o,d=o;const u=Date.now();return new de(h=>{const m=setInterval(()=>{const f=e.getVolumeLevel();a=f>a?f:a,d=f<d?f:d;const E=a-d>1e-4,T=Date.now()-u;if(E||T>t){clearInterval(m);const R=E,A={duration:T,deviceLabel:r,maxVolumeLevel:a,result:R};v.info("[track-".concat(e.getTrackId(),"] check audio track active completed. ").concat(JSON.stringify(A))),n.onSuccess(A),h(R)}},200)})},checkVideoTrackIsActive:async function(e){let t=arguments.length>1&&arguments[1]!==void 0?arguments[1]:5e3;const n=he.reportApiInvoke(null,{tag:Et.TRACER,name:Mt.CHECK_VIDEO_TRACK_IS_ACTIVE,options:[t]});if(!(e instanceof Ft||e instanceof Gu)){const T=new b(I.INVALID_TRACK,"the parameter is not a video track");return n.onError(T),T.throw()}const r=4;t&&t<1e3&&(t=1e3);const o=e instanceof Ft?e.getTrackLabel():"remote_track",a=e.getMediaStreamTrack(!0),d=document.createElement("video");d.style.width="1px",d.style.height="1px",d.setAttribute("muted",""),d.muted=!0,d.setAttribute("playsinline",""),d.controls=!1,(kn()||tu())&&(d.style.opacity="0.01",d.style.position="fixed",d.style.left="0",d.style.top="0",document.body.appendChild(d)),d.srcObject=new MediaStream([a]),d.play();const u=document.createElement("canvas");u.width=160,u.height=120;let h=0,m=0;try{const T=Date.now();h=await i3(d,t,u,r),m=Date.now()-T}catch(T){throw n.onError(T),T}r3===Ze.SAFARI&&(d.pause(),d.remove()),d.srcObject=null;const f=h>r,E={duration:m,changedPicNum:h,deviceLabel:o,result:f};return v.info("[track-".concat(e.getTrackId(),"] check video track active completed. ").concat(JSON.stringify(E))),n.onSuccess(E),f},setArea:lE,audioElementPlayCenter:mr,processExternalMediaAEC:function(e){s3.processExternalMediaAEC(e)},registerExtensions:function(e){e.forEach(t=>{const n=t;n.__registered__=!0,n.logger.hookLog=v.extLog,n.reporter.hookApiInvoke=he.extApiInvoke,n.parameters&&Object.keys(n.parameters).forEach(r=>{n.parameters[r]=k(r)})})},ChannelMediaRelayError:zo,ChannelMediaRelayEvent:bi,ChannelMediaRelayState:xn,RemoteStreamFallbackType:Bm,RemoteStreamType:jm,ConnectionDisconnectedReason:Je,AudienceLatencyLevelType:Mm,AREAS:je});return Object.defineProperties(qt,{onAudioAutoplayFailed:{get:()=>wr.onAudioAutoplayFailed,set:e=>{wr.onAudioAutoplayFailed=e}},onAutoplayFailed:{get:()=>wr.onAutoplayFailed,set:e=>{wr.onAutoplayFailed=e}},_onSecurityPolicyViolation:{value:void 0,writable:!0},_cspEventHandlerPointer:{value:void 0,writable:!0},onSecurityPolicyViolation:{get:()=>qt._onSecurityPolicyViolation,set(e){qt._onSecurityPolicyViolation=e,I0(e)}}}),br.on(mo.CAMERA_DEVICE_CHANGED,e=>{v.info("camera device changed",JSON.stringify(e)),qt.onCameraChanged&&qt.onCameraChanged(e),qt.safeEmit(Pi.CAMERA_CHANGED,e)}),br.on(mo.RECORDING_DEVICE_CHANGED,e=>{v.info("microphone device changed",JSON.stringify(e)),qt.onMicrophoneChanged&&qt.onMicrophoneChanged(e),qt.safeEmit(Pi.MICROPHONE_CHANGED,e)}),br.on(mo.PLAYOUT_DEVICE_CHANGED,e=>{v.debug("playout device changed",JSON.stringify(e)),qt.onPlaybackDeviceChanged&&qt.onPlaybackDeviceChanged(e),qt.safeEmit(Pi.PLAYBACK_DEVICE_CHANGED,e)}),mr.onAutoplayFailed=()=>{v.info("detect audio element autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed()},Xe.on("autoplay-failed",()=>{v.info("detect webaudio autoplay failed"),wr.onAudioAutoplayFailed&&wr.onAudioAutoplayFailed(),qt.safeEmit(Pi.AUTOPLAY_FAILED)}),window&&(window.__ARTC__=qt),qt})})(pP);var LW=pP.exports;const mP=ZN(LW),kW=({user:i})=>{const s=dr.useRef();return dr.useEffect(()=>{i.videoTrack.play(s.current)},[]),Lt.jsx("div",{children:Lt.jsx("div",{ref:s,style:{width:"250px",height:"250px"}})})},MW="5f41eed412454d93ab8e2d9b61430bc6",UW="007eJxTYJjSdzdiSrfe0RV/sqrmh22af7Dt3vzw+6FTdjN5lr3at4hTgcE0zcQwNTXFxNDIxNQkxdI4Mcki1SjFMsnM0MTYICnZrMz4ZkpDICNDDJ8XEyMDBIL4bAwlqYUFRfkMDABEdCHL",xW="teqpro",vo=mP.createClient({mode:"rtc",codec:"vp8"}),VW=()=>{const[i,s]=dr.useState([]),[c,l]=dr.useState([]),p=async(y,C)=>{await vo.subscribe(y,C),C==="video"&&s(L=>[...L,y]),C==="audio"&&y.audioTrack.play()},_=y=>{s(C=>C.filter(L=>L.uid!==y.uid))};return dr.useEffect(()=>(vo.on("user-published",p),vo.on("user-left",_),vo.join(MW,xW,UW,null).then(y=>Promise.all([mP.createMicrophoneAndCameraTracks(),y])).then(([y,C])=>{const[L,U]=y;l(y),s(G=>[...G,{uid:C,videoTrack:U,audioTrack:L}]),vo.publish(y)}),()=>{for(let y of c)y.stop(),y.close();vo.off("user-published",p),vo.off("user-left",_),vo.unpublish(tracks).then(()=>vo.leave())}),[]),Lt.jsx("div",{style:{display:"flex",justifyContent:"flex-start"},children:Lt.jsx("div",{style:{flex:1,display:"grid",gridTemplateColumns:"'repeat(2, 200px)'",gridGap:10},children:i.map(y=>Lt.jsx(kW,{user:y},y.uid))})})};function EP(i,s){return function(){return i.apply(s,arguments)}}const{toString:FW}=Object.prototype,{getPrototypeOf:RS}=Object,vp=(i=>s=>{const c=FW.call(s);return i[c]||(i[c]=c.slice(8,-1).toLowerCase())})(Object.create(null)),so=i=>(i=i.toLowerCase(),s=>vp(s)===i),yp=i=>s=>typeof s===i,{isArray:kc}=Array,cl=yp("undefined");function jW(i){return i!==null&&!cl(i)&&i.constructor!==null&&!cl(i.constructor)&&Ti(i.constructor.isBuffer)&&i.constructor.isBuffer(i)}const _P=so("ArrayBuffer");function BW(i){let s;return typeof ArrayBuffer<"u"&&ArrayBuffer.isView?s=ArrayBuffer.isView(i):s=i&&i.buffer&&_P(i.buffer),s}const GW=yp("string"),Ti=yp("function"),gP=yp("number"),Rp=i=>i!==null&&typeof i=="object",WW=i=>i===!0||i===!1,Nh=i=>{if(vp(i)!=="object")return!1;const s=RS(i);return(s===null||s===Object.prototype||Object.getPrototypeOf(s)===null)&&!(Symbol.toStringTag in i)&&!(Symbol.iterator in i)},HW=so("Date"),KW=so("File"),zW=so("Blob"),YW=so("FileList"),qW=i=>Rp(i)&&Ti(i.pipe),JW=i=>{let s;return i&&(typeof FormData=="function"&&i instanceof FormData||Ti(i.append)&&((s=vp(i))==="formdata"||s==="object"&&Ti(i.toString)&&i.toString()==="[object FormData]"))},XW=so("URLSearchParams"),QW=i=>i.trim?i.trim():i.replace(/^[\s\uFEFF\xA0]+|[\s\uFEFF\xA0]+$/g,"");function fl(i,s,{allOwnKeys:c=!1}={}){if(i===null||typeof i>"u")return;let l,p;if(typeof i!="object"&&(i=[i]),kc(i))for(l=0,p=i.length;l<p;l++)s.call(null,i[l],l,i);else{const _=c?Object.getOwnPropertyNames(i):Object.keys(i),y=_.length;let C;for(l=0;l<y;l++)C=_[l],s.call(null,i[C],C,i)}}function SP(i,s){s=s.toLowerCase();const c=Object.keys(i);let l=c.length,p;for(;l-- >0;)if(p=c[l],s===p.toLowerCase())return p;return null}const TP=(()=>typeof globalThis<"u"?globalThis:typeof self<"u"?self:typeof window<"u"?window:global)(),vP=i=>!cl(i)&&i!==TP;function Ig(){const{caseless:i}=vP(this)&&this||{},s={},c=(l,p)=>{const _=i&&SP(s,p)||p;Nh(s[_])&&Nh(l)?s[_]=Ig(s[_],l):Nh(l)?s[_]=Ig({},l):kc(l)?s[_]=l.slice():s[_]=l};for(let l=0,p=arguments.length;l<p;l++)arguments[l]&&fl(arguments[l],c);return s}const $W=(i,s,c,{allOwnKeys:l}={})=>(fl(s,(p,_)=>{c&&Ti(p)?i[_]=EP(p,c):i[_]=p},{allOwnKeys:l}),i),ZW=i=>(i.charCodeAt(0)===65279&&(i=i.slice(1)),i),e4=(i,s,c,l)=>{i.prototype=Object.create(s.prototype,l),i.prototype.constructor=i,Object.defineProperty(i,"super",{value:s.prototype}),c&&Object.assign(i.prototype,c)},t4=(i,s,c,l)=>{let p,_,y;const C={};if(s=s||{},i==null)return s;do{for(p=Object.getOwnPropertyNames(i),_=p.length;_-- >0;)y=p[_],(!l||l(y,i,s))&&!C[y]&&(s[y]=i[y],C[y]=!0);i=c!==!1&&RS(i)}while(i&&(!c||c(i,s))&&i!==Object.prototype);return s},n4=(i,s,c)=>{i=String(i),(c===void 0||c>i.length)&&(c=i.length),c-=s.length;const l=i.indexOf(s,c);return l!==-1&&l===c},r4=i=>{if(!i)return null;if(kc(i))return i;let s=i.length;if(!gP(s))return null;const c=new Array(s);for(;s-- >0;)c[s]=i[s];return c},i4=(i=>s=>i&&s instanceof i)(typeof Uint8Array<"u"&&RS(Uint8Array)),o4=(i,s)=>{const l=(i&&i[Symbol.iterator]).call(i);let p;for(;(p=l.next())&&!p.done;){const _=p.value;s.call(i,_[0],_[1])}},s4=(i,s)=>{let c;const l=[];for(;(c=i.exec(s))!==null;)l.push(c);return l},a4=so("HTMLFormElement"),c4=i=>i.toLowerCase().replace(/[-_\s]([a-z\d])(\w*)/g,function(c,l,p){return l.toUpperCase()+p}),UN=(({hasOwnProperty:i})=>(s,c)=>i.call(s,c))(Object.prototype),d4=so("RegExp"),yP=(i,s)=>{const c=Object.getOwnPropertyDescriptors(i),l={};fl(c,(p,_)=>{s(p,_,i)!==!1&&(l[_]=p)}),Object.defineProperties(i,l)},l4=i=>{yP(i,(s,c)=>{if(Ti(i)&&["arguments","caller","callee"].indexOf(c)!==-1)return!1;const l=i[c];if(Ti(l)){if(s.enumerable=!1,"writable"in s){s.writable=!1;return}s.set||(s.set=()=>{throw Error("Can not rewrite read-only method '"+c+"'")})}})},u4=(i,s)=>{const c={},l=p=>{p.forEach(_=>{c[_]=!0})};return kc(i)?l(i):l(String(i).split(s)),c},h4=()=>{},p4=(i,s)=>(i=+i,Number.isFinite(i)?i:s),O_="abcdefghijklmnopqrstuvwxyz",xN="0123456789",RP={DIGIT:xN,ALPHA:O_,ALPHA_DIGIT:O_+O_.toUpperCase()+xN},f4=(i=16,s=RP.ALPHA_DIGIT)=>{let c="";const{length:l}=s;for(;i--;)c+=s[Math.random()*l|0];return c};function m4(i){return!!(i&&Ti(i.append)&&i[Symbol.toStringTag]==="FormData"&&i[Symbol.iterator])}const E4=i=>{const s=new Array(10),c=(l,p)=>{if(Rp(l)){if(s.indexOf(l)>=0)return;if(!("toJSON"in l)){s[p]=l;const _=kc(l)?[]:{};return fl(l,(y,C)=>{const L=c(y,p+1);!cl(L)&&(_[C]=L)}),s[p]=void 0,_}}return l};return c(i,0)},_4=so("AsyncFunction"),g4=i=>i&&(Rp(i)||Ti(i))&&Ti(i.then)&&Ti(i.catch),se={isArray:kc,isArrayBuffer:_P,isBuffer:jW,isFormData:JW,isArrayBufferView:BW,isString:GW,isNumber:gP,isBoolean:WW,isObject:Rp,isPlainObject:Nh,isUndefined:cl,isDate:HW,isFile:KW,isBlob:zW,isRegExp:d4,isFunction:Ti,isStream:qW,isURLSearchParams:XW,isTypedArray:i4,isFileList:YW,forEach:fl,merge:Ig,extend:$W,trim:QW,stripBOM:ZW,inherits:e4,toFlatObject:t4,kindOf:vp,kindOfTest:so,endsWith:n4,toArray:r4,forEachEntry:o4,matchAll:s4,isHTMLForm:a4,hasOwnProperty:UN,hasOwnProp:UN,reduceDescriptors:yP,freezeMethods:l4,toObjectSet:u4,toCamelCase:c4,noop:h4,toFiniteNumber:p4,findKey:SP,global:TP,isContextDefined:vP,ALPHABET:RP,generateString:f4,isSpecCompliantForm:m4,toJSONObject:E4,isAsyncFn:_4,isThenable:g4};function pt(i,s,c,l,p){Error.call(this),Error.captureStackTrace?Error.captureStackTrace(this,this.constructor):this.stack=new Error().stack,this.message=i,this.name="AxiosError",s&&(this.code=s),c&&(this.config=c),l&&(this.request=l),p&&(this.response=p)}se.inherits(pt,Error,{toJSON:function(){return{message:this.message,name:this.name,description:this.description,number:this.number,fileName:this.fileName,lineNumber:this.lineNumber,columnNumber:this.columnNumber,stack:this.stack,config:se.toJSONObject(this.config),code:this.code,status:this.response&&this.response.status?this.response.status:null}}});const CP=pt.prototype,IP={};["ERR_BAD_OPTION_VALUE","ERR_BAD_OPTION","ECONNABORTED","ETIMEDOUT","ERR_NETWORK","ERR_FR_TOO_MANY_REDIRECTS","ERR_DEPRECATED","ERR_BAD_RESPONSE","ERR_BAD_REQUEST","ERR_CANCELED","ERR_NOT_SUPPORT","ERR_INVALID_URL"].forEach(i=>{IP[i]={value:i}});Object.defineProperties(pt,IP);Object.defineProperty(CP,"isAxiosError",{value:!0});pt.from=(i,s,c,l,p,_)=>{const y=Object.create(CP);return se.toFlatObject(i,y,function(L){return L!==Error.prototype},C=>C!=="isAxiosError"),pt.call(y,i.message,s,c,l,p),y.cause=i,y.name=i.name,_&&Object.assign(y,_),y};const S4=null;function Ag(i){return se.isPlainObject(i)||se.isArray(i)}function AP(i){return se.endsWith(i,"[]")?i.slice(0,-2):i}function VN(i,s,c){return i?i.concat(s).map(function(p,_){return p=AP(p),!c&&_?"["+p+"]":p}).join(c?".":""):s}function T4(i){return se.isArray(i)&&!i.some(Ag)}const v4=se.toFlatObject(se,{},null,function(s){return/^is[A-Z]/.test(s)});function Cp(i,s,c){if(!se.isObject(i))throw new TypeError("target must be an object");s=s||new FormData,c=se.toFlatObject(c,{metaTokens:!0,dots:!1,indexes:!1},!1,function(ie,Ie){return!se.isUndefined(Ie[ie])});const l=c.metaTokens,p=c.visitor||G,_=c.dots,y=c.indexes,L=(c.Blob||typeof Blob<"u"&&Blob)&&se.isSpecCompliantForm(s);if(!se.isFunction(p))throw new TypeError("visitor must be a function");function U(W){if(W===null)return"";if(se.isDate(W))return W.toISOString();if(!L&&se.isBlob(W))throw new pt("Blob is not supported. Use a Buffer instead.");return se.isArrayBuffer(W)||se.isTypedArray(W)?L&&typeof Blob=="function"?new Blob([W]):Buffer.from(W):W}function G(W,ie,Ie){let B=W;if(W&&!Ie&&typeof W=="object"){if(se.endsWith(ie,"{}"))ie=l?ie:ie.slice(0,-2),W=JSON.stringify(W);else if(se.isArray(W)&&T4(W)||(se.isFileList(W)||se.endsWith(ie,"[]"))&&(B=se.toArray(W)))return ie=AP(ie),B.forEach(function(M,j){!(se.isUndefined(M)||M===null)&&s.append(y===!0?VN([ie],j,_):y===null?ie:ie+"[]",U(M))}),!1}return Ag(W)?!0:(s.append(VN(Ie,ie,_),U(W)),!1)}const F=[],H=Object.assign(v4,{defaultVisitor:G,convertValue:U,isVisitable:Ag});function ne(W,ie){if(!se.isUndefined(W)){if(F.indexOf(W)!==-1)throw Error("Circular reference detected in "+ie.join("."));F.push(W),se.forEach(W,function(B,P){(!(se.isUndefined(B)||B===null)&&p.call(s,B,se.isString(P)?P.trim():P,ie,H))===!0&&ne(B,ie?ie.concat(P):[P])}),F.pop()}}if(!se.isObject(i))throw new TypeError("data must be an object");return ne(i),s}function FN(i){const s={"!":"%21","'":"%27","(":"%28",")":"%29","~":"%7E","%20":"+","%00":"\0"};return encodeURIComponent(i).replace(/[!'()~]|%20|%00/g,function(l){return s[l]})}function CS(i,s){this._pairs=[],i&&Cp(i,this,s)}const OP=CS.prototype;OP.append=function(s,c){this._pairs.push([s,c])};OP.toString=function(s){const c=s?function(l){return s.call(this,l,FN)}:FN;return this._pairs.map(function(p){return c(p[0])+"="+c(p[1])},"").join("&")};function y4(i){return encodeURIComponent(i).replace(/%3A/gi,":").replace(/%24/g,"$").replace(/%2C/gi,",").replace(/%20/g,"+").replace(/%5B/gi,"[").replace(/%5D/gi,"]")}function wP(i,s,c){if(!s)return i;const l=c&&c.encode||y4,p=c&&c.serialize;let _;if(p?_=p(s,c):_=se.isURLSearchParams(s)?s.toString():new CS(s,c).toString(l),_){const y=i.indexOf("#");y!==-1&&(i=i.slice(0,y)),i+=(i.indexOf("?")===-1?"?":"&")+_}return i}class R4{constructor(){this.handlers=[]}use(s,c,l){return this.handlers.push({fulfilled:s,rejected:c,synchronous:l?l.synchronous:!1,runWhen:l?l.runWhen:null}),this.handlers.length-1}eject(s){this.handlers[s]&&(this.handlers[s]=null)}clear(){this.handlers&&(this.handlers=[])}forEach(s){se.forEach(this.handlers,function(l){l!==null&&s(l)})}}const jN=R4,NP={silentJSONParsing:!0,forcedJSONParsing:!0,clarifyTimeoutError:!1},C4=typeof URLSearchParams<"u"?URLSearchParams:CS,I4=typeof FormData<"u"?FormData:null,A4=typeof Blob<"u"?Blob:null,O4=(()=>{let i;return typeof navigator<"u"&&((i=navigator.product)==="ReactNative"||i==="NativeScript"||i==="NS")?!1:typeof window<"u"&&typeof document<"u"})(),w4=(()=>typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope&&typeof self.importScripts=="function")(),ro={isBrowser:!0,classes:{URLSearchParams:C4,FormData:I4,Blob:A4},isStandardBrowserEnv:O4,isStandardBrowserWebWorkerEnv:w4,protocols:["http","https","file","blob","url","data"]};function N4(i,s){return Cp(i,new ro.classes.URLSearchParams,Object.assign({visitor:function(c,l,p,_){return ro.isNode&&se.isBuffer(c)?(this.append(l,c.toString("base64")),!1):_.defaultVisitor.apply(this,arguments)}},s))}function b4(i){return se.matchAll(/\w+|\[(\w*)]/g,i).map(s=>s[0]==="[]"?"":s[1]||s[0])}function D4(i){const s={},c=Object.keys(i);let l;const p=c.length;let _;for(l=0;l<p;l++)_=c[l],s[_]=i[_];return s}function bP(i){function s(c,l,p,_){let y=c[_++];const C=Number.isFinite(+y),L=_>=c.length;return y=!y&&se.isArray(p)?p.length:y,L?(se.hasOwnProp(p,y)?p[y]=[p[y],l]:p[y]=l,!C):((!p[y]||!se.isObject(p[y]))&&(p[y]=[]),s(c,l,p[y],_)&&se.isArray(p[y])&&(p[y]=D4(p[y])),!C)}if(se.isFormData(i)&&se.isFunction(i.entries)){const c={};return se.forEachEntry(i,(l,p)=>{s(b4(l),p,c,0)}),c}return null}const P4={"Content-Type":void 0};function L4(i,s,c){if(se.isString(i))try{return(s||JSON.parse)(i),se.trim(i)}catch(l){if(l.name!=="SyntaxError")throw l}return(c||JSON.stringify)(i)}const Ip={transitional:NP,adapter:["xhr","http"],transformRequest:[function(s,c){const l=c.getContentType()||"",p=l.indexOf("application/json")>-1,_=se.isObject(s);if(_&&se.isHTMLForm(s)&&(s=new FormData(s)),se.isFormData(s))return p&&p?JSON.stringify(bP(s)):s;if(se.isArrayBuffer(s)||se.isBuffer(s)||se.isStream(s)||se.isFile(s)||se.isBlob(s))return s;if(se.isArrayBufferView(s))return s.buffer;if(se.isURLSearchParams(s))return c.setContentType("application/x-www-form-urlencoded;charset=utf-8",!1),s.toString();let C;if(_){if(l.indexOf("application/x-www-form-urlencoded")>-1)return N4(s,this.formSerializer).toString();if((C=se.isFileList(s))||l.indexOf("multipart/form-data")>-1){const L=this.env&&this.env.FormData;return Cp(C?{"files[]":s}:s,L&&new L,this.formSerializer)}}return _||p?(c.setContentType("application/json",!1),L4(s)):s}],transformResponse:[function(s){const c=this.transitional||Ip.transitional,l=c&&c.forcedJSONParsing,p=this.responseType==="json";if(s&&se.isString(s)&&(l&&!this.responseType||p)){const y=!(c&&c.silentJSONParsing)&&p;try{return JSON.parse(s)}catch(C){if(y)throw C.name==="SyntaxError"?pt.from(C,pt.ERR_BAD_RESPONSE,this,null,this.response):C}}return s}],timeout:0,xsrfCookieName:"XSRF-TOKEN",xsrfHeaderName:"X-XSRF-TOKEN",maxContentLength:-1,maxBodyLength:-1,env:{FormData:ro.classes.FormData,Blob:ro.classes.Blob},validateStatus:function(s){return s>=200&&s<300},headers:{common:{Accept:"application/json, text/plain, */*"}}};se.forEach(["delete","get","head"],function(s){Ip.headers[s]={}});se.forEach(["post","put","patch"],function(s){Ip.headers[s]=se.merge(P4)});const IS=Ip,k4=se.toObjectSet(["age","authorization","content-length","content-type","etag","expires","from","host","if-modified-since","if-unmodified-since","last-modified","location","max-forwards","proxy-authorization","referer","retry-after","user-agent"]),M4=i=>{const s={};let c,l,p;return i&&i.split(`
`).forEach(function(y){p=y.indexOf(":"),c=y.substring(0,p).trim().toLowerCase(),l=y.substring(p+1).trim(),!(!c||s[c]&&k4[c])&&(c==="set-cookie"?s[c]?s[c].push(l):s[c]=[l]:s[c]=s[c]?s[c]+", "+l:l)}),s},BN=Symbol("internals");function Od(i){return i&&String(i).trim().toLowerCase()}function bh(i){return i===!1||i==null?i:se.isArray(i)?i.map(bh):String(i)}function U4(i){const s=Object.create(null),c=/([^\s,;=]+)\s*(?:=\s*([^,;]+))?/g;let l;for(;l=c.exec(i);)s[l[1]]=l[2];return s}const x4=i=>/^[-_a-zA-Z0-9^`|~,!#$%&'*+.]+$/.test(i.trim());function w_(i,s,c,l,p){if(se.isFunction(l))return l.call(this,s,c);if(p&&(s=c),!!se.isString(s)){if(se.isString(l))return s.indexOf(l)!==-1;if(se.isRegExp(l))return l.test(s)}}function V4(i){return i.trim().toLowerCase().replace(/([a-z\d])(\w*)/g,(s,c,l)=>c.toUpperCase()+l)}function F4(i,s){const c=se.toCamelCase(" "+s);["get","set","has"].forEach(l=>{Object.defineProperty(i,l+c,{value:function(p,_,y){return this[l].call(this,s,p,_,y)},configurable:!0})})}class Ap{constructor(s){s&&this.set(s)}set(s,c,l){const p=this;function _(C,L,U){const G=Od(L);if(!G)throw new Error("header name must be a non-empty string");const F=se.findKey(p,G);(!F||p[F]===void 0||U===!0||U===void 0&&p[F]!==!1)&&(p[F||L]=bh(C))}const y=(C,L)=>se.forEach(C,(U,G)=>_(U,G,L));return se.isPlainObject(s)||s instanceof this.constructor?y(s,c):se.isString(s)&&(s=s.trim())&&!x4(s)?y(M4(s),c):s!=null&&_(c,s,l),this}get(s,c){if(s=Od(s),s){const l=se.findKey(this,s);if(l){const p=this[l];if(!c)return p;if(c===!0)return U4(p);if(se.isFunction(c))return c.call(this,p,l);if(se.isRegExp(c))return c.exec(p);throw new TypeError("parser must be boolean|regexp|function")}}}has(s,c){if(s=Od(s),s){const l=se.findKey(this,s);return!!(l&&this[l]!==void 0&&(!c||w_(this,this[l],l,c)))}return!1}delete(s,c){const l=this;let p=!1;function _(y){if(y=Od(y),y){const C=se.findKey(l,y);C&&(!c||w_(l,l[C],C,c))&&(delete l[C],p=!0)}}return se.isArray(s)?s.forEach(_):_(s),p}clear(s){const c=Object.keys(this);let l=c.length,p=!1;for(;l--;){const _=c[l];(!s||w_(this,this[_],_,s,!0))&&(delete this[_],p=!0)}return p}normalize(s){const c=this,l={};return se.forEach(this,(p,_)=>{const y=se.findKey(l,_);if(y){c[y]=bh(p),delete c[_];return}const C=s?V4(_):String(_).trim();C!==_&&delete c[_],c[C]=bh(p),l[C]=!0}),this}concat(...s){return this.constructor.concat(this,...s)}toJSON(s){const c=Object.create(null);return se.forEach(this,(l,p)=>{l!=null&&l!==!1&&(c[p]=s&&se.isArray(l)?l.join(", "):l)}),c}[Symbol.iterator](){return Object.entries(this.toJSON())[Symbol.iterator]()}toString(){return Object.entries(this.toJSON()).map(([s,c])=>s+": "+c).join(`
`)}get[Symbol.toStringTag](){return"AxiosHeaders"}static from(s){return s instanceof this?s:new this(s)}static concat(s,...c){const l=new this(s);return c.forEach(p=>l.set(p)),l}static accessor(s){const l=(this[BN]=this[BN]={accessors:{}}).accessors,p=this.prototype;function _(y){const C=Od(y);l[C]||(F4(p,y),l[C]=!0)}return se.isArray(s)?s.forEach(_):_(s),this}}Ap.accessor(["Content-Type","Content-Length","Accept","Accept-Encoding","User-Agent","Authorization"]);se.freezeMethods(Ap.prototype);se.freezeMethods(Ap);const Oo=Ap;function N_(i,s){const c=this||IS,l=s||c,p=Oo.from(l.headers);let _=l.data;return se.forEach(i,function(C){_=C.call(c,_,p.normalize(),s?s.status:void 0)}),p.normalize(),_}function DP(i){return!!(i&&i.__CANCEL__)}function ml(i,s,c){pt.call(this,i??"canceled",pt.ERR_CANCELED,s,c),this.name="CanceledError"}se.inherits(ml,pt,{__CANCEL__:!0});function j4(i,s,c){const l=c.config.validateStatus;!c.status||!l||l(c.status)?i(c):s(new pt("Request failed with status code "+c.status,[pt.ERR_BAD_REQUEST,pt.ERR_BAD_RESPONSE][Math.floor(c.status/100)-4],c.config,c.request,c))}const B4=ro.isStandardBrowserEnv?function(){return{write:function(c,l,p,_,y,C){const L=[];L.push(c+"="+encodeURIComponent(l)),se.isNumber(p)&&L.push("expires="+new Date(p).toGMTString()),se.isString(_)&&L.push("path="+_),se.isString(y)&&L.push("domain="+y),C===!0&&L.push("secure"),document.cookie=L.join("; ")},read:function(c){const l=document.cookie.match(new RegExp("(^|;\\s*)("+c+")=([^;]*)"));return l?decodeURIComponent(l[3]):null},remove:function(c){this.write(c,"",Date.now()-864e5)}}}():function(){return{write:function(){},read:function(){return null},remove:function(){}}}();function G4(i){return/^([a-z][a-z\d+\-.]*:)?\/\//i.test(i)}function W4(i,s){return s?i.replace(/\/+$/,"")+"/"+s.replace(/^\/+/,""):i}function PP(i,s){return i&&!G4(s)?W4(i,s):s}const H4=ro.isStandardBrowserEnv?function(){const s=/(msie|trident)/i.test(navigator.userAgent),c=document.createElement("a");let l;function p(_){let y=_;return s&&(c.setAttribute("href",y),y=c.href),c.setAttribute("href",y),{href:c.href,protocol:c.protocol?c.protocol.replace(/:$/,""):"",host:c.host,search:c.search?c.search.replace(/^\?/,""):"",hash:c.hash?c.hash.replace(/^#/,""):"",hostname:c.hostname,port:c.port,pathname:c.pathname.charAt(0)==="/"?c.pathname:"/"+c.pathname}}return l=p(window.location.href),function(y){const C=se.isString(y)?p(y):y;return C.protocol===l.protocol&&C.host===l.host}}():function(){return function(){return!0}}();function K4(i){const s=/^([-+\w]{1,25})(:?\/\/|:)/.exec(i);return s&&s[1]||""}function z4(i,s){i=i||10;const c=new Array(i),l=new Array(i);let p=0,_=0,y;return s=s!==void 0?s:1e3,function(L){const U=Date.now(),G=l[_];y||(y=U),c[p]=L,l[p]=U;let F=_,H=0;for(;F!==p;)H+=c[F++],F=F%i;if(p=(p+1)%i,p===_&&(_=(_+1)%i),U-y<s)return;const ne=G&&U-G;return ne?Math.round(H*1e3/ne):void 0}}function GN(i,s){let c=0;const l=z4(50,250);return p=>{const _=p.loaded,y=p.lengthComputable?p.total:void 0,C=_-c,L=l(C),U=_<=y;c=_;const G={loaded:_,total:y,progress:y?_/y:void 0,bytes:C,rate:L||void 0,estimated:L&&y&&U?(y-_)/L:void 0,event:p};G[s?"download":"upload"]=!0,i(G)}}const Y4=typeof XMLHttpRequest<"u",q4=Y4&&function(i){return new Promise(function(c,l){let p=i.data;const _=Oo.from(i.headers).normalize(),y=i.responseType;let C;function L(){i.cancelToken&&i.cancelToken.unsubscribe(C),i.signal&&i.signal.removeEventListener("abort",C)}se.isFormData(p)&&(ro.isStandardBrowserEnv||ro.isStandardBrowserWebWorkerEnv?_.setContentType(!1):_.setContentType("multipart/form-data;",!1));let U=new XMLHttpRequest;if(i.auth){const ne=i.auth.username||"",W=i.auth.password?unescape(encodeURIComponent(i.auth.password)):"";_.set("Authorization","Basic "+btoa(ne+":"+W))}const G=PP(i.baseURL,i.url);U.open(i.method.toUpperCase(),wP(G,i.params,i.paramsSerializer),!0),U.timeout=i.timeout;function F(){if(!U)return;const ne=Oo.from("getAllResponseHeaders"in U&&U.getAllResponseHeaders()),ie={data:!y||y==="text"||y==="json"?U.responseText:U.response,status:U.status,statusText:U.statusText,headers:ne,config:i,request:U};j4(function(B){c(B),L()},function(B){l(B),L()},ie),U=null}if("onloadend"in U?U.onloadend=F:U.onreadystatechange=function(){!U||U.readyState!==4||U.status===0&&!(U.responseURL&&U.responseURL.indexOf("file:")===0)||setTimeout(F)},U.onabort=function(){U&&(l(new pt("Request aborted",pt.ECONNABORTED,i,U)),U=null)},U.onerror=function(){l(new pt("Network Error",pt.ERR_NETWORK,i,U)),U=null},U.ontimeout=function(){let W=i.timeout?"timeout of "+i.timeout+"ms exceeded":"timeout exceeded";const ie=i.transitional||NP;i.timeoutErrorMessage&&(W=i.timeoutErrorMessage),l(new pt(W,ie.clarifyTimeoutError?pt.ETIMEDOUT:pt.ECONNABORTED,i,U)),U=null},ro.isStandardBrowserEnv){const ne=(i.withCredentials||H4(G))&&i.xsrfCookieName&&B4.read(i.xsrfCookieName);ne&&_.set(i.xsrfHeaderName,ne)}p===void 0&&_.setContentType(null),"setRequestHeader"in U&&se.forEach(_.toJSON(),function(W,ie){U.setRequestHeader(ie,W)}),se.isUndefined(i.withCredentials)||(U.withCredentials=!!i.withCredentials),y&&y!=="json"&&(U.responseType=i.responseType),typeof i.onDownloadProgress=="function"&&U.addEventListener("progress",GN(i.onDownloadProgress,!0)),typeof i.onUploadProgress=="function"&&U.upload&&U.upload.addEventListener("progress",GN(i.onUploadProgress)),(i.cancelToken||i.signal)&&(C=ne=>{U&&(l(!ne||ne.type?new ml(null,i,U):ne),U.abort(),U=null)},i.cancelToken&&i.cancelToken.subscribe(C),i.signal&&(i.signal.aborted?C():i.signal.addEventListener("abort",C)));const H=K4(G);if(H&&ro.protocols.indexOf(H)===-1){l(new pt("Unsupported protocol "+H+":",pt.ERR_BAD_REQUEST,i));return}U.send(p||null)})},Dh={http:S4,xhr:q4};se.forEach(Dh,(i,s)=>{if(i){try{Object.defineProperty(i,"name",{value:s})}catch{}Object.defineProperty(i,"adapterName",{value:s})}});const J4={getAdapter:i=>{i=se.isArray(i)?i:[i];const{length:s}=i;let c,l;for(let p=0;p<s&&(c=i[p],!(l=se.isString(c)?Dh[c.toLowerCase()]:c));p++);if(!l)throw l===!1?new pt(`Adapter ${c} is not supported by the environment`,"ERR_NOT_SUPPORT"):new Error(se.hasOwnProp(Dh,c)?`Adapter '${c}' is not available in the build`:`Unknown adapter '${c}'`);if(!se.isFunction(l))throw new TypeError("adapter is not a function");return l},adapters:Dh};function b_(i){if(i.cancelToken&&i.cancelToken.throwIfRequested(),i.signal&&i.signal.aborted)throw new ml(null,i)}function WN(i){return b_(i),i.headers=Oo.from(i.headers),i.data=N_.call(i,i.transformRequest),["post","put","patch"].indexOf(i.method)!==-1&&i.headers.setContentType("application/x-www-form-urlencoded",!1),J4.getAdapter(i.adapter||IS.adapter)(i).then(function(l){return b_(i),l.data=N_.call(i,i.transformResponse,l),l.headers=Oo.from(l.headers),l},function(l){return DP(l)||(b_(i),l&&l.response&&(l.response.data=N_.call(i,i.transformResponse,l.response),l.response.headers=Oo.from(l.response.headers))),Promise.reject(l)})}const HN=i=>i instanceof Oo?i.toJSON():i;function bc(i,s){s=s||{};const c={};function l(U,G,F){return se.isPlainObject(U)&&se.isPlainObject(G)?se.merge.call({caseless:F},U,G):se.isPlainObject(G)?se.merge({},G):se.isArray(G)?G.slice():G}function p(U,G,F){if(se.isUndefined(G)){if(!se.isUndefined(U))return l(void 0,U,F)}else return l(U,G,F)}function _(U,G){if(!se.isUndefined(G))return l(void 0,G)}function y(U,G){if(se.isUndefined(G)){if(!se.isUndefined(U))return l(void 0,U)}else return l(void 0,G)}function C(U,G,F){if(F in s)return l(U,G);if(F in i)return l(void 0,U)}const L={url:_,method:_,data:_,baseURL:y,transformRequest:y,transformResponse:y,paramsSerializer:y,timeout:y,timeoutMessage:y,withCredentials:y,adapter:y,responseType:y,xsrfCookieName:y,xsrfHeaderName:y,onUploadProgress:y,onDownloadProgress:y,decompress:y,maxContentLength:y,maxBodyLength:y,beforeRedirect:y,transport:y,httpAgent:y,httpsAgent:y,cancelToken:y,socketPath:y,responseEncoding:y,validateStatus:C,headers:(U,G)=>p(HN(U),HN(G),!0)};return se.forEach(Object.keys(Object.assign({},i,s)),function(G){const F=L[G]||p,H=F(i[G],s[G],G);se.isUndefined(H)&&F!==C||(c[G]=H)}),c}const LP="1.4.0",AS={};["object","boolean","number","function","string","symbol"].forEach((i,s)=>{AS[i]=function(l){return typeof l===i||"a"+(s<1?"n ":" ")+i}});const KN={};AS.transitional=function(s,c,l){function p(_,y){return"[Axios v"+LP+"] Transitional option '"+_+"'"+y+(l?". "+l:"")}return(_,y,C)=>{if(s===!1)throw new pt(p(y," has been removed"+(c?" in "+c:"")),pt.ERR_DEPRECATED);return c&&!KN[y]&&(KN[y]=!0,console.warn(p(y," has been deprecated since v"+c+" and will be removed in the near future"))),s?s(_,y,C):!0}};function X4(i,s,c){if(typeof i!="object")throw new pt("options must be an object",pt.ERR_BAD_OPTION_VALUE);const l=Object.keys(i);let p=l.length;for(;p-- >0;){const _=l[p],y=s[_];if(y){const C=i[_],L=C===void 0||y(C,_,i);if(L!==!0)throw new pt("option "+_+" must be "+L,pt.ERR_BAD_OPTION_VALUE);continue}if(c!==!0)throw new pt("Unknown option "+_,pt.ERR_BAD_OPTION)}}const Og={assertOptions:X4,validators:AS},ds=Og.validators;class ip{constructor(s){this.defaults=s,this.interceptors={request:new jN,response:new jN}}request(s,c){typeof s=="string"?(c=c||{},c.url=s):c=s||{},c=bc(this.defaults,c);const{transitional:l,paramsSerializer:p,headers:_}=c;l!==void 0&&Og.assertOptions(l,{silentJSONParsing:ds.transitional(ds.boolean),forcedJSONParsing:ds.transitional(ds.boolean),clarifyTimeoutError:ds.transitional(ds.boolean)},!1),p!=null&&(se.isFunction(p)?c.paramsSerializer={serialize:p}:Og.assertOptions(p,{encode:ds.function,serialize:ds.function},!0)),c.method=(c.method||this.defaults.method||"get").toLowerCase();let y;y=_&&se.merge(_.common,_[c.method]),y&&se.forEach(["delete","get","head","post","put","patch","common"],W=>{delete _[W]}),c.headers=Oo.concat(y,_);const C=[];let L=!0;this.interceptors.request.forEach(function(ie){typeof ie.runWhen=="function"&&ie.runWhen(c)===!1||(L=L&&ie.synchronous,C.unshift(ie.fulfilled,ie.rejected))});const U=[];this.interceptors.response.forEach(function(ie){U.push(ie.fulfilled,ie.rejected)});let G,F=0,H;if(!L){const W=[WN.bind(this),void 0];for(W.unshift.apply(W,C),W.push.apply(W,U),H=W.length,G=Promise.resolve(c);F<H;)G=G.then(W[F++],W[F++]);return G}H=C.length;let ne=c;for(F=0;F<H;){const W=C[F++],ie=C[F++];try{ne=W(ne)}catch(Ie){ie.call(this,Ie);break}}try{G=WN.call(this,ne)}catch(W){return Promise.reject(W)}for(F=0,H=U.length;F<H;)G=G.then(U[F++],U[F++]);return G}getUri(s){s=bc(this.defaults,s);const c=PP(s.baseURL,s.url);return wP(c,s.params,s.paramsSerializer)}}se.forEach(["delete","get","head","options"],function(s){ip.prototype[s]=function(c,l){return this.request(bc(l||{},{method:s,url:c,data:(l||{}).data}))}});se.forEach(["post","put","patch"],function(s){function c(l){return function(_,y,C){return this.request(bc(C||{},{method:s,headers:l?{"Content-Type":"multipart/form-data"}:{},url:_,data:y}))}}ip.prototype[s]=c(),ip.prototype[s+"Form"]=c(!0)});const Ph=ip;class OS{constructor(s){if(typeof s!="function")throw new TypeError("executor must be a function.");let c;this.promise=new Promise(function(_){c=_});const l=this;this.promise.then(p=>{if(!l._listeners)return;let _=l._listeners.length;for(;_-- >0;)l._listeners[_](p);l._listeners=null}),this.promise.then=p=>{let _;const y=new Promise(C=>{l.subscribe(C),_=C}).then(p);return y.cancel=function(){l.unsubscribe(_)},y},s(function(_,y,C){l.reason||(l.reason=new ml(_,y,C),c(l.reason))})}throwIfRequested(){if(this.reason)throw this.reason}subscribe(s){if(this.reason){s(this.reason);return}this._listeners?this._listeners.push(s):this._listeners=[s]}unsubscribe(s){if(!this._listeners)return;const c=this._listeners.indexOf(s);c!==-1&&this._listeners.splice(c,1)}static source(){let s;return{token:new OS(function(p){s=p}),cancel:s}}}const Q4=OS;function $4(i){return function(c){return i.apply(null,c)}}function Z4(i){return se.isObject(i)&&i.isAxiosError===!0}const wg={Continue:100,SwitchingProtocols:101,Processing:102,EarlyHints:103,Ok:200,Created:201,Accepted:202,NonAuthoritativeInformation:203,NoContent:204,ResetContent:205,PartialContent:206,MultiStatus:207,AlreadyReported:208,ImUsed:226,MultipleChoices:300,MovedPermanently:301,Found:302,SeeOther:303,NotModified:304,UseProxy:305,Unused:306,TemporaryRedirect:307,PermanentRedirect:308,BadRequest:400,Unauthorized:401,PaymentRequired:402,Forbidden:403,NotFound:404,MethodNotAllowed:405,NotAcceptable:406,ProxyAuthenticationRequired:407,RequestTimeout:408,Conflict:409,Gone:410,LengthRequired:411,PreconditionFailed:412,PayloadTooLarge:413,UriTooLong:414,UnsupportedMediaType:415,RangeNotSatisfiable:416,ExpectationFailed:417,ImATeapot:418,MisdirectedRequest:421,UnprocessableEntity:422,Locked:423,FailedDependency:424,TooEarly:425,UpgradeRequired:426,PreconditionRequired:428,TooManyRequests:429,RequestHeaderFieldsTooLarge:431,UnavailableForLegalReasons:451,InternalServerError:500,NotImplemented:501,BadGateway:502,ServiceUnavailable:503,GatewayTimeout:504,HttpVersionNotSupported:505,VariantAlsoNegotiates:506,InsufficientStorage:507,LoopDetected:508,NotExtended:510,NetworkAuthenticationRequired:511};Object.entries(wg).forEach(([i,s])=>{wg[s]=i});const eH=wg;function kP(i){const s=new Ph(i),c=EP(Ph.prototype.request,s);return se.extend(c,Ph.prototype,s,{allOwnKeys:!0}),se.extend(c,s,null,{allOwnKeys:!0}),c.create=function(p){return kP(bc(i,p))},c}const Ln=kP(IS);Ln.Axios=Ph;Ln.CanceledError=ml;Ln.CancelToken=Q4;Ln.isCancel=DP;Ln.VERSION=LP;Ln.toFormData=Cp;Ln.AxiosError=pt;Ln.Cancel=Ln.CanceledError;Ln.all=function(s){return Promise.all(s)};Ln.spread=$4;Ln.isAxiosError=Z4;Ln.mergeConfig=bc;Ln.AxiosHeaders=Oo;Ln.formToJSON=i=>bP(se.isHTMLForm(i)?new FormData(i):i);Ln.HttpStatusCode=eH;Ln.default=Ln;const zN=Ln;var MP={},tH=Jn&&Jn.__extends||function(){var i=function(s,c){return i=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(l,p){l.__proto__=p}||function(l,p){for(var _ in p)Object.prototype.hasOwnProperty.call(p,_)&&(l[_]=p[_])},i(s,c)};return function(s,c){if(typeof c!="function"&&c!==null)throw new TypeError("Class extends value "+String(c)+" is not a constructor or null");i(s,c);function l(){this.constructor=s}s.prototype=c===null?Object.create(c):(l.prototype=c.prototype,new l)}}(),Fn=Jn&&Jn.__assign||function(){return Fn=Object.assign||function(i){for(var s,c=1,l=arguments.length;c<l;c++){s=arguments[c];for(var p in s)Object.prototype.hasOwnProperty.call(s,p)&&(i[p]=s[p])}return i},Fn.apply(this,arguments)},nH=Jn&&Jn.__createBinding||(Object.create?function(i,s,c,l){l===void 0&&(l=c);var p=Object.getOwnPropertyDescriptor(s,c);(!p||("get"in p?!s.__esModule:p.writable||p.configurable))&&(p={enumerable:!0,get:function(){return s[c]}}),Object.defineProperty(i,l,p)}:function(i,s,c,l){l===void 0&&(l=c),i[l]=s[c]}),rH=Jn&&Jn.__setModuleDefault||(Object.create?function(i,s){Object.defineProperty(i,"default",{enumerable:!0,value:s})}:function(i,s){i.default=s}),iH=Jn&&Jn.__importStar||function(i){if(i&&i.__esModule)return i;var s={};if(i!=null)for(var c in i)c!=="default"&&Object.prototype.hasOwnProperty.call(i,c)&&nH(s,i,c);return rH(s,i),s},oH=Jn&&Jn.__rest||function(i,s){var c={};for(var l in i)Object.prototype.hasOwnProperty.call(i,l)&&s.indexOf(l)<0&&(c[l]=i[l]);if(i!=null&&typeof Object.getOwnPropertySymbols=="function")for(var p=0,l=Object.getOwnPropertySymbols(i);p<l.length;p++)s.indexOf(l[p])<0&&Object.prototype.propertyIsEnumerable.call(i,l[p])&&(c[l[p]]=i[l[p]]);return c};Object.defineProperty(MP,"__esModule",{value:!0});var wd=iH(dr),sH=13,aH=9,cH=8,dH=89,fh=90,lH=77,YN=57,qN=219,JN=222,XN=192,uH=27,QN=100,hH=3e3,pH=typeof window<"u"&&"navigator"in window&&/Win/i.test(navigator.platform),D_=typeof window<"u"&&"navigator"in window&&/(Mac|iPhone|iPod|iPad)/i.test(navigator.platform),Lh="npm__react-simple-code-editor__textarea",fH=`
/**
 * Reset the text fill color so that placeholder is visible
 */
.`.concat(Lh,`:empty {
  -webkit-text-fill-color: inherit !important;
}

/**
 * Hack to apply on some CSS on IE10 and IE11
 */
@media all and (-ms-high-contrast: none), (-ms-high-contrast: active) {
  /**
    * IE doesn't support '-webkit-text-fill-color'
    * So we use 'color: transparent' to make the text transparent on IE
    * Unlike other browsers, it doesn't affect caret color in IE
    */
  .`).concat(Lh,` {
    color: transparent !important;
  }

  .`).concat(Lh,`::selection {
    background-color: #accef7 !important;
    color: transparent !important;
  }
}
`),mH=function(i){tH(s,i);function s(){var c=i!==null&&i.apply(this,arguments)||this;return c.state={capture:!0},c._recordCurrentState=function(){var l=c._input;if(l){var p=l.value,_=l.selectionStart,y=l.selectionEnd;c._recordChange({value:p,selectionStart:_,selectionEnd:y})}},c._getLines=function(l,p){return l.substring(0,p).split(`
`)},c._recordChange=function(l,p){var _,y,C;p===void 0&&(p=!1);var L=c._history,U=L.stack,G=L.offset;if(U.length&&G>-1){c._history.stack=U.slice(0,G+1);var F=c._history.stack.length;if(F>QN){var H=F-QN;c._history.stack=U.slice(H,F),c._history.offset=Math.max(c._history.offset-H,0)}}var ne=Date.now();if(p){var W=c._history.stack[c._history.offset];if(W&&ne-W.timestamp<hH){var ie=/[^a-z0-9]([a-z0-9]+)$/i,Ie=(_=c._getLines(W.value,W.selectionStart).pop())===null||_===void 0?void 0:_.match(ie),B=(y=c._getLines(l.value,l.selectionStart).pop())===null||y===void 0?void 0:y.match(ie);if(Ie!=null&&Ie[1]&&(!((C=B==null?void 0:B[1])===null||C===void 0)&&C.startsWith(Ie[1]))){c._history.stack[c._history.offset]=Fn(Fn({},l),{timestamp:ne});return}}}c._history.stack.push(Fn(Fn({},l),{timestamp:ne})),c._history.offset++},c._updateInput=function(l){var p=c._input;p&&(p.value=l.value,p.selectionStart=l.selectionStart,p.selectionEnd=l.selectionEnd,c.props.onValueChange(l.value))},c._applyEdits=function(l){var p=c._input,_=c._history.stack[c._history.offset];_&&p&&(c._history.stack[c._history.offset]=Fn(Fn({},_),{selectionStart:p.selectionStart,selectionEnd:p.selectionEnd})),c._recordChange(l),c._updateInput(l)},c._undoEdit=function(){var l=c._history,p=l.stack,_=l.offset,y=p[_-1];y&&(c._updateInput(y),c._history.offset=Math.max(_-1,0))},c._redoEdit=function(){var l=c._history,p=l.stack,_=l.offset,y=p[_+1];y&&(c._updateInput(y),c._history.offset=Math.min(_+1,p.length-1))},c._handleKeyDown=function(l){var p=c.props,_=p.tabSize,y=p.insertSpaces,C=p.ignoreTabKey,L=p.onKeyDown;if(!(L&&(L(l),l.defaultPrevented))){l.keyCode===uH&&l.currentTarget.blur();var U=l.currentTarget,G=U.value,F=U.selectionStart,H=U.selectionEnd,ne=(y?" ":"	").repeat(_);if(l.keyCode===aH&&!C&&c.state.capture)if(l.preventDefault(),l.shiftKey){var W=c._getLines(G,F),ie=W.length-1,Ie=c._getLines(G,H).length-1,B=G.split(`
`).map(function(en,Vr){return Vr>=ie&&Vr<=Ie&&en.startsWith(ne)?en.substring(ne.length):en}).join(`
`);if(G!==B){var P=W[ie];c._applyEdits({value:B,selectionStart:P!=null&&P.startsWith(ne)?F-ne.length:F,selectionEnd:H-(G.length-B.length)})}}else if(F!==H){var W=c._getLines(G,F),M=W.length-1,j=c._getLines(G,H).length-1,P=W[M];c._applyEdits({value:G.split(`
`).map(function(Gn,Ri){return Ri>=M&&Ri<=j?ne+Gn:Gn}).join(`
`),selectionStart:P&&/\S/.test(P)?F+ne.length:F,selectionEnd:H+ne.length*(j-M+1)})}else{var J=F+ne.length;c._applyEdits({value:G.substring(0,F)+ne+G.substring(H),selectionStart:J,selectionEnd:J})}else if(l.keyCode===cH){var Z=F!==H,ce=G.substring(0,F);if(ce.endsWith(ne)&&!Z){l.preventDefault();var J=F-ne.length;c._applyEdits({value:G.substring(0,F-ne.length)+G.substring(H),selectionStart:J,selectionEnd:J})}}else if(l.keyCode===sH){if(F===H){var me=c._getLines(G,F).pop(),_e=me==null?void 0:me.match(/^\s+/);if(_e!=null&&_e[0]){l.preventDefault();var Ne=`
`+_e[0],J=F+Ne.length;c._applyEdits({value:G.substring(0,F)+Ne+G.substring(H),selectionStart:J,selectionEnd:J})}}}else if(l.keyCode===YN||l.keyCode===qN||l.keyCode===JN||l.keyCode===XN){var Ye=void 0;l.keyCode===YN&&l.shiftKey?Ye=["(",")"]:l.keyCode===qN?l.shiftKey?Ye=["{","}"]:Ye=["[","]"]:l.keyCode===JN?l.shiftKey?Ye=['"','"']:Ye=["'","'"]:l.keyCode===XN&&!l.shiftKey&&(Ye=["`","`"]),F!==H&&Ye&&(l.preventDefault(),c._applyEdits({value:G.substring(0,F)+Ye[0]+G.substring(F,H)+Ye[1]+G.substring(H),selectionStart:F,selectionEnd:H+2}))}else(D_?l.metaKey&&l.keyCode===fh:l.ctrlKey&&l.keyCode===fh)&&!l.shiftKey&&!l.altKey?(l.preventDefault(),c._undoEdit()):(D_?l.metaKey&&l.keyCode===fh&&l.shiftKey:pH?l.ctrlKey&&l.keyCode===dH:l.ctrlKey&&l.keyCode===fh&&l.shiftKey)&&!l.altKey?(l.preventDefault(),c._redoEdit()):l.keyCode===lH&&l.ctrlKey&&(!D_||l.shiftKey)&&(l.preventDefault(),c.setState(function(en){return{capture:!en.capture}}))}},c._handleChange=function(l){var p=l.currentTarget,_=p.value,y=p.selectionStart,C=p.selectionEnd;c._recordChange({value:_,selectionStart:y,selectionEnd:C},!0),c.props.onValueChange(_)},c._history={stack:[],offset:-1},c._input=null,c}return s.prototype.componentDidMount=function(){this._recordCurrentState()},Object.defineProperty(s.prototype,"session",{get:function(){return{history:this._history}},set:function(c){this._history=c.history},enumerable:!1,configurable:!0}),s.prototype.render=function(){var c=this,l=this.props,p=l.value,_=l.style,y=l.padding,C=l.highlight,L=l.textareaId,U=l.textareaClassName,G=l.autoFocus,F=l.disabled,H=l.form,ne=l.maxLength,W=l.minLength,ie=l.name,Ie=l.placeholder,B=l.readOnly,P=l.required,M=l.onClick,j=l.onFocus,J=l.onBlur,Z=l.onKeyUp;l.onKeyDown,l.onValueChange,l.tabSize,l.insertSpaces,l.ignoreTabKey;var ce=l.preClassName,me=oH(l,["value","style","padding","highlight","textareaId","textareaClassName","autoFocus","disabled","form","maxLength","minLength","name","placeholder","readOnly","required","onClick","onFocus","onBlur","onKeyUp","onKeyDown","onValueChange","tabSize","insertSpaces","ignoreTabKey","preClassName"]),_e={paddingTop:typeof y=="object"?y.top:y,paddingRight:typeof y=="object"?y.right:y,paddingBottom:typeof y=="object"?y.bottom:y,paddingLeft:typeof y=="object"?y.left:y},Ne=C(p);return wd.createElement("div",Fn({},me,{style:Fn(Fn({},Nd.container),_)}),wd.createElement("pre",Fn({className:ce,"aria-hidden":"true",style:Fn(Fn(Fn({},Nd.editor),Nd.highlight),_e)},typeof Ne=="string"?{dangerouslySetInnerHTML:{__html:Ne+"<br />"}}:{children:Ne})),wd.createElement("textarea",{ref:function(Ye){return c._input=Ye},style:Fn(Fn(Fn({},Nd.editor),Nd.textarea),_e),className:Lh+(U?" ".concat(U):""),id:L,value:p,onChange:this._handleChange,onKeyDown:this._handleKeyDown,onClick:M,onKeyUp:Z,onFocus:j,onBlur:J,disabled:F,form:H,maxLength:ne,minLength:W,name:ie,placeholder:Ie,readOnly:B,required:P,autoFocus:G,autoCapitalize:"off",autoComplete:"off",autoCorrect:"off",spellCheck:!1,"data-gramm":!1}),wd.createElement("style",{dangerouslySetInnerHTML:{__html:fH}}))},s.defaultProps={tabSize:2,insertSpaces:!0,ignoreTabKey:!1,padding:0},s}(wd.Component),EH=MP.default=mH,Nd={container:{position:"relative",textAlign:"left",boxSizing:"border-box",padding:0,overflow:"hidden"},textarea:{position:"absolute",top:0,left:0,height:"100%",width:"100%",resize:"none",color:"inherit",overflow:"hidden",MozOsxFontSmoothing:"grayscale",WebkitFontSmoothing:"antialiased",WebkitTextFillColor:"transparent"},highlight:{position:"relative",pointerEvents:"none"},editor:{margin:0,border:0,background:"none",boxSizing:"inherit",display:"inherit",fontFamily:"inherit",fontSize:"inherit",fontStyle:"inherit",fontVariantLigatures:"inherit",fontWeight:"inherit",letterSpacing:"inherit",lineHeight:"inherit",tabSize:"inherit",textIndent:"inherit",textRendering:"inherit",textTransform:"inherit",whiteSpace:"pre-wrap",wordBreak:"keep-all",overflowWrap:"break-word"}},UP={exports:{}};(function(i){var s=typeof window<"u"?window:typeof WorkerGlobalScope<"u"&&self instanceof WorkerGlobalScope?self:{};/**
 * Prism: Lightweight, robust, elegant syntax highlighting
 *
 * @license MIT <https://opensource.org/licenses/MIT>
 * @author Lea Verou <https://lea.verou.me>
 * @namespace
 * @public
 */var c=function(l){var p=/(?:^|\s)lang(?:uage)?-([\w-]+)(?=\s|$)/i,_=0,y={},C={manual:l.Prism&&l.Prism.manual,disableWorkerMessageHandler:l.Prism&&l.Prism.disableWorkerMessageHandler,util:{encode:function P(M){return M instanceof L?new L(M.type,P(M.content),M.alias):Array.isArray(M)?M.map(P):M.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/\u00a0/g," ")},type:function(P){return Object.prototype.toString.call(P).slice(8,-1)},objId:function(P){return P.__id||Object.defineProperty(P,"__id",{value:++_}),P.__id},clone:function P(M,j){j=j||{};var J,Z;switch(C.util.type(M)){case"Object":if(Z=C.util.objId(M),j[Z])return j[Z];J={},j[Z]=J;for(var ce in M)M.hasOwnProperty(ce)&&(J[ce]=P(M[ce],j));return J;case"Array":return Z=C.util.objId(M),j[Z]?j[Z]:(J=[],j[Z]=J,M.forEach(function(me,_e){J[_e]=P(me,j)}),J);default:return M}},getLanguage:function(P){for(;P;){var M=p.exec(P.className);if(M)return M[1].toLowerCase();P=P.parentElement}return"none"},setLanguage:function(P,M){P.className=P.className.replace(RegExp(p,"gi"),""),P.classList.add("language-"+M)},currentScript:function(){if(typeof document>"u")return null;if("currentScript"in document&&1<2)return document.currentScript;try{throw new Error}catch(J){var P=(/at [^(\r\n]*\((.*):[^:]+:[^:]+\)$/i.exec(J.stack)||[])[1];if(P){var M=document.getElementsByTagName("script");for(var j in M)if(M[j].src==P)return M[j]}return null}},isActive:function(P,M,j){for(var J="no-"+M;P;){var Z=P.classList;if(Z.contains(M))return!0;if(Z.contains(J))return!1;P=P.parentElement}return!!j}},languages:{plain:y,plaintext:y,text:y,txt:y,extend:function(P,M){var j=C.util.clone(C.languages[P]);for(var J in M)j[J]=M[J];return j},insertBefore:function(P,M,j,J){J=J||C.languages;var Z=J[P],ce={};for(var me in Z)if(Z.hasOwnProperty(me)){if(me==M)for(var _e in j)j.hasOwnProperty(_e)&&(ce[_e]=j[_e]);j.hasOwnProperty(me)||(ce[me]=Z[me])}var Ne=J[P];return J[P]=ce,C.languages.DFS(C.languages,function(Ye,en){en===Ne&&Ye!=P&&(this[Ye]=ce)}),ce},DFS:function P(M,j,J,Z){Z=Z||{};var ce=C.util.objId;for(var me in M)if(M.hasOwnProperty(me)){j.call(M,me,M[me],J||me);var _e=M[me],Ne=C.util.type(_e);Ne==="Object"&&!Z[ce(_e)]?(Z[ce(_e)]=!0,P(_e,j,null,Z)):Ne==="Array"&&!Z[ce(_e)]&&(Z[ce(_e)]=!0,P(_e,j,me,Z))}}},plugins:{},highlightAll:function(P,M){C.highlightAllUnder(document,P,M)},highlightAllUnder:function(P,M,j){var J={callback:j,container:P,selector:'code[class*="language-"], [class*="language-"] code, code[class*="lang-"], [class*="lang-"] code'};C.hooks.run("before-highlightall",J),J.elements=Array.prototype.slice.apply(J.container.querySelectorAll(J.selector)),C.hooks.run("before-all-elements-highlight",J);for(var Z=0,ce;ce=J.elements[Z++];)C.highlightElement(ce,M===!0,J.callback)},highlightElement:function(P,M,j){var J=C.util.getLanguage(P),Z=C.languages[J];C.util.setLanguage(P,J);var ce=P.parentElement;ce&&ce.nodeName.toLowerCase()==="pre"&&C.util.setLanguage(ce,J);var me=P.textContent,_e={element:P,language:J,grammar:Z,code:me};function Ne(en){_e.highlightedCode=en,C.hooks.run("before-insert",_e),_e.element.innerHTML=_e.highlightedCode,C.hooks.run("after-highlight",_e),C.hooks.run("complete",_e),j&&j.call(_e.element)}if(C.hooks.run("before-sanity-check",_e),ce=_e.element.parentElement,ce&&ce.nodeName.toLowerCase()==="pre"&&!ce.hasAttribute("tabindex")&&ce.setAttribute("tabindex","0"),!_e.code){C.hooks.run("complete",_e),j&&j.call(_e.element);return}if(C.hooks.run("before-highlight",_e),!_e.grammar){Ne(C.util.encode(_e.code));return}if(M&&l.Worker){var Ye=new Worker(C.filename);Ye.onmessage=function(en){Ne(en.data)},Ye.postMessage(JSON.stringify({language:_e.language,code:_e.code,immediateClose:!0}))}else Ne(C.highlight(_e.code,_e.grammar,_e.language))},highlight:function(P,M,j){var J={code:P,grammar:M,language:j};if(C.hooks.run("before-tokenize",J),!J.grammar)throw new Error('The language "'+J.language+'" has no grammar.');return J.tokens=C.tokenize(J.code,J.grammar),C.hooks.run("after-tokenize",J),L.stringify(C.util.encode(J.tokens),J.language)},tokenize:function(P,M){var j=M.rest;if(j){for(var J in j)M[J]=j[J];delete M.rest}var Z=new F;return H(Z,Z.head,P),G(P,Z,M,Z.head,0),W(Z)},hooks:{all:{},add:function(P,M){var j=C.hooks.all;j[P]=j[P]||[],j[P].push(M)},run:function(P,M){var j=C.hooks.all[P];if(!(!j||!j.length))for(var J=0,Z;Z=j[J++];)Z(M)}},Token:L};l.Prism=C;function L(P,M,j,J){this.type=P,this.content=M,this.alias=j,this.length=(J||"").length|0}L.stringify=function P(M,j){if(typeof M=="string")return M;if(Array.isArray(M)){var J="";return M.forEach(function(Ne){J+=P(Ne,j)}),J}var Z={type:M.type,content:P(M.content,j),tag:"span",classes:["token",M.type],attributes:{},language:j},ce=M.alias;ce&&(Array.isArray(ce)?Array.prototype.push.apply(Z.classes,ce):Z.classes.push(ce)),C.hooks.run("wrap",Z);var me="";for(var _e in Z.attributes)me+=" "+_e+'="'+(Z.attributes[_e]||"").replace(/"/g,"&quot;")+'"';return"<"+Z.tag+' class="'+Z.classes.join(" ")+'"'+me+">"+Z.content+"</"+Z.tag+">"};function U(P,M,j,J){P.lastIndex=M;var Z=P.exec(j);if(Z&&J&&Z[1]){var ce=Z[1].length;Z.index+=ce,Z[0]=Z[0].slice(ce)}return Z}function G(P,M,j,J,Z,ce){for(var me in j)if(!(!j.hasOwnProperty(me)||!j[me])){var _e=j[me];_e=Array.isArray(_e)?_e:[_e];for(var Ne=0;Ne<_e.length;++Ne){if(ce&&ce.cause==me+","+Ne)return;var Ye=_e[Ne],en=Ye.inside,Vr=!!Ye.lookbehind,Gn=!!Ye.greedy,Ri=Ye.alias;if(Gn&&!Ye.pattern.global){var Fr=Ye.pattern.toString().match(/[imsuy]*$/)[0];Ye.pattern=RegExp(Ye.pattern.source,Fr+"g")}for(var ao=Ye.pattern||Ye,ge=J.next,Le=Z;ge!==M.tail&&!(ce&&Le>=ce.reach);Le+=ge.value.length,ge=ge.next){var Ve=ge.value;if(M.length>P.length)return;if(!(Ve instanceof L)){var Nt=1,mt;if(Gn){if(mt=U(ao,Le,P,Vr),!mt||mt.index>=P.length)break;var $n=mt.index,Lo=mt.index+mt[0].length,fn=Le;for(fn+=ge.value.length;$n>=fn;)ge=ge.next,fn+=ge.value.length;if(fn-=ge.value.length,Le=fn,ge.value instanceof L)continue;for(var Ci=ge;Ci!==M.tail&&(fn<Lo||typeof Ci.value=="string");Ci=Ci.next)Nt++,fn+=Ci.value.length;Nt--,Ve=P.slice(Le,fn),mt.index-=Le}else if(mt=U(ao,0,Ve,Vr),!mt)continue;var $n=mt.index,Ii=mt[0],ko=Ve.slice(0,$n),El=Ve.slice($n+Ii.length),Mc=Le+Ve.length;ce&&Mc>ce.reach&&(ce.reach=Mc);var jr=ge.prev;ko&&(jr=H(M,jr,ko),Le+=ko.length),ne(M,jr,Nt);var Op=new L(me,en?C.tokenize(Ii,en):Ii,Ri,Ii);if(ge=H(M,jr,Op),El&&H(M,ge,El),Nt>1){var Zn={cause:me+","+Ne,reach:Mc};G(P,M,j,ge.prev,Le,Zn),ce&&Zn.reach>ce.reach&&(ce.reach=Zn.reach)}}}}}}function F(){var P={value:null,prev:null,next:null},M={value:null,prev:P,next:null};P.next=M,this.head=P,this.tail=M,this.length=0}function H(P,M,j){var J=M.next,Z={value:j,prev:M,next:J};return M.next=Z,J.prev=Z,P.length++,Z}function ne(P,M,j){for(var J=M.next,Z=0;Z<j&&J!==P.tail;Z++)J=J.next;M.next=J,J.prev=M,P.length-=Z}function W(P){for(var M=[],j=P.head.next;j!==P.tail;)M.push(j.value),j=j.next;return M}if(!l.document)return l.addEventListener&&(C.disableWorkerMessageHandler||l.addEventListener("message",function(P){var M=JSON.parse(P.data),j=M.language,J=M.code,Z=M.immediateClose;l.postMessage(C.highlight(J,C.languages[j],j)),Z&&l.close()},!1)),C;var ie=C.util.currentScript();ie&&(C.filename=ie.src,ie.hasAttribute("data-manual")&&(C.manual=!0));function Ie(){C.manual||C.highlightAll()}if(!C.manual){var B=document.readyState;B==="loading"||B==="interactive"&&ie&&ie.defer?document.addEventListener("DOMContentLoaded",Ie):window.requestAnimationFrame?window.requestAnimationFrame(Ie):window.setTimeout(Ie,16)}return C}(s);i.exports&&(i.exports=c),typeof Jn<"u"&&(Jn.Prism=c)})(UP);var $N=UP.exports;Prism.languages.clike={comment:[{pattern:/(^|[^\\])\/\*[\s\S]*?(?:\*\/|$)/,lookbehind:!0,greedy:!0},{pattern:/(^|[^\\:])\/\/.*/,lookbehind:!0,greedy:!0}],string:{pattern:/(["'])(?:\\(?:\r\n|[\s\S])|(?!\1)[^\\\r\n])*\1/,greedy:!0},"class-name":{pattern:/(\b(?:class|extends|implements|instanceof|interface|new|trait)\s+|\bcatch\s+\()[\w.\\]+/i,lookbehind:!0,inside:{punctuation:/[.\\]/}},keyword:/\b(?:break|catch|continue|do|else|finally|for|function|if|in|instanceof|new|null|return|throw|try|while)\b/,boolean:/\b(?:false|true)\b/,function:/\b\w+(?=\()/,number:/\b0x[\da-f]+\b|(?:\b\d+(?:\.\d*)?|\B\.\d+)(?:e[+-]?\d+)?/i,operator:/[<>]=?|[!=]=?=?|--?|\+\+?|&&?|\|\|?|[?*/~^%]/,punctuation:/[{}[\];(),.:]/};Prism.languages.javascript=Prism.languages.extend("clike",{"class-name":[Prism.languages.clike["class-name"],{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$A-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\.(?:constructor|prototype))/,lookbehind:!0}],keyword:[{pattern:/((?:^|\})\s*)catch\b/,lookbehind:!0},{pattern:/(^|[^.]|\.\.\.\s*)\b(?:as|assert(?=\s*\{)|async(?=\s*(?:function\b|\(|[$\w\xA0-\uFFFF]|$))|await|break|case|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally(?=\s*(?:\{|$))|for|from(?=\s*(?:['"]|$))|function|(?:get|set)(?=\s*(?:[#\[$\w\xA0-\uFFFF]|$))|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)\b/,lookbehind:!0}],function:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*(?:\.\s*(?:apply|bind|call)\s*)?\()/,number:{pattern:RegExp(/(^|[^\w$])/.source+"(?:"+(/NaN|Infinity/.source+"|"+/0[bB][01]+(?:_[01]+)*n?/.source+"|"+/0[oO][0-7]+(?:_[0-7]+)*n?/.source+"|"+/0[xX][\dA-Fa-f]+(?:_[\dA-Fa-f]+)*n?/.source+"|"+/\d+(?:_\d+)*n/.source+"|"+/(?:\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\.\d+(?:_\d+)*)(?:[Ee][+-]?\d+(?:_\d+)*)?/.source)+")"+/(?![\w$])/.source),lookbehind:!0},operator:/--|\+\+|\*\*=?|=>|&&=?|\|\|=?|[!=]==|<<=?|>>>?=?|[-+*/%&|^!=<>]=?|\.{3}|\?\?=?|\?\.?|[~:]/});Prism.languages.javascript["class-name"][0].pattern=/(\b(?:class|extends|implements|instanceof|interface|new)\s+)[\w.\\]+/;Prism.languages.insertBefore("javascript","keyword",{regex:{pattern:RegExp(/((?:^|[^$\w\xA0-\uFFFF."'\])\s]|\b(?:return|yield))\s*)/.source+/\//.source+"(?:"+/(?:\[(?:[^\]\\\r\n]|\\.)*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}/.source+"|"+/(?:\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.|\[(?:[^[\]\\\r\n]|\\.)*\])*\])*\]|\\.|[^/\\\[\r\n])+\/[dgimyus]{0,7}v[dgimyus]{0,7}/.source+")"+/(?=(?:\s|\/\*(?:[^*]|\*(?!\/))*\*\/)*(?:$|[\r\n,.;:})\]]|\/\/))/.source),lookbehind:!0,greedy:!0,inside:{"regex-source":{pattern:/^(\/)[\s\S]+(?=\/[a-z]*$)/,lookbehind:!0,alias:"language-regex",inside:Prism.languages.regex},"regex-delimiter":/^\/|\/$/,"regex-flags":/^[a-z]+$/}},"function-variable":{pattern:/#?(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*[=:]\s*(?:async\s*)?(?:\bfunction\b|(?:\((?:[^()]|\([^()]*\))*\)|(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)\s*=>))/,alias:"function"},parameter:[{pattern:/(function(?:\s+(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*)?\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\))/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(^|[^$\w\xA0-\uFFFF])(?!\s)[_$a-z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*=>)/i,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/(\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*=>)/,lookbehind:!0,inside:Prism.languages.javascript},{pattern:/((?:\b|\s|^)(?!(?:as|async|await|break|case|catch|class|const|continue|debugger|default|delete|do|else|enum|export|extends|finally|for|from|function|get|if|implements|import|in|instanceof|interface|let|new|null|of|package|private|protected|public|return|set|static|super|switch|this|throw|try|typeof|undefined|var|void|while|with|yield)(?![$\w\xA0-\uFFFF]))(?:(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*\s*)\(\s*|\]\s*\(\s*)(?!\s)(?:[^()\s]|\s+(?![\s)])|\([^()]*\))+(?=\s*\)\s*\{)/,lookbehind:!0,inside:Prism.languages.javascript}],constant:/\b[A-Z](?:[A-Z_]|\dx?)*\b/});Prism.languages.insertBefore("javascript","string",{hashbang:{pattern:/^#!.*/,greedy:!0,alias:"comment"},"template-string":{pattern:/`(?:\\[\s\S]|\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}|(?!\$\{)[^\\`])*`/,greedy:!0,inside:{"template-punctuation":{pattern:/^`|`$/,alias:"string"},interpolation:{pattern:/((?:^|[^\\])(?:\\{2})*)\$\{(?:[^{}]|\{(?:[^{}]|\{[^}]*\})*\})+\}/,lookbehind:!0,inside:{"interpolation-punctuation":{pattern:/^\$\{|\}$/,alias:"punctuation"},rest:Prism.languages.javascript}},string:/[\s\S]+/}},"string-property":{pattern:/((?:^|[,{])[ \t]*)(["'])(?:\\(?:\r\n|[\s\S])|(?!\2)[^\\\r\n])*\2(?=\s*:)/m,lookbehind:!0,greedy:!0,alias:"property"}});Prism.languages.insertBefore("javascript","operator",{"literal-property":{pattern:/((?:^|[,{])[ \t]*)(?!\s)[_$a-zA-Z\xA0-\uFFFF](?:(?!\s)[$\w\xA0-\uFFFF])*(?=\s*:)/m,lookbehind:!0,alias:"property"}});Prism.languages.markup&&(Prism.languages.markup.tag.addInlined("script","javascript"),Prism.languages.markup.tag.addAttribute(/on(?:abort|blur|change|click|composition(?:end|start|update)|dblclick|error|focus(?:in|out)?|key(?:down|up)|load|mouse(?:down|enter|leave|move|out|over|up)|reset|resize|scroll|select|slotchange|submit|unload|wheel)/.source,"javascript"));Prism.languages.js=Prism.languages.javascript;Prism.languages.python={comment:{pattern:/(^|[^\\])#.*/,lookbehind:!0,greedy:!0},"string-interpolation":{pattern:/(?:f|fr|rf)(?:("""|''')[\s\S]*?\1|("|')(?:\\.|(?!\2)[^\\\r\n])*\2)/i,greedy:!0,inside:{interpolation:{pattern:/((?:^|[^{])(?:\{\{)*)\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}]|\{(?!\{)(?:[^{}])+\})+\})+\}/,lookbehind:!0,inside:{"format-spec":{pattern:/(:)[^:(){}]+(?=\}$)/,lookbehind:!0},"conversion-option":{pattern:/![sra](?=[:}]$)/,alias:"punctuation"},rest:null}},string:/[\s\S]+/}},"triple-quoted-string":{pattern:/(?:[rub]|br|rb)?("""|''')[\s\S]*?\1/i,greedy:!0,alias:"string"},string:{pattern:/(?:[rub]|br|rb)?("|')(?:\\.|(?!\1)[^\\\r\n])*\1/i,greedy:!0},function:{pattern:/((?:^|\s)def[ \t]+)[a-zA-Z_]\w*(?=\s*\()/g,lookbehind:!0},"class-name":{pattern:/(\bclass\s+)\w+/i,lookbehind:!0},decorator:{pattern:/(^[\t ]*)@\w+(?:\.\w+)*/m,lookbehind:!0,alias:["annotation","punctuation"],inside:{punctuation:/\./}},keyword:/\b(?:_(?=\s*:)|and|as|assert|async|await|break|case|class|continue|def|del|elif|else|except|exec|finally|for|from|global|if|import|in|is|lambda|match|nonlocal|not|or|pass|print|raise|return|try|while|with|yield)\b/,builtin:/\b(?:__import__|abs|all|any|apply|ascii|basestring|bin|bool|buffer|bytearray|bytes|callable|chr|classmethod|cmp|coerce|compile|complex|delattr|dict|dir|divmod|enumerate|eval|execfile|file|filter|float|format|frozenset|getattr|globals|hasattr|hash|help|hex|id|input|int|intern|isinstance|issubclass|iter|len|list|locals|long|map|max|memoryview|min|next|object|oct|open|ord|pow|property|range|raw_input|reduce|reload|repr|reversed|round|set|setattr|slice|sorted|staticmethod|str|sum|super|tuple|type|unichr|unicode|vars|xrange|zip)\b/,boolean:/\b(?:False|None|True)\b/,number:/\b0(?:b(?:_?[01])+|o(?:_?[0-7])+|x(?:_?[a-f0-9])+)\b|(?:\b\d+(?:_\d+)*(?:\.(?:\d+(?:_\d+)*)?)?|\B\.\d+(?:_\d+)*)(?:e[+-]?\d+(?:_\d+)*)?j?(?!\w)/i,operator:/[-+%=]=?|!=|:=|\*\*?=?|\/\/?=?|<[<=>]?|>[=>]?|[&|^~]/,punctuation:/[{}[\];(),.:]/};Prism.languages.python["string-interpolation"].inside.interpolation.inside.rest=Prism.languages.python;Prism.languages.py=Prism.languages.python;const _H=[{label:"C#",value:"1"},{label:"F#",value:"3"},{label:"Java",value:"4"},{label:"Python",value:"5"},{label:"C (gcc)",value:"6"},{label:"C++ (gcc)",value:"7"},{label:"Php",value:"8"},{label:"Haskell",value:"11"},{label:"Ruby",value:"12"},{label:"Perl",value:"13"},{label:"Lua",value:"14"},{label:"Nasm",value:"15"},{label:"Javascript",value:"17"},{label:"Go",value:"20"},{label:"Scala",value:"21"},{label:"D",value:"30"},{label:"Swift",value:"37"},{label:"Bash",value:"38"},{label:"Erlang",value:"40"},{label:"Elixir",value:"41"},{label:"Ocaml",value:"42"},{label:"Kotlin",value:"43"},{label:"Rust",value:"46"},{label:"Clojure",value:"47"},{label:"ATS",value:"48"},{label:"Cobol",value:"49"},{label:"Coffeescript",value:"50"},{label:"Crystal",value:"51"},{label:"Elm",value:"52"},{label:"Groovy",value:"53"},{label:"Idris",value:"54"},{label:"Julia",value:"55"},{label:"Mercury",value:"56"},{label:"Nim",value:"57"},{label:"Nix",value:"58"},{label:"Raku",value:"59"},{label:"TypeScript",value:"60"}];function gH(){const[i,s]=dr.useState(""),[c,l]=dr.useState(!1),[p,_]=dr.useState(!1),[y,C]=dr.useState(""),[L,U]=dr.useState("5"),[G,F]=dr.useState(""),H=async()=>{l(!0),F("");const Ie=new URLSearchParams;Ie.set("LanguageChoice",L),Ie.set("Program",y);const B={method:"POST",url:"https://code-compiler.p.rapidapi.com/v2",headers:{"content-type":"application/x-www-form-urlencoded","X-RapidAPI-Key":"c40e63ca05msh21cc53be5c61ed5p1be771jsnda85c9acad28","X-RapidAPI-Host":"code-compiler.p.rapidapi.com"},data:Ie};try{const P=await zN.request(B),M=P.data.Result,j=P.data.Errors;j?(s(j+`
`+M),F(j)):(s(M),F(""))}catch(P){console.error(P),F("Error compiling code. Please check your code and try again.")}l(!1)},ne=[{functionCode:`
    def fizz_buzz(n):
        result = []
        for i in range(1, n+1):
            if i % 3 == 0 and i % 5 == 0:
                result.append("FizzBuzz")
            elif i % 3 == 0:
                result.append("Fizz")
            elif i % 5 == 0:
                result.append("Buzz")
            else:
                result.append(str(i))
        return '
'.join(result)
  `,expectedOutput:`1
2
Fizz
4
Buzz
Fizz
7
8
Fizz
Buzz
11
Fizz
13
14
FizzBuzz
16
17
Fizz
19
Buzz
Fizz
22
23
Fizz
Buzz
26
Fizz
28
29
FizzBuzz
31
32
Fizz
34
Buzz
Fizz
37
38
Fizz
Buzz
41
Fizz
43
44
FizzBuzz
46
47
Fizz
49
Buzz
`}],W=async(Ie,B)=>{l(!0),F("");const P=new URLSearchParams;P.set("LanguageChoice",L),P.set("Program",Ie);const M={method:"POST",url:"https://code-compiler.p.rapidapi.com/v2",headers:{"content-type":"application/x-www-form-urlencoded","X-RapidAPI-Key":"c40e63ca05msh21cc53be5c61ed5p1be771jsnda85c9acad28","X-RapidAPI-Host":"code-compiler.p.rapidapi.com"},data:P};try{const j=await zN.request(M),J=j.data.Result,Z=j.data.Errors;return l(!1),Z?(F(Z),"Test Failed!"):J===B?"Test Passed!":"Test Failed!"}catch(j){return console.error(j),F("Error compiling code. Please check your code and try again."),l(!1),"Test Failed!"}},ie=async()=>{_(!0);const Ie=ne[0],P=await W(y,Ie.expectedOutput);if(P==="Test Failed!"){F(!0);const M=`${P}

Expected Output:
${Ie.expectedOutput}`;s(M),_(!1)}else{const M=`${P}

Your Output:
${Ie.expectedOutput}`;s(M),_(!1)}};return Lt.jsxs("div",{children:[Lt.jsx("h2",{className:"compiler-title",children:"Code Compiler"}),Lt.jsxs("div",{style:{display:"flex",gap:"10px"},children:["  ",Lt.jsx("div",{className:"input",children:Lt.jsx(EH,{value:y,onValueChange:Ie=>C(Ie),highlight:Ie=>$N.highlight(Ie,$N.languages.python),padding:10,style:{fontFamily:'"Fira code", "Fira Mono", monospace',fontSize:14,color:"gray",height:"100%",backgroundColor:"#171717"}})}),Lt.jsx("textarea",{className:"output",id:"output",name:"output",readOnly:!0,value:i,style:{fontFamily:'"Fira code", "Fira Mono", monospace',fontSize:14,color:G?"red":"black",backgroundColor:G?"#ffebeb":"white"}})]}),Lt.jsxs("div",{className:"language-selector",children:[Lt.jsx("label",{style:{color:"white"},children:"Choose a programming language:"}),Lt.jsx("select",{value:L,onChange:Ie=>U(Ie.target.value),children:_H.map(Ie=>Lt.jsx("option",{value:Ie.value,children:Ie.label},Ie.value))})]}),Lt.jsx("div",{className:"language-buttons-container",children:Lt.jsxs("center",{children:[Lt.jsx("button",{type:"button",className:"CompileSubmitButton",onClick:H,disabled:c,children:c?"Compiling...":"Compile"}),Lt.jsx("button",{type:"button",className:"CompileSubmitButton",onClick:ie,disabled:p,children:p?"Submitting...":"Submit"})]})})]})}function SH(){const[i,s]=dr.useState(!1);return y3.useState(`function add(a, b) {
  return a + b;
}`),Lt.jsxs("div",{className:"App",children:[Lt.jsx("h1",{children:"TeqPro Virtual Call"}),i?Lt.jsxs("div",{className:"container",children:[Lt.jsx("div",{className:"video-container",children:Lt.jsx(VW,{})}),Lt.jsx("div",{className:"code-compiler-container",children:Lt.jsx(gH,{})})]}):Lt.jsx("button",{onClick:()=>s(!0),children:"Join Room"})]})}P_.createRoot(document.getElementById("root")).render(Lt.jsx(SH,{}));
